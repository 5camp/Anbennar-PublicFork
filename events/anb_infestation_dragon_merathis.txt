namespace = infestation_dragon_merathis

# for testing, use event infestation_dragon_merathis.0 to force spawn in one of your provinces

# notes on dragons:
# dragons can have three opinions of their host country:
#  - hostile - will actively raid
#  - neutral - minds its own business, rare raids
#  - friendly - beneficial to host, raids only neighbours with low opinion
# a dragon maintains a hoard, which can be won by those that defeat it
# kobold minions are attracted as a racial minority
# dragon+kobolds can rebel, with demands for loot
# dragons are named monsters, and can only exist once per dragon per game

# possible flags and province modifiers
# infestation_present - flag
# infestation_dragon_hostile, infestation_dragon_neutral, infestation_dragon_friendly - prov modifiers
# infestation_dragon_merathis - prov modifier for effects that are specific to this named dragon
# infestation_dragon_merathis_hoard - keeps track of hoard size
# infestation_dragon_leveraged_hoard - country modifier, if you decided to leverage the hoard in .201

# spawn dragon merathis infestation in this province and start event loop
province_event = {
    id = infestation_dragon_merathis.0
    title = infestation_dragon_merathis.0.t
    desc = infestation_dragon_merathis.0.d
    picture = CAVE_eventPicture
    goto = ROOT
    
    hidden = yes
    is_triggered_only = yes
    
    immediate = {
        hidden_effect = {
            set_province_flag = infestation_present # important; or event loop will exit
        }
    }
    
    option = {
        ai_chance = { factor = 100 }
        add_province_modifier = {
            name = infestation_dragon_neutral
            duration = -1  
            desc = infestation_dragon_neutral_tooltip
        }
        add_province_modifier = {
            name = infestation_dragon_merathis
            duration = -1  
            desc = infestation_dragon_merathis_tooltip
        }
        set_variable = {
            which = infestation_dragon_merathis_hoard 
            value = 0 # start with nothing in their hoard
        }
        province_event = { id = infestation_dragon_merathis.100 days = 1 } # spawn response event
    }
    after = {
        # first event in half a year, ish; start event loop
        province_event = { id = infestation_dragon_merathis.1 days = 100 random = 100 }
    }
}

# random event dispatcher, on a loop until infestation_present is removed
province_event = {
    id = infestation_dragon_merathis.1
    title = infestation_dragon_merathis.1.t
    desc = infestation_dragon_merathis.1.d
    picture = CAVE_eventPicture
    goto = ROOT
    
    hidden = yes
    is_triggered_only = yes
    

    trigger = {
        has_province_flag = infestation_present
        OR = { 
            has_province_modifier = infestation_dragon_friendly
            has_province_modifier = infestation_dragon_neutral
            has_province_modifier = infestation_dragon_hostile
        }
        has_province_modifier = infestation_dragon_merathis
    }

    option = {
        # vanish; only happens if neutral opinion - should be rare
        trigger = { has_province_modifier = infestation_dragon_neutral }
        ai_chance = { factor = 1 }
        province_event = { id = infestation_dragon_merathis.101 }
    }
        
    option = {
        # migrate internally - if better terrain exists
        trigger = {
            NOT = { 
                OR = {
                    has_terrain = mountain
                    has_terrain = cavern
                    has_terrain = dwarven_hold
                    has_terrain = dwarven_hold_surface
                }
            }
            any_owned_province = {
                OR = {
                    has_terrain = mountain
                    has_terrain = cavern
                    has_terrain = dwarven_hold
                    has_terrain = dwarven_hold_surface
                }
            }
        }
        ai_chance = { factor = 1 }
        province_event = { id = infestation_dragon_merathis.110 }
    }
    
    option = {
        # migrate out of country
        trigger = {
            NOT = { has_province_modifier = infestation_dragon_friendly }
        }
        ai_chance = { 
            factor = 1 
        }
        province_event = { id = infestation_dragon_merathis.111 }
    }

    option = {
        # banish (migrate to random neighbour)
        trigger = {
            NOT = { has_province_modifier = infestation_dragon_friendly }
        }
        ai_chance = { 
            factor = 1
            modifier = {
                factor = 3 # more likely if generous quest rewards/adverturer nation
                OR = {
                    owner = { has_estate_privilege = estate_adventurers_generous_quest_rewards }
                    owner = { has_reform = adventurer }
                }
            }
        }
        province_event = { id = infestation_dragon_merathis.115 }
    }
    
    option = {
        # devastation/looting - neutral version. See .210 and .211 for the fun versions
        trigger = { has_province_modifier = infestation_dragon_neutral }
        ai_chance = { factor = 1 }
        province_event = { id = infestation_dragon_merathis.140 }
    }
    
    after = {
        # loop this random event dispatcher
        # about a year between events
        province_event = { id = infestation_dragon_merathis.1 days = 300 random = 100 }
    }
}

# notification of Dragon spawning, major event!
province_event = {
    id = infestation_dragon_merathis.100
    title = infestation_dragon_merathis.100.t
    desc = infestation_dragon_merathis.100.d
    picture = CAVE_eventPicture
    goto = ROOT
    
    hidden = no
    major = yes
    major_trigger = {
        capital_scope = {
            continent = europe # cannor
        }
    }
    is_triggered_only = yes
    
    option = {
        # "Perhaps we can befriend it?"
        name = infestation_dragon_merathis.100.a
        ai_chance = { factor = 50 }
    }
    option = {
        # "Grant adventurers Generous Quest Rewards to deal with it."
        name = infestation_dragon_merathis.100.b
        ai_chance = { 
            factor = 20 
            modifier = {
                factor = 0
                owner = { is_in_deficit = yes }
            }
        }
        trigger = {
            owner = { has_estate = estate_adventurers }
            owner = { NOT = { has_estate_privilege = estate_adventurers_generous_quest_rewards } }
        }
        owner = { set_estate_privilege = estate_adventurers_generous_quest_rewards }
    }
    option = {
        # "This is why the adventurers have such Generous Quest Rewards."
        name = infestation_dragon_merathis.100.c
        ai_chance = { factor = 50 }
        trigger = {
            owner = { has_estate = estate_adventurers }
            owner = { has_estate_privilege = estate_adventurers_generous_quest_rewards }
        }
    }
    option = {
        # "We are a country of adventurers! We shall deal with this dragon!"
        name = infestation_dragon_merathis.100.e
        ai_chance = { factor = 50 }
        trigger = {
            owner = { has_reform = adventurer }
        }
    }
}

# dragon vanishes on its own
province_event = {
    id = infestation_dragon_merathis.101
    title = infestation_dragon_merathis.101.t
    desc = infestation_dragon_merathis.101.d
    picture = CAVE_eventPicture
    goto = ROOT
    
    hidden = no
    is_triggered_only = yes
    
    trigger = {
        has_province_flag = infestation_present
        has_province_modifier = infestation_dragon_neutral
        has_province_modifier = infestation_dragon_merathis
    }
    
    option = {
        # Quick, her hoard is there for the taking!
        name = infestation_dragon_merathis.101.a
        ai_chance = { factor = 100 }
        remove_province_modifier = infestation_dragon_merathis
        remove_province_modifier = infestation_dragon_neutral
        clr_province_flag = infestation_present
    }
    after = {
        hidden_effect = {
            province_event = { id = infestation_dragon_merathis.201 days = 30 } # deal with hoard
        }
    }
}

# infestation migrates to another province internally event; if better terrain for lair
province_event = {
    id = infestation_dragon_merathis.110
    title = infestation_dragon_merathis.110.t
    desc = infestation_dragon_merathis.110.d
    picture = CAVE_eventPicture
    goto = ROOT
    
    hidden = yes
    is_triggered_only = yes
    
    trigger = {
        owner = { 
            num_of_cities = 2 # you have something to migrate to
            any_owned_province = {
                OR = {
                    has_terrain = mountain
                    has_terrain = cavern
                    has_terrain = dwarven_hold
                    has_terrain = dwarven_hold_surface
                }
                NOT = { has_province_flag = infestation_present }
            }
        }
    }
    
    immediate = {
        hidden_effect = {
            random_owned_province = {
                limit = {
                    OR = {
                        has_terrain = mountain
                        has_terrain = cavern
                        has_terrain = dwarven_hold
                        has_terrain = dwarven_hold_surface
                    }
                }
                save_event_target_as = infestation_migration_target
            }
            event_target:infestation_migration_target = {
                set_province_flag = infestation_present
                add_province_modifier = {
                    name = infestation_dragon_merathis
                    duration = -1  
                    desc = infestation_dragon_merathis_tooltip
                }
            }
            remove_province_modifier = infestation_dragon_merathis
            clr_province_flag = infestation_present
        }
    }
    option = {
        name = infestation_dragon_merathis.110.a
        ai_chance = { factor = 100 }
        goto = infestation_migration_target
        trigger = {
            has_province_modifier = infestation_dragon_friendly
        }
        event_target:infestation_migration_target = {
            add_province_modifier = {
                name = infestation_dragon_friendly
                duration = -1  
                desc = infestation_dragon_friendly_tooltip
            }
        }
        remove_province_modifier = infestation_dragon_friendly
    }    
    option = {
        name = infestation_dragon_merathis.110.b
        ai_chance = { factor = 100 }
        goto = infestation_migration_target
        trigger = {
            has_province_modifier = infestation_dragon_neutral
        }
        event_target:infestation_migration_target = {
            add_province_modifier = {
                name = infestation_dragon_neutral
                duration = -1  
                desc = infestation_dragon_neutral_tooltip
            }
        }
        remove_province_modifier = infestation_dragon_neutral
    }    
    option = {
        name = infestation_dragon_merathis.110.c
        ai_chance = { factor = 100 }
        goto = infestation_migration_target
        trigger = {
            has_province_modifier = infestation_dragon_hostile
        }
        event_target:infestation_migration_target = {
            add_province_modifier = {
                name = infestation_dragon_hostile
                duration = -1  
                desc = infestation_dragon_hostile_tooltip
            }
        }
        remove_province_modifier = infestation_dragon_hostile
    }    
    
    after = {
        # first event in a year, ish
        event_target:infestation_migration_target = {
            province_event = { id = infestation_dragon_merathis.1 days = 300 random = 100 }
        }
    }
}

# dragon seeks out a superior home outside the country
province_event = {
    id = infestation_dragon_merathis.111
    title = infestation_dragon_merathis.111.t
    desc = infestation_dragon_merathis.111.d
    picture = CAVE_eventPicture
    goto = ROOT
    
    hidden = no
    is_triggered_only = yes
    
    trigger = {
        NOT = { has_province_modifier = infestation_dragon_friendly }
    }
    
    immediate = {
        hidden_effect = {
            # set migration target, starting at least desirable and working upwards
            random_province = {
                limit = {
                    continent = europe # cannorian dragon
                    OR = {
                        has_terrain = mountain
                        has_terrain = cavern
                        has_terrain = dwarven_hold
                        has_terrain = dwarven_hold_surface
                    }
                }
                save_event_target_as = infestation_migration_target
            }
            random_province = {
                limit = {
                    continent = europe # cannorian dragon
                    owner = {
                        OR = {
                            high_tolerance_kobold_race_trigger = yes
                            has_kobold_accepted_culture = yes
                            tag = A33 # verne, due to wyverns
                            tag = B31 # castellyr, would apparently like them too
                            tag = B32 # castanor, due to dragon on flag
                            tag = Z34 # black castanor, likewise
                        }
                    }
                }
                save_event_target_as = infestation_migration_target
            }
            event_target:infestation_migration_target = {
                set_province_flag = infestation_present
            }
            clr_province_flag = infestation_present
        }
    }
    
    option = {
        name = infestation_dragon_merathis.111.a
        ai_chance = { factor = 100 }
        goto = infestation_migration_target
        event_target:infestation_migration_target = {
            add_province_modifier = {
                name = infestation_dragon_neutral
                duration = -1  
                desc = infestation_dragon_neutral_tooltip
            }
            add_province_modifier = {
                name = infestation_dragon_merathis
                duration = -1  
                desc = infestation_dragon_merathis_tooltip
            }
        }
        remove_province_modifier = infestation_dragon_neutral
        remove_province_modifier = infestation_dragon_hostile
        remove_province_modifier = infestation_dragon_merathis
    }
 
    after = {
        event_target:infestation_migration_target = {
            province_event = { id = infestation_dragon_merathis.112 }
        }
    }
}

# dragon migrated across our border into this province
# basically the same as infestation_dragon_merathis.100
# except the dragon chose to come here, because it is a superior lair or the country is friendly
province_event = {
    id = infestation_dragon_merathis.112
    title = infestation_dragon_merathis.112.t
    desc = infestation_dragon_merathis.112.d
    picture = CAVE_eventPicture
    goto = ROOT
    
    hidden = no
    is_triggered_only = yes
    
    immediate = {
        hidden_effect = {
            export_to_variable = {
                which = infestation_dragon_gift_size
                value = monthly_income
                who = ROOT
            }
            multiply_variable = {
                which = infestation_dragon_gift_size
                value = -1
            }
        }
    }
    
    option = {
        # how wonderful, send her a welcoming gift
        name = infestation_dragon_merathis.112.a
        ai_chance = { 
            factor = 50 
            modifier = {
                factor = 2
                owner = { 
                    OR = {
                        high_tolerance_kobold_race_trigger = yes
                        has_kobold_accepted_culture = yes
                        tag = A33 # verne, due to wyverns
                        tag = B31 # castellyr, would apparently like them too
                        tag = B32 # castanor, due to dragon on flag
                        tag = Z34 # black castanor, likewise
                    }
                }
            }
        }
        add_treasury = infestation_dragon_gift_size
        hidden_effect = {
            subtract_variable = { # subtracting a negative -> adding!
                which = infestation_dragon_merathis_hoard
                value = infestation_dragon_gift_size
            }
        }
        random = { 
            chance = 10 
            hidden_effect = { remove_province_modifier = infestation_dragon_neutral }
            add_province_modifier = infestation_dragon_friendly
        }
    }
    option = {
        # we cannot afford a dragon
        name = infestation_dragon_merathis.112.b
        ai_chance = { 
            factor = 50 
            modifier = {
                factor = 2
                owner = { 
                    OR = {
                        is_in_deficit = yes
                        num_of_loans = 1
                    }
                }
            }
        }
        random = { 
            chance = 10 
            hidden_effect = { remove_province_modifier = infestation_dragon_neutral }
            add_province_modifier = infestation_dragon_hostile
        }
    }

    after = {
        # first event in half a year, ish
        province_event = { id = infestation_dragon_merathis.1 days = 100 random = 100 }
    }
}

# banished (migrate to a neighbour at random) - similar to .111 except dragon 
# has no choice in landing province, and receiving country less likely to be happy
# about us sending them our unwanted dragon
province_event = {
    id = infestation_dragon_merathis.115
    title = infestation_dragon_merathis.115.t
    desc = infestation_dragon_merathis.115.d
    picture = CAVE_eventPicture
    goto = ROOT
    
    hidden = no
    is_triggered_only = yes
        
    trigger = {
        NOT = { has_province_modifier = infestation_dragon_friendly }
        owner = {
            any_neighbor_country = {
                any_owned_province = {
                    NOT = { has_province_flag = infestation_present }
                }
            }
        }
    }
    
    immediate = {
        hidden_effect = {
            owner = {
                random_neighbor_country = {
                    limit = {
                        any_owned_province = {
                                NOT = { has_province_flag = infestation_present }
                        }
                    }
                    save_event_target_as = infestation_migration_country_target
                }
            }
            event_target:infestation_migration_country_target = {
                random_owned_province = {
                    limit = { NOT = { has_province_flag = infestation_present } }
                    save_event_target_as = infestation_migration_target
                }
            }
            event_target:infestation_migration_target = {
                set_province_flag = infestation_present
            }
            clr_province_flag = infestation_present
        }
    }
    
    option = {
        # their problem now
        name = infestation_dragon_merathis.115.a
        ai_chance = { factor = 100 }
        goto = infestation_migration_target
        event_target:infestation_migration_target = {
            add_province_modifier = {
                name = infestation_dragon_neutral
                duration = -1  
                desc = infestation_dragon_neutral_tooltip
            }
            add_province_modifier = {
                name = infestation_dragon_merathis
                duration = -1  
                desc = infestation_dragon_merathis_tooltip
            }
        }
        remove_province_modifier = infestation_dragon_neutral
        remove_province_modifier = infestation_dragon_hostile
        remove_province_modifier = infestation_dragon_merathis
        if = {
            limit = { owner = { has_estate_privilege = estate_adventurers_generous_quest_rewards } }
            owner = {
                add_estate_influence_modifier = {
                    estate = estate_adventurers
                    desc = handled_infestation
                    duration = 3650
                    influence = 5
                }
            }
        }
        # new owner of dragon is unlikely to be happy, except if...
        if = {
            limit = {
                event_target:infestation_migration_target = {
                    owner = {
                        NOT = {
                            OR = {
                                high_tolerance_kobold_race_trigger = yes
                                has_kobold_accepted_culture = yes
                                tag = A33 # verne, due to wyverns
                                tag = B31 # castellyr, would apparently like them too
                                tag = B32 # castanor, due to dragon on flag
                                tag = Z34 # black castanor, likewise
                            }
                        }
                    }
                }
            }
            event_target:infestation_migration_target = {
                owner = {
                    add_opinion = {
                        who = ROOT
                        modifier = infestation_crossed_border
                    }
                }
            }
        }
    }
    
    after = {
        event_target:infestation_migration_target = {
            province_event = { id = infestation_dragon_merathis.112 }
        }
    }
}

# devastation/looting - neutral version. See .210 and .211 for the fun versions with diplo effects
province_event = {
    id = infestation_dragon_merathis.140
    title = infestation_dragon_merathis.140.t
    desc = infestation_dragon_merathis.140.d
    picture = COMET_SIGHTED_eventPicture
    goto = ROOT
    
    hidden = no
    is_triggered_only = yes
    
    immediate = {
        hidden_effect = {
            save_event_target_as = infestation_dragon_raid_target # in case there's no neighbour
            # select any random province
            random_neighbor_province = {
                save_event_target_as = infestation_dragon_raid_target
            }
            # but prefer one with loot
            random_neighbor_province = {
                limit = {
                    is_looted = no
                }
                save_event_target_as = infestation_dragon_raid_target
            }
            # calculate loot amount = ~ province dev*5
            export_to_variable = {
                which = infestation_dragon_raid_amount
                value = development
                who = event_target:infestation_dragon_raid_target
            }
            multiply_variable = {
                which = infestation_dragon_raid_amount
                value = 5
            }
        }
    }

    option = {
        # turn a blind eye
        name = infestation_dragon_merathis.140.a
        ai_chance = { factor = 50 }
        trigger = { owned_by = ROOT }
        goto = event_target:infestation_dragon_raid_target
        event_target:infestation_dragon_raid_target = {
            add_devastation = 5
            remove_loot = {
                who = REB # hoping this works!
                amount = infestation_dragon_raid_amount
            }
            change_variable = {
                which = infestation_dragon_merathis_hoard
                value = infestation_dragon_raid_amount
            }
        }
        random = { # sometimes, by turning a blind eye, we can make her friendly
            chance = 5 
            hidden_effect = { remove_province_modifier = infestation_dragon_neutral }
            add_province_modifier = infestation_dragon_friendly
        }
    }
    option = {
        # "Attack the dragon with everything we have!"
        name = infestation_dragon_merathis.140.b
        ai_chance = { factor = 50 }
        add_devastation = 10
    }
    option = {
        # "Time for the adventurers to shine"
        name = infestation_dragon_merathis.140.b
        ai_chance = { factor = 50 }
        add_devastation = 10
    }
    option = {
        # "we must control her" <- get claim if not ROOT
        name = infestation_dragon_merathis.140.b
        ai_chance = { factor = 50 }
        add_devastation = 10
    }
}



# deal with dragon hoard; dragon is dead/vanished
province_event = {
    id = infestation_dragon_merathis.201
    title = infestation_dragon_merathis.201.t
    desc = infestation_dragon_merathis.201.d
    picture = CAVE_eventPicture
    goto = ROOT
    
    hidden = no
    is_triggered_only = yes
    
    trigger = {
    }
    
    immediate = {
        # we need to set some targets for one option. This is a cascade, selecting
        # three targets, first by opinion, then replacing them with better options
        # if there are allies/subjects/overlords available
        hidden_effect = {
            random_country = {
                limit = {
                    has_opinion = {
                        who = ROOT
                        value = 100
                    }
                }
                save_event_target_as = infestation_dragon_hoard_friend_target1
            }
        }
        hidden_effect = {
            random_country = {
                limit = {
                    has_opinion = {
                        who = ROOT
                        value = 50
                    }
                    NOT = { tag = event_target:infestation_dragon_hoard_friend_target1 }
                }
                save_event_target_as = infestation_dragon_hoard_friend_target2
            }
        }
        hidden_effect = {
            random_country = {
                limit = {
                    has_opinion = {
                        who = ROOT
                        value = 25
                    }
                    NOT = { tag = event_target:infestation_dragon_hoard_friend_target1 }
                    NOT = { tag = event_target:infestation_dragon_hoard_friend_target2 }
                }
                save_event_target_as = infestation_dragon_hoard_friend_target3
            }
        }
        hidden_effect = {
            random_country = {
                limit = {
                    has_opinion = {
                        who = ROOT
                        value = 100
                    }
                    OR = {
                        alliance_with = ROOT
                        overlord_of = ROOT
                        is_subject_of = ROOT
                    }
                    NOT = { tag = event_target:infestation_dragon_hoard_friend_target2 }
                    NOT = { tag = event_target:infestation_dragon_hoard_friend_target3 }
                }
                save_event_target_as = infestation_dragon_hoard_friend_target1
            }
        }
        hidden_effect = {
            random_country = {
                limit = {
                    has_opinion = {
                        who = ROOT
                        value = 50
                    }
                    OR = {
                        alliance_with = ROOT
                        overlord_of = ROOT
                        is_subject_of = ROOT
                    }
                    NOT = { tag = event_target:infestation_dragon_hoard_friend_target1 }
                    NOT = { tag = event_target:infestation_dragon_hoard_friend_target3 }
                }
                save_event_target_as = infestation_dragon_hoard_friend_target2
            }
        }
        hidden_effect = {
            random_country = {
                limit = {
                    has_opinion = {
                        who = ROOT
                        value = 25
                    }
                    OR = {
                        alliance_with = ROOT
                        overlord_of = ROOT
                        is_subject_of = ROOT
                    }
                    NOT = { tag = event_target:infestation_dragon_hoard_friend_target1 }
                    NOT = { tag = event_target:infestation_dragon_hoard_friend_target2 }
                }
                save_event_target_as = infestation_dragon_hoard_friend_target3
            }
        } 
    }
    
    option = {
        # claim the hoard
        name = infestation_dragon_merathis.201.a
        ai_chance = { factor = 50 }
        custom_tooltip = infestation_dragon_merathis.201.a.tooltip
        hidden_effect = {
            while = {
                limit = {
                    check_variable = {
                        which = infestation_dragon_merathis_hoard
                        value = 40
                    }
                }
                owner = { add_treasury = 40 }
                change_variable = {
                    which = infestation_dragon_merathis_hoard
                    value = -40
                }
            }
        }
    }
    option = {
        # share the wealth - send some to allies/subjects for opinion bonuses
        name = infestation_dragon_merathis.201.b
        ai_chance = { factor = 50 }
        custom_tooltip = infestation_dragon_merathis.201.b.tooltip
        event_target:infestation_dragon_hoard_friend_target1 = {
            add_historical_friend = ROOT
        }
        event_target:infestation_dragon_hoard_friend_target2 = {
            add_historical_friend = ROOT
        }
        event_target:infestation_dragon_hoard_friend_target3 = {
            add_historical_friend = ROOT
        }
        hidden_effect = {
            while = {
                limit = {
                    check_variable = {
                        which = infestation_dragon_merathis_hoard
                        value = 40
                    }
                }
                owner = { add_treasury = 10 }
                event_target:infestation_dragon_hoard_friend_target1 = {
                    add_treasury = 10
                }
                event_target:infestation_dragon_hoard_friend_target2 = {
                    add_treasury = 10
                }
                event_target:infestation_dragon_hoard_friend_target3 = {
                    add_treasury = 10
                }
                change_variable = {
                    which = infestation_dragon_merathis_hoard
                    value = -40
                }
            }
        }
    }
    option = {
        # reward the adventurers - permanent bonus to adventurers estate
        name = infestation_dragon_merathis.201.c
        trigger = { owner = { has_estate_privilege = estate_adventurers_generous_quest_rewards }  }
        ai_chance = { factor = 50 }
        custom_tooltip = infestation_dragon_merathis.201.c.tooltip
        hidden_effect = {
            while = {
                limit = {
                    check_variable = {
                        which = infestation_dragon_merathis_hoard
                        value = 40
                    }
                }
                owner = { add_treasury = 20 } # only gain 1/2 of value
                change_variable = {
                    which = infestation_dragon_merathis_hoard
                    value = -40
                }
            }
        }
        owner = {
            add_estate_influence_modifier = {
                estate = estate_adventurers
                desc = infestation_dragon_adventurers_reward
                duration = -1
                influence = 10
            }
            add_estate_loyalty = {
                estate = estate_adventurers
                loyalty = 10
            }
        }
    }
    option = {
        # leverage the asset - gain permanent modifiers for loans/interest/inflation
        name = infestation_dragon_merathis.201.e
        ai_chance = { factor = 50 }
        owner = {
            add_country_modifier = {
                name = infestation_dragon_leveraged_hoard
                duration = -1  
                desc = infestation_dragon_leveraged_hoard_tooltop
            }
        }
    }
    after = {
        set_variable = {
            which = infestation_dragon_merathis_hoard
            value = 0
        }
    }
}

# cleanup event; wipes all trace of this infestation from the province
# this is useful for debugging
# note this clears hoard value and the global flag allowing merathis to spawn again
province_event = {
    id = infestation_dragon_merathis.2000
    title = infestation_dragon_merathis.2000.t
    desc = infestation_dragon_merathis.2000.d
    picture = CAVE_eventPicture
    goto = ROOT
    
    hidden = yes
    is_triggered_only = yes
    
    option = {
        # cleanup; hidden
        name = infestation_dragon_merathis.2000.a
        ai_chance = { factor = 100 }
        remove_province_modifier = infestation_dragon_friendly
        remove_province_modifier = infestation_dragon_neutral
        remove_province_modifier = infestation_dragon_hostile
        remove_province_modifier = infestation_dragon_merathis
        remove_country_modifier = infestation_dragon_leveraged_hoard
        set_variable = {
            which = infestation_dragon_merathis_hoard
            value = 0
        }
        clr_province_flag = infestation_present
        clr_global_flag = infestation_dragon_merathis_spawned
    }
}
