
namespace = patrons_on_action
#Coded by RubedoFox

# # Succession-style spirit patrons, activates patron selection without magical project, ONLY TRIGGER THIS VIA GOVERNMENT REFORMS IT IS VERY POWERFUL
country_event = {
	id =  patrons_on_action.1
	title =  patrons_on_action.1.t
	desc =  patrons_on_action.1.d
	picture = FAMINE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		always = yes
	}
	
	option = {	#Find a patron
		name = patrons_on_action.1.a
		ai_chance = { factor = 100 }
		country_event = { id = patrons_on_action.2 } #patron trials
		clr_ruler_flag = spirit_patron_delayed
	}
	
	option = {	#Wait a bit
		name = patrons_on_action.1.b
		ai_chance = { factor = 0 }
		set_ruler_flag = spirit_patron_delayed
	}
}

country_event = { #Patron Choice
	id = patrons_on_action.2
	title = patrons_on_action.2.t
	desc = patrons_on_action.2.d
	picture = COURT_eventPicture
	
	is_triggered_only = yes
	
	option = { #Trial of the Fox
		name = patrons_on_action.2.a
		ai_chance = {
			factor = 50
			modifier = {
				factor = 5
				OR = {
					ruler_has_personality = sinner_personality
					ruler_has_personality = free_thinker_personality
					ruler_has_personality = intricate_web_weaver_personality
					ruler_has_personality = secretive_personality
				}
			}
		}
		random_list = {
			# Succeed
			1 = {
				modifier = {
					factor = 4
					ruler_has_personality = free_thinker_personality
				}
				modifier = {
					factor = 4
					ruler_has_personality = intricate_web_weaver_personality
				}
				modifier = {
					factor = 4
					ruler_has_personality = secretive_personality
				}
				modifier = {
					factor = 2
					ruler_has_personality = sinner_personality
				}
				if = {
					limit = {
						culture_group = odheongun
					}
					set_ruler_flag = gumiho_patron
					set_ruler_flag = patron_favored_enchantment
					set_ruler_flag = patron_favored_illusion
					set_ruler_flag = patron_disfavored_abjuration
					set_ruler_flag = patron_disfavored_evocation
					custom_tooltip = gumiho.d
				}
				else_if = {
					limit = {
						culture_group = yan
					}
					set_ruler_flag = huli_jing_patron
					set_ruler_flag = patron_favored_enchantment
					set_ruler_flag = patron_favored_illusion
					set_ruler_flag = patron_disfavored_divination
					set_ruler_flag = patron_disfavored_necromancy
					custom_tooltip = huli_jing.d
				}
				hidden_effect = {
					set_variable = {
						which = PatronApproval
						value = 5
					}
				}
			}
			# Fail
			1 = {
				modifier = {
					factor = 4
					NOT = { dip = 4 }
				}
				kill_ruler = yes
			}
		}
	}
	option = { #Trial of the Ancestor
		name = patrons_on_action.2.b
		ai_chance = {
			factor = 50
			modifier = {
				factor = 5
				OR = {
					ruler_has_personality = craven_personality
					ruler_has_personality = fierce_negotiator_personality
					ruler_has_personality = benevolent_personality
					ruler_has_personality = pious_personality
				}
			}
		}
		random_list = {
			# Succeed
			1 = {
				modifier = {
					factor = 4
					ruler_has_personality = fierce_negotiator_personality
				}
				modifier = {
					factor = 4
					ruler_has_personality = benevolent_personality
				}
				modifier = {
					factor = 4
					ruler_has_personality = pious_personality
				}
				modifier = {
					factor = 2
					ruler_has_personality = craven_personality
				}
				custom_tooltip = ancestor_spirit.d
				set_ruler_flag = honored_ancestor_patron
				set_ruler_flag = patron_favored_divination
				set_ruler_flag = patron_favored_conjuration
				set_ruler_flag = patron_disfavored_illusion
				set_ruler_flag = patron_disfavored_transmutation
				hidden_effect = {
					set_variable = {
						which = PatronApproval
						value = 5
					}
				}
			}
			# Fail
			1 = {
				modifier = {
					factor = 4
					NOT = { adm = 4 }
				}
				kill_ruler = yes
			}
		}
	}
	option = { #Trial of Nature
		name = patrons_on_action.2.c
		ai_chance = {
			factor = 50
			modifier = {
				factor = 5
				OR = {
					ruler_has_personality = cruel_personality
					ruler_has_personality = righteous_personality
					ruler_has_personality = incorruptible_personality
					ruler_has_personality = industrious_personality
				}
			}
		}
		random_list = {
			# Succeed
			1 = {
				modifier = {
					factor = 4
					ruler_has_personality = righteous_personality
				}
				modifier = {
					factor = 4
					ruler_has_personality = incorruptible_personality
				}
				modifier = {
					factor = 4
					ruler_has_personality = industrious_personality
				}
				modifier = {
					factor = 2
					ruler_has_personality = cruel_personality
				}
				custom_tooltip = nature_spirit.d
				set_ruler_flag = nature_spirit_patron
				set_ruler_flag = patron_favored_evocation
				set_ruler_flag = patron_favored_transmutation
				set_ruler_flag = patron_disfavored_abjuration
				set_ruler_flag = patron_disfavored_enchantment
				hidden_effect = {
					set_variable = {
						which = PatronApproval
						value = 5
					}
				}
			}
			# Fail
			1 = {
				modifier = {
					factor = 4
					NOT = { mil = 4 }
				}
				kill_ruler = yes
			}
		}
	}
}