
namespace = flavor_sugamber

# Start of the Sugambrian succession crisis
country_event = {
	id = flavor_sugamber.1
	title = flavor_sugamber.1.t
	desc = flavor_sugamber.1.d
	picture = KING_SICK_IN_BED_eventPicture
	
	fire_only_once = yes

	is_triggered_only = yes

	trigger = {
			tag = A48
			NOT = { has_country_flag = A48_succesion_war_Ethelbert }
			NOT = { has_country_flag = A48_succesion_war_Liselotte }
			NOT = { has_country_flag = had_succession_war }
	}

	immediate = {
	}

	option = {
		name = flavor_sugamber.1.a
			define_ruler = {
				name = "Ethelbert"
				dynasty = "Wa"
				fixed = yes
				adm = 4
				dip = 4
				mil = 5
			}
			add_stability = -1
		hidden_effect = {
				country_event = { id = flavor_sugamber.2 days = 1 }
		}
	}

	option = {
		name = flavor_sugamber.1.b
		hidden_effect = {
				country_event = { id = flavor_sugamber.3 days = 1 }
		}
	}
}

country_event = {
	id = flavor_sugamber.2
	title = flavor_sugamber.2.t
	desc = flavor_sugamber.2.d
	picture = CIVIL_WAR_eventPicture
	
	fire_only_once = yes

	is_triggered_only = yes

	immediate = {
				set_country_flag = A48_succesion_war_Ethelbert
	}

	option = {
		name = flavor_sugamber.2.a
		if = {
			limit = {
				owns = 415		# Lockcastle
				415 = {
					units_in_province = 1
				}
			}
			415 = {
				set_province_flag = local_support_for_rebells 
				spawn_rebels = {
					type = pretender_rebels
					size = 1.75
					leader = "Baldwin Lockcastle"
					win = yes
				}
			}
		}
		else = {
			random_owned_province = {
				limit = {
					NOT = { units_in_province = 1 }
					NOT = { has_province_modifier = gnollish_minority}
					NOT = { culture = hill_gnoll }
				}
				set_province_flag = local_support_for_rebells
				spawn_rebels = {
					type = pretender_rebels
					size = 2
					leader = "Baldwin Lockcastle"
					win = yes
				}
			}
		}
		random_owned_province = {
			limit = {
				NOT = { units_in_province = 1 }
				NOT = { has_province_modifier = gnollish_minority}
				NOT = { culture = hill_gnoll }
			}
			set_province_flag = local_support_for_rebells
			spawn_rebels = {
				type = pretender_rebels
				size = 1
				leader = "Baldwin Lockcastle"
				win = yes
			}
		}
		add_yearly_manpower = -1.5
	}
}

# Ethelbert rises up
country_event = {
	id = flavor_sugamber.3
	title = flavor_sugamber.3.t
	desc = flavor_sugamber.3.d
	picture = CIVIL_WAR_eventPicture
	
	fire_only_once = yes

	is_triggered_only = yes

	immediate = {
				set_country_flag = A48_succesion_war_Liselotte
	}

	option = {
		name = flavor_sugamber.3.a
			random_owned_province = {
				limit = {
					NOT = { units_in_province = 1 }
					NOT = { has_province_modifier = gnollish_minority}
					NOT = { culture = hill_gnoll }
				}
				set_province_flag = local_support_for_rebells
				spawn_rebels = {
					type = pretender_rebels
					size = 2
					leader = "Ethelbert Wa"
					win = yes
				}
			}
			random_owned_province = {
				limit = {
					NOT = { units_in_province = 1 }
					NOT = { has_province_modifier = gnollish_minority}
					NOT = { culture = hill_gnoll }
				}
				set_province_flag = local_support_for_rebells
				spawn_rebels = {
					type = pretender_rebels
					size = 1
					leader = "Ethelbert Wa"
					win = yes
				}
			}
			add_yearly_manpower = -1.5
	}
}

# Alternative start of the Sugambrian succession crisis
country_event = {
	id = flavor_sugamber.4
	title = flavor_sugamber.4.t
	desc = flavor_sugamber.4.d
	picture = KING_SICK_IN_BED_eventPicture
	
	fire_only_once = yes

	is_triggered_only = yes

	trigger = {
		tag = A48
		NOT = { has_country_flag = A48_succesion_war_Ethelbert }
		NOT = { has_country_flag = A48_succesion_war_Liselotte }
		NOT = { has_country_flag = had_succession_war }
	}

	immediate = {
	}

	option = {
		name = flavor_sugamber.4.a
			add_stability = -1
			set_country_flag = A48_succesion_war_Liselotte
			random_owned_province = {
				limit = {
					NOT = { units_in_province = 1 }
					NOT = { has_province_modifier = gnollish_minority}
					NOT = { culture = hill_gnoll }
				}
				set_province_flag = local_support_for_rebells
				spawn_rebels = {
					type = pretender_rebels
					size = 2
					leader = "Ethelbert Wa"
					win = yes
				}
			}
			random_owned_province = {
				limit = {
					NOT = { units_in_province = 1 }
					NOT = { has_province_modifier = gnollish_minority}
					NOT = { culture = hill_gnoll }
				}
				set_province_flag = local_support_for_rebells
				spawn_rebels = {
					type = pretender_rebels
					size = 1
					leader = "Ethelbert Wa"
					win = yes
				}
			}
			add_yearly_manpower = -1.5
	}
}

# Gnolles might start making trouble
country_event = {
	id = flavor_sugamber.5
	title = flavor_sugamber.5.t
	desc = flavor_sugamber.5.d
	picture = REVOLUTION_eventPicture
	
	major = yes
	fire_only_once = yes
	
	trigger = {
		tag = A48
		OR	= {	has_country_flag = A48_succesion_war_Ethelbert
				has_country_flag = A48_succesion_war_Liselotte
		}
		owns = 913
		occupies = 913
	}
	
	mean_time_to_happen = {
		months = 5
	}
	
	immediate = {
	}
	
	option = {	# Just ignore them.
		name = flavor_sugamber.5.a
		random = { 
			chance = 50 
			913 = {
			spawn_rebels = {
				type = nationalist_rebels
				size = 1
				friend = A49
				}
			}
		}
	}
	
	option = {	# Pre-empt rebelion by giving them someone else to fight.
		name = flavor_sugamber.5.b
			913 = {
				add_unit_construction = {
					type = infantry
					amount = 1
					speed = 0.25
					cost = 1
					mercenary = yes
			}
		}
		set_country_flag = gnollish_officer	
	}
	
	option = {	# Keep them quit by lowering their taxes.
		name = flavor_sugamber.5.c
			913 = {
				add_local_autonomy = 30
		}	
	}
}

# The civil war hurts our agriculture.
country_event = {
	id =  flavor_sugamber.6
	title = flavor_sugamber.6.t
	desc = flavor_sugamber.6.d
	picture = WAR_OF_THE_ROSES_eventPicture
	
	trigger = {
		tag = A48
		OR	= {	has_country_flag = A48_succesion_war_Ethelbert
				has_country_flag = A48_succesion_war_Liselotte
		}
	}
	
	fire_only_once = yes
	
	mean_time_to_happen = {
		months = 5
	}
	
	option = {		# Why can't the peasants eat cake?
		name = flavor_sugamber.6.a
		ai_chance = { factor = 25 }
		add_stability = -1
		add_legitimacy = -5
	}
	option = {		# Just import food from abroad.
		name = flavor_sugamber.6.b
		ai_chance = { factor = 50 }
		add_years_of_income = -0.5
	}
	option = {		# Someone must be hoarding food, we must seize it.
		name = flavor_sugamber.6.c
		ai_chance = { factor = 25 }
		if = { limit = { has_dlc = "The Cossacks" }
			add_estate_loyalty = {
				estate = estate_nobles
				loyalty = -10
			}
			add_estate_loyalty = {
				estate = estate_burghers
				loyalty = -10
			}
		}
		else = {
			add_adm_power = -100
			add_dip_power = -50
			add_legitimacy = -5
		}
	}
}

#Neighbors supporting Liselotte
country_event = {
	id = flavor_sugamber.10
	title = flavor_sugamber.10.t
	desc = flavor_sugamber.10.d
	picture = SPY_eventPicture
	
	trigger = {
		is_neighbor_of = A48
		A48 = {
			has_country_flag = A48_succesion_war_Ethelbert
		}
		NOT = { has_country_flag = support_rebels }
		NOT = { has_country_flag = no_support_for_rebels }
		A48 = {
			any_owned_province = {
				OR = {
					any_neighbor_province = {
						owned_by = ROOT
					}
					has_port = yes
				}
				unit_in_siege = no
				NOT = { has_province_flag = local_support_for_rebells }
				NOT = { has_province_modifier = gnollish_minority}
				NOT = { culture = hill_gnoll }
			}
		}
	}
	
	mean_time_to_happen = {
		months = 12
	}
	
	option = {		# Send some unruly subjects to the rebels as 'volunteers'.
		name = flavor_sugamber.10.a
		ai_chance = { factor = 30 }
		set_country_flag = support_rebels
		add_manpower = -2
		hidden_effect = {
			A48 = {
				country_event = { id = flavor_sugamber.12 days = 1 }
			}
		}
	}
	option = {		# Give the rebels some monetary aid.
		name = flavor_sugamber.10.b
		ai_chance = { factor = 20 }
		set_country_flag = support_rebels
		add_years_of_income = -0.4
		hidden_effect = {
			A48 = {
				country_event = { id = flavor_sugamber.12 days = 1 }
			}
		}
	}
	option = {		# We don't help rebel scum.
		name = flavor_sugamber.10.c
		ai_chance = { 
			factor = 50
			modifier = {
				factor = 3
				has_opinion = {
					who = A48
					value = 30 }
			}
			modifier = {
				factor = 0.3
				NOT = {
					has_opinion = {
						who = A48
						value = -30 }
				}
			}
		}
		set_country_flag = no_support_for_rebels
		add_prestige = 5
	}
}

#Neighbors supporting Ethelbert
country_event = {
	id = flavor_sugamber.11
	title = flavor_sugamber.11.t
	desc = flavor_sugamber.11.d
	picture = SPY_eventPicture
	
	trigger = {
		is_neighbor_of = A48
		A48 = {
			has_country_flag = A48_succesion_war_Liselotte
		}
		NOT = { has_country_flag = support_rebels }
		NOT = { has_country_flag = no_support_for_rebels }
		A48 = {
			any_owned_province = {
				OR = {
					any_neighbor_province = {
						owned_by = ROOT
					}
					has_port = yes
				}
				unit_in_siege = no
				NOT = { has_province_flag = local_support_for_rebells }
				NOT = { has_province_modifier = gnollish_minority}
				NOT = { culture = hill_gnoll }
			}
		}
	}
	
	mean_time_to_happen = {
		months = 12
	}
	
	option = {		# Send some unruly subjects to the rebels as 'volunteers'.
		name = flavor_sugamber.11.a
		ai_chance = { factor = 30 }
		set_country_flag = support_rebels
		add_manpower = -2
		hidden_effect = {
			A48 = {
				country_event = { id = flavor_sugamber.12 days = 1 }
			}
		}
	}
	option = {		# Give the rebels some monetary aid.
		name = flavor_sugamber.11.b
		ai_chance = { factor = 20 }
		set_country_flag = support_rebels
		add_years_of_income = -0.4
		hidden_effect = {
			A48 = {
				country_event = { id = flavor_sugamber.12 days = 1 }
			}
		}
	}
	option = {		# We don't help rebel scum.
		name = flavor_sugamber.11.c
		ai_chance = { 
			factor = 50
			modifier = {
				factor = 3
				has_opinion = {
					who = A48
					value = 30 }
			}
			modifier = {
				factor = 0.3
				NOT = {
					has_opinion = {
						who = A48
						value = -30 }
				}
			}
		}
		set_country_flag = no_support_for_rebels
		add_prestige = 5
	}
}

# Country Intervenes!
country_event = {
	id = flavor_sugamber.12
	title = flavor_sugamber.12.t
	desc = flavor_sugamber.12.d
	picture = SPY_eventPicture
	
	is_triggered_only = yes
	
	option = {		# We will not forget this.
		name = flavor_sugamber.12.a
		if = {
			limit = {
				any_owned_province = {
					any_neighbor_province = {
						owned_by = FROM
					}
					unit_in_siege = no
				}
			}
			random_owned_province = {
				limit = {
					any_neighbor_province = {
						owned_by = FROM
					}
					unit_in_siege = no
					NOT = { has_province_flag = local_support_for_rebells }
					NOT = { has_province_modifier = gnollish_minority}
					NOT = { culture = hill_gnoll }
				}
				spawn_rebels = {
					type = pretender_rebels
					size = 1
					friend = FROM
				}
				set_province_flag = local_support_for_rebells
			}
		}
	}
}


########################################
# The End of the War
########################################

# Rebels beaten
country_event = {
	id = flavor_sugamber.13
	title = flavor_sugamber.13.t
	desc = flavor_sugamber.13.d
	picture = WAR_OF_THE_ROSES_eventPicture
	
	major = yes
	fire_only_once = yes
	
	mean_time_to_happen = {
		months = 1
	}
	
	trigger = {
		tag = A48
		NOT = { has_country_flag = had_succession_war }
		NOT = { num_of_rebel_controlled_provinces = 1 }
		NOT = {
			has_spawned_rebels = pretender_rebels
		}
		OR	= {	has_country_flag = A48_succesion_war_Ethelbert
				has_country_flag = A48_succesion_war_Liselotte
		}
	}
	
	immediate = {
		hidden_effect = {

			# Clear Province Flags
			clr_province_flag = local_support_for_rebells
				
			# Clear Flags
			clr_country_flag = A48_succesion_war_Ethelbert
			clr_country_flag = A48_succesion_war_Liselotte
			
			# Set Flag
			set_country_flag = had_succession_war
		}
	}
	
	option = {		# Order has finally been restored
		name = flavor_sugamber.13.a
		add_stability_or_adm_power = yes
		add_prestige = 10
		every_owned_province = {
			limit = {
				has_province_flag = local_support_for_rebells
			}
			add_province_modifier = {
				name = add_unrest_5_modifier
				duration = 3650
			}
		}
		hidden_effect = {
			every_country = {
				limit = {
					OR = {
						has_country_flag = no_support_for_rebels
						has_country_flag = support_rebels
					}
				}
				country_event = { id = flavor_sugamber.17 days = 1 } #Relations deteriorate with Sugamber
			}
			if = { limit = { has_country_flag = gnollish_officer }
				country_event = { id = flavor_sugamber.18 days = 10 }
			}
		}
	}
}

# Pro-Liselotte rebels win the war
country_event = {
	id = flavor_sugamber.14
	title = flavor_sugamber.14.t
	desc = flavor_sugamber.14.d
	picture = REVOLUTION_eventPicture

	major = yes
	is_triggered_only = yes
	fire_only_once = yes
	
	trigger = {
		tag = A48
		has_country_flag = A48_succesion_war_Ethelbert
		dynasty = Lockcastle
	}
	
	immediate = {
		hidden_effect = {
			# Clear Flags
			clr_country_flag = A48_succesion_war_Ethelbert
			clr_country_flag = A48_succesion_war_Liselotte
			
			# Set Flag
			set_country_flag = had_succession_war
		}
	}
	
	option = {		# Liselotte has been avenged!
		name = flavor_sugamber.14.a
		add_stability_or_adm_power = yes
		add_prestige = -10
		every_owned_province = {
			limit = {
					NOT = { has_province_flag = local_support_for_rebells }
			}
			add_province_modifier = {
				name = add_unrest_5_modifier
				duration = 3650
			}
		}
		hidden_effect = {
			# Clear Province Flags
			clr_province_flag = local_support_for_rebells
			every_country = {
				limit = {
					has_country_flag = support_rebels
				}
				country_event = { id = flavor_sugamber.16 days = 1 } # Improved Relations with Sugamber
			}
			if = { limit = { has_dlc = "The Cossacks" }
				country_event = { id = flavor_sugamber.20 days = 1 } # To the victor's supporters go the spoils
			}
		}
	}
}

# Pro-Ethelbert rebels win the war
country_event = {
	id = flavor_sugamber.15
	title = flavor_sugamber.15.t
	desc = flavor_sugamber.15.d
	picture = REVOLUTION_eventPicture
	
	major = yes
	is_triggered_only = yes
	fire_only_once = yes
	
	trigger = {
		tag = A48
		has_country_flag = A48_succesion_war_Liselotte
		dynasty = Wa	
	}
	
	immediate = {
		hidden_effect = {
				
			# Clear Flags
			clr_country_flag = A48_succesion_war_Ethelbert
			clr_country_flag = A48_succesion_war_Liselotte
			
			# Set Flag
			set_country_flag = had_succession_war
		}
	}
	
	option = {		# Justice has been fullfilled!
		name = flavor_sugamber.15.a
		add_stability_or_adm_power = yes
		add_prestige = -10
		every_owned_province = {
			limit = {
					NOT = { has_province_flag = local_support_for_rebells }
			}
			add_province_modifier = {
				name = add_unrest_5_modifier
				duration = 3650
			}
		}
		
		hidden_effect = {
			# Clear Province Flags
			clr_province_flag = local_support_for_rebells
			
			every_country = {
				limit = {
					has_country_flag = support_rebels
				}
				country_event = { id = flavor_sugamber.16 days = 1 } # Improved Relations with Sugamber
			}
			if = { limit = { has_dlc = "The Cossacks" }
				country_event = { id = flavor_sugamber.20 days = 1 } # To the victor's supporters go the spoils
			}
		}
	}
}

# Improved Relations with Sugamber
country_event = {
	id = flavor_sugamber.16
	title = flavor_sugamber.16.t
	desc = flavor_sugamber.16.d
	picture = WAR_OF_THE_ROSES_eventPicture
	
	is_triggered_only = yes
	
	immediate = {
		clr_country_flag = support_rebels
	}
	
	option = {		# Hopefully he'll one day pays us back.
		name = flavor_sugamber.16.a
		FROM = {
			add_opinion = {
				who = ROOT
				modifier = A48_support_during_succession_war
			}
		}
	}
}

# Relations Deteriorate with Sugamber
country_event = {
	id = flavor_sugamber.17
	title = flavor_sugamber.17.t
	desc = flavor_sugamber.17.d
	picture = WAR_OF_THE_ROSES_eventPicture
	
	is_triggered_only = yes
	
	option = {		# Not mentioning any names? that's how you recognize anyone who's bluffing.
		trigger = { has_country_flag = support_rebels }
		name = flavor_sugamber.17.a
		FROM = {
			add_opinion = {
				who = ROOT
				modifier = A48_supported_rebels
			}
		}
		clr_country_flag = support_rebels
	}
	
	option = {		# Oh, good thing we didn't.
		trigger = { has_country_flag = no_support_for_rebels }
		name = flavor_sugamber.17.b
		FROM = {
			add_opinion = {
				who = ROOT
				modifier = A48_didnt_support_rebels
			}
		}
		clr_country_flag = no_support_for_rebels
	}
}

# Gnollish officers?
country_event = {
	id = flavor_sugamber.18
	title = flavor_sugamber.18.t
	desc = flavor_sugamber.18.d
	picture = WAR_OF_THE_ROSES_eventPicture
	
	is_triggered_only = yes
	
	
	immediate = {
		hidden_effect = {
			clr_country_flag = gnollish_officer
		}
	}

	option = {	# Give him a high function.
		name = flavor_sugamber.18.a
		ai_chance = { factor = 10 }
		define_advisor = {
			type = commandant
			skill = 2
			culture = hill_gnoll
			location = 913
			discount = yes
		}
		add_legitimacy = -10
		add_prestige = -10
		add_army_tradition = 5
		if = { limit = { has_dlc = "The Cossacks" }
			add_estate_loyalty = {
				estate = estate_nobles
				loyalty = -5
			}
			add_estate_loyalty = {
				estate = estate_church
				loyalty = -5
			}
			add_absolutism = 5 # This damages the power the before mentioned have on the government
		}
	}

	option = {	# Make him an officer.
		name = flavor_sugamber.18.b
		ai_chance = { factor = 50 }
		add_army_tradition = 5
	}

	option = {	# Gnolles already cause enough havoc without recieving high positions.
		name = flavor_sugamber.18.a
		ai_chance = { factor = 40 }
		add_legitimacy = 5
		add_prestige = 5
		add_army_tradition = -5
	}
}

# A third party has seized the throne
country_event = {
	id = flavor_sugamber.19
	title = flavor_sugamber.19.t
	desc = flavor_sugamber.19.d
	picture = REVOLUTION_eventPicture
	
	major = yes
	is_triggered_only = yes
	fire_only_once = yes
	
	trigger = {
		tag = A48
		NOT = { dynasty = Lockcastle }
		NOT = { dynasty = Wa }
		OR	= {	has_country_flag = A48_succesion_war_Ethelbert
				has_country_flag = A48_succesion_war_Liselotte
		}
	}
	
	immediate = {
		hidden_effect = {
			# Clear Province Flags
			clr_province_flag = local_support_for_rebells
				
			# Clear Flags
			clr_country_flag = A48_succesion_war_Ethelbert
			clr_country_flag = A48_succesion_war_Liselotte
			
			# Set Flag
			set_country_flag = had_succession_war
		}
	}
	
	option = {
		name = flavor_sugamber.19.a
		add_stability = -1
		add_prestige = -20
		every_owned_province = {
			limit = {
					NOT = { has_province_flag = local_support_for_rebells }
			}
			add_province_modifier = {
				name = add_unrest_5_modifier
				duration = 3650
			}
		}
		hidden_effect = {
			# Clear Province Flags
			clr_province_flag = local_support_for_rebells
			if = { limit = { has_dlc = "The Cossacks" }
				country_event = { id = flavor_sugamber.20 days = 1 } # To the victor's supporters go the spoils
			}
		}
	}
}

# To the victor's supporters go the spoils
country_event = {
	id = flavor_sugamber.20
	title = flavor_sugamber.20.t
	desc = flavor_sugamber.20.d
	picture = CIVIL_WAR_eventPicture
	
	fire_only_once = yes

	is_triggered_only = yes

	option = { # Divide the crown lawns under our supporters.
		name = flavor_sugamber.20.a
		ai_chance = { factor = 20 }
		random_owned_province = {
			limit = {
				has_estate = no
			}
			set_estate = estate_nobles
			add_local_autonomy = 40
		}
		random_owned_province = {
			limit = {
				has_estate = no
			}
			set_estate = estate_nobles
			add_local_autonomy = 40
		}
		add_estate_loyalty = {
			estate = estate_nobles
			loyalty = 5
		}
	}

	option = { # Arrange for public offices to be given to their surplus children, even if those traditionaly went to priest or burghers.
		name = flavor_sugamber.20.b
		ai_chance = { factor = 20 }
		add_estate_loyalty = {
			estate = estate_burghers
			loyalty = -5
		}
		add_estate_loyalty = {
			estate = estate_church
			loyalty = -5
		}
		add_estate_loyalty = {
			estate = estate_nobles
			loyalty = 5
		}
		add_corruption = 5
	}

	option = { # Give them a donation out of the treasury.
		name = flavor_sugamber.20.c
		ai_chance = {
			factor = 30
			modifier = {
				factor = 0.1
				num_of_loans = 2
			}
		}
		add_years_of_income = -0.75
		add_estate_loyalty = {
			estate = estate_nobles
			loyalty = 5
		}
	}

	option = { # They only did their duty, I don't reward basic decency.
		name = flavor_sugamber.20.e
		ai_chance = {
			factor = 30
			modifier = {
				factor = 0.1
				NOT = {
					estate_loyalty = {
						estate = estate_nobles
						loyalty = 40
					}
				}
			}
		}
		add_estate_loyalty = {
			estate = estate_nobles
			loyalty = -10
		}
	}
}