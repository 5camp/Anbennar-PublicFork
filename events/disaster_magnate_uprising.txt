namespace = magnate_uprising

# The Magnates show their hand
country_event = {
	id = magnate_uprising.1
	title = "magnate_uprising.1.t"
	desc = "magnate_uprising.1.d"
	picture = COUNTRY_COLLAPSE_eventPicture
	mean_time_to_happen = {
		days = 1
	}

	is_triggered_only = yes

	after = {
		hidden_effect = {
			country_event = { id = magnate_uprising.5 days = 730 random = 180 } # 2ish Years
		}
	}

	# Rally to the Delanders
	option = {
		name = magnate_uprising.1.a
		ai_chance = {
			factor = 9
		}
		setup_magnates_magnate_side = yes
		set_country_flag = chose_magnates
		hidden_effect = {
			country_event = {
				id = magnate_uprising.100
				days = 50
				random = 10
			}
		}
	}
	
	# We must crush these upstarts
	option = {
		name = magnate_uprising.1.b
		ai_chance = {
			factor = 1
		}
		set_country_flag = chose_crown
		setup_magnates_crown_side = yes
	}
}

# The end of the war
country_event = {
	id = magnate_uprising.2
	title = "magnate_uprising.2.t"
	desc = {
		trigger = {
			OR = {
				AND = {
					has_country_flag = chose_crown
					NOT = { has_country_modifier = just_lost_to_rebels }
				}
				AND = {
					has_country_flag = chose_magnates
					has_country_modifier = just_lost_to_rebels
				}
			}
		}
		desc = "magnate_uprising.2.d1"
	}
	desc = {
		trigger = {
			OR = {
				AND = {
					has_country_flag = chose_magnates
					NOT = { has_country_modifier = just_lost_to_rebels }
				}
				AND = {
					has_country_flag = chose_crown
					has_country_modifier = just_lost_to_rebels
				}
			}
		}
		desc = "magnate_uprising.2.d2"
	}
	picture = CONQUEST_eventPicture
	mean_time_to_happen = {
		days = 1
	}

	is_triggered_only = yes
	
	immediate = {
		set_country_flag = ended_magnate_uprising
	}
	
	major = yes

	option = {
		name = magnate_uprising.2.a
		trigger = { 
			OR = {
				AND = {
					has_country_flag = chose_crown
					NOT = { has_country_modifier = just_lost_to_rebels }
				}
				AND = {
					has_country_flag = chose_magnates
					has_country_modifier = just_lost_to_rebels
				}
			}
		}
		if = {
			limit = { has_country_modifier = just_lost_to_rebels ai = no }
			add_stability_or_adm_power = yes
			add_country_modifier = {
				name = magnates_enforced_control_lose
				duration = 1825
			}
		}
		else = {
			add_stability_or_adm_power = yes
			add_country_modifier = {
				name = magnates_enforced_control_win
				duration = 1825
			}
		}
	}
	
	# Crown Win
	option = {
		name = magnate_uprising.2.b
		trigger = { 
			OR = {
				AND = {
					has_country_flag = chose_magnates
					NOT = { has_country_modifier = just_lost_to_rebels }
				}
				AND = {
					has_country_flag = chose_crown
					has_country_modifier = just_lost_to_rebels
				}
			}
		}
		if = {
			limit = { has_country_modifier = just_lost_to_rebels ai = no }
			add_stability_or_adm_power = yes
			add_country_modifier = {
				name = crown_enforced_control_lose
				duration = 1825
			}
		}
		else = {
			add_stability_or_adm_power = yes
			add_country_modifier = {
				name = crown_enforced_control_win
				duration = 1825
			}
		}
	}
	
	after = {
		# Don't need these anymore so cya
		clr_country_flag = chose_magnates
		clr_country_flag = chose_crown
	}
}

# Hostile stronghold, small rebels
country_event = {
	id = magnate_uprising.3
	title = "magnate_uprising.3.t"
	desc = "magnate_uprising.3.d"
	picture = RELIGIOUS_TURMOIL_eventPicture
	mean_time_to_happen = {
		days = 1
	}

	is_triggered_only = yes
	
	option = {
		name = magnate_uprising.3.a
		random_owned_province = {
			limit = { has_hostile_stronghold = yes }
			spawn_magnate_uprising_rebels_small = yes
		}
	}
}

# Hostile stronghold, medium rebels
country_event = {
	id = magnate_uprising.4
	title = "magnate_uprising.4.t"
	desc = "magnate_uprising.4.d"
	picture = REVOLUTION_eventPicture
	mean_time_to_happen = {
		days = 1
	}

	is_triggered_only = yes
	
	option = {
		name = magnate_uprising.4.a
		random_owned_province = {
			limit = { has_hostile_stronghold = yes }
			spawn_magnate_uprising_rebels_medium = yes
		}
	}
}

# War has gone on for too long, peasants rise up
country_event = {
	id = magnate_uprising.5
	title = "magnate_uprising.5.t"
	desc = "magnate_uprising.5.d"
	picture = BATTLE_eventPicture
	mean_time_to_happen = {
		days = 1
	}

	is_triggered_only = yes
	fire_only_once = yes
	
	trigger = {
		has_disaster = magnate_uprising 
	}
	
	option = {
		name = magnate_uprising.5.a
		capital_scope = {
			area = {
				spawn_rebels = {
					type = leadered_peasant_rebels
					size = 1
				}
			}
		}
	}
}

# Province changes sides
country_event = {
	id = magnate_uprising.6
	title = "magnate_uprising.6.t"
	desc = "magnate_uprising.6.d"
	picture = FORT_eventPicture
	mean_time_to_happen = {
		days = 1
		# AI cheats
		modifier = {
			factor = 0
			ai = yes
			has_country_flag = chose_magnates
		}
	}

	is_triggered_only = yes
	
	immediate = {
		random_owned_province = {
			limit = { 
				NOT = { 
					has_hostile_stronghold = yes 
					any_neighbor_province = { has_hostile_stronghold = yes } 
				}
			}
			save_event_target_as = bad_province
		}
	}
	
	# We must accept their demands
	option = {
		name = magnate_uprising.6.a
		add_dip_power = -50
		event_target:bad_province = {
			add_local_autonomy = 50
		}
	}
	
	# We will crush them as well!
	option = {
		name = magnate_uprising.6.b
		event_target:bad_province = {
			add_hostile_stronghold = yes
		}
		if = {
			limit = { has_country_flag = chose_crown }
			change_estate_land_share = {
				estate = estate_burghers
				share = -2
			}
		}
	}
}

# Province tires of fighting
country_event = {
	id = magnate_uprising.7
	title = "magnate_uprising.7.t"
	desc = "magnate_uprising.7.d"
	picture = MILITARY_CAMP_eventPicture
	mean_time_to_happen = {
		days = 1
		# Must fight for one year
		modifier = {
			factor = 0
			NOT = { 
				had_country_flag = {
					flag = chose_crown
					duration = 365
				}
				had_country_flag = {
					flag = chose_magnates
					duration = 365
				}
			}
		}
		# Tiring of fighting
		modifier = {
			factor = 2
			OR = {
				had_country_flag = {
					flag = chose_crown
					duration = 730
				}
				had_country_flag = {
					flag = chose_magnates
					duration = 730
				}
			}
		}
		# Wish for peace after 5 year
		modifier = {
			factor = 2.5
			OR = {
				had_country_flag = {
					flag = chose_crown
					duration = 1825
				}
				had_country_flag = {
					flag = chose_magnates
					duration = 1825
				}
			}
		}
		# AI cheats
		modifier = {
			factor = 1.5
			ai = yes
			has_country_flag = chose_magnates
		}
	}

	is_triggered_only = yes
	
	immediate = {
		random_owned_province = {
			limit = { 
				has_hostile_stronghold = yes
			}
			save_event_target_as = good_province
		}
	}
	
	# We accept their surrender
	option = {
		name = magnate_uprising.7.a
		add_dip_power = -20
		event_target:good_province = {
			add_local_autonomy = 25
			clear_strongholds = yes
		}
		ai_chance = {
			factor = 20
		}
	}
	
	# They are traitors, and they shall be slain to the last
	option = {
		name = magnate_uprising.7.b
		add_prestige = 10
		ai_chance = {
			factor = 1
		}
	}
}

# Pretender seeks push their claim in the chaos
country_event = {
	id = magnate_uprising.8
	title = "magnate_uprising.8.t"
	desc = "magnate_uprising.8.d"
	picture = CIVIL_WAR_eventPicture
	mean_time_to_happen = {
		days = 1
	}
	
	is_triggered_only = yes
	fire_only_once = yes
	
	trigger = {
		government = monarchy
	}
	
	# How dare they.
	option = {
		name = magnate_uprising.8.a
		random_owned_province = {
			limit = {
				is_in_capital_area = yes
			}
			spawn_rebels = {
				type = rebel_pretender
				size = 2
			}
		}
	}
}


# Bayvic stands against the League
country_event = {
	id = magnate_uprising.9
	title = "magnate_uprising.9.t"
	desc = "magnate_uprising.9.d"
	picture = CITY_VIEW_eventPicture
	mean_time_to_happen = {
		days = 1
	}
	
	is_triggered_only = yes
	fire_only_once = yes
	
	trigger = {
		any_owned_province = {
			culture = city_goblin
			is_in_capital_area = yes
		}
	}
	
	# Great
	option = {
		name = magnate_uprising.9.a
		trigger = {
			has_country_flag = chose_crown
		}
		every_owned_province = {
			limit = { culture = city_goblin }
			clear_strongholds = yes
		}
		add_years_of_income = 0.25
		add_manpower = 3
	}
	
	# Those Traitors
	option = {
		name = magnate_uprising.9.b
		trigger = {
			has_country_flag = chose_magnates
		}
		random_owned_province = {
			limit = { culture = city_goblin is_in_capital_area = yes }
			add_hostile_stronghold = yes
		}
	}
}

# Defectors from enemy side
country_event = {
	id = magnate_uprising.10
	title = "magnate_uprising.10.t"
	desc = "magnate_uprising.10.d"
	picture = DIPLOMACY_eventPicture
	mean_time_to_happen = {
		days = 1
	}
	
	is_triggered_only = yes
	
	# Great
	option = {
		name = magnate_uprising.10.a
		trigger = {
			has_country_flag = chose_crown
		}
		add_manpower = 5
	}
	
	# Great
	option = {
		name = magnate_uprising.10.b
		trigger = {
			has_country_flag = chose_magnates
		}
		add_manpower = 5
	}
}


# NL is declared
country_event = {
	id = magnate_uprising.100
	title = "magnate_uprising.100.t"
	desc = "magnate_uprising.100.d"
	picture = LIBERUM_VETO_eventPicture
	
	major = yes
	
	is_triggered_only = yes
	
	option = {
		name = magnate_uprising.100.a
		hidden_effect = {
			change_government = republic
		}
		add_government_reform = northern_league_magnates
		override_country_name = NORTHERN_LEAGUE
	}
}