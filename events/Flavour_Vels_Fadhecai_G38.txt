namespace = flavour_velsfadhecai

## Game Start

# The Whale Of The West
country_event = {
	id = flavour_velsfadhecai.1
	title = flavour_velsfadhecai.1.t
	desc = flavour_velsfadhecai.1.d
	picture = BAD_WITH_MONARCH_eventPicture

	fire_only_once = yes
	is_triggered_only = yes

	trigger = {
		tag = G38
	}

	immediate = {
		hidden_effect = {
			set_estate_privilege = estate_nobles_command_of_the_military
			set_estate_privilege = estate_nobles_vf_first_night
		}
	}

	option = {
		name = flavour_velsfadhecai.1.a
		custom_tooltip = vf_wotw_tt
		hidden_effect = {
			set_country_flag = vf_barge_canonicity_flg
		}
	}
}

## MT Triggered Events

# Twilit Auditions
country_event = {
	id = flavour_velsfadhecai.2
	title = flavour_velsfadhecai.2.t
	desc = flavour_velsfadhecai.2.d
	picture = SPELL_LIST_eventPicture

	is_triggered_only = yes

	immediate = {
		set_country_flag = vf_count_flg
	}

	option = {
		name = flavour_velsfadhecai.2.a
		define_general = {
			fire = 1
			shock = 3
			manuever = 2
			siege = 2
			trait = war_wizard_personality
			female = yes
			name = "Nathasadra Latekyr"
		}
		define_advisor = {
			type = spymaster
			skill = 1
			discount = yes
			name = "Ardan Galyvlai"
		}
		add_country_modifier = {
			name = vf_vesdiretnik
			duration = -1
		}
	}
}

# A Feast For Vultures
country_event = {
	id = flavour_velsfadhecai.3
	title = flavour_velsfadhecai.3.t
	desc = flavour_velsfadhecai.3.d
	picture = COUNTRY_COLLAPSE_eventPicture

	is_triggered_only = yes
	major = yes
	major_trigger = {
		primary_culture = sarda
	}

	option = {
		name = flavour_velsfadhecai.3.a
		if = {
			limit = {
				AND = {
					is_in_war = {
						participants = G84
					}
					NOT = {
						G84 = {
							is_subject_of = ROOT
						}
					}
				}
			}
			white_peace = G84
		}
		if = {
			limit = {
				NOT = {
					exists = G84
				}
			}
			release = G84
		}
		if = {
			limit = {
				AND = {
					1138 = {
						owner = {
							NOT = {
								tag = G84
							}
						}
					}
					exists = G84
				}
			}
			1138 = {
				cede_province = G84
			}
		}
		if = {
			limit = {
				AND = {
					1822 = {
						owner = {
							NOT = {
								tag = G84
							}
						}
					}
					exists = G84
				}
			}
			1822 = {
				cede_province = G84
			}
		}
		if = {
			limit = {
				AND = {
					1821 = {
						owner = {
							NOT = {
								tag = G84
							}
						}
					}
					exists = G84
				}
			}
			1821 = {
				cede_province = G84
			}
		}
		if = {
			limit = {
				NOT = {
					G84 = {
						is_subject_of = ROOT
					}
				}
			}
			create_subject = {
				subject_type = ynnic_iosahar
				subject = G84
			}
			hidden_effect = {
				every_known_country = {
					limit = {
						primary_culture = sarda
					}
					add_aggressive_expansion = {
						who = ROOT
						value = 7
					}
				}
				if = {
					limit = {
						NOT = {
							has_global_flag = dont_color_ynnic_iosahar
						}
					}
					G84 = {
						change_country_color = {
							country = ROOT
						}
					}
				}
			}
			custom_tooltip = vf_affv_ae_tt
		}
		hidden_effect = {
			1138 = {
				add_base_tax = -1
				add_base_production = -1
				add_base_manpower = -1
			}
			1826 = {
				add_base_tax = 1
				add_base_production = 1
				add_base_manpower = 1
			}
		}
		custom_tooltip = vf_affv_dev_tt
		add_country_modifier = {
			name = vf_speedy
			duration = 5475
		}
	}
}

# Swords In The Darkness
country_event = {
	id = flavour_velsfadhecai.4
	title = flavour_velsfadhecai.4.t
	desc = flavour_velsfadhecai.4.d
	picture = STREET_SPEECH_eventPicture

	is_triggered_only = yes

	option = {
		name = flavour_velsfadhecai.4.a
		add_ruler_modifier = {
			name = vf_polerenik
			duration = -1
		}
		custom_tooltip = vf_polerenikbonus_tt
	}
}

# A Lord In Purple
country_event = {
	id = flavour_velsfadhecai.5
	title = flavour_velsfadhecai.5.t
	desc = flavour_velsfadhecai.5.d
	picture = LOOMING_DEATH_eventPicture

	is_triggered_only = yes
	fire_only_once = yes

	immediate = {
		hidden_effect = {
			kill_heir = { 
				allow_new_heir = no 
			}
			define_ruler = {
				name = "The Purple Council"
				dynasty = " "
				adm = 2
				dip = 2
				mil = 2
				regency = yes
			}
		}
	}

	option = {
		name = flavour_velsfadhecai.5.a
		custom_tooltip = vf_purplecouncil_tt
		hidden_effect = {
			country_event = {
				id = flavour_velsfadhecai.6
				days = 365
			}
		}
	}
}

# The Gloaming
country_event = {
	id = flavour_velsfadhecai.6
	title = flavour_velsfadhecai.6.t
	desc = flavour_velsfadhecai.6.d
	picture = GOOD_WITH_MONARCH_eventPicture

	is_triggered_only = yes

	option = {
		name = flavour_velsfadhecai.6.a
		custom_tooltip = vf_ariadnefound_tt
		hidden_effect = {
			set_country_flag = vf_ariadnefound_flg
		}
	}
}

# Destiny
country_event = {
	id = flavour_velsfadhecai.7
	title = flavour_velsfadhecai.7.t
	desc = flavour_velsfadhecai.7.d
	picture = BIG_STAR_IN_SKY_eventPicture

	trigger = {
		has_country_flag = vf_ariadnefound_flg
	}

	mean_time_to_happen = {
		months = 18
	}

	immediate = {
		hidden_effect = {
			clr_country_flag = vf_ariadnefound_flg
		}
	}

	option = {
		name = flavour_velsfadhecai.7.a
		define_ruler = {
			name = "Ariadne"
			dynasty = "Konyrzab"
			adm = 6
			dip = 6
			mil = 3
			age = 22
			female = yes
		}
		custom_tooltip = vf_ariadneominous_tt
		hidden_effect = {
			country_event = {
				id = flavour_velsfadhecai.8
				days = 32
			}
		}
	}
}

# Until Dawn
country_event = {
	id = flavour_velsfadhecai.8
	title = flavour_velsfadhecai.8.t
	desc = flavour_velsfadhecai.8.d
	picture = THE_COVENANT_eventPicture

	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			add_government_reform = vf_ynnic_feudalism_reform
			define_ruler = {
				name = "Mitrenya"
				dynasty = "Konyrzab"
				adm = 5
				dip = 3
				mil = 6
				age = 21
				female = yes
			}
			add_ruler_personality = mage_personality
			add_ruler_modifier = {
				name = vf_fatecutter
				duration = -1
			}
			set_country_flag = vf_mitrenya_in_power_flg
			set_ruler_flag = vf_fatecutter_flg
			set_ruler_flag = abjuration_1
			set_ruler_flag = evocation_1
			set_ruler_flag = initialized_magic_flags
			ruler_save_spell_schools = yes
			set_country_flag = vf_onwards_to_dawn_flg
		}
	}

	option = {
		name = flavour_velsfadhecai.8.a
		swap_non_generic_missions = yes
	}
}

# Twilight Sonata
country_event = {
	id = flavour_velsfadhecai.9
	title = flavour_velsfadhecai.9.t
	desc = flavour_velsfadhecai.9.d
	picture = CULTURE_eventPicture

	is_triggered_only = yes

	option = {
		name = flavour_velsfadhecai.9.a
		add_country_modifier = {
			name = vf_painted_river
			duration = 9125
		}
	}
}

# The Proclamation At Farside
country_event = {
	id = flavour_velsfadhecai.10
	title = flavour_velsfadhecai.10.t
	desc = flavour_velsfadhecai.10.d
	picture = BLANK_eventPicture

	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			clr_country_flag = vf_farsidenotproclaimed_flg
		}
	}

	option = {
		name = flavour_velsfadhecai.10.a
		add_country_modifier = {
			name = vf_buyceyvalk
			duration = 1825
		}
		custom_tooltip = vf_farsidewarning_tt
		hidden_effect = {
			clr_country_flag = vf_farside_flg
			set_country_flag = vf_farsideproclaimed_flg
			country_event = {
				id = flavour_velsfadhecai.12
				days = 1826
			}
		}
	}

	option = {
		name = flavour_velsfadhecai.10.b
		add_mil_power = 100
		hidden_effect = {
			set_country_flag = vf_farsidenotproclaimed_flg
		}
	}
}

# Farside Successful
country_event = {
	id = flavour_velsfadhecai.11
	title = flavour_velsfadhecai.11.t
	desc = flavour_velsfadhecai.11.d
	picture = BLANK_eventPicture

	trigger = {
		has_country_flag = vf_farsideproclaimed_flg
		NOT = {
			calc_true_if = {
				amount = 1
				all_known_country = {
					primary_culture = sarda
					NOT = {
						is_subject_of = ROOT
					}
				}
			}
		}
	}

	mean_time_to_happen = {
		days = 1
	}

	immediate = {
		hidden_effect = {
			clr_country_flag = vf_farsideproclaimed_flg
			remove_country_modifier = vf_buyceyvalk
		}
	}

	option = {
		name = flavour_velsfadhecai.11.a
		add_country_modifier = {
			name = vf_primacy
			duration = 18250
		}
	}
}

# Farside Unsuccessful
country_event = {
	id = flavour_velsfadhecai.12
	title = flavour_velsfadhecai.12.t
	desc = flavour_velsfadhecai.12.d
	picture = BLANK_eventPicture

	is_triggered_only = yes

	trigger = {
		has_country_flag = vf_farsideproclaimed_flg
	}

	immediate = {
		hidden_effect = {
			clr_country_flag = vf_farsideproclaimed_flg
			remove_country_modifier = vf_buyceyvalk
		}
	}

	option = {
		name = flavour_velsfadhecai.12.a
		add_country_modifier = {
			name = vf_noballs
			duration = 9125
		}
	}
}

# Excision
country_event = {
	id = flavour_velsfadhecai.13
	title = flavour_velsfadhecai.13.t
	desc = flavour_velsfadhecai.13.d
	picture = BLANK_eventPicture

	is_triggered_only = yes

	option = {
		name = flavour_velsfadhecai.13.a
		add_stability = -1
		change_estate_land_share = {
			estate = estate_nobles
			share = -7.5
		}
		change_estate_land_share = {
			estate = estate_mages
			share = 2.5
		}
		1826 = {
			spawn_rebels = {
				type = noble_rebels
				size = 2
			}
		}
		remove_estate_privilege = estate_nobles_command_of_the_military
		remove_estate_privilege = estate_nobles_supremacy_over_crown
		hidden_effect = {
			set_country_flag = vf_lownobles_flg
		}
		add_country_modifier = {
			name = vf_night_wound
			duration = -1
		}
		if = {
			limit = {
				has_country_flag = yrw_2a_reform
			}
			add_ruler_modifier = {
				name = vf_favour_queens
				duration = -1
			}
			hidden_effect = {
				set_country_flag = vf_favour_flg
			}
		}
		else = {
			change_estate_land_share = {
				estate = estate_church
				share = -2.5
			}
			1827 = {
				spawn_rebels = {
					type = religious_rebels
					size = 0.25
				}
			}
			change_estate_land_share = {
				estate = estate_burghers
				share = -2.5
			}
			1825 = {
				spawn_rebels = {
					type = particularist_rebels
					size = 0.25
				}
			}
		}
	}
}

country_event = {
	id = flavour_velsfadhecai.14
	title = flavour_velsfadhecai.14.t
	desc = flavour_velsfadhecai.14.d
	picture = BLANK_eventPicture

	is_triggered_only = yes

	option = {
		name = flavour_velsfadhecai.14.a
		custom_tooltip = add_magic_study_modifier_20_tt
		hidden_effect = {
			set_country_flag = vf_bleed_flg
			update_magic_study_experience_modifier = { value = 20 }
		}
		if = {
			limit = {
				has_country_flag = yrw_1a_reform
			}
			hidden_effect = {
				set_country_flag = vf_bleed_nice_flg
			}
			add_ruler_modifier = {
				name = vf_bleed_nice
				duration = -1
			}
		}
		else = {
			hidden_effect = {
				set_country_flag = vf_bleed_racist_flg
			}
			add_ruler_modifier = {
				name = vf_bleed_racist
				duration = -1
			}
		}
	}
}

# DEBUG
country_event = {
	id = flavour_velsfadhecai.69
	title = flavour_velsfadhecai.69.t
	desc = flavour_velsfadhecai.69.d
	picture = BLANK_eventPicture

	is_triggered_only = yes

	option = {
		name = flavour_velsfadhecai.69.a
		swap_non_generic_missions = yes
	}
}

# Mitrenya Goes And Showers Or Something IDK (FAILSAFE EVENT)
country_event = {
	id = flavour_velsfadhecai.98
	title = flavour_velsfadhecai.98.t
	desc = flavour_velsfadhecai.98.d
	picture = BLANK_eventPicture

	is_triggered_only = yes

	option = {
		name = flavour_velsfadhecai.98.a
		custom_tooltip = vf_showering_tt
		hidden_effect = {
			country_event = {
				id = flavour_velsfadhecai.99
				days = 180
			}
			update_magic_study_experience_modifier = { 
				value = -20 
			}
		}
	}
}

# Mitrenya's Return (FAILSAFE EVENT)
country_event = {
	id = flavour_velsfadhecai.99
	title = flavour_velsfadhecai.99.t
	desc = flavour_velsfadhecai.99.d
	picture = BLANK_eventPicture

	is_triggered_only = yes

	option = {
		name = flavour_velsfadhecai.99.a
		custom_tooltip = vf_squeakyclean_tt
		hidden_effect = {
			define_ruler = {
				name = "Mitrenya"
				dynasty = "Konyrzab"
				adm = 5
				dip = 3
				mil = 6
				age = 21
				female = yes
			}
			add_ruler_personality = mage_personality
			add_ruler_modifier = {
				name = vf_fatecutter
				duration = -1
			}
			set_ruler_flag = vf_fatecutter_flg
			ruler_give_saved_spell_schools = yes
			if = {
				limit = {
					has_country_flag = vf_favour_flg
				}
				add_ruler_modifier = {
					name = vf_favour_queens
					duration = -1
				}
			}
			if = {
				limit = {
					has_country_flag = vf_bleed_flg
				}
				update_magic_study_experience_modifier = { 
					value = 20 
				}
			}
			if = {
				limit = {
					has_country_flag = vf_bleed_racist_flg
				}
				add_ruler_modifier = {
					name = vf_bleed_racist
					duration = -1
				}
			}
			if = {
				limit = {
					has_country_flag = vf_bleed_nice_flg
				}
				add_ruler_modifier = {
					name = vf_bleed_nice
					duration = -1
				}
			}
			if = {
				limit = {
					has_country_flag = vf_symposium_flg
				}
				add_ruler_modifier = {
					name = vf_symposium_mitrenya
					duration = -1
				}
			}
		}
	}
}