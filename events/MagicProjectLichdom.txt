namespace = magic_project_lichdom

#Homunculus
#1 - Find tome how to do it
#2 - Phylactery 1 - Constructing the Container
#3 - Phylactery 2 - Carving the Interiors Walls
#4 - Phylactery 3 - Enchanting the Phylactery
#5 - Phylactery 4 - Priming via Clone (you transfer ur soul to a clone and kill your true body, so that technically your soul has no true home)
# FYI a lich can only have one phylactery (as it stores it soul), if the phylactery is destroyed the lich can die 
#5 - Potion 1 - Collecting Reagents 1
#6 - Potion 2 - Collecting Reagents 2 (this should have like abcde variants for sending quests)
#7 - Potion 3 - Getting the vessel (aka heart of a loved one/innocent, heart of a unicorn) quest time!
#8 - Dark Ritual 1 - Preparing everything, getting all sorts of dark wards and shit
#9 - Dark Ritual 2 - Cleansing and putting yourself to near death
#10 - Dark Ritual 3 - drinking it (success rate determined by how much money you spent before)
#11 - Lichdom

#Events
# Topping up your Phylactery with souls
# Prob in another event file really
# Resurrection system (you get country flag that says you have an active phylactery, if ruler dies it defines a new ruler with the saved name)

# 1 - Finding out how to do it
country_event = {
	id = magic_project_lichdom.1
	title = magic_project_lichdom.1.t
	desc = magic_project_lichdom.1.d
	picture = BIG_BOOK_eventPicture
	
	trigger = {
		has_ruler_flag = magic_project_lichdom_started
		NOT = { has_ruler_flag = magic_project_lichdom_1 }
		NOT = { has_ruler_flag = magic_project_lichdom_complete }
	}
	
	mean_time_to_happen = {
		months = 3
	}
	
	option = {	#Send Adventurers to find a lost tome
		name = magic_project_lichdom.1.a
		trigger = {
			has_estate = estate_adventurers
		}
		ai_chance = {
			factor = 50
		}
		
		add_treasury = -100
		
		set_ruler_flag = magic_project_lichdom_1
		
		set_ruler_flag = magic_project_lichdom_1_adventurers
		
		custom_tooltip = tooltip_magic_project_advance
	}
	option = {	#Use state resources
		name = magic_project_lichdom.1.b
		ai_chance = {
			factor = 50
		}
		add_adm_power = -30
		add_dip_power = -30
		add_mil_power = -30
		
		add_treasury = -50
		
		set_ruler_flag = magic_project_lichdom_1
		
		set_ruler_flag = magic_project_lichdom_1_state
		
		custom_tooltip = tooltip_magic_project_advance
	}
	option = {	#I'll find it myself!
		name = magic_project_lichdom.1.c
		ai_chance = {
			factor = 50
		}
		add_adm_power = -50
		add_dip_power = -50
		
		set_ruler_flag = magic_project_lichdom_1
		
		set_ruler_flag = magic_project_lichdom_1_myself
		
		custom_tooltip = tooltip_magic_project_advance
	}
}

# 2 - Phylactery 1 - Constructing the Container
country_event = {
	id = magic_project_lichdom.2
	title = magic_project_lichdom.2.t
	desc = magic_project_lichdom.2.d
	picture = DEATH_OF_HEIR_eventPicture
	
	trigger = {
		has_ruler_flag = magic_project_lichdom_1
		NOT = { has_ruler_flag = magic_project_lichdom_2 }
		NOT = { has_ruler_flag = magic_project_lichdom_complete }
	}
	
	mean_time_to_happen = {
		months = 60	#5 years
		modifier = {
			factor = 0.5
			has_ruler_flag = magic_project_lichdom_1_adventurers
		}
		modifier = {
			factor = 0.75
			has_ruler_flag = magic_project_lichdom_1_state
		}
	}
	
	option = {	#An amulet capable of containing a small object
		name = magic_project_lichdom.2.a
		ai_chance = {
			factor = 50
		}
		
		add_treasury = -100
		
		set_ruler_flag = magic_project_lichdom_2
		set_ruler_flag = magic_project_lichdom_2_amulet

		custom_tooltip = tooltip_magic_project_advance
		
	}
	
	option = {	#An ornate, jewel-encrusted box
		name = magic_project_lichdom.2.b
		trigger = {
		
		}
		ai_chance = {
			factor = 50
		}
		
		add_treasury = -200
		
		set_ruler_flag = magic_project_lichdom_2
		set_ruler_flag = magic_project_lichdom_2_box

		custom_tooltip = tooltip_magic_project_advance
		
	}
}

# 3 - Phylactery 2 - Carving the Interiors Walls
country_event = {
	id = magic_project_lichdom.3
	title = magic_project_lichdom.3.t
	desc = magic_project_lichdom.3.d
	picture = DEATH_OF_HEIR_eventPicture
	
	trigger = {
		has_ruler_flag = magic_project_lichdom_2
		NOT = { has_ruler_flag = magic_project_lichdom_3 }
		NOT = { has_ruler_flag = magic_project_lichdom_complete }

	}
	
	mean_time_to_happen = {
		months = 30
	}
	
	option = {	#Scribe dark spells on tiny magical parchments to put inside
		name = magic_project_lichdom.3.a
		ai_chance = {
			factor = 50
		}
		
		add_adm_power = -100
		
		set_ruler_flag = magic_project_lichdom_3

		custom_tooltip = tooltip_magic_project_advance
	}
	
	option = {	#Carve unholy runes on the interior walls and fill them with liquified Damestear
		name = magic_project_lichdom.3.b
		ai_chance = {
			factor = 50
		}
		
		add_dip_power = -100
		
		set_ruler_flag = magic_project_lichdom_3

		custom_tooltip = tooltip_magic_project_advance
	}
	
	option = {	#Coat the insides with enchanted blood of a magical beast
		name = magic_project_lichdom.3.c
		ai_chance = {
			factor = 50
		}
		
		add_mil_power = -100
		
		set_ruler_flag = magic_project_lichdom_3

		custom_tooltip = tooltip_magic_project_advance
	}
}

#4 - Phylactery 3 - Enchanting the Phylactery
country_event = {
	id = magic_project_lichdom.4
	title = magic_project_lichdom.4.t
	desc = magic_project_lichdom.4.d
	picture = DEATH_OF_HEIR_eventPicture
	
	trigger = {
		has_ruler_flag = magic_project_lichdom_3
		NOT = { has_ruler_flag = magic_project_lichdom_4 }
		NOT = { has_ruler_flag = magic_project_lichdom_complete }

	}
	
	mean_time_to_happen = {
		months = 48
	}
	
	option = {	#Perform Dark Enchantments
		name = magic_project_lichdom.4.a
		ai_chance = {
			factor = 50
		}
		
		add_adm_power = -100
		
		set_ruler_flag = magic_project_lichdom_4
		
		increase_witch_king_points_large = yes

		custom_tooltip = tooltip_magic_project_advance
	}
}

#5 - Potion 1 - Collecting Reagents 1
country_event = {
	id = magic_project_lichdom.5
	title = magic_project_lichdom.5.t
	desc = magic_project_lichdom.5.d
	picture = TRADEGOODS_eventPicture
	
	trigger = {
		has_ruler_flag = magic_project_lichdom_4
		NOT = { has_ruler_flag = magic_project_lichdom_5 }
		NOT = { has_ruler_flag = magic_project_lichdom_complete }

	}
	
	mean_time_to_happen = {
		months = 60
	}
	
	option = {	#4 roots of Queen's Belladonna
		name = magic_project_lichdom.5.a
		ai_chance = {
			factor = 50
		}
		
		add_treasury = -100
		
		set_ruler_flag = magic_project_lichdom_5
		set_ruler_flag = magic_project_lichdom_5_a
		
		custom_tooltip = tooltip_magic_project_advance
	}
	
	option = {	#2 bowls of grounded Halanna's Tears
		name = magic_project_lichdom.5.b
		ai_chance = {
			factor = 50
		}
		
		add_treasury = -200
		
		set_ruler_flag = magic_project_lichdom_5
		set_ruler_flag = magic_project_lichdom_5_b
		
		custom_tooltip = tooltip_magic_project_advance
	}
	
	option = {	#10 blooms of Fey-touched Hemlock
		name = magic_project_lichdom.5.c
		ai_chance = {
			factor = 50
		}
		
		add_treasury = -300
		
		set_ruler_flag = magic_project_lichdom_5
		set_ruler_flag = magic_project_lichdom_5_c
		
		custom_tooltip = tooltip_magic_project_advance
	}
}

#6 - Potion 2 - Collecting Reagents 2
country_event = {
	id = magic_project_lichdom.6
	title = magic_project_lichdom.6.t
	desc = magic_project_lichdom.6.d
	picture = TRADEGOODS_eventPicture
	
	trigger = {
		has_ruler_flag = magic_project_lichdom_5
		NOT = { has_ruler_flag = magic_project_lichdom_6 }
		NOT = { has_ruler_flag = magic_project_lichdom_complete }
	}
	
	mean_time_to_happen = {
		months = 24
	}
	
	option = {	#3 grams of Black Damestear
		name = magic_project_lichdom.6.a
		ai_chance = {
			factor = 50
		}
		
		add_treasury = -100
		
		set_ruler_flag = magic_project_lichdom_6
		set_ruler_flag = magic_project_lichdom_6_a
		
		custom_tooltip = tooltip_magic_project_advance
	}
	
	option = {	#6 drops of Neratic Asp Venom
		name = magic_project_lichdom.6.b
		ai_chance = {
			factor = 50
		}
		
		add_treasury = -200
		
		set_ruler_flag = magic_project_lichdom_6
		set_ruler_flag = magic_project_lichdom_6_b
		
		custom_tooltip = tooltip_magic_project_advance
	}
	
	option = {	#1 tincture of Wyvern Blood
		name = magic_project_lichdom.6.c
		ai_chance = {
			factor = 50
		}
		
		add_treasury = -300
		
		set_ruler_flag = magic_project_lichdom_6
		set_ruler_flag = magic_project_lichdom_6_c
		
		custom_tooltip = tooltip_magic_project_advance
	}
}

#7 - Potion 3 - Getting the vessel (aka heart of a loved one/innocent, heart of a unicorn) quest time!
country_event = {
	id = magic_project_lichdom.7
	title = magic_project_lichdom.7.t
	desc = magic_project_lichdom.7.d
	picture = TRADEGOODS_eventPicture
	
	trigger = {
		has_ruler_flag = magic_project_lichdom_6
		NOT = { has_ruler_flag = magic_project_lichdom_7 }
		NOT = { has_ruler_flag = magic_project_lichdom_complete }
	}
	
	mean_time_to_happen = {
		months = 24
	}
	
	option = {	#Obtain the heart of an innocent
		name = magic_project_lichdom.7.a
		ai_chance = {
			factor = 50
		}
		
		add_mil_power = -100
		
		set_ruler_flag = magic_project_lichdom_7
		set_ruler_flag = magic_project_lichdom_7_heart
		
		increase_witch_king_points_large = yes
		
		custom_tooltip = tooltip_magic_project_advance
	}
	
	option = {	#Find me a unicorn and bring me its horn!
		name = magic_project_lichdom.7.b
		ai_chance = {
			factor = 50
		}
		
		add_treasury = -100
		add_mil_power = -100
		
		set_ruler_flag = magic_project_lichdom_7
		set_ruler_flag = magic_project_lichdom_7_unicorn
		
		increase_witch_king_points_large = yes
		
		custom_tooltip = tooltip_magic_project_advance
	}	
}

#8 - Dark Ritual 1 - Preparing everything, getting all sorts of dark wards and shit
country_event = {
	id = magic_project_lichdom.8
	title = magic_project_lichdom.8.t
	desc = magic_project_lichdom.8.d
	picture = FAMINE_eventPicture
	
	trigger = {
		has_ruler_flag = magic_project_lichdom_7
		NOT = { has_ruler_flag = magic_project_lichdom_8 }
		NOT = { has_ruler_flag = magic_project_lichdom_complete }
	}
	
	mean_time_to_happen = {
		months = 24
	}
	
	option = {	#Make the preparations
		name = magic_project_lichdom.8.a
		ai_chance = {
			factor = 50
		}
		
		add_treasury = -100
		
		set_ruler_flag = magic_project_lichdom_8
		
		custom_tooltip = tooltip_magic_project_advance
	}
	
	option = {	#Draw a Circle of Power to improve my chances
		name = magic_project_lichdom.8.b
		trigger = {
			has_ruler_flag = abjuration_2
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 10
				has_ruler_flag = abjuration_2
			}
		}
		highlight = yes
		
		add_adm_power = -100
		
		set_ruler_flag = magic_project_lichdom_8
		set_ruler_flag = magic_project_lichdom_8_a
		
		custom_tooltip = tooltip_magic_project_advance
		
		custom_tooltip = tooltip_option_abjuration_2
	}
	
	#Summon an outsider to give its dark blessing
	
	#Pray to my Dark Patron
	
}

#9 - Dark Ritual 2 - Cleansing and putting yourself to near death
country_event = {
	id = magic_project_lichdom.9
	title = magic_project_lichdom.9.t
	desc = magic_project_lichdom.9.d
	picture = FAMINE_eventPicture
	
	trigger = {
		has_ruler_flag = magic_project_lichdom_8
		NOT = { has_ruler_flag = magic_project_lichdom_9 }
		NOT = { has_ruler_flag = magic_project_lichdom_complete }
	}
	
	mean_time_to_happen = {
		months = 24
	}
	
	option = {	#Begin the cleanse
		name = magic_project_lichdom.9.a
		ai_chance = {
			factor = 50
		}
		
		add_ruler_modifier = {
			name = magic_project_necromancy_ruler_cleansing
			duration = 1095
		}
		
		set_ruler_flag = magic_project_lichdom_9
		
		hidden_effect = { country_event = { id = magic_project_lichdom.10 days = 1095} }
		
		custom_tooltip = tooltip_magic_project_advance
	}
	
	option = {	#Transmutation spells will help quicken the process
		name = magic_project_lichdom.9.b
		trigger = {
			has_ruler_flag = transmutation_2
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 10
				has_ruler_flag = transmutation_2
			}
		}
		highlight = yes
		
		add_ruler_modifier = {
			name = magic_project_necromancy_ruler_cleansing
			duration = 365
		}
		
		hidden_effect = { country_event = { id = magic_project_lichdom.10 days = 365} }
		
		set_ruler_flag = magic_project_lichdom_9
		
		custom_tooltip = tooltip_magic_project_advance
		
		custom_tooltip = tooltip_option_transmutation_1
	}
	
}

#10 - Dark Ritual 3 - drinking it (success rate determined by how much money you spent before)
country_event = {
	id = magic_project_lichdom.10
	title = magic_project_lichdom.10.t
	desc = magic_project_lichdom.10.d
	picture = FAMINE_eventPicture
	
	trigger = {
		has_ruler_flag = magic_project_lichdom_9
		NOT = { has_ruler_flag = magic_project_lichdom_10 }
		NOT = { has_ruler_flag = magic_project_lichdom_complete }
	}
	
	immediate = {
		hidden_effect = { 
			calculate_lichdoom_chance = {
				which = lichdomChance
			}
		}
	}
	
	is_triggered_only = yes
	
	option = {	#Drink
		name = magic_project_lichdom.10.a
		ai_chance = {
			factor = 50
		}
		
		#Some calculations depending on previous shit
		if = {
			limit = {
				check_variable = { which = lichdomChance value = 1 }
				NOT = { check_variable = { which = lichdomChance value = 2 } }
			}
			random_list = {
				60 = {
					country_event  = { id = magic_project_lichdom.11 days = 10 }
				}
				40 = {
					kill_ruler = yes
				}
			}
		}
		else_if = {
			limit = {
				check_variable = { which = lichdomChance value = 2 }
				NOT = { check_variable = { which = lichdomChance value = 3 } }
			}
			random_list = {
				65 = {
					country_event  = { id = magic_project_lichdom.11 days = 10 }
				}
				35 = {
					kill_ruler = yes
				}
			}
		}
		else_if = {
			limit = {
				check_variable = { which = lichdomChance value = 3 }
				NOT = { check_variable = { which = lichdomChance value = 4 } }
			}
			random_list = {
				70 = {
					country_event  = { id = magic_project_lichdom.11 days = 10 }
				}
				30 = {
					kill_ruler = yes
				}
			}
		}
		else_if = {
			limit = {
				check_variable = { which = lichdomChance value = 4 }
				NOT = { check_variable = { which = lichdomChance value = 5 } }
			}
			random_list = {
				75 = {
					country_event  = { id = magic_project_lichdom.11 days = 10 }
				}
				25 = {
					kill_ruler = yes
				}
			}
		}
		else_if = {
			limit = {
				check_variable = { which = lichdomChance value = 5 }
				NOT = { check_variable = { which = lichdomChance value = 6 } }
			}
			random_list = {
				80 = {
					country_event  = { id = magic_project_lichdom.11 days = 10 }
				}
				20 = {
					kill_ruler = yes
				}
			}
		}
		else_if = {
			limit = {
				check_variable = { which = lichdomChance value = 6 }
				NOT = { check_variable = { which = lichdomChance value = 7 } }
			}
			random_list = {
				85 = {
					country_event  = { id = magic_project_lichdom.11 days = 10 }
				}
				15 = {
					kill_ruler = yes
				}
			}
		}
		else_if = {
			limit = {
				check_variable = { which = lichdomChance value = 7 }
				NOT = { check_variable = { which = lichdomChance value = 8 } }
			}
			random_list = {
				90 = {
					country_event  = { id = magic_project_lichdom.11 days = 10 }
				}
				10 = {
					kill_ruler = yes
				}
			}
		}
		else = {
			random_list = {
				50 = {
					country_event  = { id = magic_project_lichdom.11 days = 10 }
				}
				50 = {
					kill_ruler = yes
				}
			}
		}
		
		magic_project_clear_lichdom_flags = yes
		
		set_ruler_flag = magic_project_lichdom_complete

		custom_tooltip = tooltip_magic_project_complete
	}
}

#11 - Ascension to Lichdom
country_event = {
	id = magic_project_lichdom.11
	title = magic_project_lichdom.11.t
	desc = magic_project_lichdom.11.d
	picture = FAMINE_eventPicture
	
	is_triggered_only = yes
	
	immediate = {
		# set_saved_name = {
			# key = lich_ruler_name
			# type = advisor
			# scope = Z99	#Black Demense holds Lich names
		# }
		
		if = {
			limit = {	
				is_female = yes
			}
			set_country_flag = female_lich_ruler
		}
		else = {
			set_country_flag = male_lich_ruler	#for names
		}
		
		export_to_variable = {
			variable_name = lichADM
			value = ADM
		}
		export_to_variable = {
			variable_name = lichDIP
			value = DIP
		}
		export_to_variable = {
			variable_name = lichMIL
			value = MIL
		}
		
		export_to_variable = {
			variable_name = lichAGE
			value = ruler_age
		}
		#A way to save stats, religion, dynasty, etc
		
		ruler_save_spell_schools = yes
		
		add_stability = 1
		
		#NEED TO SAVE WHAT RULER SPELL SCHOOLS THEY HAVE INCASE THEY DIE
		hidden_effect = { clear_scripted_personalities = yes }
		add_ruler_personality = mage_personality
		#exile_ruler_as = my_lich_ruler	#we can use this for deposing them
	}
	
	option = {	#Immortality is mine.
		name = magic_project_lichdom.11.a
		ai_chance = {
			factor = 50
		}
		
		# hidden_effect = { clear_scripted_personalities = yes }
		# add_ruler_personality = immortal_personality
		# add_ruler_personality = mage_personality
		
		add_ruler_personality = immortal_personality
		
		#SOME SORT OF LICH RULER MODIFIER
		
		increase_witch_king_points_large = yes
		
		set_ruler_flag = is_a_lich
		set_ruler_flag = is_a_secret_lich
		
		set_country_flag = lich_ruler
		set_country_flag = lich_ruler_has_phylactery
		
		if = {
			limit = { is_female = yes }
			set_country_flag = lich_ruler_female
		}
		else = {
			set_country_flag = lich_ruler_male
		}
		
		add_ruler_modifier = {
			name = lich_ruler
			duration = -1
		}
		
	}
}

# # Lich Revival
# country_event = {
	# id = magic_project_lichdom.12
	# title = magic_project_lichdom.12.t
	# desc = magic_project_lichdom.12.d
	# picture = COMET_SIGHTED_eventPicture
	
	# is_triggered_only = yes
	
	# trigger = {
		# has_country_flag = lich_ruler
		# has_country_flag = lich_ruler_has_phylactery
	# }
	
	# immediate = {
		# any_province = {
			# limit = { culture = sun_elf }
				# set_saved_name = {
					# key = lich_ruler_name_male
					# type = advisor
					# scope = PREV	#Black Demense holds Lich names
				# }
				# set_saved_name = {
					# key = lich_ruler_name_female
					# type = advisor
					# scope = PREV	#Black Demense holds Lich names
					# female = yes
				# }
		# }
		# set_saved_name = {
			# key = lich_ruler_name_Z99
			# type = advisor
			# scope = A01	#Black Demense holds Lich names
		# }
		# set_saved_name = {
			# key = lich_ruler_name_Z
			# type = advisor
			# scope = lich	#Black Demense holds Lich names
		# }
	# }
	
	# option = {	#I rise again!
		# name = magic_project_lichdom.12.a
		# ai_chance = {
			# factor = 50
		# }
		# # any_country = {
			# # limit = {
				# # tag = A01
			# # }
			# # ROOT = {
				# # if = {
					# # limit = {
						# # has_country_flag = female_lich_ruler
					# # }
					# # define_ruler = {
						# # #name = lich_ruler_name_female
						# # dynasty = PREV
						# # female = yes
						# # culture = PREV
					# # }
				# # }
				# # else = {
					# # define_ruler = {
						# # #name = lich_ruler_name_male
						# # dynasty = PREV
						# # male = yes
						# # culture = PREV
					# # }
				# # }
			# # }
		# #}
		
		# #Regency Council 14 hits and this should fire shortly after
		
		# define_general = {
			# name = lich_ruler_name_male
		# }
		
		# define_general = {
			# name = lich_ruler_name_Z99
		# }
		
		# define_general = {
			# name = lich_ruler_name_Z
		# }
		
		# # hidden_effect = { remove_heir = yes }
		# # define_heir = {
			# # age = 18
			# # dynasty = PREV
			# # no_consort_with_heir = yes
		# # }
		
		# # set_heir_flag = is_a_secret_lich
		
		# # exile_ruler_as = old_heir
		
		# # #Removing Interregnum
		# # #kill_ruler = yes
		
		# # clear_scripted_personalities = yes
		# # add_ruler_personality = immortal_personality
		# # add_ruler_personality = mage_personality
		
		# # increase_witch_king_points_large = yes
		
		# # ruler_give_saved_spell_schools = yes	#links to ruler_save_spell_schools
		
		# # set_country_flag = lich_ruler
		# # set_country_flag = lich_ruler_has_phylactery
	# }
	
	# #Option 2: Free the country
	
	# #Option 3: Disloyal Acolytes say fuck their Lich master and bind them
# }

# # Lich Destroyed (without phylactery)
# country_event = {
	# id = magic_project_lichdom.13
	# title = magic_project_lichdom.13.t
	# desc = magic_project_lichdom.13.d
	# picture = wihgfx_FEMALES_eventPicture
	
	# is_triggered_only = yes	#this should be triggered by other events like adventurers destroying phylactery
	
	# trigger = {
		# has_country_flag = lich_ruler
		# NOT = { has_country_flag = lich_ruler_has_phylactery }
	# }
	
	# option = {	#Noooooooo!
		# name = magic_project_lichdom.13.a
		# ai_chance = {
			# factor = 50
		# }
		
		# kill_ruler = yes
		
		# custom_tooltip = tooltip_lich_destroyed
		
		# #Clear all related lich flags
		# clr_country_flag = lich_ruler
		# clr_country_flag = lich_ruler_has_phylactery #just in case
		# clr_country_flag = male_lich_ruler
		# clr_country_flag = female_lich_ruler
	# }
	
# }

#Lich Death - Regency Council
country_event = {
	id = magic_project_lichdom.12
	title = magic_project_lichdom.12.t
	desc = magic_project_lichdom.12.d
	picture = wihgfx_FEMALES_eventPicture
	
	#is_triggered_only = yes	#this should be triggered by other events like adventurers destroying phylactery
	
	#hidden = yes
	
	trigger = {
		has_country_flag = lich_ruler
		has_country_flag = lich_ruler_has_phylactery
		
		NOT = { has_ruler_flag = is_a_lich }
	}
	
	immediate = {
		if = {
			limit = {
				has_regency = no
			}
			exile_ruler_as = old_heir_turned_ruler
		}
		define_ruler = {
			name = "(Interregnum)"
			#dynasty = ROOT
			adm = 0
			mil = 0
			dip = 0
			regency = yes
		}
		if = {
			limit = {
				has_heir = yes
			}
			exile_heir_as = old_heir
		}
		# 
	}
	
	option = {
		name = magic_project_lichdom.12.a
		ai_chance = {
			factor = 50
		}
		
		if = {
			limit = { has_country_flag = lich_ruler_female }
			define_heir = {
				age = 33
				dynasty = PREV
				no_consort_with_heir = yes
				female = yes
			}
		}
		else = {
			define_heir = {
				age = 33
				dynasty = PREV
				no_consort_with_heir = yes
				male = yes
			}
		}
		
		set_heir_flag = is_a_lich
		set_heir_flag = new_lich_setup
		set_country_flag = interregnum
		
		hidden_effect = { country_event = { id = magic_project_lichdom.13 days = 3 } }
		
	}
	
	option = {
		name = magic_project_lichdom.12.b
		ai_chance = {
			factor = 50
		}
		
		# Z99 = {
			# ROOT = {
				# define_heir = {
					# age = 33
					# dynasty = PREV
					# no_consort_with_heir = yes
				# }
			# }
		# }
		
		if = {
			limit = { has_country_flag = lich_ruler_female }
			define_heir = {
				age = 33
				dynasty = " "
				no_consort_with_heir = yes
				female = yes
			}
		}
		else = {
			define_heir = {
				age = 33
				dynasty = " "
				no_consort_with_heir = yes
				male = yes
			}
		}
		
		set_heir_flag = is_a_lich
		set_heir_flag = new_lich_setup
		set_country_flag = interregnum
		
		hidden_effect = { country_event = { id = magic_project_lichdom.13 days = 3 } }
	}
	
}


#Lich Reborn - initialization giving spell schools to ascending ruler
country_event = {
	id = magic_project_lichdom.13
	title = magic_project_lichdom.13.t
	desc = magic_project_lichdom.13.d
	picture = wihgfx_FEMALES_eventPicture
	
	is_triggered_only = yes	#this should be triggered by other events like adventurers destroying phylactery
	
	hidden = yes
	
	trigger = {
		has_ruler_flag = is_a_lich
		has_country_flag = interregnum
		has_regency = no
		
		has_ruler_flag = new_lich_setup
	}
	
	option = {
		name = magic_project_lichdom.13.a
		ai_chance = {
			factor = 50
		}
		if = {
			limit = {
				NOT = { ruler_age = 33 }
			}
			kill_ruler = yes
		}
		clr_country_flag = interregnum
		
		clr_heir_flag = new_lich_setup
		clr_ruler_flag = new_lich_setup
		
		clear_scripted_personalities = yes
		add_ruler_personality = immortal_personality
		add_ruler_personality = mage_personality
		
		increase_witch_king_points_large = yes
		
		ruler_give_saved_spell_schools = yes	#links to ruler_save_spell_schools
		
		set_heir = old_heir_turned_ruler
		
		add_ruler_modifier = {
			name = lich_ruler
			duration = -1
		}
	}

	
}