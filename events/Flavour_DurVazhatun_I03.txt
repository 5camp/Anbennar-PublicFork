namespace = flavor_vazhatun

#1-89 missions

################
####Missions####
################

#Restoration of the Setzunkhûpa
country_event = {
	id = flavor_vazhatun.1
	title = flavor_vazhatun.1.t
	desc = flavor_vazhatun.1.d
	picture = FORT_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = flavor_vazhatun.1.a	
		vazhatun_unlock_astronomy = yes
	}
}

#Contact with Krakdhumvror
country_event = {
	id = flavor_vazhatun.2
	title = flavor_vazhatun.2.t
	desc = flavor_vazhatun.2.d
	picture = FORT_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = flavor_vazhatun.2.a
			
		reverse_add_opinion = {
    			who = I02
    			modifier = insulted
		}
		
		add_casus_belli = {
    			target = I02
    			type = cb_vassalize_mission
    			months = 120
		}
	}
}

#The fall of Dûr_Vazhatun
country_event = {
	id = flavor_vazhatun.3
	title = flavor_vazhatun.3.t
	desc = flavor_vazhatun.3.d
	picture = FORT_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = flavor_vazhatun.3.a
		
		hidden_respite_area = { add_permanent_claim = ROOT }
		lonely_mountains_area = { add_permanent_claim = ROOT }
		
		add_country_modifier = {
			name = vazhatun_astral_cautiousness
			duration = 1825
		}
	}
}

#Scouring the remains
country_event = {
	id = flavor_vazhatun.4
	title = flavor_vazhatun.4.t
	desc = flavor_vazhatun.4.d
	picture = FORT_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = flavor_vazhatun.4.a

		vazhatun_increase_astral_efficiency = yes
		
		tanning_valley_area = { add_permanent_claim = ROOT }
		far_moitsa_area = { add_permanent_claim = ROOT }
		upper_logr_area = { add_permanent_claim = ROOT }
		skurkha_kyard_area = { add_permanent_claim = ROOT }
		
		add_country_modifier = { 
			name = vazhatun_research_stations_located 
			duration = 5475
		}
		
		custom_tooltip = vazhatun_enable_knowledge_from_digging_tt
		hidden_effect = { set_country_flag = vazhatun_enable_knowledge_from_digging }
	}
}

#Dealing with the Terror
country_event = {
	id = flavor_vazhatun.5
	title = flavor_vazhatun.5.t
	desc = flavor_vazhatun.5.d
	picture = FORT_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = flavor_vazhatun.5.a
			
		custom_tooltip = vazhatun_unlock_clergy_privileges_tt
	}
}

#Contact with the Kukatodic
country_event = {
	id = flavor_vazhatun.6
	title = flavor_vazhatun.6.t
	desc = flavor_vazhatun.6.d
	picture = FORT_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = flavor_vazhatun.6.a
		yyl_moista_region = {
			discover_country = ROOT
			
			if = {
				limit = { culture = kukatodic }

				change_native_hostileness = -2
			}
		}

		add_country_modifier = {
			name = vazhatun_kukatodic_relations
			duration = 9125
		}
	}
}

#The hidden archive
country_event = {
	id = flavor_vazhatun.7
	title = flavor_vazhatun.7.t
	desc = flavor_vazhatun.7.d
	picture = FORT_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = flavor_vazhatun.7.a
		
		vazhatun_increase_astral_efficiency_small = yes

		#TODO
		#Unlocks custom expedition target in Dûr-Vazhatun that triggers event Astronomer's Sanctum event (flavor_vazhatun.7) when comleted
	}
}

#Astronomer's sanctum
country_event = {
	id = flavor_vazhatun.8
	title = flavor_vazhatun.8.t
	desc = flavor_vazhatun.8.d
	picture = FORT_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = flavor_vazhatun.8.a
		#TODO
		#Required for Damestear Expedition and Secrets Applied missions
	}
}

#The Kovtalzar academy
country_event = {
	id = flavor_vazhatun.9
	title = flavor_vazhatun.9.t
	desc = flavor_vazhatun.9.d
	picture = FORT_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = flavor_vazhatun.9.a
		
		4020 = {
			add_building_construction = {
    			building = university
    			speed = 1
    			cost = 0.5
			}
		}

		vazhatun_increase_astral_efficiency = yes

		hidden_effect = { set_country_flag = vazhatun_kovtalzar_unlocked }
		custom_tooltip = vazhatun_kovtalzar_unlocked_tt
	}
}

#The Yikashlay delegation
country_event = {
	id = flavor_vazhatun.10
	title = flavor_vazhatun.10.t
	desc = flavor_vazhatun.10.d
	picture = FORT_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = flavor_vazhatun.10.a
		
		4020 = { add_human_minority_size_effect = yes }

		vazhatun_increase_astral_efficiency_large = yes

		5287 = {
			owner = {
				if = {
					limit = {
						NOT = {
							has_country_modifier = monstrous_nation
							has_country_flag = semi_monstrous
							ai_attitude = {
								who = ROOT
								attitude = attitude_hostile
							}
						}
					}
					add_opinion = {
    					who = ROOT
						modifier = vazhatun_scholarly_exchange
					}
				}
			}
		}
		
		hidden_effect = { set_country_flag = vazhatun_yikashlay_unlocked }
		custom_tooltip = vazhatun_yikashlay_unlocked_tt
	}
}

#Damestear research
country_event = {
	id = flavor_vazhatun.11
	title = flavor_vazhatun.11.t
	desc = flavor_vazhatun.11.d
	picture = FORT_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = flavor_vazhatun.11.a
		
		add_country_modifier = {
			name = vazhatun_damestear_research
			duration = -1
		}
	}

	option = {
		name = flavor_vazhatun.11.b

		trigger = {
			owns = 5006
		}
		
		5006 = {
			remove_province_modifier = vazhatun_careful_extraction
			hidden_effect = {
					clr_province_flag = permanent_damestear
				}
		}

		add_country_modifier = {
			name = vazhatun_damestear_research
			duration = -1
		}
	}
}

#Anbenncost connections
country_event = {
	id = flavor_vazhatun.12
	title = flavor_vazhatun.12.t
	desc = flavor_vazhatun.12.d
	picture = FORT_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = flavor_vazhatun.12.a
		
		add_country_modifier = {
			name = vazhatun_connections_in_anbenncost
			duration = -1
		}

		add_treasury = -2000
		if = {
			limit = {
				8 = {
					feudalism = 100
				}
			}
			4020 = {
				add_institution_embracement = {
    				which = feudalism
    				value = 50
				}
			}
		}
		if = {
			limit = {
				8 = {
					renaissance = 100
				}
			}
			4020 = {
				add_institution_embracement = {
    				which = renaissance
    				value = 50
				}
			}
		}
		if = {
			limit = {
				8 = {
					new_world_i = 100
				}
			}
			4020 = {
				add_institution_embracement = {
    				which = new_world_i
    				value = 50
				}
			}
		}
		if = {
			limit = {
				8 = {
					printing_press = 100
				}
			}
			4020 = {
				add_institution_embracement = {
    				which = printing_press
    				value = 50
				}
			}
		}
		if = {
			limit = {
				8 = {
					global_trade = 100
				}
			}
			4020 = {
				add_institution_embracement = {
    				which = global_trade
    				value = 50
				}
			}
		}
		if = {
			limit = {
				8 = {
					manufactories = 100
				}
			}
			4020 = {
				add_institution_embracement = {
    				which = manufactories
    				value = 50
				}
			}
		}
		if = {
			limit = {
				8 = {
					enlightenment = 100
				}
			}
			4020 = {
				add_institution_embracement = {
    				which = enlightenment
    				value = 50
				}
			}
		}
		if = {
			limit = {
				8 = {
					industrialization = 100
				}
			}
			4020 = {
				add_institution_embracement = {
    				which = industrialization
    				value = 50
				}
			}
		}
	}
}

#Damish knowledge
country_event = {
	id = flavor_vazhatun.13
	title = flavor_vazhatun.13.t
	desc = flavor_vazhatun.13.d
	picture = FORT_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = flavor_vazhatun.13.a
		
		add_country_modifier = {
			name = vazhatun_damish_learning
			duration = 10950
		}

		vazhatun_increase_astral_efficiency = yes

		custom_tooltip = vazhatun_lose_50_astral_knowledge_tt
		hidden_effect = {
			subtract_variable = {
				which = astral_knowledge
				value = 50
			}
		}

		8 = {
			owner = {
				if = {
					limit = {
						NOT = {
							has_country_modifier = monstrous_nation
							has_country_flag = semi_monstrous
							ai_attitude = {
								who = ROOT
								attitude = attitude_hostile
							}
						}
					}
					add_opinion = {
    					who = ROOT
						modifier = vazhatun_scholarly_exchange
					}
				}
			}
		}
		
		custom_tooltip = vazhatun_moonmount_unlocked_tt
		hidden_effect = { set_country_flag = vazhatun_moonmount_unlocked }
	}
}

#Magisterium scholars
country_event = {
	id = flavor_vazhatun.14
	title = flavor_vazhatun.14.t
	desc = flavor_vazhatun.14.d
	picture = FORT_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = flavor_vazhatun.14.a

		custom_tooltip = vazhatun_enhance_mage_privilege_tt
		hidden_effect = {
			if = {
				limit = { has_estate_privilege = estate_mages_vazhatun_study_runes }
				vazhatun_increase_astral_efficiency = yes
			}
		}

		hidden_effect = { set_country_flag = vazhatun_magisterium_unlocked }
		custom_tooltip = vazhatun_magisterium_unlocked_tt
	}
}

#Konwell books
country_event = {
	id = flavor_vazhatun.15
	title = flavor_vazhatun.15.t
	desc = flavor_vazhatun.15.d
	picture = FORT_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = flavor_vazhatun.15.a

		if = {
			limit = { is_institution_enabled = printing_press}
			every_owned_province = {
				if = {
					limit = {
						OR = {
							has_terrain = dwarven_hold
							has_terrain = dwarven_hold_surface
							has_terrain = urban
						}
						NOT = { printing_press = 100 }
					}
					add_institution_embracement = {
    					which = printing_press
    					value = 100
					}
				}
			}
		}

		add_country_modifier = {
			name = vazhatun_printing_techniques
			duration = -1
		}

		vazhatun_increase_astral_efficiency_large = yes

		hidden_effect = { set_country_flag = vazhatun_konwell_unlocked }
		custom_tooltip = vazhatun_konwell_unlocked_tt
	}
}

#Yangcheng academy
country_event = {
	id = flavor_vazhatun.16
	title = flavor_vazhatun.16.t
	desc = flavor_vazhatun.16.d
	picture = FORT_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = flavor_vazhatun.16.a

		custom_tooltip = vazhatun_lose_50_astral_knowledge_tt
		hidden_effect = {
			subtract_variable = {
				which = astral_knowledge
				value = 50
			}
		}

		add_country_modifier = {
			name = vazhatun_academy_innovations
			duration = 14600
		}

		hidden_effect = { set_country_flag = vazhatun_yangcheng_unlocked }
		custom_tooltip = vazhatun_yangcheng_unlocked_tt
	}
}

#The bustling Tianlou
country_event = {
	id = flavor_vazhatun.17
	title = flavor_vazhatun.17.t
	desc = flavor_vazhatun.17.d
	picture = FORT_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = flavor_vazhatun.17.a

		add_country_modifier = {
			name = vazhatun_connections_in_tianlou
			duration = 5475
		}

		hidden_effect = { set_country_flag = vazhatun_tianlou_unlocked }
		custom_tooltip = vazhatun_tianlou_unlocked_tt
	}
}

#Astral prophecies
country_event = {
	id = flavor_vazhatun.18
	title = flavor_vazhatun.18.t
	desc = flavor_vazhatun.18.d
	picture = FORT_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = flavor_vazhatun.18.a

		vazhatun_increase_astral_efficiency = yes
		
		hidden_effect = { set_country_flag = vazhatun_tughayasa_unlocked }
		custom_tooltip = vazhatun_tughayasa_unlocked_tt
	}
}

#Ravelian scholars
country_event = {
	id = flavor_vazhatun.19
	title = flavor_vazhatun.19.t
	desc = flavor_vazhatun.19.d
	picture = FORT_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = flavor_vazhatun.19.a

		mission_reward_artifice_points_1 = yes

		Z97 = {
			if = {
				limit = {
					NOT = {
						has_country_modifier = monstrous_nation
						has_country_flag = semi_monstrous
						ai_attitude = {
							who = ROOT
							attitude = attitude_hostile
						}
					}
				}
				add_opinion = {
    				who = ROOT
					modifier = vazhatun_ravelian_relations
				}
			}
		}

		hidden_effect = { set_country_flag = vazhatun_rectorate_unlocked }
		custom_tooltip = vazhatun_rectorate_unlocked_tt
	}
}

#Messenger from the stars
country_event = {
	id = flavor_vazhatun.20
	title = flavor_vazhatun.20.t
	desc = flavor_vazhatun.20.d
	picture = FORT_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = flavor_vazhatun.20.a

		4182 = { add_devastation = 50 }

		
		vazhatun_raise_terror = { small = yes }

		#Note: Second event happens once 4182 reaches 0 devastation
	}
}

#Astral glow
#Note: Should start after vazhatun.20 once 4182 reaches 0 devastation
country_event = {
	id = flavor_vazhatun.21
	title = flavor_vazhatun.21.t
	desc = flavor_vazhatun.21.d
	picture = FORT_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = flavor_vazhatun.21.a

		4182 = {
			change_trade_goods = dyes
			add_permanent_province_modifier = {
				name = vazhatun_astral_glow
				duration = -1
			}
		}

		vazhatun_raise_terror = { small = yes }

		#Note: Next event happens at least one year later once 4182 reaches 7 base production. Periodical events inbetween will increase its base produciton by 1.
	}
}

#Astral glow fascination
#Note: Should happen periodically after vazhatun.21 and before vazhatun.23
country_event = {
	id = flavor_vazhatun.22
	title = flavor_vazhatun.22.t
	desc = flavor_vazhatun.22.d
	picture = FORT_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = flavor_vazhatun.22.a

		4182 = { add_base_production = 1 }
	}
}

#Strange sightings
#Note: Should start at least one year after vazhatun.21 once 4182 reaches 7 base production
country_event = {
	id = flavor_vazhatun.23
	title = flavor_vazhatun.23.t
	desc = flavor_vazhatun.23.d
	picture = FORT_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = flavor_vazhatun.23.a

		add_country_modifier = {
			name = vazhatun_glowing_terror
			duration = 1
		}

		#Note: Next event happens once you put an army in 4182
	}
}

#Glowing horror
#Note: Should start after vazhatun.23 once you put an army in 4182
country_event = {
	id = flavor_vazhatun.24
	title = flavor_vazhatun.24.t
	desc = flavor_vazhatun.24.d
	picture = FORT_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = flavor_vazhatun.24.a

		#TODO
		#Glowing mutant rebels spawn in 4182 and lonely_mountains_area, all of these provinces also immediately become rebel controlled
		#Defeating them gives vazhatun.25, losing gives vazhatun.26
	}
}

#Astral hues
#Note: Should happen if you defeat the rebels in vazhatun.24
country_event = {
	id = flavor_vazhatun.25
	title = flavor_vazhatun.25.t
	desc = flavor_vazhatun.25.d
	picture = FORT_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = flavor_vazhatun.25.a

		remove_country_modifier = vazhatun_glowing_terror
		
		4182 = {
			remove_province_modifier = vazhatun_astral_glow
			
			add_permanent_province_modifier = {
				name = vazhatun_astral_hues
				duration = -1
			}
		}
		lonely_mountains_area = {
			change_trade_goods = dyes
			add_permanent_province_modifier = {
				name = vazhatun_astral_hues
				duration = -1
			}
		}

		vazhatun_drop_terror = { small = yes }
	}
}

#Message recieved
#Note: Should happen if you lose to the rebels in vazhatun.24
country_event = {
	id = flavor_vazhatun.26
	title = flavor_vazhatun.26.t
	desc = flavor_vazhatun.26.d
	picture = FORT_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = flavor_vazhatun.26.a

		remove_country_modifier = vazhatun_glowing_terror
		
		4182 = {
			remove_province_modifier = vazhatun_astral_glow
			#TODO
			#Restore old trade good
		}
		
		#TODO
		#Decolonise all glowing mutant-controlled proovinces in Seprent's Vale, Northern Pass and Forbidden Lands.
		#They get 1000 natives per development and max ferocity and aggressiveness

		vazhatun_raise_terror = { small = yes }
	}
}


#############
# ASTRONOMY #
#############

## Change terror stage ##

# Terror 0 -> 1
country_event = {
	id = flavor_vazhatun.90
	title = flavor_vazhatun.90.t
	desc = flavor_vazhatun.90.d
	picture = ARTWORK_eventPicture
	
	mean_time_to_happen = {
		months = 96
		modifier = {
			factor = 0.8
			has_disaster_progress = {
				disaster = astral_terror
				value = 20
			}
		}
		modifier = {
			factor = 0.01
			has_disaster_progress = {
				disaster = astral_terror
				value = 25
			}
		}
	}
	
	trigger = {
		tag = I03
		has_disaster_progress = {
			disaster = astral_terror
			value = 15
		}
		NOT = { has_disaster = astral_terror }
		NOT = { has_country_modifier = vazhatun_terror_1 }
		NOT = { has_country_modifier = vazhatun_terror_2 }
		NOT = { has_country_modifier = vazhatun_terror_3 }
	}
	
	option = {
		name = flavor_vazhatun.90.a
		
		add_country_modifier = {
			name = vazhatun_terror_1
			duration = -1
		}
	}
}


# Terror 1 -> 2
country_event = {
	id = flavor_vazhatun.91
	title = flavor_vazhatun.91.t
	desc = flavor_vazhatun.91.d
	picture = ARTWORK_eventPicture
	
	mean_time_to_happen = {
		months = 96
		modifier = {
			factor = 0.8
			has_disaster_progress = {
				disaster = astral_terror
				value = 45
			}
		}
		modifier = {
			factor = 0.01
			has_disaster_progress = {
				disaster = astral_terror
				value = 50
			}
		}
	}
	
	trigger = {
		tag = I03
		has_disaster_progress = {
			disaster = astral_terror
			value = 40
		}
		NOT = { has_disaster = astral_terror }
		has_country_modifier = vazhatun_terror_1
	}
	
	option = {
		name = flavor_vazhatun.91.a
		
		add_country_modifier = {
			name = vazhatun_terror_2
			duration = -1
		}
		hidden_effect = { remove_country_modifier = vazhatun_terror_1 }

	}
}

# Terror 2 -> 3
country_event = {
	id = flavor_vazhatun.92
	title = flavor_vazhatun.92.t
	desc = flavor_vazhatun.92.d
	picture = ARTWORK_eventPicture
	
	mean_time_to_happen = {
		months = 96
		modifier = {
			factor = 0.8
			has_disaster_progress = {
				disaster = astral_terror
				value = 70
			}
		}
		modifier = {
			factor = 0.01
			has_disaster_progress = {
				disaster = astral_terror
				value = 75
			}
		}
	}
	
	trigger = {
		tag = I03
		has_disaster_progress = {
			disaster = astral_terror
			value = 65
		}
		NOT = { has_disaster = astral_terror }
		has_country_modifier = vazhatun_terror_2
	}
	
	option = {
		name = flavor_vazhatun.92.a
		
		add_country_modifier = {
			name = vazhatun_terror_3
			duration = -1
		}
		hidden_effect = { remove_country_modifier = vazhatun_terror_2 }

	}
}

# Terror 1 -> 0
country_event = {
	id = flavor_vazhatun.93
	title = flavor_vazhatun.93.t
	desc = flavor_vazhatun.93.d
	picture = ARTWORK_eventPicture
	
	mean_time_to_happen = {
		months = 96
		modifier = {
			factor = 0.8
			NOT = {
				has_disaster_progress = {
					disaster = astral_terror
					value = 5
				}
			}
		}
		modifier = {
			factor = 0.01
			NOT = {
				has_disaster_progress = {
					disaster = astral_terror
					value = 1
				}
			}
		}
	}
	
	trigger = {
		tag = I03
		NOT = {
			has_disaster_progress = {
				disaster = astral_terror
				value = 10
			}
		}
		NOT = { has_disaster = astral_terror }
		has_country_modifier = vazhatun_terror_1
	}
	
	option = {
		name = flavor_vazhatun.93.a
		
		remove_country_modifier = vazhatun_terror_1
	}
}

# Terror 2 -> 1
country_event = {
	id = flavor_vazhatun.94
	title = flavor_vazhatun.94.t
	desc = flavor_vazhatun.94.d
	picture = ARTWORK_eventPicture
	
	mean_time_to_happen = {
		months = 96
		modifier = {
			factor = 0.8
			NOT = {
				has_disaster_progress = {
					disaster = astral_terror
					value = 30
				}
			}
		}
		modifier = {
			factor = 0.01
			NOT = {
				has_disaster_progress = {
					disaster = astral_terror
					value = 25
				}
			}
		}
	}
	
	trigger = {
		tag = I03
		NOT = {
			has_disaster_progress = {
				disaster = astral_terror
				value = 35
			}
		}
		NOT = { has_disaster = astral_terror }
		has_country_modifier = vazhatun_terror_2
	}
	
	option = {
		name = flavor_vazhatun.94.a
		
		add_country_modifier = {
			name = vazhatun_terror_1
			duration = -1
		}
		hidden_effect = { remove_country_modifier = vazhatun_terror_2 }
	}
}

# Terror 3 -> 2
country_event = {
	id = flavor_vazhatun.95
	title = flavor_vazhatun.95.t
	desc = flavor_vazhatun.95.d
	picture = ARTWORK_eventPicture
	
	mean_time_to_happen = {
		months = 96
		modifier = {
			factor = 0.8
			NOT = {
				has_disaster_progress = {
					disaster = astral_terror
					value = 55
				}
			}
		}
		modifier = {
			factor = 0.01
			NOT = {
				has_disaster_progress = {
					disaster = astral_terror
					value = 50
				}
			}
		}
	}
	
	trigger = {
		tag = I03
		NOT = {
			has_disaster_progress = {
				disaster = astral_terror
				value = 60
			}
		}
		NOT = { has_disaster = astral_terror }
		has_country_modifier = vazhatun_terror_3
	}
	
	option = {
		name = flavor_vazhatun.95.a
		
		add_country_modifier = {
			name = vazhatun_terror_2
			duration = -1
		}
		hidden_effect = { remove_country_modifier = vazhatun_terror_3 }
	}
}

## Spending Astral Knowledge ##
country_event = {
	id = flavor_vazhatun.96
	title = flavor_vazhatun.96.t
	title = flavor_vazhatun.96.t
	desc = flavor_vazhatun.96.d
	picture = ARTWORK_eventPicture
	
	is_triggered_only = yes
	trigger = {
		tag = I03
	}
	
	# yikashlay
	option = {
		trigger = { has_country_flag = vazhatun_yikashlay_unlocked }
	
		name = flavor_vazhatun.96.a
		if = {
			limit = { NOT = { monthly_income = 15 } }
			define_advisor = {
				type = natural_scientist
				location = 4020 # TODO
				discount = yes
				skill = 1
			}
		}
		else_if = {
			limit = { NOT = { monthly_income = 25 } }
			define_advisor = {
				type = natural_scientist
				location = 4020 # TODO
				discount = yes
				skill = 2
			}
		}
		else = {
			define_advisor = {
				type = natural_scientist
				location = 4020 # TODO
				discount = yes
				skill = 3
			}
		}
		vazhatun_spend_knowledge = yes
		hidden_effect = { country_event = { id = flavor_vazhatun.97 } }
	}
	
	# anbenncost
	option = {
		trigger = {
			has_country_flag = vazhatun_anbenncost_unlocked
			NOT = { prestige = 100 }
		}
		name = flavor_vazhatun.96.b
		add_prestige = 10
		vazhatun_spend_knowledge = yes
		hidden_effect = { country_event = { id = flavor_vazhatun.97 } }
	}
	
	# rectorate
	option = {
		name = flavor_vazhatun.96.c
		trigger = {
			has_country_flag = vazhatun_rectorate_unlocked
		}
		mission_reward_artifice_points_1 = yes
		vazhatun_spend_knowledge = yes
		hidden_effect = { country_event = { id = flavor_vazhatun.97 } }
	}
	
	# yangcheng
	option = {
		trigger = {
			has_country_flag = vazhatun_yangcheng_unlocked
			NOT = { innovativeness = 100 }
		}
		name = flavor_vazhatun.96.e
		change_innovativeness = 3
		vazhatun_spend_knowledge = yes
		hidden_effect = { country_event = { id = flavor_vazhatun.97 } }
	}
	
	# kovtalzar
	option = {
		trigger = {
			has_country_flag = vazhatun_kovtalzar_unlocked
			NOT = { has_country_modifier = vazhatun_kovtalzar }
		}
		name = flavor_vazhatun.96.f
		add_country_modifier = {
			name = vazhatun_kovtalzar
			duration = 3650
		}
		vazhatun_spend_knowledge = yes
		hidden_effect = { country_event = { id = flavor_vazhatun.97 } }
	}
	
	# konwell
	option = {
		trigger = {
			has_country_flag = vazhatun_konwell_unlocked
			is_lacking_institutions = yes
			any_owned_province = {
				OR = {
					has_terrain = dwarven_hold
					has_terrain = dwarven_hold_surface
					has_terrain = city_terrain
				}
			}
		}
		name = flavor_vazhatun.96.g
		every_owned_province = {
			limit = {
				OR = {
					has_terrain = dwarven_hold
					has_terrain = dwarven_hold_surface
					has_terrain = city_terrain
				}
			}
			add_next_institution_embracement = 100
		}
		vazhatun_spend_knowledge = yes
		hidden_effect = { country_event = { id = flavor_vazhatun.97 } }
	}
	
	# tianlou
	option = {
		trigger = {
			has_country_flag = vazhatun_tianlou_unlocked
		}
		name = flavor_vazhatun.96.h
		add_years_of_income = 1
		vazhatun_spend_knowledge = yes
		hidden_effect = { country_event = { id = flavor_vazhatun.97 } }
	}
	
	# moonmount
	option = {
		trigger = {
			has_country_flag = vazhatun_moonmount_unlocked
			NOT = { has_country_modifier = vazhatun_moonmount }
		}
		name = flavor_vazhatun.96.i
		add_country_modifier = {
			name = vazhatun_moonmount
			duration = 3650
		}
		vazhatun_spend_knowledge = yes
		hidden_effect = { country_event = { id = flavor_vazhatun.97 } }
	}
	
	# tughayasa
	option = {
		trigger = {
			has_country_flag = vazhatun_tughayasa_unlocked
			NOT = { has_country_modifier = vazhatun_tughayasa }
		}
		name = flavor_vazhatun.96.j
		add_country_modifier = {
			name = vazhatun_tughayasa
			duration = 3650
		}
		vazhatun_spend_knowledge = yes
		hidden_effect = { country_event = { id = flavor_vazhatun.97 } }
	}
	
	# magisterium
	option = {
		trigger = {
			has_country_flag = vazhatun_magisterium_unlocked
		}
		name = flavor_vazhatun.96.k
		if = {
			limit = { NOT = { monthly_income = 15 } }
			define_advisor = {
				type = court_mage
				location = 4020 # TODO
				discount = yes
				skill = 1
			}
		}
		else_if = {
			limit = { NOT = { monthly_income = 25 } }
			define_advisor = {
				type = court_mage
				location = 4020 # TODO
				discount = yes
				skill = 2
			}
		}
		else = {
			define_advisor = {
				type = court_mage
				location = 4020 # TODO
				discount = yes
				skill = 3
			}
		}
		vazhatun_spend_knowledge = yes
		hidden_effect = { country_event = { id = flavor_vazhatun.97 } }
	}
	
	# Close menu
	option = {
		name = flavor_vazhatun.96.m
		hidden_effect = { clr_country_flag = vazhatun_astral_menu_open }
	}
}

# Spending astral knowledge mirror
country_event = {
	id = flavor_vazhatun.97
	title = flavor_vazhatun.96.t # intentional (shares same loc as event 96)
	title = flavor_vazhatun.96.t
	desc = flavor_vazhatun.96.d
	picture = ARTWORK_eventPicture
	
	is_triggered_only = yes
	trigger = {
		tag = I03
	}
	
	# yikashlay
	option = {
		trigger = { has_country_flag = vazhatun_yikashlay_unlocked }
	
		name = flavor_vazhatun.96.a
		if = {
			limit = { NOT = { monthly_income = 15 } }
			define_advisor = {
				type = natural_scientist
				location = 4020 # TODO
				discount = yes
				skill = 1
			}
		}
		else_if = {
			limit = { NOT = { monthly_income = 25 } }
			define_advisor = {
				type = natural_scientist
				location = 4020 # TODO
				discount = yes
				skill = 2
			}
		}
		else = {
			define_advisor = {
				type = natural_scientist
				location = 4020 # TODO
				discount = yes
				skill = 3
			}
		}
		vazhatun_spend_knowledge = yes
		hidden_effect = { country_event = { id = flavor_vazhatun.96 } }
	}
	
	# anbenncost
	option = {
		trigger = {
			has_country_flag = vazhatun_anbenncost_unlocked
			NOT = { prestige = 100 }
		}
		name = flavor_vazhatun.96.b
		add_prestige = 10
		vazhatun_spend_knowledge = yes
		hidden_effect = { country_event = { id = flavor_vazhatun.96 } }
	}
	
	# rectorate
	option = {
		name = flavor_vazhatun.96.c
		trigger = {
			has_country_flag = vazhatun_rectorate_unlocked
		}
		mission_reward_artifice_points_1 = yes
		vazhatun_spend_knowledge = yes
		hidden_effect = { country_event = { id = flavor_vazhatun.96 } }
	}
	
	# yangcheng
	option = {
		trigger = {
			has_country_flag = vazhatun_yangcheng_unlocked
			NOT = { innovativeness = 100 }
		}
		name = flavor_vazhatun.96.e
		change_innovativeness = 3
		vazhatun_spend_knowledge = yes
		hidden_effect = { country_event = { id = flavor_vazhatun.96 } }
	}
	
	# kovtalzar
	option = {
		trigger = {
			has_country_flag = vazhatun_kovtalzar_unlocked
			NOT = { has_country_modifier = vazhatun_kovtalzar }
		}
		name = flavor_vazhatun.96.f
		add_country_modifier = {
			name = vazhatun_kovtalzar
			duration = 3650
		}
		vazhatun_spend_knowledge = yes
		hidden_effect = { country_event = { id = flavor_vazhatun.96 } }
	}
	
	# konwell
	option = {
		trigger = {
			has_country_flag = vazhatun_konwell_unlocked
			is_lacking_institutions = yes
			any_owned_province = {
				OR = {
					has_terrain = dwarven_hold
					has_terrain = dwarven_hold_surface
					has_terrain = city_terrain
				}
			}
		}
		name = flavor_vazhatun.96.g
		every_owned_province = {
			limit = {
				OR = {
					has_terrain = dwarven_hold
					has_terrain = dwarven_hold_surface
					has_terrain = city_terrain
				}
			}
			add_next_institution_embracement = 100
		}
		vazhatun_spend_knowledge = yes
		hidden_effect = { country_event = { id = flavor_vazhatun.96 } }
	}
	
	# tianlou
	option = {
		trigger = {
			has_country_flag = vazhatun_tianlou_unlocked
		}
		name = flavor_vazhatun.96.h
		add_years_of_income = 1
		vazhatun_spend_knowledge = yes
		hidden_effect = { country_event = { id = flavor_vazhatun.96 } }
	}
	
	# moonmount
	option = {
		trigger = {
			has_country_flag = vazhatun_moonmount_unlocked
			NOT = { has_country_modifier = vazhatun_moonmount }
		}
		name = flavor_vazhatun.96.i
		add_country_modifier = {
			name = vazhatun_moonmount
			duration = 3650
		}
		vazhatun_spend_knowledge = yes
		hidden_effect = { country_event = { id = flavor_vazhatun.96 } }
	}
	
	# tughayasa
	option = {
		trigger = {
			has_country_flag = vazhatun_tughayasa_unlocked
			NOT = { has_country_modifier = vazhatun_tughayasa }
		}
		name = flavor_vazhatun.96.j
		add_country_modifier = {
			name = vazhatun_tughayasa
			duration = 3650
		}
		vazhatun_spend_knowledge = yes
		hidden_effect = { country_event = { id = flavor_vazhatun.96 } }
	}
	
	# magisterium
	option = {
		trigger = {
			has_country_flag = vazhatun_magisterium_unlocked
		}
		name = flavor_vazhatun.96.k
		if = {
			limit = { NOT = { monthly_income = 15 } }
			define_advisor = {
				type = court_mage
				location = 4020 # TODO
				discount = yes
				skill = 1
			}
		}
		else_if = {
			limit = { NOT = { monthly_income = 25 } }
			define_advisor = {
				type = court_mage
				location = 4020 # TODO
				discount = yes
				skill = 2
			}
		}
		else = {
			define_advisor = {
				type = court_mage
				location = 4020 # TODO
				discount = yes
				skill = 3
			}
		}
		vazhatun_spend_knowledge = yes
		hidden_effect = { country_event = { id = flavor_vazhatun.96 } }
	}
	
	# Close menu
	option = {
		name = flavor_vazhatun.96.m
		hidden_effect = { clr_country_flag = vazhatun_astral_menu_open }
	}
}

# Disable astral knowledge when dur-vazhatun is lost
province_event = {
	id = flavor_vazhatun.98
	title = flavor_vazhatun.98.t
	desc = flavor_vazhatun.98.d
	picture = ARTWORK_eventPicture
	hidden = yes
	
	is_triggered_only = yes
	
	trigger = {
		province_id = 4020
		owner = {
			NOT = { tag = I03 }
		}
		FROM = {
			tag = I03
			has_country_modifier = vazhatun_astronomy_enabled
		}
	}
	
	option = {
		name = flavor_vazhatun.99.a
		FROM = {
			country_event = { id = flavor_vazhatun.99 days = 1 }
		}
	}
}
	
country_event = {
	id = flavor_vazhatun.99
	title = flavor_vazhatun.99.t
	desc = flavor_vazhatun.98.d
	picture = ARTWORK_eventPicture
	hidden = yes
	
	is_triggered_only = yes
	
	trigger = {
		tag = I03
		NOT = { owns = 4020 }
		has_country_modifier = vazhatun_astronomy_enabled
	}
	
	option = {
		name = flavor_vazhatun.99.a
		remove_country_modifier = vazhatun_astronomy_enabled
		custom_tooltip = vazhatun_disable_astronomy_tt
	}
}

# Hidden event to gain ticking astral knowledge
country_event = {
	id = flavor_vazhatun.100
	title = flavor_vazhatun.100.t
	desc = flavor_vazhatun.100.d
	picture = ARTWORK_eventPicture	
	hidden = yes
	
	is_triggered_only = yes
	
	trigger = {
		tag = I03
		has_country_modifier = vazhatun_astronomy_enabled
	}
	
	option = {
		name = flavor_vazhatun.100.a
		
		vazhatun_add_scaling_knowledge = {
			AMOUNT = 10
		}
	}
}

##########################
# Astral Terror Disaster #
##########################

# 101 - disaster start
country_event = {
	id = flavor_vazhatun.101
	title = flavor_vazhatun.101.t
	desc = flavor_vazhatun.101.d
	picture = ARTWORK_eventPicture
	
	is_triggered_only = yes
	
	immediate = {
		hidden_effect = {
			capital_scope = {
				spawn_rebels = {
					type = vazhatun_rebels
					size = 3
				}
			}
			random_owned_province = {
				limit = { NOT = { fort_level = 1 } }
				spawn_rebels = {
					type = vazhatun_rebels
					size = 2
				}
				set_province_flag = vazhatun_terror_rebels
			}
			set_variable = {
				which = vazhatun_astral_knowledge
				value = 0
			}
			set_variable = {
				which = vazhatun_terror_points
				value = 100
			}
			remove_country_modifier = vazhatun_terror_1
			remove_country_modifier = vazhatun_terror_2
			remove_country_modifier = vazhatun_terror_3
		}
	}
	
	option = {
		name = flavor_vazhatun.101.a
		if = {
			limit = { stability = -2 }
			add_stability = -1
		}
		custom_tooltip = vazhatun_lose_all_knowledge_tt
		if = {
			limit = { has_country_modifier = vazhatun_astronomy_enabled }
			remove_country_modifier = vazhatun_astronomy_enabled
			custom_tooltip = vazhatun_disable_astronomy_tt
		}
		tooltip = {
			capital_scope = {
				vazhatun_rebels = 3
			}
			random_owned_province = {
				limit = { has_province_flag = vazhatun_terror_rebels }
				vazhatun_rebels = 2
			}
		}
	}
}

# 102 - disaster end
country_event = {
	id = flavor_vazhatun.102
	title = flavor_vazhatun.102.t
	desc = flavor_vazhatun.102.d
	picture = ARTWORK_eventPicture
	
	is_triggered_only = yes
	
	immediate = {
		hidden_effect = {
			add_country_modifier = { 
				name = vazhatun_recent_terror
				duration = 3650
			}
			every_owned_province = {
				remove_province_modifier = vazhatun_rebel_stronghold
				clr_province_flag = vazhatun_terror_rebels
			}
		}
	}
	
	option = {
		name = flavor_vazhatun.102.a
		add_stability_or_adm_power = yes
		tooltip = {
			add_country_modifier = { 
				name = vazhatun_recent_terror
				duration = 3650
			}
		}
	}
}

# 103 - disaster monthly pulse - rebel stack 1
country_event = {
	id = flavor_vazhatun.103
	title = flavor_vazhatun.103.t
	desc = flavor_vazhatun.103.d
	picture = ARTWORK_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		NOT = { has_country_modifier = vazhatun_one_quiet_night }
		any_owned_province = {
			NOT = { fort_level = 1 }
			NOT = { has_province_flag = vazhatun_terror_rebels }
		}
	}
	
	immediate = {
		random_owned_province = {
			limit = {
				NOT = { fort_level = 1 }
				NOT = { has_province_flag = vazhatun_terror_rebels }
			}
			save_event_target_as = rebel_stack_1
			set_province_flag = vazhatun_terror_rebels
			spawn_rebels = {
				type = vazhatun_rebels
				size = 1
			}
		}
		random_owned_province = {
			limit = {
				NOT = { fort_level = 1 }
				NOT = { has_province_flag = vazhatun_terror_rebels }
			}
			save_event_target_as = rebel_stack_2
			set_province_flag = vazhatun_terror_rebels
			spawn_rebels = {
				type = vazhatun_rebels
				size = 1
			}
		}
	}
	
	option = {
		name = flavor_vazhatun.103.a
		tooltip = {
			event_target:rebel_stack_1 = {
				vazhatun_rebels = 1
			}
			event_target:rebel_stack_2 = {
				vazhatun_rebels = 1
			}
		}
	}
}

# 104 - disaster monthly pulse - rebel stack 2
country_event = {
	id = flavor_vazhatun.104
	title = flavor_vazhatun.104.t
	desc = flavor_vazhatun.104.d
	picture = ARTWORK_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		NOT = { has_country_modifier = vazhatun_one_quiet_night }
		any_owned_province = {
			NOT = { fort_level = 1 }
			NOT = { has_province_flag = vazhatun_terror_rebels }
		}
	}
	
	immediate = {
		random_owned_province = {
			limit = {
				NOT = { fort_level = 1 }
				NOT = { has_province_flag = vazhatun_terror_rebels }
			}
			save_event_target_as = rebel_stack
			set_province_flag = vazhatun_terror_rebels
			spawn_rebels = {
				type = vazhatun_rebels
				size = 2
			}
		}
	}
	
	option = {
		name = flavor_vazhatun.104.a
		tooltip = {
			event_target:rebel_stack = {
				vazhatun_rebels = 2
			}
		}
	}
}

# 105 - disaster monthly pulse - rebel stack 3
country_event = {
	id = flavor_vazhatun.105
	title = flavor_vazhatun.105.t
	desc = flavor_vazhatun.105.d
	picture = ARTWORK_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		NOT = { has_country_modifier = vazhatun_one_quiet_night }
		any_owned_province = {
			NOT = { fort_level = 1 }
			NOT = { has_province_flag = vazhatun_terror_rebels }
		}
	}
	
	immediate = {
		random_owned_province = {
			limit = {
				NOT = { fort_level = 1 }
				NOT = { has_province_flag = vazhatun_terror_rebels }
			}
			save_event_target_as = rebel_stack
			set_province_flag = vazhatun_terror_rebels
			spawn_rebels = {
				type = vazhatun_rebels
				size = 1
			}
		}
	}
	
	option = {
		name = flavor_vazhatun.105.a
		add_yearly_manpower = -0.5
		tooltip = {
			event_target:vazhatun_terror_rebels = {
				vazhatun_rebels = 1
			}
		}
	}
}

# 106 - disaster monthly pulse - rebel stronghold
country_event = {
	id = flavor_vazhatun.106
	title = flavor_vazhatun.106.t
	desc = flavor_vazhatun.106.d
	picture = ARTWORK_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		NOT = { has_country_modifier = vazhatun_one_quiet_night }
		any_owned_province = {
			fort_level = 2
			is_capital = no
			NOT = { has_province_flag = vazhatun_terror_rebels }
		}
		NOT = {
			any_owned_province = {
				has_province_modifier = vazhatun_rebel_stronghold
			}
		}
	}
	
	immediate = {
		random_owned_province = {
			limit = {
				fort_level = 2
				is_capital = no
				NOT = { has_province_flag = vazhatun_terror_rebels }
			}
			save_event_target_as = rebel_stack
			set_province_flag = vazhatun_terror_rebels
			spawn_rebels = {
				type = vazhatun_rebels
				size = 2
				win = yes
			}
		}
	}
	
	option = {
		name = flavor_vazhatun.106.a
		event_target:rebel_stack = {
			add_province_modifier = { 
				name = vazhatun_rebel_stronghold
				duration = -1  
			}
			tooltip = {
				spawn_rebels = {
					type = vazhatun_rebels
					size = 2
				}
			}
		}
	}
}

# 107 - disaster monthly pulse - spend to end 1
country_event = {
	id = flavor_vazhatun.107
	title = flavor_vazhatun.107.t
	desc = flavor_vazhatun.107.d
	picture = ARTWORK_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		NOT = { has_country_modifier = vazhatun_one_quiet_night }
	}
	
	option = {
		name = flavor_vazhatun.107.a
		add_years_of_income = -0.5
		vazhatun_drop_terror = { large = yes }
	}
	
	option = {
		name = flavor_vazhatun.107.b
		vazhatun_drop_terror = { small = yes }
	}
}

# 108 - disaster monthly pulse - spend to end 2
country_event = {
	id = flavor_vazhatun.108
	title = flavor_vazhatun.108.t
	desc = flavor_vazhatun.108.d
	picture = ARTWORK_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		NOT = { has_country_modifier = vazhatun_one_quiet_night }
	}
	
	option = {
		name = flavor_vazhatun.108.a
		add_adm_power = -100
		add_dip_power = -100
		add_mil_power = -100
		vazhatun_drop_terror = { large = yes }
	}
	
	option = {
		name = flavor_vazhatun.108.b
		add_adm_power = -50
		add_dip_power = -50
		add_mil_power = -50
		vazhatun_drop_terror = { medium = yes }
	}
	
	option = {
		name = flavor_vazhatun.108.c
		vazhatun_drop_terror = { small = yes }
	}
}

# 109 - disaster monthly pulse - free progress 1
country_event = {
	id = flavor_vazhatun.109
	title = flavor_vazhatun.109.t
	desc = flavor_vazhatun.109.d
	picture = ARTWORK_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		NOT = { has_country_modifier = vazhatun_one_quiet_night }
	}
	
	option = {
		name = flavor_vazhatun.109.a
		vazhatun_drop_terror = { medium = yes }
	}
	
	option = {
		name = flavor_vazhatun.109.b
		trigger = { NOT = { stability = -1 } }
		add_stability = 1
	}
}

# 110 - disaster monthly pulse - free progress 2
country_event = {
	id = flavor_vazhatun.110
	title = flavor_vazhatun.110.t
	desc = flavor_vazhatun.110.d
	picture = ARTWORK_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		NOT = { has_country_modifier = vazhatun_one_quiet_night }
	}
	
	option = {
		name = flavor_vazhatun.110.a
		vazhatun_drop_terror = { medium = yes }
	}
	
	option = {
		name = flavor_vazhatun.110.b
		add_yearly_manpower = 0.5
		vazhatun_drop_terror = { small = yes }
	}
}

# 111 - on rebel stronghold taken
province_event = {
	id = flavor_vazhatun.111
	title = flavor_vazhatun.111.t
	desc = flavor_vazhatun.111.d
	picture = ARTWORK_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_modifier = vazhatun_rebel_stronghold
	}
	
	immediate = {
		random = {
			chance = 50
			owner = { set_country_flag = vazhatun_rebel_stab }
		}
	}
	
	after = {
		clr_country_flag = vazhatun_rebel_stab
	}
	
	option = {
		name = flavor_vazhatun.111.a
		owner = {
			if = {
				limit = {
					has_country_flag = vazhatun_rebel_stab
					NOT = { stability = 0 }
				}
				add_stability = 1
				vazhatun_drop_terror = { small = yes }
			}
			else = {
				vazhatun_drop_terror = { large = yes }
			}
		}
		
		remove_province_modifier = vazhatun_rebel_stronghold
	}
}

# 112 - monthly pulse - breathing room
country_event = {
	id = flavor_vazhatun.112
	title = flavor_vazhatun.112.t
	desc = flavor_vazhatun.112.d
	picture = ARTWORK_eventPicture
	
	is_triggered_only = yes
	fire_only_once = yes
	
	trigger = {
		check_variable = {
			which = vazhatun_terror_points
			value = 30
		}
		NOT = {
			check_variable = {
				which = vazhatun_terror_points
				value = 90
			}
		}
		num_of_rebel_armies = 5
	}
	
	option = {
		name = flavor_vazhatun.112.a
		add_disaster_modifier = {
			name = vazhatun_one_quiet_night
			duration = 180
			disaster = astral_terror
		}
		if = {
			limit = { NOT = { stability = 0 } }
			add_stability = 1
			vazhatun_drop_terror = { small = yes }
		}
		else = {
			vazhatun_drop_terror = { large = yes }
		}
	}
}
