namespace = flavor_malacnar

#You slay the Malacnar battleking
country_event = {
	id = flavor_malacnar.2
	title = flavor_malacnar.2.t
	desc = flavor_malacnar.2.d
	picture = BATTLE_eventPicture
	
	is_triggered_only = yes
	
	immediate = {
		hidden_effect = {
			G32 = { country_event = { id = flavor_malacnar.3 } }
		}
	}
	
	option = {
		name = flavor_malacnar.2.a
		
		add_prestige = 10
		
		ai_chance = {
			factor = 1
		}
	}
}

#Malacnar battleking is slain after being defeated in a battle
country_event = {
	id = flavor_malacnar.3
	title = flavor_malacnar.3.t
	desc = flavor_malacnar.3.d
	picture = BATTLE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		tag = G32
	}
	
	option = {
		name = flavor_malacnar.3.a
		
		kill_ruler = yes
		
		add_prestige = -20
		
		add_stability = -1
		custom_tooltip = malacnar_stability_tooltip
		
		if = {
			limit = {
				NOT = {
					has_heir = yes
				}
			}
			
			custom_tooltip = malacnar_emergency_meeting_tooltip
			
			add_mil_power = -50
		
		}
		
		ai_chance = {
			factor = 1
		}
	}
}

#Reforming the country
country_event = {
	id = flavor_malacnar.5
	title = flavor_malacnar.5.t
	desc = flavor_malacnar.5.d
	picture = REFORM_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		tag = G32
	}
	
	option = {	#keep the elective stratocracy
		name = flavor_malacnar.5.a
		
		set_country_flag = reformed_malacnar_flag 
		
		change_government_to_republic = yes
		add_government_reform = malacnar_republic_reform
		
		if = {
			limit = {
				has_reform = states_general_reform
			}
			remove_government_reform = states_general_reform
		}
		
		ai_chance = {
			factor = 3
		}
	}
	
	option = {	#let's make Malacnar into a hereditary monarchy because why not
		name = flavor_malacnar.5.b
		
		trigger = { government = monarchy }
		
		set_country_flag = reformed_malacnar_flag 
		
		if =  {
			limit = {
				calc_true_if = {
					has_reform = enforce_privileges_reform
					has_reform = decentralize_reform
					has_reform = states_general_reform
					NOT = { legitimacy = 80 }
					amount = 1
				}
			}
			add_stability = -1
		}
		
		if =  {
			limit = {
				calc_true_if = {
					has_reform = enforce_privileges_reform
					has_reform = decentralize_reform
					has_reform = states_general_reform
					NOT = { legitimacy = 80 }
					amount = 2
				}
			}
			custom_tooltip = malacnar_really_good_idea_tooltip
			hidden_effect = {
				malacnar_area = {
					spawn_rebels = {
						type = pretender_rebels
						size = 2
					}
				}
				add_manpower = -27
			}
		}
		
		change_government_to_monarchy = yes
		add_government_reform = malacnar_monarchy_reformed
		
		define_heir = {
			age = 12
			dynasty = ROOT
		}
		
		if = {
			limit = {
				has_reform = states_general_reform
			}
			remove_government_reform = states_general_reform
		}
		
		ai_chance = {
			factor = 1
			
			modifier = {
				factor = 10
				OR = {
					ruler_has_personality = lawgiver_personality
					ruler_has_personality = cruel_personality
					ruler_has_personality = greedy_personality
					ruler_has_personality = malevolent_personality
				}
			}
			
			modifier = {
				factor = 0.5
				OR = {
					has_reform = enforce_privileges_reform
					has_reform = decentralize_reform
					has_reform = states_general_reform
					NOT = { legitimacy = 80 }
				}
			}
		}
	}
}