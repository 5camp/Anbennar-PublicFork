########################################
# Events for Religious Reforms system
#
# written by Martin Anward
########################################

namespace = religious_reforms

# Nahuatl reform
country_event = {
	id = religious_reforms.1
	title = religious_reforms.1.t
	desc = religious_reforms.1.d
	picture = ANGRY_MOB_eventPicture

	is_triggered_only = yes
	
	trigger = {
		has_dlc = "El Dorado"
		religion = nahuatl
	}
	
	mean_time_to_happen = {
		days = 1
	}
	
	immediate = {
		hidden_effect = {
			add_stability = -1
			every_subject_country = {
				add_truce_with = ROOT
				ROOT = {
					add_truce_with = PREV
				}
			}
			release_all_subjects = yes 
			add_doom = 25 
		}
	}
	
	option = {
		name = religious_reforms.1.a
		tooltip = {
			add_stability = -1
			every_subject_country = {
				add_truce_with = ROOT
				ROOT = {
					add_truce_with = PREV
				}
			}
			release_all_subjects = yes
			add_doom = 25
		}
	}
}

# Inti reform
country_event = {
	id = religious_reforms.2
	title = religious_reforms.2.t
	desc = religious_reforms.2.d
	picture = CIVIL_WAR_eventPicture

	is_triggered_only = yes
	
	trigger = {
		has_dlc = "El Dorado"
		religion = inti
	}
	
	mean_time_to_happen = {
		days = 1
	}
	
	immediate = {
		hidden_effect = {		
			add_authority = -100 
			add_stability = -2
			
			random_owned_province = {
				limit = { 
					is_in_capital_area = yes 
					is_capital = no
				}
				set_province_flag = civil_war_prov_1
			}		
			random_owned_province = {
				limit = { 
					is_in_capital_area = yes
					is_capital = no
					NOT = { has_province_flag = civil_war_prov_1 }
				}
				set_province_flag = civil_war_prov_2
			}
			
			random_owned_province = {
				limit = { has_province_flag = civil_war_prov_1 }
				pretender_rebels = 4
				clr_province_flag = civil_war_prov_1
			}
			random_owned_province = {
				limit = { has_province_flag = civil_war_prov_2 }
				pretender_rebels = 3
				clr_province_flag = civil_war_prov_2
			}
		}
		
	}	
	
	option = {
		name = religious_reforms.2.a
		tooltip = {
			add_stability = -2
			add_authority = -100			
		}		
	}
}

# Mayan reform
country_event = {
	id = religious_reforms.3
	title = religious_reforms.3.t
	desc = religious_reforms.3.d
	picture = ANGRY_MOB_eventPicture

	is_triggered_only = yes
	
	trigger = {
		has_dlc = "El Dorado"
		religion = mesoamerican_religion
	}
	
	mean_time_to_happen = {
		days = 1
	}
	
	immediate = {
		hidden_effect = { 
			add_stability = -1
			every_subject_country = {
				add_truce_with = ROOT
				ROOT = {
					add_truce_with = PREV
				}
			}
			release_all_subjects = yes
			collapse_nation = yes
		}
	}
	
	option = {
		name = religious_reforms.1.a
		tooltip = {
			add_stability = -1
			every_subject_country = {
				add_truce_with = ROOT
				ROOT = {
					add_truce_with = PREV
				}
			}
			release_all_subjects = yes
			collapse_nation = yes
		}
	}
}

# Ynn River Worship reform
country_event = {
	id = religious_reforms.4
	title = religious_reforms.4.t
	desc = religious_reforms.4.d
	picture = ANGRY_MOB_eventPicture

	is_triggered_only = yes
	
	trigger = {
		has_dlc = "El Dorado"
		religion = ynn_river_worship
	}
	
	mean_time_to_happen = {
		days = 1
	}
	
	immediate = {
		hidden_effect = { 
			add_stability = -1
			add_authority = -100
			country_event = { id = ynn_worship.6 }
#			country_event = { id = ynn_worship.7 }
		}
	}
	
	option = {
		name = religious_reforms.1.a
		tooltip = {
			add_stability = -1
			add_authority = -100 
		}
	}
}

# Leechfather reform
country_event = {
	id = religious_reforms.5
	title = religious_reforms.5.t
	desc = religious_reforms.5.d
	picture = ANGRY_MOB_eventPicture

	is_triggered_only = yes
	
	trigger = {
		has_dlc = "El Dorado"
		religion = leechfather
	}
	
	mean_time_to_happen = {
		days = 1
	}
	
	immediate = {
		hidden_effect = {
			if {
				change_variable {
					which = leechfather_reform_count
					value = 1
				}
				every_subject_country = {
					add_truce_with = ROOT
					ROOT = {
						add_truce_with = PREV
					}
				}
				random_subject_country = {
					ROOT = { 
					inherit = PREV
					}
				}
				release_all_subjects = yes 
				add_doom = 25
			}		
		}
	}
	#reform 1
	option = {
		trigger = {
			check_variable = {
				leechfather_reform_count = 1
			}
			NOT = {
				check_variable = {
					leechfather_reform_count = 2
				}
			}
		}
		name = "religious_reforms.5.a"
		tooltip = {
			add_stability = -1
			add_doom = 25
			release_all_subjects = yes
		}
		add_prestige = 25
	}
	#reform 2
	option = {
		trigger = {
			check_variable = {
				leechfather_reform_count = 2
			}
			NOT = {
				check_variable = {
					leechfather_reform_count = 3
				}
			}
		}
		name = "religious_reforms.5.b"
		tooltip = {
			add_stability = -1
			add_prestige = 25
			add_doom = 25
			release_all_subjects = yes
		}
	}
	#reform 3
	option = {
		trigger = {
			check_variable = {
				leechfather_reform_count = 3
			}
			NOT = {
				check_variable = {
					leechfather_reform_count = 4
				}
			}
		}
		name = "religious_reforms.5.c"
		random_province = {
			limit = {
				region = leechdens_region
				any_core_country = {
					exists = no
				}
			}
			random_core_country = {
				limit = {
					exists = no
				}
				every_core_province = {
					limit = {
						region = leechdens_region
					}
					cede_province = PREV
				}
			}
		}
		tooltip = {
			add_stability = -1
			add_prestige = 25
			add_doom = 25
			release_all_subjects = yes
		}
	}
	#reform 4
	option = {
		trigger = {
			check_variable = {
				leechfather_reform_count = 4
			}
			NOT = {
				check_variable = {
					leechfather_reform_count = 5
				}
			}
		}
		name = "religious_reforms.5.e"
		random_province = {
			limit = {
				region = leechdens_region
				any_core_country = {
					exists = no
				}
			}
			random_core_country = {
				limit = {
					exists = no
				}
				every_core_province = {
					limit = {
						region = leechdens_region
					}
					cede_province = PREV
				}
			}
		}
		tooltip = {
			add_stability = -1
			add_prestige = 25
			add_doom = 25
			release_all_subjects = yes
		}
		add_prestige = 25
	}
	#reform 5
	option = {
		trigger = {
			check_variable = {
				leechfather_reform_count = 5
			}
			NOT = {
				check_variable = {
					leechfather_reform_count = 6
				}
			}
		}
		name = "religious_reforms.5.f"
		leechdens_region = {
			if = {
				limit = {
					NOT = {
						has_province_flag = leeches
					}
					any_core_country = {
						exists = no
					}
				}
				random_core_country = { #for a random country
                    limit = {
                        exists = no
                    }
                    every_core_province = { #go through all their core provinces in leechdens
                        limit = {
                            region = leechdens_region
                            NOT = {
                                has_province_flag = leeches
                            }
                        }
                        set_province_flag = leeches
                        cede_province = PREV
                    }
					if = {
						limit = {
							NOT = { has_global_flag = leeched }
						}
						set_global_flag = leeched
						save_event_target_as = leecher
						declare_war_with_cb = {
							who = ROOT
							casus_belli = cb_crusade
						}
					}
					else = {
						join_all_offensive_wars_of = event_target:leecher
					}
					leechdens_region = {
					  limit = {
						is_capital = yes
					  }
					  owner = {
						IF = {
						  limit = {
							NOT = {
							  war_with = ROOT
							}
						  }
						  join_all_offensive_wars_of = event_target:leecher
						}
					  }
					}
                }
			}
			else = {
				clr_province_flag = leeches
			}
		}
		clr_global_flag = leeched
		tooltip = {
			add_stability = -1
			add_prestige = 25
			add_doom = 25
			release_all_subjects = yes
		}
		add_prestige = 25
	}
}