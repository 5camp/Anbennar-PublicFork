namespace = diggy_dungeons

# Create dungeons or not
# Launch by the immediate effect of diggy_expedition.12 at the end of a succesfull expedition
province_event = {
	id = diggy_dungeons.0
	title = diggy_dungeons.0.t
	desc = diggy_dungeons.0.d
	picture = CAVE_eventPicture
	
	# hidden = yes #Must be hidden, not hidden for test purposes
	is_triggered_only = yes
	
	trigger = {
		has_dlc = "Leviathan"
		REB = {
			NOT = { check_variable = { dwarovarDungeon = 10 } }
		}
	}
	
	immediate = {
	}
	
	after = {
	}
	
	# Does the dungeon spawn or not
	option = {
        name = diggy_dungeons.0.a
        ai_chance = { factor = 100 }
		random_list = {
			90 = {  }
			1000 = { #1000 for test purposes
				modifier = { factor = 1.2 check_variable = { dangerLevel = 3 } }
				modifier = { factor = 1.3 check_variable = { dangerLevel = 4 } }
				modifier = { factor = 1.4 check_variable = { dangerLevel = 5 } }
				REB = { change_variable = { dwarovarDungeon = 1 } }
				province_event = { id = diggy_dungeons.1 }
			}
		}
	}
}

# Select which dungeon to add
province_event = {
	id = diggy_dungeons.1
	title = diggy_dungeons.1.t
	desc = diggy_dungeons.1.d
	picture = CAVE_eventPicture
	
	# hidden = yes #Must be hidden, not hidden for test purposes
	is_triggered_only = yes
	
	trigger = {
		always = yes
	}
	
	immediate = {
	}
	
	after = {
	}
	
	# No dungeon. It's here if no other option is available
	option = {
        name = diggy_dungeons.1.a
        ai_chance = { factor = 1 }
	}
	
	# Frogarsalforn, library of the ancients
	option = {
        name = diggy_dungeons.1.b
        ai_chance = { 
			factor = 100 #Higher for test purposes, should be much lower
			modifier = {
				factor = 1.5
				OR = { has_terrain = dwarven_hold has_terrain = dwarven_hold_surface }
			}
		}
		trigger = { NOT = { has_global_flag = dd_frogarsalforn } }
		set_global_flag = dd_frogarsalforn
		set_province_flag = dd_frogarsalforn_flag
		set_province_flag = explorable_dungeon
		REB = { change_variable = { dwarovarDungeon = 1 } }		#Global Indicator of how many Dungeons have spawned
		province_event = { id = diggy_dungeons.100 }			#Dungeon description event
		add_great_project = {
			type = dd_frogarsalforn
			instant = yes
		}
	}

	#Stunveigryôrth, petrified forest
	option = {
        name = diggy_dungeons.1.c
        ai_chance = { 
			factor = 100 #Higher for test purposes, should be much lower
			modifier = {
				factor = 1.5
				OR = { has_terrain = dwarven_hold has_terrain = dwarven_hold_surface }
			}
		}
		trigger = { NOT = { has_global_flag = dd_stunveigryorth } }
		set_global_flag = dd_stunveigryorth
		set_province_flag = dd_stunveigryorth_flag
		set_province_flag = explorable_dungeon
		REB = { change_variable = { dwarovarDungeon = 1 } }		#Global Indicator of how many Dungeons have spawned
		province_event = { id = diggy_dungeons.200 }			#Dungeon description event
		add_great_project = {
			type = dd_stunveigryorth
			instant = yes
		}
	}

	#Wytlramvar, Roots of the Spine
	option = {
        name = diggy_dungeons.1.c
        ai_chance = { 
			factor = 100 #Higher for test purposes, should be much lower
			modifier = {
				factor = 1.5
				OR = { has_terrain = dwarven_hold has_terrain = dwarven_hold_surface }
			}
		}
		trigger = { NOT = { has_global_flag = dd_wytlramvar } }
		set_global_flag = dd_wytlramvar
		set_province_flag = dd_wytlramvar_flag
		set_province_flag = explorable_dungeon
		REB = { change_variable = { dwarovarDungeon = 1 } }		#Global Indicator of how many Dungeons have spawned
		province_event = { id = diggy_dungeons.300 }			#Dungeon description event
		add_great_project = {
			type = dd_wytlramvar
			instant = yes
		}
	}
	
}

# Start the Dungeon Event Chain
province_event = {
	id = diggy_dungeons.2
	title = diggy_dungeons.2.t
	desc = diggy_dungeons.2.d
	picture = CAVE_eventPicture
	
	# hidden = yes	#Must be hidden, not hidden for test purposes
	is_triggered_only = yes
	
	trigger = {
		always = yes
	}
	
	immediate = {
	}
	
	after = {
	}
	
	# Select which dungeon to launch depending on the province flag set on diggy_dungeons.1
	option = {
        name = diggy_dungeons.2.a
        ai_chance = { factor = 100 }
		trigger_switch = {
			on_trigger = has_province_flag

			# Frogarsalforn, library of the ancients
			dd_frogarsalforn_flag = { 
				if = {
					limit = { has_great_project = { type = dd_frogarsalforn tier = 2 } }
					province_event = { id = diggy_dungeons.142 }
				}
				else_if = {
					limit = { has_great_project = { type = dd_frogarsalforn tier = 1 } }
					province_event = { id = diggy_dungeons.120 }
				}
				else = { province_event = { id = diggy_dungeons.101 } }
			} 

			# Stunveigryôrth, petrified forest
			dd_stunveigryorth_flag = { 
				if = {
					limit = { has_great_project = { type = dd_stunveigryorth tier = 2 } }
					province_event = { id = diggy_dungeons.249 }
				}
				else_if = {
					limit = { has_great_project = { type = dd_stunveigryorth tier = 1 } }
					province_event = { id = diggy_dungeons.223 }
				}
				else = { province_event = { id = diggy_dungeons.201 } }
			}

			#Wytlramvar, Roots of the Spine
			dd_wytlramvar_flag = {
				if = {
					limit = { has_great_project = { type = dd_wytlramvar tier = 2 } }
					province_event = { id = diggy_dungeons.347 }
				}
				else_if = {
					limit = { has_great_project = { type = dd_wytlramvar tier = 1 } }
					province_event = { id = diggy_dungeons.327 }
				}
				else = { province_event = { id = diggy_dungeons.301 } }
			}
		}
		province_event = { id = diggy_dungeons.2000 }
	}
}

# Progress Loop
province_event = {
	id = diggy_dungeons.2000
	title = diggy_dungeons.2000.t
	desc = diggy_dungeons.2000.d
	picture = CAVE_eventPicture
	
	hidden = yes	#Must be hidden, not hidden for test purposes
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}
	
	immediate = {
	}
	
	after = {
	}
	
	option = {
        name = diggy_dungeons.2000.a
        ai_chance = { factor = 100 }
		dungeon_progress = yes
		
		if = {
			limit = { NOT = { check_variable = { partyManpower = 1 } } } #No more soldiers, you ded
			province_event = { id = diggy_dungeons.2001 }
		}
		else = {
			province_event = { id = diggy_dungeons.2000 days = 30 }
		}
	}
}

#Expedition Dead
province_event = {
	id = diggy_dungeons.2001
	title = diggy_dungeons.2001.t
	desc = diggy_dungeons.2001.d
	picture = LOOMING_DEATH_eventPicture
	goto = ROOT
	is_triggered_only = yes
	
	trigger = {
		always = yes
	}
	
	immediate = {
		hidden_effect = { clr_province_flag = sent_expedition_@owner }
	}
	
	after = {
	}
	
	#Damnation
	option = {
        name = diggy_dungeons.2001.a
        ai_chance = { factor = 100 }
		owner = {
			add_prestige = -20
			random = {
				chance = 50
				add_stability = -1
			}
		}
		custom_tooltip = expedition_dead_tooltip
		hidden_effect = { expedition_dead_effect = yes }
	}
}



###############################
######## Frogarsalforn ########
###############################

# Misc event presenting what the dungeons is
province_event = {
    id = diggy_dungeons.100
    title = diggy_dungeons.100.t
    desc = diggy_dungeons.100.d
    picture = CAVE_eventPicture
    
    is_triggered_only = yes
    
    trigger = {
        always = yes
    }
    
    immediate = {
    }
    
    after = {
    }
    
    # Nice
    option = {
        name = diggy_dungeons.100.a
        ai_chance = { factor = 100 }
    }
}
# Ancient Library floor 1
# Beginning Floor 1
province_event = {
	id = diggy_dungeons.101
	title = diggy_dungeons.101.t
	desc = diggy_dungeons.101.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.101.a
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		
        dungeon_encounter_effect = {
			base_success = 80
			success_id = 102
			
			base_failure = 20
			failure_id = 103
		}
	}
	option = {
		name = diggy_dungeons.101.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 104 }
	}
}

# Beginning Floor 1: Clear the webs (E) - Success
province_event = {
	id = diggy_dungeons.102
	title = diggy_dungeons.102.t
	desc = diggy_dungeons.102.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.102.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 75}

		dungeon_progress_advancement = { id = 104 }
	}
}

# Beginning Floor 1: Clear the webs (E) - Failure
province_event = {
	id = diggy_dungeons.103
	title = diggy_dungeons.103.t
	desc = diggy_dungeons.103.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.103.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 104 }
	}
}

# Reading Hall
province_event = {
	id = diggy_dungeons.104
	title = diggy_dungeons.104.t
	desc = diggy_dungeons.104.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.104.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 80
			success_id = 105
			
			base_failure = 20
			failure_id = 106
		}
	}
	option = {
		name = diggy_dungeons.104.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 105
			
			base_failure = 40
			failure_id = 106
		}
	}
}

# Reading Hall: Destroy the statue (E) - Success
province_event = {
	id = diggy_dungeons.105
	title = diggy_dungeons.105.t
	desc = {
		trigger = { always = yes }
		desc = diggy_dungeons.105.d.1
	}
	desc = {
		trigger = { always = no }
		desc = diggy_dungeons.105.d.2
	}

	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.105.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 75}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 107 }
	}
}

# Reading Hall: Destroy the statue (E) - Failure
province_event = {
	id = diggy_dungeons.106
	title = diggy_dungeons.106.t
	desc = {
		trigger = { always = yes }
		desc = diggy_dungeons.106.d.1
	}
	desc = {
		trigger = { always = no }
		desc = diggy_dungeons.106.d.2
	}

	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.106.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 107 }
	}
}

# Main Library
province_event = {
	id = diggy_dungeons.107
	title = diggy_dungeons.107.t
	desc = diggy_dungeons.107.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.107.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 109 }
	}
	option = {
		name = diggy_dungeons.107.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 108 }
	}
}

# Papermill
province_event = {
	id = diggy_dungeons.108
	title = diggy_dungeons.108.t
	desc = diggy_dungeons.108.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.108.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 80
			success_id = 111
			
			base_failure = 20
			failure_id = 110
		}
	}
}

# Bookbinder
province_event = {
	id = diggy_dungeons.109
	title = diggy_dungeons.109.t
	desc = diggy_dungeons.109.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.109.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 111
			
			base_failure = 40
			failure_id = 110
		}
	}
}

# Papermill: Fight (M) - Failure
province_event = {
	id = diggy_dungeons.110
	title = diggy_dungeons.110.t
	desc = {
		trigger = { always = yes }
		desc = diggy_dungeons.110.d.1
	}
	desc = {
		trigger = { always = no }
		desc = diggy_dungeons.110.d.2
	}

	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.110.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 400}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 112 }
	}
}

# Bookbinder: Fight (E) - Success
province_event = {
	id = diggy_dungeons.111
	title = diggy_dungeons.111.t
	desc = {
		trigger = { always = yes }
		desc = diggy_dungeons.111.d.1
	}
	desc = {
		trigger = { always = no }
		desc = diggy_dungeons.111.d.2
	}

	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.111.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200}
		change_party_loot = { add_tooltip = yes add = 75}

		dungeon_progress_advancement = { id = 113 }
	}
}

# Emergency System
province_event = {
	id = diggy_dungeons.112
	title = diggy_dungeons.112.t
	desc = diggy_dungeons.112.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.112.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 80
			success_id = 114
			
			base_failure = 20
			failure_id = 115
		}
	}
	option = {
		name = diggy_dungeons.112.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 116 }
	}
}

# Main Library
province_event = {
	id = diggy_dungeons.113
	title = diggy_dungeons.113.t
	desc = diggy_dungeons.113.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.113.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 40
			success_id = 118
			
			base_failure = 60
			failure_id = 117
		}
	}
}

# Emergency System: Yay - Success
province_event = {
	id = diggy_dungeons.114
	title = diggy_dungeons.114.t
	desc = diggy_dungeons.114.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.114.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 113 }
	}
}

# Emergency System: Yay - Failure
province_event = {
	id = diggy_dungeons.115
	title = diggy_dungeons.115.t
	desc = diggy_dungeons.115.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.115.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

        custom_tooltip = expedition_dead_tooltip
        hidden_effect = { expedition_dead_effect = yes }

	}
}

# Emergency System: Nay - Failure
province_event = {
	id = diggy_dungeons.116
	title = diggy_dungeons.116.t
	desc = diggy_dungeons.116.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.116.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

        custom_tooltip = expedition_dead_tooltip
        hidden_effect = { expedition_dead_effect = yes }

	}
}

# Main Library: Fight (H) - Failure
province_event = {
	id = diggy_dungeons.117
	title = diggy_dungeons.117.t
	desc = diggy_dungeons.117.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.117.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

        custom_tooltip = expedition_dead_tooltip
        hidden_effect = { expedition_dead_effect = yes }

	}
}

# Main Library: Fight (H) - Success
province_event = {
	id = diggy_dungeons.118
	title = diggy_dungeons.118.t
	desc = diggy_dungeons.118.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.118.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 150}
		add_adk_effect = { add = 1 }

		dungeon_progress_advancement = { id = 119 }
	}
}

# End Event
province_event = {
	id = diggy_dungeons.119
	title = diggy_dungeons.119.t
	desc = diggy_dungeons.119.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

    immediate = {
        dungeon_immediate_effect = yes
    }

    option = {
        name = diggy_dungeons.119.a
        ai_chance = { factor = 100 }
        trigger = {
            always = yes
        }
        special_reward_expedition = yes
        currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
        currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
        currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
        currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
        hidden_effect = {
            while = {
                limit = { check_variable = { partyManpower = 1000 } }
                subtract_variable = { partyManpower = 1000 }
                owner = { add_manpower = 1 }
            }
        }
        custom_tooltip = back_to_manpower_tooltip
        custom_tooltip = base_expedition_loot_tooltip
        if = {
            limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
            province_event = { id = diggy_expedition.14 }
        }
        else = { hidden_effect = { clear_expedition_effect = yes } }
        hidden_effect = { set_province_flag = floor_explored }
    }

}
# Ancient Library floor 2
# Beginning Floor 2
province_event = {
	id = diggy_dungeons.120
	title = diggy_dungeons.120.t
	desc = diggy_dungeons.120.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.120.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 80
			success_id = 121
			
			base_failure = 20
			failure_id = 122
		}
	}
}

# Beginning Floor 2: Fight (E) - Success
province_event = {
	id = diggy_dungeons.121
	title = diggy_dungeons.121.t
	desc = diggy_dungeons.121.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.121.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200}
		change_party_loot = { add_tooltip = yes add = 75}

		dungeon_progress_advancement = { id = 123 }
	}
}

# Beginning Floor 2: Fight (E) - Failure
province_event = {
	id = diggy_dungeons.122
	title = diggy_dungeons.122.t
	desc = diggy_dungeons.122.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.122.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 400}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 123 }
	}
}

# Get Down
province_event = {
	id = diggy_dungeons.123
	title = diggy_dungeons.123.t
	desc = diggy_dungeons.123.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.123.a
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 126
			
			base_failure = 40
			failure_id = 125
		}
	}
	option = {
		name = diggy_dungeons.123.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 124 }
	}
}

# Get Down: Just rope down - Failure
province_event = {
	id = diggy_dungeons.124
	title = diggy_dungeons.124.t
	desc = diggy_dungeons.124.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.124.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200}
		change_party_morale = { remove_tooltip = yes loss = 0.5}
		change_party_supplies = { remove_tooltip = yes loss = 4 }

		dungeon_progress_advancement = { id = 127 }
	}
}

# Get Down: Secure the thing (M) - Failure
province_event = {
	id = diggy_dungeons.125
	title = diggy_dungeons.125.t
	desc = diggy_dungeons.125.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.125.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }

		dungeon_progress_advancement = { id = 127 }
	}
}

# Get Down: Secure the thing (M) - Success
province_event = {
	id = diggy_dungeons.126
	title = diggy_dungeons.126.t
	desc = diggy_dungeons.126.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.126.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 127 }
	}
}

# Chasm 1
province_event = {
	id = diggy_dungeons.127
	title = diggy_dungeons.127.t
	desc = diggy_dungeons.127.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.127.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 128
			
			base_failure = 40
			failure_id = 129
		}
	}
}

# Chasm 1: Fight (M) - Success
province_event = {
	id = diggy_dungeons.128
	title = diggy_dungeons.128.t
	desc = diggy_dungeons.128.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.128.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200}
		change_party_morale = { add_tooltip = yes add = 0.5}
		change_party_supplies = { add_tooltip = yes add = 4 }

		dungeon_progress_advancement = { id = 130 }
	}
}

# Chasm 1: Fight (M) - Failure
province_event = {
	id = diggy_dungeons.129
	title = diggy_dungeons.129.t
	desc = diggy_dungeons.129.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.129.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 400}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 130 }
	}
}

# Chasm 2
province_event = {
	id = diggy_dungeons.130
	title = diggy_dungeons.130.t
	desc = diggy_dungeons.130.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.130.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 131
			
			base_failure = 40
			failure_id = 132
		}
	}
}

# Chasm 2: Fight (M) - Success
province_event = {
	id = diggy_dungeons.131
	title = diggy_dungeons.131.t
	desc = diggy_dungeons.131.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.131.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200}
		change_party_loot = { add_tooltip = yes add = 75}

		dungeon_progress_advancement = { id = 133 }
	}
}

# Chasm 2: Fight (M) - Failure
province_event = {
	id = diggy_dungeons.132
	title = diggy_dungeons.132.t
	desc = diggy_dungeons.132.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.132.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 600}

		dungeon_progress_advancement = { id = 133 }
	}
}

# Big Boss
province_event = {
	id = diggy_dungeons.133
	title = diggy_dungeons.133.t
	desc = diggy_dungeons.133.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.133.a
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4  }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		
        dungeon_encounter_effect = {
			base_success = 40
			success_id = 134
			
			base_failure = 60
			failure_id = 135
		}
	}
	option = {
		name = diggy_dungeons.133.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 136
			
			base_failure = 40
			failure_id = 137
		}
	}
}

# Big Boss: Make a Trap (H) - Success
province_event = {
	id = diggy_dungeons.134
	title = diggy_dungeons.134.t
	desc = diggy_dungeons.134.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.134.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 138 }
	}
}

# Big Boss: Make a Trap (H) - Failure
province_event = {
	id = diggy_dungeons.135
	title = diggy_dungeons.135.t
	desc = diggy_dungeons.135.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.135.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 40
			success_id = 136
			
			base_failure = 60
			failure_id = 137
		}
	}
}

# Big Boss: Fight (H) - Success
province_event = {
	id = diggy_dungeons.136
	title = diggy_dungeons.136.t
	desc = diggy_dungeons.136.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.136.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 150}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 138 }
	}
}

# Big Boss: Fight (H) - Failure
province_event = {
	id = diggy_dungeons.137
	title = diggy_dungeons.137.t
	desc = diggy_dungeons.137.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.137.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

        custom_tooltip = expedition_dead_tooltip
        hidden_effect = { expedition_dead_effect = yes }

	}
}

# Way Up
province_event = {
	id = diggy_dungeons.138
	title = diggy_dungeons.138.t
	desc = diggy_dungeons.138.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.138.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 139
			
			base_failure = 40
			failure_id = 140
		}
	}
}

# Way Up: Seal the wall (M) - Success
province_event = {
	id = diggy_dungeons.139
	title = diggy_dungeons.139.t
	desc = diggy_dungeons.139.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.139.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 141 }
	}
}

# Way Up: Seal the wall (M) - Failure
province_event = {
	id = diggy_dungeons.140
	title = diggy_dungeons.140.t
	desc = diggy_dungeons.140.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.140.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { remove_tooltip = yes loss = 150}
		change_party_manpower = { remove_tooltip = yes loss = 200}

		dungeon_progress_advancement = { id = 141 }
	}
}

# End Event
province_event = {
	id = diggy_dungeons.141
	title = diggy_dungeons.141.t
	desc = diggy_dungeons.141.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

    immediate = {
        dungeon_immediate_effect = yes
    }

    option = {
        name = diggy_dungeons.141.a
        ai_chance = { factor = 100 }
        trigger = {
            always = yes
        }
        special_reward_expedition = yes
        currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
        currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
        currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
        currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
        hidden_effect = {
            while = {
                limit = { check_variable = { partyManpower = 1000 } }
                subtract_variable = { partyManpower = 1000 }
                owner = { add_manpower = 1 }
            }
        }
        custom_tooltip = back_to_manpower_tooltip
        custom_tooltip = base_expedition_loot_tooltip
        if = {
            limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
            province_event = { id = diggy_expedition.14 }
        }
        else = { hidden_effect = { clear_expedition_effect = yes } }
        hidden_effect = { set_province_flag = floor_explored }
    }

}
# Ancient Library floor 3
# Beginning Floor 3
province_event = {
	id = diggy_dungeons.142
	title = diggy_dungeons.142.t
	desc = diggy_dungeons.142.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.142.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 143 }
	}
	option = {
		name = diggy_dungeons.142.b
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 145
			
			base_failure = 40
			failure_id = 144
		}
	}
}

# Collapsing Shelf
province_event = {
	id = diggy_dungeons.143
	title = diggy_dungeons.143.t
	desc = diggy_dungeons.143.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.143.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 147
			
			base_failure = 40
			failure_id = 146
		}
	}
}

# Beginning Floor 3: Barricade door (M) - Failure
province_event = {
	id = diggy_dungeons.144
	title = diggy_dungeons.144.t
	desc = diggy_dungeons.144.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.144.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 148
			
			base_failure = 40
			failure_id = 149
		}
	}
}

# Beginning Floor 3: Barricade door (M) - Success
province_event = {
	id = diggy_dungeons.145
	title = diggy_dungeons.145.t
	desc = diggy_dungeons.145.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.145.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 225}

		dungeon_progress_advancement = { id = 150 }
	}
}

# Collapsing Shelf: Evade (M) - Failure
province_event = {
	id = diggy_dungeons.146
	title = diggy_dungeons.146.t
	desc = diggy_dungeons.146.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.146.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 150 }
	}
}

# Collapsing Shelf: Evade (M) - Success
province_event = {
	id = diggy_dungeons.147
	title = diggy_dungeons.147.t
	desc = diggy_dungeons.147.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.147.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 150 }
	}
}

# Beginning Floor 3: Barricade door (M) - Failure: Fight (M) - Success
province_event = {
	id = diggy_dungeons.148
	title = diggy_dungeons.148.t
	desc = diggy_dungeons.148.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.148.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200}
		change_party_loot = { add_tooltip = yes add = 75}

		dungeon_progress_advancement = { id = 150 }
	}
}

# Beginning Floor 3: Barricade door (M) - Failure: Fight (M) - Failure
province_event = {
	id = diggy_dungeons.149
	title = diggy_dungeons.149.t
	desc = diggy_dungeons.149.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.149.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 400}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 150 }
	}
}

# Scribe Room
province_event = {
	id = diggy_dungeons.150
	title = diggy_dungeons.150.t
	desc = diggy_dungeons.150.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.150.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 40
			success_id = 152
			
			base_failure = 60
			failure_id = 151
		}
	}
	option = {
		name = diggy_dungeons.150.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 153
			
			base_failure = 40
			failure_id = 154
		}
	}
}

# Scribe Room: Fight (H) - Failure
province_event = {
	id = diggy_dungeons.151
	title = diggy_dungeons.151.t
	desc = diggy_dungeons.151.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.151.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 155 }
	}
}

# Scribe Room: Fight (H) - Success
province_event = {
	id = diggy_dungeons.152
	title = diggy_dungeons.152.t
	desc = diggy_dungeons.152.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.152.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 155 }
	}
}

# Scribe Room: Try to catch (M) - Success
province_event = {
	id = diggy_dungeons.153
	title = diggy_dungeons.153.t
	desc = diggy_dungeons.153.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.153.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 156 }
	}
}

# Scribe Room: Try to catch (M) - Failure
province_event = {
	id = diggy_dungeons.154
	title = diggy_dungeons.154.t
	desc = diggy_dungeons.154.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.154.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 156 }
	}
}

# Gold Room
province_event = {
	id = diggy_dungeons.155
	title = diggy_dungeons.155.t
	desc = diggy_dungeons.155.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.155.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 158
			
			base_failure = 40
			failure_id = 157
		}
	}
}

# Room Somewhere
province_event = {
	id = diggy_dungeons.156
	title = diggy_dungeons.156.t
	desc = diggy_dungeons.156.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.156.a
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		
        dungeon_encounter_effect = {
			base_success = 80
			success_id = 160
			
			base_failure = 20
			failure_id = 161
		}
	}
	option = {
		name = diggy_dungeons.156.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 159 }
	}
}

# Gold Room: try to calm down (M) - Failure
province_event = {
	id = diggy_dungeons.157
	title = diggy_dungeons.157.t
	desc = diggy_dungeons.157.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.157.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 159 }
	}
}

# Gold Room: try to calm down (M) - Success
province_event = {
	id = diggy_dungeons.158
	title = diggy_dungeons.158.t
	desc = diggy_dungeons.158.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.158.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 225}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 159 }
	}
}

# Knowledge Elemental
province_event = {
	id = diggy_dungeons.159
	title = diggy_dungeons.159.t
	desc = diggy_dungeons.159.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.159.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 40
			success_id = 162
			
			base_failure = 60
			failure_id = 163
		}
	}
}

# Room Somewhere: Search Closely - Success
province_event = {
	id = diggy_dungeons.160
	title = diggy_dungeons.160.t
	desc = diggy_dungeons.160.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.160.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		add_adk_effect = { add = 1 }

		dungeon_progress_advancement = { id = 159 }
	}
}

# Room Somewhere: Search Closely - Failure
province_event = {
	id = diggy_dungeons.161
	title = diggy_dungeons.161.t
	desc = diggy_dungeons.161.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.161.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 159 }
	}
}

# Knowledge Elemental: Fight (H) - Success
province_event = {
	id = diggy_dungeons.162
	title = diggy_dungeons.162.t
	desc = diggy_dungeons.162.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.162.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200}
		change_party_loot = { add_tooltip = yes add = 75}

		dungeon_progress_advancement = { id = 164 }
	}
}

# Knowledge Elemental: Fight (H) - Failure
province_event = {
	id = diggy_dungeons.163
	title = diggy_dungeons.163.t
	desc = diggy_dungeons.163.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.163.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 400}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 164 }
	}
}

# Living Spell
province_event = {
	id = diggy_dungeons.164
	title = diggy_dungeons.164.t
	desc = diggy_dungeons.164.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.164.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 40
			success_id = 165
			
			base_failure = 60
			failure_id = 166
		}
	}
}

# Living Spell: Fight (H) - Success
province_event = {
	id = diggy_dungeons.165
	title = diggy_dungeons.165.t
	desc = diggy_dungeons.165.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.165.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		add_adk_effect = { add = 1 }
		change_party_loot = { add_tooltip = yes add = 150}

		dungeon_progress_advancement = { id = 167 }
	}
}

# Living Spell: Fight (H) - Failure
province_event = {
	id = diggy_dungeons.166
	title = diggy_dungeons.166.t
	desc = diggy_dungeons.166.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.166.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

        custom_tooltip = expedition_dead_tooltip
        hidden_effect = { expedition_dead_effect = yes }

	}
}

# End Event
province_event = {
	id = diggy_dungeons.167
	title = diggy_dungeons.167.t
	desc = diggy_dungeons.167.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

    immediate = {
        dungeon_immediate_effect = yes
    }

    option = {
        name = diggy_dungeons.167.a
        ai_chance = { factor = 100 }
        trigger = {
            always = yes
        }
        special_reward_expedition = yes
        currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
        currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
        currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
        currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
        hidden_effect = {
            while = {
                limit = { check_variable = { partyManpower = 1000 } }
                subtract_variable = { partyManpower = 1000 }
                owner = { add_manpower = 1 }
            }
        }
        custom_tooltip = back_to_manpower_tooltip
        custom_tooltip = base_expedition_loot_tooltip
        if = {
            limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
            province_event = { id = diggy_expedition.14 }
        }
        else = { hidden_effect = { clear_expedition_effect = yes } }
        hidden_effect = { set_province_flag = floor_explored }
    }

}

###############################
######## Stunveigryôrth #######
###############################

# Misc event presenting what the dungeons is
province_event = {
    id = diggy_dungeons.200
    title = diggy_dungeons.200.t
    desc = diggy_dungeons.200.d
    picture = CAVE_eventPicture
    
    is_triggered_only = yes
    
    trigger = {
        always = yes
    }
    
    immediate = {
    }
    
    after = {
    }
    
    # Nice
    option = {
        name = diggy_dungeons.200.a
        ai_chance = { factor = 100 }
    }
}
# Petrified Forest floor 1
# Beginning
province_event = {
	id = diggy_dungeons.201
	title = diggy_dungeons.201.t
	desc = diggy_dungeons.201.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.201.a
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4  }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		
        dungeon_encounter_effect = {
			base_success = 80
			success_id = 204
			
			base_failure = 20
			failure_id = 203
		}
	}
	option = {
		name = diggy_dungeons.201.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 202 }
	}
}

# A Brook Through the Canopy
province_event = {
	id = diggy_dungeons.202
	title = diggy_dungeons.202.t
	desc = diggy_dungeons.202.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.202.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 205 }
	}
	option = {
		name = diggy_dungeons.202.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 206 }
	}
}

# Beginning: Widen entrance (E) - Failure
province_event = {
	id = diggy_dungeons.203
	title = diggy_dungeons.203.t
	desc = diggy_dungeons.203.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.203.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 202 }
	}
}

# Beginning: Widen entrance (E) - Success
province_event = {
	id = diggy_dungeons.204
	title = diggy_dungeons.204.t
	desc = diggy_dungeons.204.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.204.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 150}

		dungeon_progress_advancement = { id = 202 }
	}
}

# Enchanting Lake
province_event = {
	id = diggy_dungeons.205
	title = diggy_dungeons.205.t
	desc = diggy_dungeons.205.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.205.a
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4  }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		
        dungeon_encounter_effect = {
			base_success = 80
			success_id = 209
			
			base_failure = 20
			failure_id = 210
		}
	}
	option = {
		name = diggy_dungeons.205.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 207
			
			base_failure = 40
			failure_id = 208
		}
	}
}

# Light from Below
province_event = {
	id = diggy_dungeons.206
	title = diggy_dungeons.206.t
	desc = diggy_dungeons.206.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.206.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 207
			
			base_failure = 40
			failure_id = 208
		}
	}
	option = {
		name = diggy_dungeons.206.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 211
			
			base_failure = 40
			failure_id = 208
		}
	}
}

# Enchanting Lake: Dig quickly (M) - Success
province_event = {
	id = diggy_dungeons.207
	title = diggy_dungeons.207.t
	desc = {
		trigger = { always = yes }
		desc = diggy_dungeons.207.d.1
	}
	desc = {
		trigger = { always = no }
		desc = diggy_dungeons.207.d.2
	}

	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.207.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200}
		change_party_loot = { add_tooltip = yes add = 75}

		dungeon_progress_advancement = { id = 212 }
	}
}

# Enchanting Lake: Dig quickly (M) - Failure
province_event = {
	id = diggy_dungeons.208
	title = diggy_dungeons.208.t
	desc = {
		trigger = { always = yes }
		desc = diggy_dungeons.208.d.1
	}
	desc = {
		trigger = { always = no }
		desc = diggy_dungeons.208.d.2
	}

	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.208.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 400}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 212 }
	}
}

# Enchanting Lake: Take the dive (E) - Success
province_event = {
	id = diggy_dungeons.209
	title = diggy_dungeons.209.t
	desc = diggy_dungeons.209.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.209.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}
		change_party_loot = { add_tooltip = yes add = 75}

		dungeon_progress_advancement = { id = 212 }
	}
}

# Enchanting Lake: Take the dive (E) - Failure
province_event = {
	id = diggy_dungeons.210
	title = diggy_dungeons.210.t
	desc = diggy_dungeons.210.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.210.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 212 }
	}
}

# Light from Below: Descend quietly (M) - Success
province_event = {
	id = diggy_dungeons.211
	title = diggy_dungeons.211.t
	desc = diggy_dungeons.211.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.211.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 212 }
	}
}

# Inside the Massive Hollow Tree
province_event = {
	id = diggy_dungeons.212
	title = diggy_dungeons.212.t
	desc = diggy_dungeons.212.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.212.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 213
			
			base_failure = 40
			failure_id = 214
		}
	}
}

# Inside the Massive Hollow Tree: Descend stairs (M) - Success
province_event = {
	id = diggy_dungeons.213
	title = diggy_dungeons.213.t
	desc = diggy_dungeons.213.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.213.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 215 }
	}
}

# Inside the Massive Hollow Tree: Descend stairs (M) - Failure
province_event = {
	id = diggy_dungeons.214
	title = diggy_dungeons.214.t
	desc = diggy_dungeons.214.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.214.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 215 }
	}
}

# A Strange Treasure
province_event = {
	id = diggy_dungeons.215
	title = diggy_dungeons.215.t
	desc = diggy_dungeons.215.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.215.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 80
			success_id = 216
			
			base_failure = 20
			failure_id = 218
		}
	}
	option = {
		name = diggy_dungeons.215.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 40
			success_id = 217
			
			base_failure = 60
			failure_id = 218
		}
	}
}

# A Strange Treasure: Scrape carefully (E) - Success
province_event = {
	id = diggy_dungeons.216
	title = diggy_dungeons.216.t
	desc = diggy_dungeons.216.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.216.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 75}

		dungeon_progress_advancement = { id = 219 }
	}
}

# A Strange Treasure: Grab greedily (H) - Success
province_event = {
	id = diggy_dungeons.217
	title = diggy_dungeons.217.t
	desc = diggy_dungeons.217.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.217.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 150}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 219 }
	}
}

# A Strange Treasure: Scrape carefully (E) - Failure
province_event = {
	id = diggy_dungeons.218
	title = diggy_dungeons.218.t
	desc = diggy_dungeons.218.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.218.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 75}
		change_party_manpower = { remove_tooltip = yes loss = 400}

		dungeon_progress_advancement = { id = 219 }
	}
}

# Thick Bark
province_event = {
	id = diggy_dungeons.219
	title = diggy_dungeons.219.t
	desc = diggy_dungeons.219.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.219.a
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4  }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		
        dungeon_encounter_effect = {
			base_success = 80
			success_id = 220
			
			base_failure = 20
			failure_id = 221
		}
	}
	option = {
		name = diggy_dungeons.219.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 220
			
			base_failure = 40
			failure_id = 221
		}
	}
}

# Thick Bark: Use explosives (E) - Success
province_event = {
	id = diggy_dungeons.220
	title = diggy_dungeons.220.t
	desc = {
		trigger = { always = yes }
		desc = diggy_dungeons.220.d.1
	}
	desc = {
		trigger = { always = no }
		desc = diggy_dungeons.220.d.2
	}

	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.220.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 222 }
	}
}

# Thick Bark: Use explosives (E) - Failure
province_event = {
	id = diggy_dungeons.221
	title = diggy_dungeons.221.t
	desc = {
		trigger = { always = yes }
		desc = diggy_dungeons.221.d.1
	}
	desc = {
		trigger = { always = no }
		desc = diggy_dungeons.221.d.2
	}

	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.221.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 222 }
	}
}

# End Event
province_event = {
	id = diggy_dungeons.222
	title = diggy_dungeons.222.t
	desc = diggy_dungeons.222.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

    immediate = {
        dungeon_immediate_effect = yes
    }

    option = {
        name = diggy_dungeons.222.a
        ai_chance = { factor = 100 }
        trigger = {
            always = yes
        }
        special_reward_expedition = yes
        currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
        currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
        currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
        currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
        hidden_effect = {
            while = {
                limit = { check_variable = { partyManpower = 1000 } }
                subtract_variable = { partyManpower = 1000 }
                owner = { add_manpower = 1 }
            }
        }
        custom_tooltip = back_to_manpower_tooltip
        custom_tooltip = base_expedition_loot_tooltip
        if = {
            limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
            province_event = { id = diggy_expedition.14 }
        }
        else = { hidden_effect = { clear_expedition_effect = yes } }
        hidden_effect = { set_province_flag = floor_explored }
    }

}
# Petrified Forest floor 2
# Beginning Floor 2
province_event = {
	id = diggy_dungeons.223
	title = diggy_dungeons.223.t
	desc = diggy_dungeons.223.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.223.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 225
			
			base_failure = 40
			failure_id = 226
		}
	}
	option = {
		name = diggy_dungeons.223.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 80
			success_id = 227
			
			base_failure = 20
			failure_id = 224
		}
	}
}

# Beginning Floor 2: Narrow opening (E) - Failure
province_event = {
	id = diggy_dungeons.224
	title = diggy_dungeons.224.t
	desc = diggy_dungeons.224.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.224.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

	}
}

# Beginning Floor 2: Speed decline (M) - Success
province_event = {
	id = diggy_dungeons.225
	title = diggy_dungeons.225.t
	desc = diggy_dungeons.225.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.225.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 228 }
	}
}

# Beginning Floor 2: Speed decline (M) - Failure
province_event = {
	id = diggy_dungeons.226
	title = diggy_dungeons.226.t
	desc = diggy_dungeons.226.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.226.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5}
		change_party_manpower = { remove_tooltip = yes loss = 200}

		dungeon_progress_advancement = { id = 228 }
	}
}

# Beginning Floor 2: Narrow opening (E) - Success
province_event = {
	id = diggy_dungeons.227
	title = diggy_dungeons.227.t
	desc = diggy_dungeons.227.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.227.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 229 }
	}
}

# Stone Dryads
province_event = {
	id = diggy_dungeons.228
	title = diggy_dungeons.228.t
	desc = {
		trigger = { always = yes }
		desc = diggy_dungeons.228.d.1
	}
	desc = {
		trigger = { always = no }
		desc = diggy_dungeons.228.d.2
	}

	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.228.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 230
			
			base_failure = 40
			failure_id = 231
		}
	}
	option = {
		name = diggy_dungeons.228.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 40
			success_id = 232
			
			base_failure = 60
			failure_id = 231
		}
	}
}

# Dancing lights
province_event = {
	id = diggy_dungeons.229
	title = diggy_dungeons.229.t
	desc = diggy_dungeons.229.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.229.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 233 }
	}
	option = {
		name = diggy_dungeons.229.b
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4  }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }

		dungeon_progress_advancement = { id = 228 }
	}
}

# Stone Dryads: Request passage (M) - Success
province_event = {
	id = diggy_dungeons.230
	title = diggy_dungeons.230.t
	desc = diggy_dungeons.230.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.230.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 233 }
	}
}

# Stone Dryads: Pulverise them (H) - Failure
province_event = {
	id = diggy_dungeons.231
	title = diggy_dungeons.231.t
	desc = {
		trigger = { always = yes }
		desc = diggy_dungeons.231.d.1
	}
	desc = {
		trigger = { always = no }
		desc = diggy_dungeons.231.d.2
	}

	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.231.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5}
		change_party_manpower = { remove_tooltip = yes loss = 200}

		dungeon_progress_advancement = { id = 233 }
	}
}

# Stone Dryads: Pulverise them (H) - Success
province_event = {
	id = diggy_dungeons.232
	title = diggy_dungeons.232.t
	desc = diggy_dungeons.232.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.232.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 225}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 233 }
	}
}

# Long-Closed Rift
province_event = {
	id = diggy_dungeons.233
	title = diggy_dungeons.233.t
	desc = diggy_dungeons.233.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.233.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 235 }
	}
	option = {
		name = diggy_dungeons.233.b
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		
        dungeon_encounter_effect = {
			base_success = 80
			success_id = 234
			
			base_failure = 20
			failure_id = 235
		}
	}
}

# Long-Closed Rift: Explosives will do (E) - Success
province_event = {
	id = diggy_dungeons.234
	title = diggy_dungeons.234.t
	desc = {
		trigger = { always = yes }
		desc = diggy_dungeons.234.d.1
	}
	desc = {
		trigger = { always = no }
		desc = diggy_dungeons.234.d.2
	}

	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.234.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 236 }
	}
}

# Long-Closed Rift: Wield it (M) - Failure
province_event = {
	id = diggy_dungeons.235
	title = diggy_dungeons.235.t
	desc = {
		trigger = { always = yes }
		desc = diggy_dungeons.235.d.1
	}
	desc = {
		trigger = { always = no }
		desc = diggy_dungeons.235.d.2
	}

	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.235.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5}
		change_party_manpower = { remove_tooltip = yes loss = 200}

		dungeon_progress_advancement = { id = 236 }
	}
}

# Bridged Chasm
province_event = {
	id = diggy_dungeons.236
	title = diggy_dungeons.236.t
	desc = diggy_dungeons.236.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.236.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 80
			success_id = 239
			
			base_failure = 20
			failure_id = 237
		}
	}
	option = {
		name = diggy_dungeons.236.b
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 238
			
			base_failure = 40
			failure_id = 237
		}
	}
}

# Bridged Chasm: A fallen tree (E) - Failure
province_event = {
	id = diggy_dungeons.237
	title = diggy_dungeons.237.t
	desc = {
		trigger = { always = yes }
		desc = diggy_dungeons.237.d.1
	}
	desc = {
		trigger = { always = no }
		desc = diggy_dungeons.237.d.2
	}

	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.237.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5}
		change_party_manpower = { remove_tooltip = yes loss = 200}

		dungeon_progress_advancement = { id = 240 }
	}
}

# Bridged Chasm: Descend (M) - Success
province_event = {
	id = diggy_dungeons.238
	title = diggy_dungeons.238.t
	desc = diggy_dungeons.238.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.238.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 150}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 240 }
	}
}

# Bridged Chasm: A fallen tree (E) - Success
province_event = {
	id = diggy_dungeons.239
	title = diggy_dungeons.239.t
	desc = diggy_dungeons.239.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.239.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 240 }
	}
}

# Stone Faerie Ring
province_event = {
	id = diggy_dungeons.240
	title = diggy_dungeons.240.t
	desc = diggy_dungeons.240.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.240.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 40
			success_id = 242
			
			base_failure = 60
			failure_id = 241
		}
	}
	option = {
		name = diggy_dungeons.240.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 243 }
	}
}

# Stone Faerie Ring: Risk it (H) - Failure
province_event = {
	id = diggy_dungeons.241
	title = diggy_dungeons.241.t
	desc = diggy_dungeons.241.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.241.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 400}
		change_party_morale = { remove_tooltip = yes loss = 1 }

		dungeon_progress_advancement = { id = 243 }
	}
}

# Stone Faerie Ring: Risk it (H) - Success
province_event = {
	id = diggy_dungeons.242
	title = diggy_dungeons.242.t
	desc = diggy_dungeons.242.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.242.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 225}

		dungeon_progress_advancement = { id = 243 }
	}
}

# Exposed Roots
province_event = {
	id = diggy_dungeons.243
	title = diggy_dungeons.243.t
	desc = diggy_dungeons.243.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.243.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 40
			success_id = 244
			
			base_failure = 60
			failure_id = 247
		}
	}
	option = {
		name = diggy_dungeons.243.b
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		
        dungeon_encounter_effect = {
			base_success = 80
			success_id = 245
			
			base_failure = 20
			failure_id = 246
		}
	}
}

# Exposed Roots: Magical means (H) - Success
province_event = {
	id = diggy_dungeons.244
	title = diggy_dungeons.244.t
	desc = diggy_dungeons.244.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.244.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 150}

		dungeon_progress_advancement = { id = 248 }
	}
}

# Exposed Roots: Gunpowder (E) - Success
province_event = {
	id = diggy_dungeons.245
	title = diggy_dungeons.245.t
	desc = diggy_dungeons.245.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.245.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 75}

		dungeon_progress_advancement = { id = 248 }
	}
}

# Exposed Roots: Gunpowder (E) - Failure
province_event = {
	id = diggy_dungeons.246
	title = diggy_dungeons.246.t
	desc = diggy_dungeons.246.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.246.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 400}
		change_party_morale = { remove_tooltip = yes loss = 1 }

		dungeon_progress_advancement = { id = 248 }
	}
}

# Exposed Roots: Magical means (H) - Failure
province_event = {
	id = diggy_dungeons.247
	title = diggy_dungeons.247.t
	desc = diggy_dungeons.247.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.247.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

        custom_tooltip = expedition_dead_tooltip
        hidden_effect = { expedition_dead_effect = yes }

	}
}

# End Event
province_event = {
	id = diggy_dungeons.248
	title = diggy_dungeons.248.t
	desc = diggy_dungeons.248.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

    immediate = {
        dungeon_immediate_effect = yes
    }

    option = {
        name = diggy_dungeons.248.a
        ai_chance = { factor = 100 }
        trigger = {
            always = yes
        }
        special_reward_expedition = yes
        currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
        currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
        currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
        currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
        hidden_effect = {
            while = {
                limit = { check_variable = { partyManpower = 1000 } }
                subtract_variable = { partyManpower = 1000 }
                owner = { add_manpower = 1 }
            }
        }
        custom_tooltip = back_to_manpower_tooltip
        custom_tooltip = base_expedition_loot_tooltip
        if = {
            limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
            province_event = { id = diggy_expedition.14 }
        }
        else = { hidden_effect = { clear_expedition_effect = yes } }
        hidden_effect = { set_province_flag = floor_explored }
    }

}
# Petrified Forest floor 3
# Beginning Floor 3
province_event = {
	id = diggy_dungeons.249
	title = diggy_dungeons.249.t
	desc = diggy_dungeons.249.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.249.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 250 }
	}
	option = {
		name = diggy_dungeons.249.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 251 }
	}
}

# Upper Path
province_event = {
	id = diggy_dungeons.250
	title = diggy_dungeons.250.t
	desc = diggy_dungeons.250.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.250.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 253
			
			base_failure = 40
			failure_id = 252
		}
	}
	option = {
		name = diggy_dungeons.250.b
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		
        dungeon_encounter_effect = {
			base_success = 80
			success_id = 253
			
			base_failure = 20
			failure_id = 252
		}
	}
}

# Boggle Nest
province_event = {
	id = diggy_dungeons.251
	title = diggy_dungeons.251.t
	desc = diggy_dungeons.251.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.251.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 255
			
			base_failure = 40
			failure_id = 256
		}
	}
	option = {
		name = diggy_dungeons.251.b
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 254
			
			base_failure = 40
			failure_id = 256
		}
	}
}

# Upper Path: Chance it (M) - Failure
province_event = {
	id = diggy_dungeons.252
	title = diggy_dungeons.252.t
	desc = {
		trigger = { always = yes }
		desc = diggy_dungeons.252.d.1
	}
	desc = {
		trigger = { always = no }
		desc = diggy_dungeons.252.d.2
	}

	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.252.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5}
		change_party_manpower = { remove_tooltip = yes loss = 200}

		dungeon_progress_advancement = { id = 251 }
	}
}

# Upper Path: Chance it (M) - Success
province_event = {
	id = diggy_dungeons.253
	title = diggy_dungeons.253.t
	desc = {
		trigger = { always = yes }
		desc = diggy_dungeons.253.d.1
	}
	desc = {
		trigger = { always = no }
		desc = diggy_dungeons.253.d.2
	}

	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.253.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 257 }
	}
}

# Boggle Nest: Smoke them out (M) - Success
province_event = {
	id = diggy_dungeons.254
	title = diggy_dungeons.254.t
	desc = diggy_dungeons.254.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.254.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}
		change_party_loot = { add_tooltip = yes add = 150}

		dungeon_progress_advancement = { id = 258 }
	}
}

# Boggle Nest: Tight formation (M) - Success
province_event = {
	id = diggy_dungeons.255
	title = diggy_dungeons.255.t
	desc = diggy_dungeons.255.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.255.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 258 }
	}
}

# Boggle Nest: Smoke them out (M) - Failure
province_event = {
	id = diggy_dungeons.256
	title = diggy_dungeons.256.t
	desc = {
		trigger = { always = yes }
		desc = diggy_dungeons.256.d.1
	}
	desc = {
		trigger = { always = no }
		desc = diggy_dungeons.256.d.2
	}

	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.256.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200}

		dungeon_progress_advancement = { id = 258 }
	}
}

# Satyr Feast Hall
province_event = {
	id = diggy_dungeons.257
	title = diggy_dungeons.257.t
	desc = diggy_dungeons.257.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.257.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 80
			success_id = 261
			
			base_failure = 20
			failure_id = 260
		}
	}
	option = {
		name = diggy_dungeons.257.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 40
			success_id = 259
			
			base_failure = 60
			failure_id = 260
		}
	}
}

# The Boneyard
province_event = {
	id = diggy_dungeons.258
	title = diggy_dungeons.258.t
	desc = diggy_dungeons.258.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.258.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 263
			
			base_failure = 40
			failure_id = 264
		}
	}
	option = {
		name = diggy_dungeons.258.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 262 }
	}
}

# Satyr Feast Hall: End the illusion (H) - Success
province_event = {
	id = diggy_dungeons.259
	title = diggy_dungeons.259.t
	desc = diggy_dungeons.259.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.259.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 150}
		change_party_supplies = { add_tooltip = yes add = 4 }

		dungeon_progress_advancement = { id = 262 }
	}
}

# Satyr Feast Hall: Indulge them (E) - Failure
province_event = {
	id = diggy_dungeons.260
	title = diggy_dungeons.260.t
	desc = {
		trigger = { always = yes }
		desc = diggy_dungeons.260.d.1
	}
	desc = {
		trigger = { always = no }
		desc = diggy_dungeons.260.d.2
	}

	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.260.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 1 }

		dungeon_progress_advancement = { id = 262 }
	}
}

# Satyr Feast Hall: Indulge them (E) - Success
province_event = {
	id = diggy_dungeons.261
	title = diggy_dungeons.261.t
	desc = diggy_dungeons.261.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.261.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_supplies = { add_tooltip = yes add = 4 }

		dungeon_progress_advancement = { id = 262 }
	}
}

# Ennis Hag
province_event = {
	id = diggy_dungeons.262
	title = diggy_dungeons.262.t
	desc = diggy_dungeons.262.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.262.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 267
			
			base_failure = 40
			failure_id = 266
		}
	}
	option = {
		name = diggy_dungeons.262.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 80
			success_id = 265
			
			base_failure = 20
			failure_id = 266
		}
	}
}

# The Boneyard: Loot it (M) - Success
province_event = {
	id = diggy_dungeons.263
	title = diggy_dungeons.263.t
	desc = diggy_dungeons.263.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.263.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 75}

		dungeon_progress_advancement = { id = 262 }
	}
}

# The Boneyard: Loot it (M) - Failure
province_event = {
	id = diggy_dungeons.264
	title = diggy_dungeons.264.t
	desc = diggy_dungeons.264.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.264.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5}
		change_party_manpower = { remove_tooltip = yes loss = 200}

		dungeon_progress_advancement = { id = 262 }
	}
}

# Ennis Hag: Kill on suspicion (E) - Success
province_event = {
	id = diggy_dungeons.265
	title = diggy_dungeons.265.t
	desc = diggy_dungeons.265.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.265.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 1 }
		change_party_manpower = { remove_tooltip = yes loss = 200}

		dungeon_progress_advancement = { id = 268 }
	}
}

# Ennis Hag: Kill on suspicion (E) - Failure
province_event = {
	id = diggy_dungeons.266
	title = diggy_dungeons.266.t
	desc = diggy_dungeons.266.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.266.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

        custom_tooltip = expedition_dead_tooltip
        hidden_effect = { expedition_dead_effect = yes }

	}
}

# Ennis Hag: Identify (M) - Success
province_event = {
	id = diggy_dungeons.267
	title = diggy_dungeons.267.t
	desc = diggy_dungeons.267.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.267.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 268 }
	}
}

# Hag Lair
province_event = {
	id = diggy_dungeons.268
	title = diggy_dungeons.268.t
	desc = diggy_dungeons.268.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.268.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 80
			success_id = 271
			
			base_failure = 20
			failure_id = 269
		}
	}
	option = {
		name = diggy_dungeons.268.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 270
			
			base_failure = 40
			failure_id = 269
		}
	}
}

# Hag Lair: Stick Together (M) - Failure
province_event = {
	id = diggy_dungeons.269
	title = diggy_dungeons.269.t
	desc = {
		trigger = { always = yes }
		desc = diggy_dungeons.269.d.1
	}
	desc = {
		trigger = { always = no }
		desc = diggy_dungeons.269.d.2
	}

	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.269.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 400}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 272 }
	}
}

# Hag Lair: Stick Together (M) - Success
province_event = {
	id = diggy_dungeons.270
	title = diggy_dungeons.270.t
	desc = diggy_dungeons.270.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.270.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 272 }
	}
}

# Hag Lair: Split up (E) - Success
province_event = {
	id = diggy_dungeons.271
	title = diggy_dungeons.271.t
	desc = diggy_dungeons.271.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.271.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200}

		dungeon_progress_advancement = { id = 272 }
	}
}

# Ennis Hag
province_event = {
	id = diggy_dungeons.272
	title = diggy_dungeons.272.t
	desc = diggy_dungeons.272.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.272.a
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4 }
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 275
			
			base_failure = 40
			failure_id = 273
		}
	}
	option = {
		name = diggy_dungeons.272.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 40
			success_id = 274
			
			base_failure = 60
			failure_id = 273
		}
	}
}

# Ennis Hag: Face the monster (H) - Failure
province_event = {
	id = diggy_dungeons.273
	title = diggy_dungeons.273.t
	desc = diggy_dungeons.273.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.273.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

        custom_tooltip = expedition_dead_tooltip
        hidden_effect = { expedition_dead_effect = yes }

	}
}

# Ennis Hag: Face the monster (H) - Success
province_event = {
	id = diggy_dungeons.274
	title = diggy_dungeons.274.t
	desc = diggy_dungeons.274.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.274.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 225}

	}
}

# Ennis Hag: Burn it down (M) - Success
province_event = {
	id = diggy_dungeons.275
	title = diggy_dungeons.275.t
	desc = diggy_dungeons.275.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.275.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 75}

		dungeon_progress_advancement = { id = 276 }
	}
}

# End Event
province_event = {
	id = diggy_dungeons.276
	title = diggy_dungeons.276.t
	desc = diggy_dungeons.276.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

    immediate = {
        dungeon_immediate_effect = yes
    }

    option = {
        name = diggy_dungeons.276.a
        ai_chance = { factor = 100 }
        trigger = {
            always = yes
        }
        special_reward_expedition = yes
        currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
        currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
        currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
        currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
        hidden_effect = {
            while = {
                limit = { check_variable = { partyManpower = 1000 } }
                subtract_variable = { partyManpower = 1000 }
                owner = { add_manpower = 1 }
            }
        }
        custom_tooltip = back_to_manpower_tooltip
        custom_tooltip = base_expedition_loot_tooltip
        if = {
            limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
            province_event = { id = diggy_expedition.14 }
        }
        else = { hidden_effect = { clear_expedition_effect = yes } }
        hidden_effect = { set_province_flag = floor_explored }
    }

}



###############################
########## Wytlramvar #########
###############################

# Misc event presenting what the dungeons is
province_event = {
    id = diggy_dungeons.300
    title = diggy_dungeons.300.t
    desc = diggy_dungeons.300.d
    picture = CAVE_eventPicture
    
    is_triggered_only = yes
    
    trigger = {
        always = yes
    }
    
    immediate = {
    }
    
    after = {
    }
    
    # Nice
    option = {
        name = diggy_dungeons.300.a
        ai_chance = { factor = 100 }
    }
}
# The Roots of the Spine floor 1
# Past the lake
province_event = {
	id = diggy_dungeons.301
	title = diggy_dungeons.301.t
	desc = diggy_dungeons.301.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.301.a
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4.0 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4.0}

		dungeon_progress_advancement = { id = 303 }
	}
	option = {
		name = diggy_dungeons.301.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 302 }
	}
}

# around the lake
province_event = {
	id = diggy_dungeons.302
	title = diggy_dungeons.302.t
	desc = diggy_dungeons.302.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.302.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 304 }
	}
	option = {
		name = diggy_dungeons.302.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 305 }
	}
}

# through the lake
province_event = {
	id = diggy_dungeons.303
	title = diggy_dungeons.303.t
	desc = diggy_dungeons.303.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.303.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 306 }
	}
	option = {
		name = diggy_dungeons.303.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 307 }
	}
}

# crabs!
province_event = {
	id = diggy_dungeons.304
	title = diggy_dungeons.304.t
	desc = diggy_dungeons.304.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.304.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 309 }
	}
	option = {
		name = diggy_dungeons.304.b
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4.0 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4.0}
		
        dungeon_encounter_effect = {
			base_success = 80
			success_id = 310
			
			base_failure = 20
			failure_id = 308
		}
	}
}

# cave in a cave
province_event = {
	id = diggy_dungeons.305
	title = diggy_dungeons.305.t
	desc = diggy_dungeons.305.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.305.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 311
			
			base_failure = 40
			failure_id = 312
		}
	}
}

# strange swells
province_event = {
	id = diggy_dungeons.306
	title = diggy_dungeons.306.t
	desc = diggy_dungeons.306.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.306.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 304 }
	}
	option = {
		name = diggy_dungeons.306.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 313 }
	}
}

# island with goblins!
province_event = {
	id = diggy_dungeons.307
	title = diggy_dungeons.307.t
	desc = diggy_dungeons.307.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.307.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 315
			
			base_failure = 40
			failure_id = 314
		}
	}
}

# crabs!: feed (E) - Failure
province_event = {
	id = diggy_dungeons.308
	title = diggy_dungeons.308.t
	desc = diggy_dungeons.308.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.308.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 316 }
	}
}

# large angry crab/orcs living in the cave
province_event = {
	id = diggy_dungeons.309
	title = diggy_dungeons.309.t
	desc = {
		trigger = { always = yes }
		desc = diggy_dungeons.309.d.1
	}
	desc = {
		trigger = { always = no }
		desc = diggy_dungeons.309.d.2
	}

	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.309.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 80
			success_id = 317
			
			base_failure = 20
			failure_id = 318
		}
	}
}

# crabs!: feed (E) - Success
province_event = {
	id = diggy_dungeons.310
	title = diggy_dungeons.310.t
	desc = diggy_dungeons.310.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.310.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 316 }
	}
}

# cave in a cave: search (M) - Success
province_event = {
	id = diggy_dungeons.311
	title = diggy_dungeons.311.t
	desc = diggy_dungeons.311.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.311.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 75}
		add_adk_effect = { add = 1 }		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 309 }
	}
}

# cave in a cave: search (M) - Failure
province_event = {
	id = diggy_dungeons.312
	title = diggy_dungeons.312.t
	desc = diggy_dungeons.312.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.312.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 309 }
	}
}

# mist spewer
province_event = {
	id = diggy_dungeons.313
	title = diggy_dungeons.313.t
	desc = diggy_dungeons.313.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.313.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 40
			success_id = 315
			
			base_failure = 60
			failure_id = 314
		}
	}
}

# island with goblins!: fight (H) - Failure
province_event = {
	id = diggy_dungeons.314
	title = diggy_dungeons.314.t
	desc = {
		trigger = { always = yes }
		desc = diggy_dungeons.314.d.1
	}
	desc = {
		trigger = { always = no }
		desc = diggy_dungeons.314.d.2
	}

	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.314.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 319 }
	}
}

# island with goblins!: fight (H) - Success
province_event = {
	id = diggy_dungeons.315
	title = diggy_dungeons.315.t
	desc = {
		trigger = { always = yes }
		desc = diggy_dungeons.315.d.1
	}
	desc = {
		trigger = { always = no }
		desc = diggy_dungeons.315.d.2
	}

	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.315.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200}
		change_party_loot = { add_tooltip = yes add = 150}

		dungeon_progress_advancement = { id = 319 }
	}
}

# we're not alone
province_event = {
	id = diggy_dungeons.316
	title = diggy_dungeons.316.t
	desc = diggy_dungeons.316.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.316.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 321
			
			base_failure = 40
			failure_id = 320
		}
	}
}

# large angry crab/orcs living in the cave: fight (E) - Success
province_event = {
	id = diggy_dungeons.317
	title = diggy_dungeons.317.t
	desc = diggy_dungeons.317.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.317.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 316 }
	}
}

# large angry crab/orcs living in the cave: fight (E) - Failure
province_event = {
	id = diggy_dungeons.318
	title = diggy_dungeons.318.t
	desc = diggy_dungeons.318.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.318.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 316 }
	}
}

# sudden speed&nbsp;
province_event = {
	id = diggy_dungeons.319
	title = diggy_dungeons.319.t
	desc = diggy_dungeons.319.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.319.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 322
			
			base_failure = 40
			failure_id = 320
		}
	}
}

# we're not alone: traverse rapids (M) - Failure
province_event = {
	id = diggy_dungeons.320
	title = diggy_dungeons.320.t
	desc = {
		trigger = { always = yes }
		desc = diggy_dungeons.320.d.1
	}
	desc = {
		trigger = { always = no }
		desc = diggy_dungeons.320.d.2
	}

	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.320.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 323 }
	}
}

# we're not alone: scout ahead (M)&nbsp; - Success
province_event = {
	id = diggy_dungeons.321
	title = diggy_dungeons.321.t
	desc = diggy_dungeons.321.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.321.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 323 }
	}
}

# sudden speed&nbsp;: traverse rapids (M) - Success
province_event = {
	id = diggy_dungeons.322
	title = diggy_dungeons.322.t
	desc = diggy_dungeons.322.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.322.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 323 }
	}
}

# Ancient legged fish
province_event = {
	id = diggy_dungeons.323
	title = diggy_dungeons.323.t
	desc = diggy_dungeons.323.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.323.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 325
			
			base_failure = 40
			failure_id = 324
		}
	}
}

# Ancient legged fish: Fight (M) - Failure
province_event = {
	id = diggy_dungeons.324
	title = diggy_dungeons.324.t
	desc = diggy_dungeons.324.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.324.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

        custom_tooltip = expedition_dead_tooltip
        hidden_effect = { expedition_dead_effect = yes }

	}
}

# Ancient legged fish: Fight (M) - Success
province_event = {
	id = diggy_dungeons.325
	title = diggy_dungeons.325.t
	desc = diggy_dungeons.325.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.325.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200}
		change_party_loot = { add_tooltip = yes add = 150}

		dungeon_progress_advancement = { id = 326 }
	}
}

# stairs below nest
province_event = {
	id = diggy_dungeons.326
	title = diggy_dungeons.326.t
	desc = diggy_dungeons.326.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

    immediate = {
        dungeon_immediate_effect = yes
    }

    option = {
        name = diggy_dungeons.326.a
        ai_chance = { factor = 100 }
        trigger = {
            always = yes
        }
        special_reward_expedition = yes
        currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
        currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
        currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
        currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
        hidden_effect = {
            while = {
                limit = { check_variable = { partyManpower = 1000 } }
                subtract_variable = { partyManpower = 1000 }
                owner = { add_manpower = 1 }
            }
        }
        custom_tooltip = back_to_manpower_tooltip
        custom_tooltip = base_expedition_loot_tooltip
        if = {
            limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
            province_event = { id = diggy_expedition.14 }
        }
        else = { hidden_effect = { clear_expedition_effect = yes } }
        hidden_effect = { set_province_flag = floor_explored }
    }

}
# The Roots of the Spine floor 2
# Collapsing wall
province_event = {
	id = diggy_dungeons.327
	title = diggy_dungeons.327.t
	desc = diggy_dungeons.327.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.327.a
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4.0 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4.0}

		dungeon_progress_advancement = { id = 328 }
	}
	option = {
		name = diggy_dungeons.327.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 329 }
	}
}

# storeroom
province_event = {
	id = diggy_dungeons.328
	title = diggy_dungeons.328.t
	desc = diggy_dungeons.328.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.328.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 80
			success_id = 332
			
			base_failure = 20
			failure_id = 331
		}
	}
	option = {
		name = diggy_dungeons.328.b
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4.0 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4.0}

		dungeon_progress_advancement = { id = 330 }
	}
}

# confusing junction
province_event = {
	id = diggy_dungeons.329
	title = diggy_dungeons.329.t
	desc = diggy_dungeons.329.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.329.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 334 }
	}
	option = {
		name = diggy_dungeons.329.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 333 }
	}
	option = {
		name = diggy_dungeons.329.c
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 335 }
	}
}

# collapsed exit
province_event = {
	id = diggy_dungeons.330
	title = diggy_dungeons.330.t
	desc = diggy_dungeons.330.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.330.a
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4.0 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4.0}
		
        dungeon_encounter_effect = {
			base_success = 80
			success_id = 337
			
			base_failure = 20
			failure_id = 336
		}
	}
	option = {
		name = diggy_dungeons.330.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 337
			
			base_failure = 40
			failure_id = 336
		}
	}
}

# storeroom: search (E) - Failure
province_event = {
	id = diggy_dungeons.331
	title = diggy_dungeons.331.t
	desc = diggy_dungeons.331.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.331.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 330 }
	}
}

# storeroom: search (E) - Success
province_event = {
	id = diggy_dungeons.332
	title = diggy_dungeons.332.t
	desc = diggy_dungeons.332.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.332.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 75}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 330 }
	}
}

# reinforced door
province_event = {
	id = diggy_dungeons.333
	title = diggy_dungeons.333.t
	desc = diggy_dungeons.333.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.333.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 40
			success_id = 339
			
			base_failure = 60
			failure_id = 338
		}
	}
}

# Crystal growths
province_event = {
	id = diggy_dungeons.334
	title = diggy_dungeons.334.t
	desc = diggy_dungeons.334.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.334.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 340 }
	}
	option = {
		name = diggy_dungeons.334.b
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4.0 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4.0}

		dungeon_progress_advancement = { id = 341 }
	}
}

# Goblin patrol
province_event = {
	id = diggy_dungeons.335
	title = diggy_dungeons.335.t
	desc = diggy_dungeons.335.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.335.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 342
			
			base_failure = 40
			failure_id = 343
		}
	}
}

# collapsed exit: sprint across (M) - Failure
province_event = {
	id = diggy_dungeons.336
	title = diggy_dungeons.336.t
	desc = {
		trigger = { always = yes }
		desc = diggy_dungeons.336.d.1
	}
	desc = {
		trigger = { always = no }
		desc = diggy_dungeons.336.d.2
	}

	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.336.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 400}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 344 }
	}
}

# collapsed exit: push through rubble (M) - Success
province_event = {
	id = diggy_dungeons.337
	title = diggy_dungeons.337.t
	desc = {
		trigger = { always = yes }
		desc = diggy_dungeons.337.d.1
	}
	desc = {
		trigger = { always = no }
		desc = diggy_dungeons.337.d.2
	}

	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.337.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 344 }
	}
}

# reinforced door: break it down (H) - Failure
province_event = {
	id = diggy_dungeons.338
	title = diggy_dungeons.338.t
	desc = diggy_dungeons.338.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.338.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 329 }
	}
}

# reinforced door: break it down (H) - Success
province_event = {
	id = diggy_dungeons.339
	title = diggy_dungeons.339.t
	desc = diggy_dungeons.339.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.339.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 328 }
	}
}

# old rope bridge
province_event = {
	id = diggy_dungeons.340
	title = diggy_dungeons.340.t
	desc = diggy_dungeons.340.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.340.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 337
			
			base_failure = 40
			failure_id = 336
		}
	}
	option = {
		name = diggy_dungeons.340.b
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4.0 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4.0}
		
        dungeon_encounter_effect = {
			base_success = 80
			success_id = 337
			
			base_failure = 20
			failure_id = 336
		}
	}
}

# Crystal monsters
province_event = {
	id = diggy_dungeons.341
	title = diggy_dungeons.341.t
	desc = diggy_dungeons.341.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.341.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

	}
	option = {
		name = diggy_dungeons.341.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 40
			success_id = 346
			
			base_failure = 60
			failure_id = 345
		}
	}
}

# Goblin patrol: fight (M) - Success
province_event = {
	id = diggy_dungeons.342
	title = diggy_dungeons.342.t
	desc = diggy_dungeons.342.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.342.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 340 }
	}
}

# Goblin patrol: fight (M) - Failure
province_event = {
	id = diggy_dungeons.343
	title = diggy_dungeons.343.t
	desc = diggy_dungeons.343.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.343.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 400}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 340 }
	}
}

# wow pretty lake
province_event = {
	id = diggy_dungeons.344
	title = diggy_dungeons.344.t
	desc = diggy_dungeons.344.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

    immediate = {
        dungeon_immediate_effect = yes
    }

    option = {
        name = diggy_dungeons.344.a
        ai_chance = { factor = 100 }
        trigger = {
            always = yes
        }
        special_reward_expedition = yes
        currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
        currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
        currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
        currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
        hidden_effect = {
            while = {
                limit = { check_variable = { partyManpower = 1000 } }
                subtract_variable = { partyManpower = 1000 }
                owner = { add_manpower = 1 }
            }
        }
        custom_tooltip = back_to_manpower_tooltip
        custom_tooltip = base_expedition_loot_tooltip
        if = {
            limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
            province_event = { id = diggy_expedition.14 }
        }
        else = { hidden_effect = { clear_expedition_effect = yes } }
        hidden_effect = { set_province_flag = floor_explored }
    }

}

# Crystal monsters: leave crystals (E) - Failure
province_event = {
	id = diggy_dungeons.345
	title = diggy_dungeons.345.t
	desc = diggy_dungeons.345.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.345.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 400}
		change_party_morale = { remove_tooltip = yes loss = 0.5}
		change_party_loot = { remove_tooltip = yes loss = 75}

		dungeon_progress_advancement = { id = 340 }
	}
}

# Crystal monsters: fight (H) - Success
province_event = {
	id = diggy_dungeons.346
	title = diggy_dungeons.346.t
	desc = diggy_dungeons.346.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.346.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200}
		change_party_morale = { add_tooltip = yes add = 0.5}
		change_party_loot = { add_tooltip = yes add = 150}

		dungeon_progress_advancement = { id = 340 }
	}
}
# The Roots of the Spine floor 3
# enter the ruins
province_event = {
	id = diggy_dungeons.347
	title = diggy_dungeons.347.t
	desc = diggy_dungeons.347.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.347.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 349 }
	}
	option = {
		name = diggy_dungeons.347.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 348 }
	}
}

# sleeping quarters
province_event = {
	id = diggy_dungeons.348
	title = diggy_dungeons.348.t
	desc = diggy_dungeons.348.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.348.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 80
			success_id = 350
			
			base_failure = 20
			failure_id = 351
		}
	}
}

# kitchen
province_event = {
	id = diggy_dungeons.349
	title = diggy_dungeons.349.t
	desc = diggy_dungeons.349.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.349.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 353
			
			base_failure = 40
			failure_id = 352
		}
	}
}

# sleeping quarters: clattering skeleton (E). if morale below 1/2 initial value then (M) - Success
province_event = {
	id = diggy_dungeons.350
	title = diggy_dungeons.350.t
	desc = diggy_dungeons.350.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.350.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}
		change_party_loot = { add_tooltip = yes add = 75}

		dungeon_progress_advancement = { id = 354 }
	}
}

# sleeping quarters: clattering skeleton (E). if morale below 1/2 initial value then (M) - Failure
province_event = {
	id = diggy_dungeons.351
	title = diggy_dungeons.351.t
	desc = diggy_dungeons.351.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.351.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 354 }
	}
}

# kitchen: search (M) - Failure
province_event = {
	id = diggy_dungeons.352
	title = diggy_dungeons.352.t
	desc = diggy_dungeons.352.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.352.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 355 }
	}
}

# kitchen: search (M) - Success
province_event = {
	id = diggy_dungeons.353
	title = diggy_dungeons.353.t
	desc = diggy_dungeons.353.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.353.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 355 }
	}
}

# t intersection
province_event = {
	id = diggy_dungeons.354
	title = diggy_dungeons.354.t
	desc = diggy_dungeons.354.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.354.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 356 }
	}
	option = {
		name = diggy_dungeons.354.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 357 }
	}
	option = {
		name = diggy_dungeons.354.c
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 349 }
	}
}

# t intersection
province_event = {
	id = diggy_dungeons.355
	title = diggy_dungeons.355.t
	desc = diggy_dungeons.355.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.355.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 356 }
	}
	option = {
		name = diggy_dungeons.355.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 357 }
	}
	option = {
		name = diggy_dungeons.355.c
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 348 }
	}
}

# closed gate
province_event = {
	id = diggy_dungeons.356
	title = diggy_dungeons.356.t
	desc = diggy_dungeons.356.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.356.a
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4.0 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4.0}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 359
			
			base_failure = 40
			failure_id = 358
		}
	}
	option = {
		name = diggy_dungeons.356.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 40
			success_id = 359
			
			base_failure = 60
			failure_id = 358
		}
	}
}

# storage room
province_event = {
	id = diggy_dungeons.357
	title = diggy_dungeons.357.t
	desc = diggy_dungeons.357.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.357.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 40
			success_id = 361
			
			base_failure = 60
			failure_id = 360
		}
	}
	option = {
		name = diggy_dungeons.357.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 362
			
			base_failure = 40
			failure_id = 360
		}
	}
}

# closed gate: fix the crank (H) - Failure
province_event = {
	id = diggy_dungeons.358
	title = diggy_dungeons.358.t
	desc = {
		trigger = { always = yes }
		desc = diggy_dungeons.358.d.1
	}
	desc = {
		trigger = { always = no }
		desc = diggy_dungeons.358.d.2
	}

	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.358.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 363 }
	}
}

# closed gate: fix the crank (H) - Success
province_event = {
	id = diggy_dungeons.359
	title = diggy_dungeons.359.t
	desc = {
		trigger = { always = yes }
		desc = diggy_dungeons.359.d.1
	}
	desc = {
		trigger = { always = no }
		desc = diggy_dungeons.359.d.2
	}

	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.359.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 363 }
	}
}

# storage room: search for shinies (M) - Failure
province_event = {
	id = diggy_dungeons.360
	title = diggy_dungeons.360.t
	desc = {
		trigger = { always = yes }
		desc = diggy_dungeons.360.d.1
	}
	desc = {
		trigger = { always = no }
		desc = diggy_dungeons.360.d.2
	}

	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.360.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { remove_tooltip = yes loss = 0.5}

		dungeon_progress_advancement = { id = 364 }
	}
}

# storage room: search for clues (H) - Success
province_event = {
	id = diggy_dungeons.361
	title = diggy_dungeons.361.t
	desc = diggy_dungeons.361.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.361.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 364 }
	}
}

# storage room: search for shinies (M) - Success
province_event = {
	id = diggy_dungeons.362
	title = diggy_dungeons.362.t
	desc = diggy_dungeons.362.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.362.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 150}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 364 }
	}
}

# large chamber
province_event = {
	id = diggy_dungeons.363
	title = diggy_dungeons.363.t
	desc = diggy_dungeons.363.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.363.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 60
			success_id = 365
			
			base_failure = 40
			failure_id = 366
		}
	}
}

# t intersection
province_event = {
	id = diggy_dungeons.364
	title = diggy_dungeons.364.t
	desc = diggy_dungeons.364.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.364.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 348 }
	}
	option = {
		name = diggy_dungeons.364.b
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 349 }
	}
	option = {
		name = diggy_dungeons.364.c
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 356 }
	}
}

# large chamber: dodge (M) - Success
province_event = {
	id = diggy_dungeons.365
	title = diggy_dungeons.365.t
	desc = diggy_dungeons.365.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.365.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_morale = { add_tooltip = yes add = 0.5}

		dungeon_progress_advancement = { id = 367 }
	}
}

# large chamber: dodge (M) - Failure
province_event = {
	id = diggy_dungeons.366
	title = diggy_dungeons.366.t
	desc = diggy_dungeons.366.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.366.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_manpower = { remove_tooltip = yes loss = 200}

		dungeon_progress_advancement = { id = 368 }
	}
}

# strange nest
province_event = {
	id = diggy_dungeons.367
	title = diggy_dungeons.367.t
	desc = diggy_dungeons.367.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.367.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

		dungeon_progress_advancement = { id = 368 }
	}
	option = {
		name = diggy_dungeons.367.b
		ai_chance = { factor = 100 }
		trigger = {
			check_variable = { partySupplies = 4.0 }
		}
		change_party_supplies = { remove_tooltip = yes loss = 4.0}

		dungeon_progress_advancement = { id = 368 }
	}
}

# &nbsp;large camouflage bug
province_event = {
	id = diggy_dungeons.368
	title = diggy_dungeons.368.t
	desc = {
		trigger = { always = yes }
		desc = diggy_dungeons.368.d.1
	}
	desc = {
		trigger = { always = no }
		desc = diggy_dungeons.368.d.2
	}

	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.368.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		
        dungeon_encounter_effect = {
			base_success = 40
			success_id = 369
			
			base_failure = 60
			failure_id = 370
		}
	}
}

# &nbsp;large camouflage bug: fight (H) - Success
province_event = {
	id = diggy_dungeons.369
	title = diggy_dungeons.369.t
	desc = diggy_dungeons.369.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.369.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}
		change_party_loot = { add_tooltip = yes add = 225}
		add_adk_effect = { add = 1 }
		dungeon_progress_advancement = { id = 371 }
	}
}

# &nbsp;large camouflage bug: fight (H) - Failure
province_event = {
	id = diggy_dungeons.370
	title = diggy_dungeons.370.t
	desc = diggy_dungeons.370.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

	option = {
		name = diggy_dungeons.370.a
		ai_chance = { factor = 100 }
		trigger = {
			always = yes
		}

        custom_tooltip = expedition_dead_tooltip
        hidden_effect = { expedition_dead_effect = yes }

	}
}

# End Event
province_event = {
	id = diggy_dungeons.371
	title = diggy_dungeons.371.t
	desc = diggy_dungeons.371.d
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_province_flag = sent_expedition_@owner
	}

    immediate = {
        dungeon_immediate_effect = yes
    }

    option = {
        name = diggy_dungeons.371.a
        ai_chance = { factor = 100 }
        trigger = {
            always = yes
        }
        special_reward_expedition = yes
        currency_effect_expedition = {  currency = treasury cash = yes addTo = owner }
        currency_effect_expedition = {  currency = adm_power mana = yes addTo = owner }
        currency_effect_expedition = {  currency = dip_power mana = yes addTo = owner }
        currency_effect_expedition = {  currency = mil_power mana = yes addTo = owner }
        hidden_effect = {
            while = {
                limit = { check_variable = { partyManpower = 1000 } }
                subtract_variable = { partyManpower = 1000 }
                owner = { add_manpower = 1 }
            }
        }
        custom_tooltip = back_to_manpower_tooltip
        custom_tooltip = base_expedition_loot_tooltip
        if = {
            limit = { check_variable = { ancientDwarvenKnowledge = 1 } }
            province_event = { id = diggy_expedition.14 }
        }
        else = { hidden_effect = { clear_expedition_effect = yes } }
        hidden_effect = { set_province_flag = floor_explored }
    }

}
