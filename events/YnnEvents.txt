
namespace = ynn_events

# Ynn Urbanization
country_event = {
	id = ynn_events.0
	title = ynn_events.0.t
	desc = ynn_events.0.d
	picture = CITY_VIEW_eventPicture
	
	fire_only_once = yes
	major = yes
	
	trigger = {
		is_year = 1620
        OR = {
            AND = {
                has_dlc = "Mandate of Heaven"
                1139 = { is_prosperous = yes }
                1171 = { is_prosperous = yes }
                1191 = { is_prosperous = yes }
            }
            NOT = {
                has_dlc = "Mandate of Heaven"
				1139 = { devastation = 1 }
                1171 = { devastation = 1 }
                1191 = { devastation = 1 }
            }
        }
		OR = {
			AND = {
				has_dlc = "Rights of Man"
				is_great_power = yes
			}
			AND = {
				NOT = { has_dlc = "Rights of Man" }
				total_development = 300
			}
		}
		capital_scope = { superregion = ynn_superregion }
		has_institution = global_trade
	}

	mean_time_to_happen = {
		months = 1
	}
	
	# Hooray
	option = {
        name = ynn_events.0.a
		add_prestige = 10
		add_stability_or_adm_power = yes
		1139 = {
			remove_province_modifier = ynn_urban_decline
			add_center_of_trade_level = 1
			owner = {
				add_opinion = {
					who = ROOT
					modifier = opinion_grateful
				}
			}
		}
		1171 = {
			remove_province_modifier = ynn_urban_decline
			add_center_of_trade_level = 1
			owner = {
				add_opinion = {
					who = ROOT
					modifier = opinion_grateful
				}
			}
		}
		1191 = {
			remove_province_modifier = ynn_urban_decline
			add_center_of_trade_level = 1
			owner = {
				add_opinion = {
					who = ROOT
					modifier = opinion_grateful
				}
			}
		}
	}
}

#Ynnic Empire restoration, Sarda version
country_event = {
	id = ynn_events.1
	title = ynn_events.1.t
	desc = ynn_events.1.d
	picture = GOOD_WITH_MONARCH_eventPicture
	
	is_triggered_only = yes
	major = yes
	
	option = {
		name = ynn_events.1.a
		if = {
			limit = { has_custom_ideas = no }
			country_event = { id = ideagroups.1 } #Swap Ideas
		}
		country_event = { id = ynn_events.5 days = 30 }
	}
}

#Ynnic Empire restoration, Dolindhan version
country_event = {
	id = ynn_events.2
	title = ynn_events.2.t
	desc = {
		trigger = { NOT = { was_tag = G32 } }
	   desc = ynn_events.2.d1
	}
	desc = {
	   trigger = { was_tag = G32 }
	   desc = ynn_events.2.d2
	}
	
	picture = {
		trigger = { NOT = { was_tag = G32 } }
		picture = GOOD_WITH_MONARCH_eventPicture
	}
	picture = {
	   trigger = { was_tag = G32 }
		picture = REFORM_eventPicture
	}
	
	is_triggered_only = yes
	major = yes
	
	option = {
		trigger = {
			NOT = {
				was_tag = G32
			}
		}
		name = ynn_events.2.a
		if = {
			limit = { has_custom_ideas = no }
			country_event = { id = ideagroups.1 } #Swap Ideas
		}
		country_event = { id = ynn_events.5 days = 30 }
	}
	
	option = {
		trigger = {
			was_tag = G32
		}
		name = ynn_events.2.b
		change_government = monarchy
		add_government_reform = feudalism_reform
		remove_country_modifier = g32_battleking_grace_period
		remove_country_modifier = g32_battleking_fought_recently
		remove_country_modifier = g32_cowardly_battleking
		remove_country_modifier = g32_untested_battleking
		remove_country_modifier = g32_tested_battleking
		remove_country_modifier = g32_bloodied_battleking
		remove_country_modifier = g32_veteran_battleking
		remove_country_modifier = g32_legendary_battleking
		if = {
			limit = { has_custom_ideas = no }
			country_event = { id = ideagroups.1 } #Swap Ideas
		}
		country_event = { id = ynn_events.5 days = 30 }
	}
}

#Ynnic Empire restoration, Rzentur version
country_event = {
	id = ynn_events.3
	title = ynn_events.3.t
	desc = ynn_events.3.d
	picture = GOOD_WITH_MONARCH_eventPicture
	
	is_triggered_only = yes
	major = yes
	
	option = {
		name = ynn_events.3.a
		if = {
			limit = { has_custom_ideas = no }
			country_event = { id = ideagroups.1 } #Swap Ideas
		}
		country_event = { id = ynn_events.5 days = 30 }
	}
}

#Ynnic Empire restoration, Outsider version
country_event = {
	id = ynn_events.4
	title = ynn_events.4.t
	desc = ynn_events.4.d
	picture = GOOD_WITH_MONARCH_eventPicture
	
	is_triggered_only = yes
	major = yes
	
	option = {
		name = ynn_events.4.a
		if = {
			limit = { has_custom_ideas = no }
			country_event = { id = ideagroups.1 } #Swap Ideas
		}
		country_event = { id = ynn_events.5 days = 30 }
	}
}

#Choose a new capital for the Ynnic Empire
country_event = {
	id = ynn_events.5
	title = ynn_events.5.t
	desc = ynn_events.5.desc
	picture = FORT_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = ynn_events.5.a
		
		ai_chance = {
			factor = 3
			modifier = {
				factor = 3
				OR = {
					capital = 1139
					capital = 1171
					capital = 1191
				}
			}
		}
	}
	
	option = {
		name = ynn_events.5.b
		
		trigger = { NOT = { capital = 1139 } }
		
		if = {
			limit = { NOT = { is_core = 1139 } }
			1139 = { add_core = ROOT }
		}
		
		if = {
			limit = { NOT = { owns = 1139 } }
			1139 = { cede_province = ROOT }
		}
		
		set_capital = 1139
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 3
				primary_culture = sarda
			}
		}
	}
	
	option = {
		name = ynn_events.5.c
		
		trigger = { NOT = { capital = 1171 } }
		
		if = {
			limit = { NOT = { is_core = 1171 } }
			1171 = { add_core = ROOT }
		}
		
		if = {
			limit = { NOT = { owns = 1171 } }
			1171 = { cede_province = ROOT }
		}
		
		set_capital = 1171
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 3
				primary_culture = dolindhan
			}
		}
	}
	
	option = {
		name = ynn_events.5.d
		
		trigger = { NOT = { capital = 1191 } }
		
		if = {
			limit = { NOT = { is_core = 1191 } }
			1191 = { add_core = ROOT }
		}
		
		if = {
			limit = { NOT = { owns = 1191 } }
			1191 = { cede_province = ROOT }
		}
		
		set_capital = 1191
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 3
				primary_culture = rzentur
			}
		}
	}
}

#iosahar to tributary
country_event = {
	id = ynn_events.6
	title = ynn_events.6.t
	desc = ynn_events.6.d
	picture = FORT_eventPicture
	
	is_triggered_only = yes
	trigger = {
		any_subject_country = {
			is_subject_of_type = ynnic_iosahar
			NOT = { is_neighbor_of = ROOT }
			liberty_desire = 20
		}
		NOT = { 
			has_country_flag = yrw_overlord_debating
			stability = 3
		}
	}
	option = {
		name = ynn_events.6.a
		trigger = {
				authority = 5
		}
		ai_chance = {
			factor = 5
			modifier = {
				factor = 2
				NOT = { ynnic_iosahar = 3 }
			}
		}
		add_authority = -5
	}

	option = {
		name = ynn_events.6.b
		
		ai_chance = {
			factor = 3
			modifier = {
				factor = 3
				ynnic_iosahar = 8
			}
		}
		random_subject_country = {
			limit = {
				is_subject_of_type = ynnic_iosahar
				NOT = { is_neighbor_of = ROOT }
			}
			ROOT = {
				create_subject = {
					subject_type = tributary_state
					subject = PREV
				}
			}
		}
	}
}

#The Great Iosahar Insurrection
country_event = {
	id = ynn_events.7
	title = ynn_events.7.t
	desc = {
		trigger = { has_country_flag = ynn_civil_war_iosahar }
	   desc = ynn_events.7.d1
	}
	desc = {
	   trigger = { has_country_flag = ynn_civil_war_religion }
	   desc = ynn_events.7.d2
	}
	picture = ACCUSATION_eventPicture
	
	is_triggered_only = yes
	trigger = {
		NOT = { is_companion = yes }
		liberty_desire = 30
		is_subject_of_type = ynnic_iosahar
	}
	
	immediate = {
		hidden_effect = {
			save_event_target_as = ynn_civil_war_leader
		}
	}
	
	option = {
		name = ynn_events.7.a		
		
		ai_chance = {
			factor = 1
		}
		
		grant_independence = yes
		
		FROM = {
			every_subject_country = {
				limit = {
					is_subject_of_type = ynnic_iosahar
					liberty_desire = 30
				}
				event_target:ynn_civil_war_leader = {
					create_subject = {
						subject_type = ynnic_iosahar
						subject = PREV
					}
				}
			}
			country_event = { id = ynn_events.8 }
		}
		declare_war_with_cb = {
			who = FROM
			casus_belli = cb_iosahar_annex
		}
	}

	option = {
		name = ynn_events.7.b
		
		ai_chance = {
			factor = 0
		}
		add_prestige = -10
	}
}

#The Great Iosahar Insurrection
country_event = {
	id = ynn_events.8
	title = ynn_events.8.t
	desc = {
		trigger = { FROM = { has_country_flag = ynn_civil_war_iosahar } }
	   desc = ynn_events.8.d1
	}
	desc = {
	   trigger = { FROM = { has_country_flag = ynn_civil_war_religion } }
	   desc = ynn_events.8.d2
	}
	picture = CIVIL_WAR_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = ynn_events.8.a		
		
		ai_chance = {
			factor = 1
		}
		
		add_stability = -1
		tooltip = {
			FROM = {
				declare_war_with_cb = {
					who = FROM
					casus_belli = cb_iosahar_annex
				}
			}
		}
	}
	
	after = {
		FROM = {
			clr_country_flag = ynn_civil_war_iosahar
			clr_country_flag = ynn_civil_war_religion
		}
	}
}

country_event = {
	id = ynn_events.9
	title = ynn_events.9.t
	desc = ynn_events.9.d
	picture = RELIGION_eventPicture

	is_triggered_only = yes
	
	trigger = {
		NOT = { has_country_flag = ynnic_debug_subjugation }
		FROM = { has_country_modifier = ynn_diplo }
	}
	
	immediate = {
		set_country_flag = ynnic_debug_subjugation
	}
	
	option = {
		name = ynn_events.9.a
		ai_chance = { factor = 1 }
		hidden_effect = { clr_country_flag = ynnic_debug_subjugation }
		add_prestige = -25
		every_subject_country = {
			limit = {
				is_subject_of_type = ynnic_iosahar
			}
			FROM = {
				create_subject = {
					subject_type = ynnic_iosahar
					subject = PREV
				}
			}
		}
		FROM = {
			create_subject = {
				subject_type = ynnic_iosahar
				subject = ROOT
			}
		}
		if = {	#cleaning allies for an overlord
			limit = {
				FROM = {
					ynnic_iosahar = 1
					num_of_allies = 1
				}
			}
			ROOT = {
				if = {
					limit = {
						is_subject_of = FROM
						is_subject_of_type = ynnic_iosahar
					}
				}
				create_subject = {
					subject_type = vassal
					subject = FROM
				}
				FROM = {
					grant_independence = yes
					create_subject = {
						subject_type = ynnic_iosahar
						subject = ROOT
					}
				}
			}
		}
		if = {	#If a Iosahar was allied with ROOT and thus went to war with their overlord, this effect restores their subject status
			limit = {
				FROM = { has_country_flag = ynn_overlord_at_war_with_iosahar }
			}
			FROM = { clr_country_flag = ynn_overlord_at_war_with_iosahar }
			every_ally = {
				limit = {
					has_country_flag = ynn_iosahar_at_war_with_overlord
				}
				FROM = {
					create_subject = {
						subject_type = ynnic_iosahar
						subject = PREV
					}
				}
				clr_country_flag = ynn_iosahar_at_war_with_overlord
			}
		}
	}
}

#Iosahar-overlord war ends and iosahar is returned
country_event = {
	id = ynn_events.10
	title = ynn_events.10.t
	desc = ynn_events.10.d
	picture = RELIGION_eventPicture

	is_triggered_only = yes
	
	trigger = {
		has_country_modifier = ynn_diplo
		has_country_flag = ynn_overlord_at_war_with_iosahar
	}
	
	hidden = yes
	
	option = {
		name = ynn_events.10.a
		
		ai_chance = {
			factor = 1
		}
		
		if = {		#If the rogue Iosahar is defeated
			limit = {
				FROM = {
					has_country_flag = ynn_iosahar_at_war_with_overlord
				}
			}
			ROOT = {
				create_subject = {
					subject_type = ynnic_iosahar
					subject = FROM
				}
			}
			FROM = { clr_country_flag = ynn_iosahar_at_war_with_overlord }
		}
		
		if = {		#If the war leader of the rogue Iosahar is defeated
			limit = {
				FROM = {
					any_ally = { has_country_flag = ynn_iosahar_at_war_with_overlord }
				}
			}
			FROM = {
				every_ally = {
					limit = {
						has_country_flag = ynn_iosahar_at_war_with_overlord
					}
					ROOT = {
						create_subject = {
							subject_type = ynnic_iosahar
							subject = PREV
						}
					}
					clr_country_flag = ynn_iosahar_at_war_with_overlord
				}
			}
		}
	}
	
	after = {
		if = {
			limit = {
				NOT = {
					any_known_country = {
						war_with = ROOT
						has_country_flag = ynn_iosahar_at_war_with_overlord
					}
				}
			}
			clr_country_flag = ynn_overlord_at_war_with_iosahar
		}
	}
}

#Iosahar-overlord war ends with Iosahar going free
country_event = {
	id = ynn_events.11
	title = ynn_events.11.t
	desc = ynn_events.11.d
	picture = RELIGION_eventPicture

	is_triggered_only = yes
	
	trigger = {
		has_country_flag = ynn_iosahar_at_war_with_overlord
		FROM = { has_country_flag = ynn_overlord_at_war_with_iosahar }
	}
	
	hidden = yes
	
	option = {
		name = ynn_events.11.a
		
		ai_chance = {
			factor = 1
		}
		
		clr_country_flag = ynn_iosahar_at_war_with_overlord
		
		if = {
			limit = {
				NOT = {
					FROM = {
						any_known_country = { 
							war_with = FROM
							has_country_flag = ynn_iosahar_at_war_with_overlord
						}
					}
				}
			}
			FROM = { clr_country_flag = ynn_overlord_at_war_with_iosahar }
		}
	}
}

#Iosahar-overlord war ends and iosahar is returned (utility to set a FROM scope in the next event)
country_event = {
	id = ynn_events.12
	title = ynn_events.12.t
	desc = ynn_events.12.d
	picture = RELIGION_eventPicture

	is_triggered_only = yes
	
	trigger = {
		FROM = { has_country_modifier = ynn_diplo }
	}
	
	hidden = yes
	
	option = {
		name = ynn_events.12.a		
		
		ai_chance = {
			factor = 1
		}
		
		FROM = { country_event = { id = ynn_events.10 } }
		FROM = { country_event = { id = ynn_events.11 } }
	}
}

#Utility event to clean up flags from .10-.13 once all wars end
country_event = {
	id = ynn_events.14
	title = ynn_events.14.t
	desc = ynn_events.14.d
	picture = RELIGION_eventPicture

	is_triggered_only = yes
	
	trigger = {
		is_at_war = no
	}
	
	hidden = yes
	
	option = {
		name = ynn_events.14.a		
		
		ai_chance = {
			factor = 1
		}
		
		clr_country_flag = ynn_overlord_at_war_with_iosahar
		clr_country_flag = ynn_iosahar_at_war_with_overlord
		
		every_ally = {
			limit = {
				is_at_war = no
			}
			clr_country_flag = ynn_overlord_at_war_with_iosahar
			clr_country_flag = ynn_iosahar_at_war_with_overlord
		}
	}
}