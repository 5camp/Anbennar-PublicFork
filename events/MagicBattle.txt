namespace = magic_battle

#Magic Menu
country_event = {
	id = magic_battle.1
	title = magic_battle.1.t	#Have this title mention the target
	desc = magic_battle.1.d
	picture = FORT_eventPicture
	
	is_triggered_only = yes
	
	immediate = {
		any_province = {
			limit = {
				unit_has_leader = yes
				unit_in_battle = yes
				num_of_units_in_province = {
					who = ROOT
					amount = 1
				}
			}
			save_global_event_target_as = spell_target_province	#this works yo
		}
	}
	
	option = {	
		name = magic_battle.1.a	#go back
		ai_chance = {
			factor = 50
		}
		#some sort of tooltip
	}
	
	option = {
		name = magic_battle.2.t
		ai_chance = {
			factor = 50
		}
		country_event = { id = magic_battle.2 days = 0 }
	}
	
	option = {
		name = magic_battle.5.t
		ai_chance = {
			factor = 50
		}
		country_event = { id = magic_battle.5 days = 0 }
	}
	
	option = {
		name = magic_battle.8.t	#Greater Fireball
		trigger = {
			has_ruler_flag = evocation_1
		}
		ai_chance = {
			factor = 50
		}
		country_event = { id = magic_battle.8 days = 0 }
	}
	
	option = {
		name = magic_battle.11.t	#Earthquake
		trigger = {
			has_ruler_flag = evocation_2
		}
		ai_chance = {
			factor = 50
		}
		country_event = { id = magic_battle.11 days = 0 }
	}
	
	option = {
		name = magic_battle.14.t	#Meteor Strike
		trigger = {
			has_ruler_flag = evocation_3
		}
		ai_chance = {
			factor = 50
		}
		country_event = { id = magic_battle.14 days = 0 }
	}
	
	option = {
		name = magic_battle.17.t	#Thunderstorm
		ai_chance = {
			factor = 50
		}
		country_event = { id = magic_battle.17 days = 0 }
	}
	
	option = {
		name = magic_battle.20.t	#Shapechange into a Giant
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0
				current_age = age_of_enlightenment
			}
		}
		country_event = { id = magic_battle.20 days = 0 }
	}
	
	option = {
		name = magic_battle.23.t	#Shapechange into a Giant
		ai_chance = {
			factor = 50
		}
		country_event = { id = magic_battle.23 days = 0 }
	}
}

############################################# CONJURATION #############################################

#Summon Siege Elemental
country_event = {
	id = magic_battle.2
	title = magic_battle.2.t
	desc = magic_battle.2.d
	picture = HUIZTILOPOCHTLI_eventPicture
	
	is_triggered_only = yes
	
	immediate = {
		hidden_effect = {
			magic_casted_spell = yes
		}
	}
	
	# Come forth!
	option = {
		name = magic_battle.2.a
		ai_chance = {
			factor = 90
		}
		
		#Costs
		add_mil_power = -10	#Adm is concentration spells
		
		
			kill_units = {
				who = enemy
				amount = 10
			}
		}
		
		
		#Success/Fail
	}
	
	option = {	#Option B: Go back
		name = magic_battle.goback
		ai_chance = {
			factor = 10
			modifier = {
				factor = 100
				NOT = { adm_power = 10 }
			}
		}
		country_event = { id = magic_battle.1 days = 0 }
	}
	
}

#Summon Siege Elemental - Success
country_event = {
	id = magic_battle.3
	title = magic_battle.3.t
	desc = magic_battle.3.d
	picture = HUIZTILOPOCHTLI_eventPicture
	
	is_triggered_only = yes
	
	
	option = {
		name = magic_battle.3.a
		ai_chance = {
			factor = 100
		}
		event_target:spell_target_province = { 
			#change_siege = 1	#if possible
			add_province_modifier = {
				name = siege_magic_elemental_besieger
				duration = -1
				desc = siege_magic_elemental_besieger_desc
			}
		}
	}
}

#Summon Siege Elemental - Fail
country_event = {
	id = magic_battle.4
	title = magic_battle.4.t
	desc = magic_battle.4.d
	picture = HUIZTILOPOCHTLI_eventPicture
	
	is_triggered_only = yes
	
	#Force Success
	option = {
		name = magic_battle.4.a
		ai_chance = {
			factor = 70
		}
		
		#Cost
		add_adm_power = -10
		
		#Spell
		event_target:spell_target_province = { 
			add_province_modifier = {
				name = siege_magic_elemental_besieger
				duration = 28
				desc = siege_magic_elemental_besieger_desc
			}
		}
	}
	
	#Fail
	option = {
		name = magic_battle.4.b
		ai_chance = {
			factor = 30
			modifier = {
				factor = 100
				NOT = { adm_power = 20 } #if they dont have double it 
			}
		}
	}
	
}

# Conjuration 2: Thunderstorm
country_event = {
	id = magic_battle.17
	title = magic_battle.17.t
	desc = magic_battle.17.d
	picture = RAMADAN_eventPicture
	
	is_triggered_only = yes
	
	immediate = {
		hidden_effect = {
			magic_casted_spell = yes
		}
	}
	
	# Cast Thunderstorm
	option = {
		name = magic_battle.17.a
		ai_chance = {
			factor = 90
		}
		
		random_list = {
			50 = {
				event_target:spell_target_province = {
					kill_units = {
						who = enemy
						amount = 1
					}
				}
			}
			50 = {
				event_target:spell_target_province = {
					kill_units = {
						who = enemy
						amount = 2
					}
				}
			}
		}
		
		#Costs
		add_mil_power = -10
		add_adm_power = -15
		
		#Success/Fail

	}
	
	option = {	#Option B: Go back
		name = magic_battle.goback
		ai_chance = {
			factor = 10
			modifier = {
				factor = 100
				NOT = { mil_power = 20 }
				NOT = { adm_power = 30 }
			}
		}
		country_event = { id = magic_battle.1 days = 0 }
	}
}

# Conjuration 2: Thunderstorm - Success
country_event = {
	id = magic_battle.18
	title = magic_battle.18.t
	desc = magic_battle.18.d
	picture = RAMADAN_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = magic_battle.18.a
		ai_chance = {
			factor = 100
		}
		
		#Spell
		event_target:spell_target_province = { 
			change_siege = 5
			add_devastation = 5
			add_province_modifier = {
				name = siege_magic_thunderstorm
				duration = 182
				desc = siege_magic_thunderstorm_desc
			}
		}
	}
}

# Conjuration 2: Thunderstorm - Fail
country_event = {
	id = magic_battle.19
	title = magic_battle.19.t
	desc = magic_battle.19.d
	picture = RAMADAN_eventPicture
	
	is_triggered_only = yes
	
	#Force Success
	option = {
		name = magic_battle.19.a
		ai_chance = {
			factor = 90
		}
		
		add_mil_power = -5
		add_adm_power = -20	#Concentration spells
		
		#Spell
		event_target:spell_target_province = { 
			change_siege = 5
			add_devastation = 5
			add_province_modifier = {
				name = siege_magic_thunderstorm
				duration = 182
				desc = siege_magic_thunderstorm_desc
			}
		}
	}
	
	option = {
		name = magic_battle.19.b
		ai_chance = {
			factor = 10
			modifier = {
				factor = 100
				NOT = { mil_power = 10 }
				NOT = { adm_power = 40 }
			}
		}
	}
}


############################################# ENCHANTMENT #############################################

#Dominate Surrender - Base
country_event = {
	id = magic_battle.5
	title = magic_battle.5.t
	desc = magic_battle.5.d
	picture = WESTERNISATION_eventPicture
	
	is_triggered_only = yes
	
	immediate = {
		hidden_effect = {
			magic_casted_spell = yes
		}
	}
	
	option = {
		name = magic_battle.5.a
		ai_chance = {
			factor = 90
		}
		
		#Costs + Success/Fail
		if = {
			limit = {
				event_target:spell_target_province = {
					base_manpower = 1
					NOT = { base_manpower = 4 }
				}
			}
			add_adm_power = -15
			add_dip_power = -10

			random_list = {
				80 = {
					country_event = { id = magic_battle.6 days = 0 }
				}
				20 = {
					country_event = { id = magic_battle.7 days = 0 }
				}
			}
		}
		if = {
			limit = {
				event_target:spell_target_province = {
					base_manpower = 4
					NOT = { base_manpower = 8 }
				}
			}
			add_adm_power = -20
			add_dip_power = -15
			
			random_list = {
				75 = {
					country_event = { id = magic_battle.6 days = 0 }
				}
				25 = {
					country_event = { id = magic_battle.7 days = 0 }
				}
			}
		}
		if = {
			limit = {
				event_target:spell_target_province = {
					base_manpower = 8
					NOT = { base_manpower = 12 }
				}
			}
			add_adm_power = -30
			add_dip_power = -20
			
			random_list = {
				70 = {
					country_event = { id = magic_battle.6 days = 0 }
				}
				30 = {
					country_event = { id = magic_battle.7 days = 0 }
				}
			}
		}
		if = {
			limit = {
				event_target:spell_target_province = {
					base_manpower = 12
					NOT = { base_manpower = 16 }
				}
			}
			add_adm_power = -40
			add_dip_power = -25
			
			random_list = {
				70 = {
					country_event = { id = magic_battle.6 days = 0 }
				}
				30 = {
					country_event = { id = magic_battle.7 days = 0 }
				}
			}
		}
		if = {
			limit = {
				event_target:spell_target_province = {
					base_manpower = 16
					NOT = { base_manpower = 20 }
				}
			}
			add_adm_power = -50
			add_dip_power = -30
			
			random_list = {
				65 = {
					country_event = { id = magic_battle.6 days = 0 }
				}
				35 = {
					country_event = { id = magic_battle.7 days = 0 }
				}
			}
		}
		if = {
			limit = {
				event_target:spell_target_province = {
					base_manpower = 20
					NOT = { base_manpower = 24 }
				}
			}
			add_adm_power = -60
			add_dip_power = -35
			
			random_list = {
				60 = {
					country_event = { id = magic_battle.6 days = 0 }
				}
				40 = {
					country_event = { id = magic_battle.7 days = 0 }
				}
			}
		}
		if = {
			limit = {
				event_target:spell_target_province = {
					base_manpower = 24
					NOT = { base_manpower = 28 }
				}
			}
			add_adm_power = -70
			add_dip_power = -40
			
			random_list = {
				55 = {
					country_event = { id = magic_battle.6 days = 0 }
				}
				45 = {
					country_event = { id = magic_battle.7 days = 0 }
				}
			}
		}
		if = {
			limit = {
				event_target:spell_target_province = {
					base_manpower = 28
					NOT = { base_manpower = 32 }
				}
			}
			add_adm_power = -80
			add_dip_power = -45
			
			random_list = {
				50 = {
					country_event = { id = magic_battle.6 days = 0 }
				}
				50 = {
					country_event = { id = magic_battle.7 days = 0 }
				}
			}
		}
		if = {
			limit = {
				event_target:spell_target_province = {
					base_manpower = 32
				}
			}
			add_adm_power = -100
			add_dip_power = -50
			
			random_list = {
				45 = {
					country_event = { id = magic_battle.6 days = 0 }
				}
				55 = {
					country_event = { id = magic_battle.7 days = 0 }
				}
			}
		}
	}
	
	option = {	#Option B: Go back
		name = magic_battle.goback
		ai_chance = {
			factor = 10
			modifier = {
				factor = 100
				NOT = { mil_power = 10 }
			}
		}
		country_event = { id = magic_battle.1 days = 0 }
	}
}

#Dominate Surrender - Success
country_event = {
	id = magic_battle.6
	title = magic_battle.6.t
	desc = magic_battle.6.d
	picture = PIRATES_CAPTURED_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = magic_battle.6.a
		ai_chance = {
			factor = 100
		}
		
		#Spell
		event_target:spell_target_province = { 
			change_controller = ROOT
		}
	}
}

#Dominate Surrender - Fail
country_event = {
	id = magic_battle.7
	title = magic_battle.7.t
	desc = magic_battle.7.d
	picture = ACCUSATION_eventPicture
	
	is_triggered_only = yes
	
	#Force Success
	option = {
		name = magic_battle.7.a
		ai_chance = {
			factor = 70
		}
		
		#Cost
		add_mil_power = -20
		
		event_target:spell_target_province = { 
			change_siege = 1	#if possible
		}
	}
	
	#Fail
	option = {
		name = magic_battle.7.b
		ai_chance = {
			factor = 30
			modifier = {
				factor = 100
				NOT = { mil_power = 100 }
			}
		}
	}
}

############################################# EVOCATION #############################################

# Evocation 1: Greater Fireball
country_event = {
	id = magic_battle.8
	title = magic_battle.8.t
	desc = magic_battle.8.d
	picture = COMET_SIGHTED_eventPicture
	
	is_triggered_only = yes
	
	immediate = {
		hidden_effect = {
			magic_casted_spell = yes
		}
	}
	
	# Come forth!
	option = {
		name = magic_battle.8.a
		ai_chance = {
			factor = 90
		}
		
		#Costs
		add_mil_power = -10
		
		#Success/Fail
		if = {
			limit = {
				event_target:spell_target_province = {
					fort_level = 1
					NOT = { fort_level = 4 }
				}
			}
			random_list = {
				80 = {
					country_event = { id = magic_battle.9 days = 0 }
				}
				20 = {
					country_event = { id = magic_battle.10 days = 0 }
				}
			}
		}
		if = {
			limit = {
				event_target:spell_target_province = {
					fort_level = 4
					NOT = { fort_level = 6 }
				}
			}
			random_list = {
				70 = {
					country_event = { id = magic_battle.9 days = 0 }
				}
				30 = {
					country_event = { id = magic_battle.10 days = 0 }
				}
			}
		}
		if = {
			limit = {
				event_target:spell_target_province = {
					fort_level = 6
					NOT = { fort_level = 8 }
				}
			}
			random_list = {
				60 = {
					country_event = { id = magic_battle.9 days = 0 }
				}
				40 = {
					country_event = { id = magic_battle.10 days = 0 }
				}
			}
		}
		if = {
			limit = {
				event_target:spell_target_province = {
					fort_level = 8
				}
			}
			random_list = {
				50 = {
					country_event = { id = magic_battle.9 days = 0 }
				}
				50 = {
					country_event = { id = magic_battle.10 days = 0 }
				}
			}
		}
	}
	
	option = {	#Option B: Go back
		name = magic_battle.goback
		ai_chance = {
			factor = 10
			modifier = {
				factor = 100
				NOT = { mil_power = 10 }
			}
		}
		country_event = { id = magic_battle.1 days = 0 }
	}
	
}

# Evocation 1: Greater Fireball - Success
country_event = {
	id = magic_battle.9
	title = magic_battle.9.t
	desc = magic_battle.9.d
	picture = SIEGE_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = magic_battle.9.a
		ai_chance = {
			factor = 100
		}
		
		#Spell
		event_target:spell_target_province = { 
			change_siege = 1
		}
	}
}

# Evocation 1: Greater Fireball - Fail (Misses)
country_event = {
	id = magic_battle.10
	title = magic_battle.10.t
	desc = magic_battle.10.d
	picture = SIEGE_eventPicture
	
	is_triggered_only = yes
	
	#Force Fail
	option = {
		name = magic_battle.10.a
		ai_chance = {
			factor = 100
		}
	}
}



# Evocation 2: Earthquake
country_event = {
	id = magic_battle.11
	title = magic_battle.11.t
	desc = magic_battle.11.d
	picture = COUNTRY_COLLAPSE_eventPicture
	
	is_triggered_only = yes
	
	immediate = {
		hidden_effect = {
			magic_casted_spell = yes
		}
	}
	
	# Cast Earthquake
	option = {
		name = magic_battle.11.a
		ai_chance = {
			factor = 90
		}
		
		#Costs
		add_mil_power = -20
		add_adm_power = -5
		
		#Success/Fail
		if = {
			limit = {
				event_target:spell_target_province = {
					OR = {
						has_terrain = mountain
						#maybe need to make a new terrain called underground
					}
				}
			}
			random_list = {
				80 = {
					country_event = { id = magic_battle.12 days = 0 }
				}
				20 = {
					country_event = { id = magic_battle.13 days = 0 }
				}
			}
		}
		if = {
			limit = {
				event_target:spell_target_province = {
					OR = {
						has_terrain = hills
						has_terrain = highlands
					}
				}
			}
			random_list = {
				70 = {
					country_event = { id = magic_battle.12 days = 0 }
				}
				30 = {
					country_event = { id = magic_battle.13 days = 0 }
				}
			}
		}
		if = {
			limit = {
				event_target:spell_target_province = {
					OR = {
						has_terrain = coastline
						has_terrain = coastal_desert
					}
				}
			}
			random_list = {
				60 = {
					country_event = { id = magic_battle.12 days = 0 }
				}
				40 = {
					country_event = { id = magic_battle.13 days = 0 }
				}
			}
		}
		else = {
			random_list = {
				50 = {
					country_event = { id = magic_battle.12 days = 0 }
				}
				50 = {
					country_event = { id = magic_battle.13 days = 0 }
				}
			}
		}
	}
	
	option = {	#Option B: Go back
		name = magic_battle.goback
		ai_chance = {
			factor = 10
			modifier = {
				factor = 100
				NOT = { mil_power = 10 }
			}
		}
		country_event = { id = magic_battle.1 days = 0 }
	}
	
}

# Evocation 2: Earthquake - Success
country_event = {
	id = magic_battle.12
	title = magic_battle.12.t
	desc = magic_battle.12.d
	picture = COUNTRY_COLLAPSE_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = magic_battle.12.a
		ai_chance = {
			factor = 100
		}
		
		#Spell
		event_target:spell_target_province = { 
			change_siege = 3
			add_province_modifier = {
				name = siege_magic_earthquake
				duration = 365
				desc = siege_magic_earthquake_desc
			}
			add_devastation = 10
		}
	}
}

# Evocation 2: Earthquake - Fail
country_event = {
	id = magic_battle.13
	title = magic_battle.13.t
	desc = magic_battle.13.d
	picture = COUNTRY_COLLAPSE_eventPicture
	
	is_triggered_only = yes
	
	#Force Success
	option = {
		name = magic_battle.13.a
		ai_chance = {
			factor = 90
		}
		
		add_mil_power = -20
		
		#Spell
		event_target:spell_target_province = { 
			change_siege = 3
			add_province_modifier = {
				name = siege_magic_earthquake
				duration = 365
				desc = siege_magic_earthquake_desc
			}
			add_devastation = 10
		}
	}
	
	option = {
		name = magic_battle.13.b
		ai_chance = {
			factor = 10
			modifier = {
				factor = 100
				NOT = { mil_power = 40 }
			}
		}
	}
}

# Evocation 3: Meteor Strike
country_event = {
	id = magic_battle.14
	title = magic_battle.14.t
	desc = magic_battle.14.d
	picture = COMET_SIGHTED_eventPicture
	
	is_triggered_only = yes
	
	immediate = {
		hidden_effect = {
			magic_casted_spell = yes
		}
	}
	
	# Cast Meteor Strike
	option = {
		name = magic_battle.14.a
		ai_chance = {
			factor = 90
		}
		
		#Costs
		add_mil_power = -50
		
		#Success/Fail
		if = {
			limit = {
				event_target:spell_target_province = {
					fort_level = 1
					NOT = { fort_level = 4 }
				}
			}
			random_list = {
				90 = {
					country_event = { id = magic_battle.15 days = 0 }
				}
				10 = {
					country_event = { id = magic_battle.16 days = 0 }
				}
			}
		}
		if = {
			limit = {
				event_target:spell_target_province = {
					fort_level = 4
					NOT = { fort_level = 6 }
				}
			}
			random_list = {
				80 = {
					country_event = { id = magic_battle.15 days = 0 }
				}
				20 = {
					country_event = { id = magic_battle.16 days = 0 }
				}
			}
		}
		if = {
			limit = {
				event_target:spell_target_province = {
					fort_level = 6
					NOT = { fort_level = 8 }
				}
			}
			random_list = {
				70 = {
					country_event = { id = magic_battle.15 days = 0 }
				}
				30 = {
					country_event = { id = magic_battle.16 days = 0 }
				}
			}
		}
		if = {
			limit = {
				event_target:spell_target_province = {
					fort_level = 8
				}
			}
			random_list = {
				60 = {
					country_event = { id = magic_battle.15 days = 0 }
				}
				40 = {
					country_event = { id = magic_battle.16 days = 0 }
				}
			}
		}
	}
	
	option = {	#Option B: Go back
		name = magic_battle.goback
		ai_chance = {
			factor = 10
			modifier = {
				factor = 100
				NOT = { mil_power = 10 }
			}
		}
		country_event = { id = magic_battle.1 days = 0 }
	}
}

# Evocation 3: Meteor Strike - Success
country_event = {
	id = magic_battle.15
	title = magic_battle.15.t
	desc = magic_battle.15.d
	picture = COMET_SIGHTED_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = magic_battle.15.a
		ai_chance = {
			factor = 100
		}
		
		#Spell
		event_target:spell_target_province = { 
			change_siege = 10
			add_devastation = 50
		}
	}
}

# Evocation 3: Meteor Strike - Fail
country_event = {
	id = magic_battle.16
	title = magic_battle.16.t
	desc = magic_battle.16.d
	picture = COMET_SIGHTED_eventPicture
	
	is_triggered_only = yes
	
	#Force Success
	option = {
		name = magic_battle.16.a
		ai_chance = {
			factor = 90
		}
		
		add_mil_power = -30
		
		#Spell
		event_target:spell_target_province = { 
			change_siege = 5
			add_devastation = 25
		}
	}
	
	option = {
		name = magic_battle.16.b
		ai_chance = {
			factor = 10
			modifier = {
				factor = 100
				NOT = { mil_power = 60 }
			}
		}
	}
}

############################################# TRANSMUTATION #############################################

# Transmutation 2: Shapechange into a Giant
country_event = {
	id = magic_battle.20
	title = magic_battle.20.t
	desc = magic_battle.20.d
	picture = TEMPORAL_RIFT_eventPicture
	
	is_triggered_only = yes
	
	immediate = {
		hidden_effect = {
			magic_casted_spell = yes
		}
	}
	
	# Shapechange
	option = {
		name = magic_battle.20.a
		ai_chance = {
			factor = 90
			modifier = {
				factor = 0 
				current_age = age_of_enlightenment
			}
		}
		
		#Costs
		add_adm_power = -30
		add_dip_power = -10
		add_mil_power = -10
		
		#Success/Fail
		if = {
			limit = {
				event_target:spell_target_province = {
					enemy = {
						mil_tech = 1
						NOT = { mil_tech = 7}
					
						# mil_tech = 7 #cannons
						# mil_tech = 11 #matchlock
						# mil_tech = 13 #trunnions
						# mil_tech = 17 #flintlock
						# mil_tech = 22 #cartridge
						# mil_tech = 26 #light infantry
						# mil_tech = 29 #defense in depth
						# mil_tech = 31 # rifle
					}
				}
			}
			random_list = {
				95 = {
					country_event = { id = magic_battle.21 days = 0 }
				}
				5 = {
					country_event = { id = magic_battle.22 days = 0 }
				}
			}
		}
		if = {
			limit = {
				event_target:spell_target_province = {
					enemy = {
						mil_tech = 7
						NOT = { mil_tech = 13}
					
						# mil_tech = 7 #cannons
						# mil_tech = 11 #matchlock
						# mil_tech = 13 #trunnions
						# mil_tech = 17 #flintlock
						# mil_tech = 22 #cartridge
						# mil_tech = 26 #light infantry
						# mil_tech = 29 #defense in depth
						# mil_tech = 31 # rifle
					}
				}
			}
			random_list = {
				90 = {
					country_event = { id = magic_battle.21 days = 0 }
				}
				10 = {
					country_event = { id = magic_battle.22 days = 0 }
				}
			}
		}
		if = {
			limit = {
				event_target:spell_target_province = {
					enemy = {
						mil_tech = 13
						NOT = { mil_tech = 18}	#carbines
					
						# mil_tech = 7 #cannons
						# mil_tech = 11 #matchlock
						# mil_tech = 13 #trunnions
						# mil_tech = 17 #flintlock
						# mil_tech = 22 #cartridge
						# mil_tech = 26 #light infantry
						# mil_tech = 29 #defense in depth
						# mil_tech = 31 # rifle
					}
				}
			}
			random_list = {
				80 = {
					country_event = { id = magic_battle.21 days = 0 }
				}
				20 = {
					country_event = { id = magic_battle.22 days = 0 }
				}
			}
		}
		if = {
			limit = {
				event_target:spell_target_province = {
					enemy = {
						mil_tech = 18
						NOT = { mil_tech = 22}
					
						# mil_tech = 7 #cannons
						# mil_tech = 11 #matchlock
						# mil_tech = 13 #trunnions
						# mil_tech = 17 #flintlock
						# mil_tech = 22 #cartridge
						# mil_tech = 26 #light infantry
						# mil_tech = 29 #defense in depth
						# mil_tech = 31 # rifle
					}
				}
			}
			random_list = {
				70 = {
					country_event = { id = magic_battle.21 days = 0 }
				}
				30 = {
					country_event = { id = magic_battle.22 days = 0 }
				}
			}
		}
		if = {
			limit = {
				event_target:spell_target_province = {
					enemy = {
						mil_tech = 22
						NOT = { mil_tech = 29}
					
						# mil_tech = 7 #cannons
						# mil_tech = 11 #matchlock
						# mil_tech = 13 #trunnions
						# mil_tech = 17 #flintlock
						# mil_tech = 22 #cartridge
						# mil_tech = 26 #light infantry
						# mil_tech = 29 #defense in depth
						# mil_tech = 31 # rifle
					}
				}
			}
			random_list = {
				60 = {
					country_event = { id = magic_battle.21 days = 0 }
				}
				40 = {
					country_event = { id = magic_battle.22 days = 0 }
				}
			}
		}
		if = {
			limit = {
				event_target:spell_target_province = {
					enemy = {
						mil_tech = 29
					
						# mil_tech = 7 #cannons
						# mil_tech = 11 #matchlock
						# mil_tech = 13 #trunnions
						# mil_tech = 17 #flintlock
						# mil_tech = 22 #cartridge
						# mil_tech = 26 #light infantry
						# mil_tech = 29 #defense in depth
						# mil_tech = 31 # rifle
					}
				}
			}
			random_list = {
				50 = {
					country_event = { id = magic_battle.21 days = 0 }
				}
				50 = {
					country_event = { id = magic_battle.22 days = 0 }
				}
			}
		}
	}
	option = {	#Option B: Go back
		name = magic_battle.goback
		ai_chance = {
			factor = 10
			modifier = {
				factor = 100
				NOT = { mil_power = 10 }
			}
		}
		country_event = { id = magic_battle.1 days = 0 }
	}
	
}

# Transmutation 2: Shapechange into Giant - Success
country_event = {
	id = magic_battle.21
	title = magic_battle.21.t
	desc = magic_battle.21.d
	picture = TEMPORAL_RIFT_eventPicture
	
	is_triggered_only = yes
	
	option = {	#Try and bring victory
		name = magic_battle.21.a
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				NOT = { mil_power = 60 }
			}
		}
		
		add_mil_power = -30
		
		random_list = {
			30 = {
				event_target:spell_target_province = { 
					change_controller = ROOT
					add_devastation = 5
				}
			}
			70 = {
				event_target:spell_target_province = {
					add_province_modifier = {
						name = siege_magic_giant_besieger
						duration = 14
						desc = siege_magic_giant_besieger_desc
					}
				}
			}
		}
	}
	
	option = {
		name = magic_battle.21.b
		ai_chance = {
			factor = 100
		}
		
		#Spell
		event_target:spell_target_province = { 
			add_province_modifier = {
				name = siege_magic_giant_besieger
				duration = 42
				desc = siege_magic_giant_besieger_desc
			}
		}
	}
}

# Transmutation 2: Shapechange into Giant - Fail
country_event = {
	id = magic_battle.22
	title = magic_battle.22.t
	desc = magic_battle.22.d
	picture = TEMPORAL_RIFT_eventPicture
	
	is_triggered_only = yes
	
	option = {	#...the harder they fall
		name = magic_battle.22.a
		ai_chance = {
			factor = 1
		}
		
		kill_ruler = yes
		event_target:spell_target_province = { 
			add_devastation = 5
		}
	}
	
	option = {	#Thankfully I had a protective ward
		name = magic_battle.22.b
		highlight = yes
		trigger = {
			has_ruler_flag = abjuration_2
		}
		ai_chance = {
			factor = 100
		}
		
		add_mil_power = -100
	}
	
}


# Transmutation 3: Shapechange into Dragon
country_event = {
	id = magic_battle.23
	title = magic_battle.23.t
	desc = magic_battle.23.d
	picture = TEMPORAL_RIFT_eventPicture
	
	is_triggered_only = yes
	
	immediate = {
		hidden_effect = {
			magic_casted_spell = yes
		}
	}
	
	# Shapechange
	option = {
		name = magic_battle.23.a
		ai_chance = {
			factor = 90
			modifier = {
				factor = 0 
				current_age = age_of_enlightenment
			}
		}
		
		#Costs
		add_adm_power = -40
		add_dip_power = -20
		add_mil_power = -10
		
		#Success/Fail
		if = {
			limit = {
				event_target:spell_target_province = {
					enemy = {
						mil_tech = 1
						NOT = { mil_tech = 11}
					
						# mil_tech = 7 #cannons
						# mil_tech = 11 #matchlock
						# mil_tech = 13 #trunnions
						# mil_tech = 17 #flintlock
						# mil_tech = 22 #cartridge
						# mil_tech = 26 #light infantry
						# mil_tech = 29 #defense in depth
						# mil_tech = 31 # rifle
					}
				}
			}
			random_list = {
				99 = {
					country_event = { id = magic_battle.24 days = 0 }
				}
				1 = {
					country_event = { id = magic_battle.25 days = 0 }
				}
			}
		}
		if = {
			limit = {
				event_target:spell_target_province = {
					enemy = {
						mil_tech = 11
						NOT = { mil_tech = 17}
					
						# mil_tech = 7 #cannons
						# mil_tech = 11 #matchlock
						# mil_tech = 13 #trunnions
						# mil_tech = 17 #flintlock
						# mil_tech = 22 #cartridge
						# mil_tech = 26 #light infantry
						# mil_tech = 29 #defense in depth
						# mil_tech = 31 # rifle
					}
				}
			}
			random_list = {
				95 = {
					country_event = { id = magic_battle.24 days = 0 }
				}
				5 = {
					country_event = { id = magic_battle.25 days = 0 }
				}
			}
		}
		if = {
			limit = {
				event_target:spell_target_province = {
					enemy = {
						mil_tech = 17
						NOT = { mil_tech = 22}	#carbines
					
						# mil_tech = 7 #cannons
						# mil_tech = 11 #matchlock
						# mil_tech = 13 #trunnions
						# mil_tech = 17 #flintlock
						# mil_tech = 22 #cartridge
						# mil_tech = 26 #light infantry
						# mil_tech = 29 #defense in depth
						# mil_tech = 31 # rifle
					}
				}
			}
			random_list = {
				90 = {
					country_event = { id = magic_battle.24 days = 0 }
				}
				10 = {
					country_event = { id = magic_battle.25 days = 0 }
				}
			}
		}
		if = {
			limit = {
				event_target:spell_target_province = {
					enemy = {
						mil_tech = 22
						NOT = { mil_tech = 26}
					
						# mil_tech = 7 #cannons
						# mil_tech = 11 #matchlock
						# mil_tech = 13 #trunnions
						# mil_tech = 17 #flintlock
						# mil_tech = 22 #cartridge
						# mil_tech = 26 #light infantry
						# mil_tech = 29 #defense in depth
						# mil_tech = 31 # rifle
					}
				}
			}
			random_list = {
				85 = {
					country_event = { id = magic_battle.24 days = 0 }
				}
				15 = {
					country_event = { id = magic_battle.25 days = 0 }
				}
			}
		}
		if = {
			limit = {
				event_target:spell_target_province = {
					enemy = {
						mil_tech = 26
						NOT = { mil_tech = 31}
					
						# mil_tech = 7 #cannons
						# mil_tech = 11 #matchlock
						# mil_tech = 13 #trunnions
						# mil_tech = 17 #flintlock
						# mil_tech = 22 #cartridge
						# mil_tech = 26 #light infantry
						# mil_tech = 29 #defense in depth
						# mil_tech = 31 # rifle
					}
				}
			}
			random_list = {
				80 = {
					country_event = { id = magic_battle.24 days = 0 }
				}
				20 = {
					country_event = { id = magic_battle.25 days = 0 }
				}
			}
		}
		if = {
			limit = {
				event_target:spell_target_province = {
					enemy = {
						mil_tech = 31
					
						# mil_tech = 7 #cannons
						# mil_tech = 11 #matchlock
						# mil_tech = 13 #trunnions
						# mil_tech = 17 #flintlock
						# mil_tech = 22 #cartridge
						# mil_tech = 26 #light infantry
						# mil_tech = 29 #defense in depth
						# mil_tech = 31 # rifle
					}
				}
			}
			random_list = {
				70 = {
					country_event = { id = magic_battle.24 days = 0 }
				}
				30 = {
					country_event = { id = magic_battle.25 days = 0 }
				}
			}
		}
	}
	option = {	#Option B: Go back
		name = magic_battle.goback
		ai_chance = {
			factor = 10
			modifier = {
				factor = 100
				NOT = { mil_power = 10 }
			}
		}
		country_event = { id = magic_battle.1 days = 0 }
	}
	
}

# Transmutation 3: Shapechange into Dragon - Success
country_event = {
	id = magic_battle.24
	title = magic_battle.24.t
	desc = magic_battle.24.d
	picture = TEMPORAL_RIFT_eventPicture
	
	is_triggered_only = yes
	
	option = {	#Burn them all!
		name = magic_battle.24.a
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				NOT = { mil_power = 120 }
			}
		}
		
		add_mil_power = -60
		
		random_list = {
			60 = {
				event_target:spell_target_province = { 
					change_controller = ROOT
					add_devastation = 10
				}
			}
			40 = {
				event_target:spell_target_province = { 
					add_province_modifier = {
						name = siege_magic_dragon_besieger
						duration = 14
						desc = siege_magic_dragon_besieger_desc
					}
				}
			}
		}
	}
	
	option = {
		name = magic_battle.24.b
		ai_chance = {
			factor = 100
		}
		
		#Spell
		event_target:spell_target_province = { 
			add_province_modifier = {
				name = siege_magic_dragon_besieger
				duration = 42
				desc = siege_magic_dragon_besieger_desc
			}
		}
	}
}

# Transmutation 3: Shapechange into Dragon - Fail
country_event = {
	id = magic_battle.25
	title = magic_battle.25.t
	desc = magic_battle.25.d
	picture = TEMPORAL_RIFT_eventPicture
	
	is_triggered_only = yes
	
	option = {	#It all comes crashing down
		name = magic_battle.25.a
		ai_chance = {
			factor = 1
		}
		
		kill_ruler = yes
		event_target:spell_target_province = { 
			add_devastation = 5
		}
	}
	
	option = {	#Wake up - Cast a spell to survive the fall!
		name = magic_battle.25.b
		highlight = yes
		trigger = {
			ROOT = { has_ruler_flag = abjuration_3 }
		}
		ai_chance = {
			factor = 100
		}
		
		add_mil_power = -100
		
		random_list = {
			60 = {
				kill_ruler = yes
			}
			40 = {
			
			}
		}
	}
	
}
