namespace = rending

##############################################################
# Legend for IDs:
# 000-099 = Rending main path
# 100-199 = Ward&Suppress path
# 200-299 = Corrupt&Scour path
# 300-399 = Appease&Dominate path
# 400-499 = tdb
# 500-599 = tdb
# 600-699 = tdb
##############################################################

country_event = {	#Early warning event. T-1 years. "Spirits Are Stirring"
	id = rending.001
	title = rending.001.t
	desc = rending.001.d # SOMETHING IS AWRY, SPIRITS ARE STURRING
	picture = MIRACLE_MONK_eventPicture
	
	fire_only_once = yes
	is_triggered_only = yes
		
	trigger = {
		is_year = 1650
		NOT = { has_global_flag = rending_has_ended_flag }
		NOT = { has_global_flag = rending_countdown_flag }
		temple_province_group = { has_damaged_derelict_or_corrupted_temple_complex = yes }
	}

	immediate = {
		hidden_effect = {
			set_global_flag = rending_countdown_flag
		}
	}
	
	option = {
		name = rending.001.a
	}
}

country_event = {	#Early warning event 2 . T-6 months. "Spirits Are Stirring"
	id = rending.002
	title = rending.002.t
	desc = rending.002.d
	picture = MIRACLE_MONK_eventPicture
	
	is_triggered_only = yes
		
	trigger = {
		is_year = 1650
		NOT = { has_global_flag = rending_has_ended_flag }
		had_global_flag = { flag = rending_countdown_flag days = 180 }
		any_owned_province = { province_group = temple_province_group }
	}
	
	option = {
		name = rending.002.a
	}
}

country_event = {	# The beginning of Rending of Realms. "The Rending of Realms"
	id = rending.003
	title = rending.003.t
	desc = rending.003.d
	picture = MIRACLE_MONK_eventPicture

	is_triggered_only = yes
		
	trigger = {
		is_year = 1650
		NOT = { has_global_flag = rending_has_ended_flag }
		NOT = { has_global_flag = rending_has_started_flag }
		had_global_flag = { flag = rending_countdown_flag days = 365 }
		capital_scope = { # capital in Haless
			OR = {
				superregion = yanshen_superregion
				superregion = rahen_superregion
				superregion = south_haless_superregion
			}
		}
		num_of_owned_provinces_with = { # 10+ provinces in Haless
			value = 10
			continent = asia
		}
	}

	immediate = {
		hidden_effect = {
			set_global_flag = rending_has_started_flag
			clr_global_flag = rending_countdown_flag
		}
		
		custom_tooltip = rending.003.itt1
		hidden_effect = {
			every_owned_province = {
				limit = { has_province_modifier = damaged_temple_complex }
				add_devastation = 25 # placeholder value
			}
		}

		custom_tooltip = rending.003.itt2 # may be show one tooltip for each damaged temple?
		hidden_effect = {
			every_owned_province = {
				limit = { has_province_modifier = temple_complex }
				random = {
					chance = 75
					remove_province_modifier = temple_complex
					add_permanent_province_modifier = {
						name = damaged_temple_complex
						duration = -1
					}
					downgrade_temple_wards = yes
				}
			}

		}

	}
	
	option = {
		name = rending.003.a
		trigger = {
			NOT = {
				religion = mystic_accord
				religion = bangujonsi
				religion = lefthand_path
				religion = bangujonsi
				religion = righteous_path
			}
		}
		country_event = { id = rending.100 }
	}
	option = {
		name = rending.003.b
		trigger = {
			OR = {
				religion = mystic_accord
				religion = bangujonsi
			}
		}
	}
	option = {
		name = rending.003.c
		trigger = {
			OR = {
				religion = lefthand_path
				religion = bangujonsi
			}
		}
	}
	option = {
		name = rending.003.e
		trigger = {
			religion = righteous_path
		}
	}
}

country_event = {	# Ward and Suprress path starting event.
	id = rending.100
	title = rending.100.t
	desc = rending.100.d
	picture = MIRACLE_MONK_eventPicture
	
	is_triggered_only = yes

	immediate = {
		set_country_flag = rending_ward_and_suppress
	}

	option = {
		name = rending.100.a
		custom_tooltip = rending.100.tt
		hidden_effect = {
			every_owned_province = {
				add_province_triggered_modifier = rending_spirit_protection
			}
		}
	}
}