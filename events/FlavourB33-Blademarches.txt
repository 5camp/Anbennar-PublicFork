
namespace = flavor_blademarches

#Dynasty Naming
country_event = {
	id = flavor_blademarches.1
	title = dynasty_setup.1.t
	desc = dynasty_setup.1.d
	picture = {
		trigger = {
			NOT = { has_dlc = "Rights of Man" }
		}
		picture = COURT_eventPicture
	}
	picture = {
		trigger = {
			has_dlc = "Rights of Man"
		}
		picture = ROYAL_COUPLE_FUTURE_eventPicture
	}
	
	fire_only_once = yes
	is_triggered_only = yes
	
	trigger = {
		tag = B33
	}
	
	#English name
	option = {		
		name = "flavor_blademarches.1.a"
		ai_chance = { 
			factor = 45 
			modifier = {
				factor = 3
				OR = {
					culture_group = alenic
				}
			}
		}	
		define_heir = {
			dynasty = "of Blademarch"
			age = 16
			male = yes
			adm = 1
			dip = 1
			mil = 3
			hide_skills = yes
		}
	}
	
	#Elven version
	option = {		
		name = "flavor_blademarches.1.b"
		ai_chance = { 
			factor = 45 
			modifier = {
				factor = 5
				OR = {
					culture_group = anbennarian
					culture_group = lencori
					primary_culture = elven
				}
			}
		}	
		define_heir = {
			dynasty = "síl Blaídith"
			age = 16
			male = yes
			adm = 1
			dip = 1
			mil = 3
			hide_skills = yes
		}
	}
	
	#Keep their name
	option = {		
		name = "flavor_blademarches.1.c"
		ai_chance = { factor = 10 }	
		define_heir = {
			dynasty = ROOT
			age = 16
			male = yes
			adm = 1
			dip = 1
			mil = 3
			hide_skills = yes
		}
	}
}

#The Order present you the Sword
country_event = {
	id = flavor_blademarches.2
	title = flavor_blademarches.2.t
	desc = flavor_blademarches.2.d
	picture = SWORD_OF_OSMAN_eventPicture
	fire_only_once = yes
	is_triggered_only = yes
	
	trigger = {
		tag = B33
		has_reform = blademarches_kingdom_reform
	}
	
	#Pass the trial
	option = {		
		name = flavor_blademarches.2.a
		ai_chance = { 
			factor = 50
			
			modifier = {
				factor = 2
				mil = 3
			}
			
			modifier = {
				factor = 2
				mil = 4
			}
			
			modifier = {
				factor = 2
				mil = 5
			}
			
			modifier = {
				factor = 100
				mil = 6
			}
		}
		custom_tooltip = wield_the_blade_tooltip
		hidden_effect = { country_event = { id = flavor_blademarches.4 } }
	}
	
	#Choose a Bladechosen
	option = {		
		name = flavor_blademarches.2.b
		ai_chance = { factor = 50 }
		custom_tooltip = nominate_bladechosen_tooltip
		hidden_effect = { country_event = { id = flavor_blademarches.8 days = 90 random = 365 } }
	}
	
	#Go train
	option = {		
		name = flavor_blademarches.2.c
		ai_chance = { 
			factor = 10
			
			modifier = {
				factor = 20
				
				mil = 1
				NOT = { mil = 2 }
			}
			
			modifier = {
				factor = 10
				
				mil = 2
				NOT = { mil = 3 }
			}
			
			modifier = {
				factor = 5
				
				mil = 3
				NOT = { mil = 4 }
			}
		}
		trigger = { NOT = { mil = 6 } NOT = { has_ruler_flag = trained_calindal } }
		custom_tooltip = calindal_training_tooltip
		add_ruler_modifier = {
			name = in_training_calindal
			duration = -1
		}
		country_event = { id = flavor_blademarches.6 days = 5 }
		hidden_effect = { set_ruler_flag = trained_calindal }
	}
}

#As the nominated heir, you get priority on the trial
country_event = {
	id = flavor_blademarches.3
	title = flavor_blademarches.3.t
	desc = flavor_blademarches.3.d
	picture = SWORD_OF_OSMAN_eventPicture

	is_triggered_only = yes
	
	trigger = {
		tag = B33
		has_reform = blademarches_kingdom_reform
	}
	
	option = {		
		name = flavor_blademarches.3.a
		ai_chance = { 
			factor = 50
			
			modifier = {
				factor = 2
				mil = 3
				NOT = { mil = 4 }
			}
			
			modifier = {
				factor = 4
				mil = 4
				NOT = { mil = 5 }
			}
			
			modifier = {
				factor = 6
				mil = 5
				NOT = { mil = 6 }
			}
			
			modifier = {
				factor = 100
				mil = 6
			}
			
			modifier = {
				factor = 1.5
				ruler_has_personality = righteous_personality
			}
			
			modifier = {
				factor = 1.5
				ruler_has_personality = inspiring_leader_personality
			}
			
			modifier = {
				factor = 1.5
				ruler_has_personality = conqueror_personality
			}
			
			modifier = {
				factor = 5
				ruler_has_personality = obsessive_perfectionist_personality
			}
		}
		hidden_effect = { country_event = { id = flavor_blademarches.4 } }
		custom_tooltip = wield_the_blade_tooltip
	}
	
	#Choose a Bladechosen
	option = {		
		name = flavor_blademarches.3.b
		ai_chance = { factor = 50 }
		hidden_effect = { country_event = { id = flavor_blademarches.8 days = 90 random = 365 } }
		custom_tooltip = nominate_bladechosen_tooltip
	}
	
	#Go train
	option = {		
		name = flavor_blademarches.3.c
		ai_chance = { 
			factor = 10
			
			modifier = {
				factor = 20
				
				mil = 1
				NOT = { mil = 2 }
			}
			
			modifier = {
				factor = 10
				
				mil = 2
				NOT = { mil = 3 }
			}
			
			modifier = {
				factor = 5
				
				mil = 3
				NOT = { mil = 4 }
			}
		}
		trigger = { NOT = { mil = 6 } NOT = { has_ruler_flag = trained_calindal } }
		add_ruler_modifier = {
			name = in_training_calindal
			duration = -1
		}
		country_event = { id = flavor_blademarches.6 days = 5 }
		custom_tooltip = calindal_training_tooltip
		hidden_effect = { set_ruler_flag = trained_calindal }
	}
}

#Calculation event for whether or not you manage to pick up the sword
country_event = {
	id = flavor_blademarches.4
	title = flavor_blademarches.4.t
	desc = flavor_blademarches.4.d
	picture = SWORD_OF_OSMAN_eventPicture

	is_triggered_only = yes
	hidden = yes
	
	trigger = {
		tag = B33
	}
	#Succeed
	option = {		
		name = flavor_blademarches.4.a
		ai_chance = { 
			factor = 50
			
			modifier = {
				factor = 2
				mil = 3
				NOT = { mil = 4 }
			}
			
			modifier = {
				factor = 4
				mil = 4
				NOT = { mil = 5 }
			}
			
			modifier = {
				factor = 6
				mil = 5
				NOT = { mil = 6 }
			}
			
			modifier = {
				factor = 20
				mil = 6
			}
			
			modifier = {
				factor = 2
				ruler_has_personality = conqueror_personality
			}
			
			modifier = {
				factor = 2
				ruler_has_personality = bold_fighter_personality
			}
			
			modifier = {
				factor = 2
				ruler_has_personality = strict_personality
			}
			
			modifier = {
				factor = 2
				has_ruler_flag = trained_calindal
			}
			
			modifier = {
				factor = 2
				has_ruler_flag = trained_heir_calindal
			}
			
		}
		set_ruler_flag = wield_the_sword
		country_event = { id = flavor_blademarches.5 }
	}
	
	option = {
		name = flavor_blademarches.4.b
		ai_chance = { 
			factor = 50
			
			modifier = {
				factor = 2
				mil = 2
				NOT = { mil = 3 }
			}
			
			modifier = {
				factor = 4
				mil = 1
				NOT = { mil = 2 }
			}
			
			modifier = {
				factor = 20
				mil = 0
				NOT = { mil = 1 }
			}
			
			modifier = {
				factor = 6
				ruler_has_personality = craven_personality
			}
			
		}
		set_ruler_flag = failed_to_wield
		country_event = { id = flavor_blademarches.5 }
	}
}


#Result of the Trial
country_event = {
	id = flavor_blademarches.5
	title = flavor_blademarches.5.t
	desc = {
		trigger = { has_ruler_flag = wield_the_sword }
		desc = flavor_blademarches.5.da
	}
	desc = {
		trigger = { has_ruler_flag = failed_to_wield }
		desc = flavor_blademarches.5.db
	}
	
	picture = SWORD_OF_OSMAN_eventPicture
	is_triggered_only = yes
	
	trigger = {
		tag = B33
	}
	
	option = {		
		name = flavor_blademarches.5.a
		ai_chance = {  factor = 50 }
		trigger = { has_ruler_flag = wield_the_sword }
		add_ruler_modifier = {
			name = wielding_calindal
			duration = -1
		}
		if = {
			limit = { mil = 4 NOT = { mil = 5 } }
			change_mil = 2
		}
		else_if = {
			limit = { mil 5 NOT = { mil = 6 } }
			change_mil = 1
			add_mil_power = 150
		}
		else_if = {
			limit = { mil = 6 }
			add_mil_power = 300
		}
		add_stability = 1
		add_legitimacy = 20
		hidden_effect = {
			random_list = {
				24 = {
					define_ruler_to_general = {
						fire = 4
						shock = 4
						manuever = 3
						siege = 2
					}
				}
				21 = {
					define_ruler_to_general = {
						fire = 5
						shock = 5
						manuever = 2
						siege = 3
					}
				}
				18 = {
					define_ruler_to_general = {
						fire = 5
						shock = 5
						manuever = 3
						siege = 2
					}
				}
				15 = {
					define_ruler_to_general = {
						fire = 5
						shock = 6
						manuever = 3
						siege = 3
					}
				}
				13 = {
					define_ruler_to_general = {
						fire = 5
						shock = 6
						manuever = 3
						siege = 3
					}
				}
				7 = {
					define_ruler_to_general = {
						fire = 5
						shock = 7
						manuever = 4
						siege = 3
					}
				}
			}
		}
	}
	
	option = {		
		name = flavor_blademarches.5.b
		ai_chance = { factor = 50 }
		trigger = { has_ruler_flag = failed_to_wield }
		add_stability = -1
		add_legitimacy = -20
		add_ruler_modifier = {
			name = has_bladechosen
			duration = -1
		}
		add_ruler_modifier = {
			name = blinded_by_the_sword
			duration = -1
		}
		custom_tooltip = blinded_tooltip
	}
}

#Training Events
country_event = {
	id = flavor_blademarches.6
	title = flavor_blademarches.6.t
	desc = flavor_blademarches.6.d
	
	picture = SWORD_OF_OSMAN_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		tag = B33
		has_ruler_modifier = in_training_calindal
	}
	
	#Easy Training
	option = {
		name = flavor_blademarches.6.a
		ai_chance = {  factor = 50 }
		add_mil_power = -50
		add_dip_power = -50
		add_adm_power = -50
		hidden_effect = { set_ruler_flag = easy_training_calindal }
	}
	
	#Normal Training
	option = {
		name = flavor_blademarches.6.b
		ai_chance = {  factor = 50 }
		add_mil_power = -150
		add_dip_power = -150
		add_adm_power = -150
		hidden_effect = { set_ruler_flag = normal_training_calindal }
	}
	
	#Hard Training
	option = {
		name = flavor_blademarches.6.c
		ai_chance = {  factor = 50 }
		add_mil_power = -200
		add_dip_power = -200
		add_adm_power = -200
		random_list = {
			50 = { change_dip = -1 }
			50 = { change_adm = -1 }
		}
		hidden_effect = { set_ruler_flag = hard_training_calindal }
	}
	
	#Super Training
	option = {
		name = flavor_blademarches.6.e
		ai_chance = {  factor = 5000 }
		trigger = { ruler_has_personality = strict_personality }
		highlight = yes
		add_mil_power = -200
		add_dip_power = -200
		add_adm_power = -200
		hidden_effect = { set_ruler_flag = super_training_calindal }
	}
}

#End of Training
country_event = {
	id = flavor_blademarches.7
	title = flavor_blademarches.7.t
	desc = flavor_blademarches.7.d
	
	picture = SWORD_OF_OSMAN_eventPicture
	
	mean_time_to_happen = {
		years = 2
		
		modifier = {
			factor = 0.5
			has_ruler_flag = easy_training_calindal
		}
		
		modifier = {
			factor = 1
			has_ruler_flag = normal_training_calindal
		}
		
		modifier = {
			factor = 2
			has_ruler_flag = hard_training_calindal
		}
		
		modifier = {
			factor = 1.5
			has_ruler_flag = super_training_calindal
		}
	}
	
	trigger = {
		tag = B33
		has_ruler_modifier = in_training_calindal
		OR = {
			has_ruler_flag = easy_training_calindal
			has_ruler_flag = normal_training_calindal
			has_ruler_flag = hard_training_calindal
			has_ruler_flag = super_training_calindal
		}
	}
	
	#Easy training
	option = {
		name = flavor_blademarches.7.a
		ai_chance = {  factor = 50 }
		trigger = { has_ruler_flag = easy_training_calindal }
		random_list = {
			60 = { change_mil = 1 }
			40 = { }
		}
		add_prestige = 5
		hidden_effect = { clr_country_flag = easy_training_calindal }
		remove_country_modifier = in_training_calindal
		country_event = { id = flavor_blademarches.3 }
	}
	
	#Normal training
	option = {
		name = flavor_blademarches.7.b
		ai_chance = {  factor = 50 }
		trigger = { has_ruler_flag = normal_training_calindal }
		random_list = {
			75 = { change_mil = 1 }
			25 = { }
		}
		add_prestige = 10
		hidden_effect = { clr_country_flag = normal_training_calindal }
		remove_country_modifier = in_training_calindal
		country_event = { id = flavor_blademarches.3 }
	}
	
	#Hard training
	option = {
		name = flavor_blademarches.7.c
		ai_chance = {  factor = 50 }
		trigger = { has_ruler_flag = hard_training_calindal }
		random_list = {
			80 = { change_mil = 1 }
			15 = { change_mil = 2 }
			5 = { }
		}
		add_prestige = 15
		hidden_effect = { clr_country_flag = hard_training_calindal }
		remove_country_modifier = in_training_calindal
		country_event = { id = flavor_blademarches.3 }
	}
	
	#Super training
	option = {
		name = flavor_blademarches.7.e
		ai_chance = {  factor = 50 }
		trigger = { has_ruler_flag = super_training_calindal }
		random_list = {
			80 = { change_mil = 1 }
			20 = { change_mil = 2 }
		}
		add_prestige = 20
		hidden_effect = { clr_country_flag = super_training_calindal }
		remove_country_modifier = in_training_calindal
		country_event = { id = flavor_blademarches.3 }
	}
}

#Bladechosen found
country_event = {
	id = flavor_blademarches.8
	title = flavor_blademarches.8.t
	desc = flavor_blademarches.8.d
	
	picture = SWORD_OF_OSMAN_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		tag = B33
	}
	
	#A new bladechosen
	option = {
		name = flavor_blademarches.8.a
		ai_chance = {  factor = 50 }
		add_ruler_modifier = {
			name = has_bladechosen
			duration = -1
		}
	}
}

#Bladechosen revolt
country_event = {
	id = flavor_blademarches.9
	title = flavor_blademarches.9.t
	desc = flavor_blademarches.9.d
	
	picture = SWORD_OF_OSMAN_eventPicture
	
	is_triggered_only = yes
	
	mean_time_to_happen = {
		years = 100
		
		modifier = {
			factor = 0.5
			
			has_ruler_modifier = blinded_by_the_sword
		}
		
		modifier = {
			factor = 0.2
			
			mil = 0
			NOT = { mil = 1 }
		}
		
		modifier = {
			factor = 0.35
			
			mil = 1
			NOT = { mil = 2 }
		}
		
		modifier = {
			factor = 0.55
			
			mil = 2
			NOT = { mil = 3 }
		}
		
		modifier = {
			factor = 0.75
			
			mil = 3
			NOT = { mil = 4 }
		}
		
		modifier = {
			factor = 0.9
			
			mil = 4
			NOT = { mil = 5 }
		}
		
		modifier = {
			factor = 0.5

			ruler_has_personality = craven_personality
		}
		
		modifier = {
			factor = 0.9

			NOT = { legitimacy = 50 }
		}
		
		modifier = {
			factor = 0.8

			NOT = { legitimacy = 20 }
		}
	}
	
	trigger = {
		tag = B33
		has_ruler_modifier = has_bladechosen
		NOT = { has_ruler_flag = calindal_revolt }
		NOT = { legitimacy = 90 }
	}
	
	#A new bladechosen
	option = {
		name = flavor_blademarches.9.a
		ai_chance = {  factor = 50 }
		remove_country_modifier = has_bladechosen
		add_stability = -1
		capital_scope = {
			if = {
				limit = { owner = { land_forcelimit = 150 } }
				spawn_rebels = {
					type = pretender_rebels
					size = 7
				}
			}
			else_if = {
				limit = { owner = { land_forcelimit = 130 } }
				spawn_rebels = {
					type = pretender_rebels
					size = 6
				}
			}
			else_if = {
				limit = { owner = { land_forcelimit = 100 } }
				spawn_rebels = {
					type = pretender_rebels
					size = 5
				}
			}
			else_if = {
				limit = { owner = { land_forcelimit = 70 } }
				spawn_rebels = {
					type = pretender_rebels
					size = 4
				}
			}
			else_if = {
				limit = { owner = { land_forcelimit = 50 } }
				spawn_rebels = {
					type = pretender_rebels
					size = 3
				}
			}
			else = {
				spawn_rebels = {
					type = pretender_rebels
					size = 2
				}
			}
		}
		hidden_effect = { set_ruler_flag = calindal_revolt }
	}
}

#Random dude claim the throne
country_event = {
	id = flavor_blademarches.10
	title = flavor_blademarches.10.t
	desc = flavor_blademarches.10.d
	
	picture = SWORD_OF_OSMAN_eventPicture
	
	is_triggered_only = yes
	
	mean_time_to_happen = {
		years = 50
		
		modifier = {
			factor = 0.15
			
			has_ruler_modifier = in_training_calindal
		}
		
		modifier = {
			factor = 0.9

			NOT = { legitimacy = 50 }
		}
		
		modifier = {
			factor = 0.8

			NOT = { legitimacy = 20 }
		}
		
		modifier = {
			factor = 0.5

			NOT = { stability = 1 }
		}
	}
	
	trigger = {
		tag = B33
		OR = {
			has_ruler_modifier = blinded_by_the_sword
			has_ruler_modifier = in_training_calindal
		}
		NOT = { has_ruler_flag = calindal_revolt }
	}
	
	#A new bladechosen
	option = {
		name = flavor_blademarches.10.a
		ai_chance = {  factor = 50 }
		capital_scope = {
			if = {
				limit = { owner = { land_forcelimit = 150 } }
				spawn_rebels = {
					type = pretender_rebels
					size = 6
				}
			}
			else_if = {
				limit = { owner = { land_forcelimit = 130 } }
				spawn_rebels = {
					type = pretender_rebels
					size = 5
				}
			}
			else_if = {
				limit = { owner = { land_forcelimit = 100 } }
				spawn_rebels = {
					type = pretender_rebels
					size = 4
				}
			}
			else_if = {
				limit = { owner = { land_forcelimit = 70 } }
				spawn_rebels = {
					type = pretender_rebels
					size = 3
				}
			}
			else_if = {
				limit = { owner = { land_forcelimit = 50 } }
				spawn_rebels = {
					type = pretender_rebels
					size = 2
				}
			}
			else = {
				spawn_rebels = {
					type = pretender_rebels
					size = 1
				}
			}
		}
		hidden_effect = { set_ruler_flag = calindal_revolt }
	}
}
