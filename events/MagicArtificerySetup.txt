namespace = magic_artificery_setup

#Rise of Artificery / Choose Mode
country_event = { 
	id = magic_artificery_setup.1
	title = magic_artificery_setup.1.t
	desc = magic_artificery_setup.1.d
	picture = INVENTION_eventPicture

	is_triggered_only = yes
	
	#mage only
	option = {
		name = magic_artificery_setup.1.a
		trigger = {
			NOT = { tag = I98 } #Allclan
			NOT = { tag = Y20 } #Feiten
			NOT = { tag = A05 } #Reveria
			NOT = { tag = A99 } #Varaine
			NOT = { tag = G27 } #Brelar
			NOT = { has_government_attribute = is_technocracy }
		}
		custom_tooltip = magic_only_tt
		hidden_effect = {
			set_country_flag = magic_artificery_mage_only
		}
	}
	#mage/artificery
	option = {
		name = magic_artificery_setup.1.b
		trigger = {
			NOT = { has_government_attribute = is_technocracy }
			NOT = { has_government_attribute = is_magocracy }
			NOT = { tag = I02 } #emrald Orc
			NOT = { tag = Y20 }
		}
		custom_tooltip = mixed_tt
		hidden_effect = {
			set_country_flag = magic_artificery_mixed
			set_country_flag = artificery_unlocked
			
			country_event = {
				id = magic_artificery_setup.2
				days = 1
			}
		}
	}
	#artificers only
	option = {
		name = magic_artificery_setup.1.c
		trigger = {
			NOT = { has_ruler_flag = is_a_lich }
			NOT = { has_government_attribute = is_magocracy }
			NOT = { tag = I02 } #emrald Orc
		}
		custom_tooltip = artificers_only_tt
		hidden_effect = {
			set_country_flag = magic_artificery_artificery_only
			set_country_flag = artificery_unlocked
	
			country_event = {
				id = magic_artificery_setup.2
				days = 1
			}
			country_event = {
				id = magic_artificery_setup.3
				days = 1
			}
		}
	}
	after = {
		clr_country_flag = magic_artificery_currently_choosing
	}
}

#Unlock Artificer Estate and Choose Org
country_event = { 
	id = magic_artificery_setup.2
	title = magic_artificery_setup.2.t
	desc = magic_artificery_setup.2.d
	picture = INVENTION_eventPicture

	is_triggered_only = yes
	
	immediate = {
		#Artificery Local Setup
		set_country_flag = artificery_unlocked #failsave
		set_country_flag = artifice_unlocked_basic
		set_variable = {
			which = artifice_level_progress
			value = 0
		}
		set_variable = {
			which = artifice_max_invention_slots
			value = 7
		}

		#Give welcome basket of three inventions if not yet received.
		artifice_inventions_give_basket = yes
		update_artifice_points = yes
	}

	#fast
	option = {
		name = magic_artificery_setup.2.a
		trigger = {
			NOT = {
				tag = R62 #Command
				tag = I98 #Allclan
				has_country_flag = nsc_sun_elf_artificery #Sun Elf only artificery
			}
		}
		remove_estate_privilege = estate_artificers_organization_international_gommo
		remove_estate_privilege = estate_artificers_organization_state
		remove_estate_privilege = estate_artificers_organization_independent_unions
		remove_estate_privilege = estate_artificers_organization_ravelian_control
		set_estate_privilege = estate_artificers_organization_international_gommo
	}
	#normal
	option = {
		name = magic_artificery_setup.2.b
		trigger = {
			NOT = {
				tag = R62 #Command
				tag = I98 #Allclan
				has_country_flag = nsc_sun_elf_artificery #Sun Elf only artificery
			}
		}
		remove_estate_privilege = estate_artificers_organization_international_gommo
		remove_estate_privilege = estate_artificers_organization_state
		remove_estate_privilege = estate_artificers_organization_independent_unions
		remove_estate_privilege = estate_artificers_organization_ravelian_control
		set_estate_privilege = estate_artificers_organization_independent_unions
	}
	#slow
	option = {
		name = magic_artificery_setup.2.c
		trigger = {
			NOT = {
				tag = R62 #Command
				tag = I98 #Allclan
				has_country_flag = nsc_sun_elf_artificery #Sun Elf only artificery
			}
		}
		remove_estate_privilege = estate_artificers_organization_international_gommo
		remove_estate_privilege = estate_artificers_organization_state
		remove_estate_privilege = estate_artificers_organization_independent_unions
		remove_estate_privilege = estate_artificers_organization_ravelian_control
		set_estate_privilege = estate_artificers_organization_state
	}
	option = {
		name = magic_artificery_setup.2.e
		trigger = {
			tag = R62
		}
		remove_estate_privilege = estate_artificers_organization_international_gommo
		remove_estate_privilege = estate_artificers_organization_state
		remove_estate_privilege = estate_artificers_organization_independent_unions
		remove_estate_privilege = estate_artificers_organization_ravelian_control
		set_estate_privilege = estate_dragon_command_ninyu_kikun_sunyanin_artificers
	}
	option = {
		name = magic_artificery_setup.2.f
		trigger = {
			tag = I98
		}
		remove_estate_privilege = estate_artificers_organization_international_gommo
		remove_estate_privilege = estate_artificers_organization_state
		remove_estate_privilege = estate_artificers_organization_independent_unions
		remove_estate_privilege = estate_artificers_organization_ravelian_control
		set_estate_privilege = estate_artificers_organization_discombobulatorium
	}
	option = {
		name = magic_artificery_setup.2.g
		trigger = {
			has_country_flag = nsc_sun_elf_artificery
		}
		remove_estate_privilege = estate_artificers_organization_international_gommo
		remove_estate_privilege = estate_artificers_organization_state
		remove_estate_privilege = estate_artificers_organization_independent_unions
		remove_estate_privilege = estate_artificers_organization_ravelian_control
		set_estate_privilege = estate_artificers_organization_sun_elf
	}
}
#Remove all Mages
country_event = { 
	id = magic_artificery_setup.3
	title = magic_artificery_setup.3.t
	desc = magic_artificery_setup.3.d
	picture = INVENTION_eventPicture

	is_triggered_only = yes
	hidden = yes
	
	immediate = {
		
	}

	option = {
		name = magic_artificery_setup.3.a
		add_country_modifier = { 
			name = expelled_mages 
			duration = 365
		}
		set_country_flag = banned_magic
		if = {
			limit = {
				exists = A85
				has_estate_privilege = estate_mages_organization_magisterium
			}
			A85 = {
				add_opinion = {
					who = ROOT
					modifier = expelled_the_magisterium
					years = 20
				}
			}
		}
		
		#gets rid of all mages advisors and stuffs in your country
		if = {
			limit = {
				advisor = court_mage
			}
			kill_advisor = court_mage
		}
		custom_tooltip = remove_mage_towers_tt
		hidden_effect = {
			every_owned_province = {
				limit = {
					has_building = mage_tower
				}
				remove_building = mage_tower
			}
		}
		#kills 
		if = {
			limit = {
				ruler_has_mage_personality = yes
			}
			kill_ruler = yes
		}
		if = {
			limit = {
				heir_has_mage_personality = yes
			}
			kill_heir = { }
		}
		if = {
			limit = {
				consort_has_mage_personality = yes
			}
			kill_consort = yes
		}
	}
}

#welcome all Mages
country_event = { 
	id = magic_artificery_setup.4
	title = magic_artificery_setup.4.t
	desc = magic_artificery_setup.4.d
	picture = INVENTION_eventPicture

	is_triggered_only = yes
	hidden = yes
	
	immediate = {
		
	}

	option = {
		name = magic_artificery_setup.4.a
		clr_country_flag = banned_magic
		country_event = { id = estate_organization.3 days = 35 } #Delay so mage estate appears
	}
}

country_event = { 
	id = magic_artificery_setup.5
	title = magic_artificery_setup.5.t
	desc = magic_artificery_setup.5.d
	picture = INVENTION_eventPicture

	is_triggered_only = yes
	hidden = yes
	
	trigger = {
		is_tribal = no
		NOT = { has_country_flag = artificery_unlocked }
		OR = {
			culture_group = kobold
			culture_group = goblin
			culture_group = gnomish
		}
		NOT = { primary_culture = goldscale_kobold }
	}
	option = {
		name = magic_artificery_setup.5.a
		country_event = {
			id = magic_artificery_setup.1
		}
	}
}