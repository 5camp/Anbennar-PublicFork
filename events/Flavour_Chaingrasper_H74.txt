namespace = flavor_chaingrasper

### Chaingrasper content made by Dadevo ###

country_event = { #Startup event, triggered from 00_on_actions startup events
	id = flavor_chaingrasper.1 #The Clock is Ticking
	title = flavor_chaingrasper.1.t
	desc = flavor_chaingrasper.1.d
	picture = BIG_STAR_IN_SKY_eventPicture #DADEVO: Change this
	
	is_triggered_only = yes	
	fire_only_once = yes
	
	trigger = {
		tag = H74
	}

	option = { #Dak WILL become a lich.
		name = flavor_chaingrasper.1.a
		ai_chance = { factor = 100 }
		add_ruler_modifier = { #DADEVO: Add loc
			name = chaingrasper_exceptional_willpower
			duration = -1 
		}
		hidden_effect = {
			set_ruler_flag = chaingrasper_lichdom_quest
		}
	}
}

country_event = {
	id = flavor_chaingrasper.100 #Studying is finished, time to remove extra study xp
	title = flavor_chaingrasper.100.t
	desc = flavor_chaingrasper.100.d
	picture = BIG_STAR_IN_SKY_eventPicture #DADEVO: Change this
	
	fire_only_once = yes
	hidden = yes
	
	trigger = {
		tag = H74 #Chaingrasper
		OR = {
			NOT = { has_ruler_flag = ruler_studying_necromancy }
			has_ruler_flag = necromancy_3
		}
	}
		
	option = { #Remove study xp
		name = flavor_chaingrasper.100.a
		ai_chance = { factor = 100 }
		remove_country_modifier = chaingrasper_pursuing_immortal
		hidden_effect = {
			update_magic_study_experience_modifier = { value = -50 } 
		}
	}
}

country_event = { 
	id = flavor_chaingrasper.101 #A Failed Endeavour
	title = flavor_chaingrasper.101.t
	desc = flavor_chaingrasper.101.d
	picture = BIG_STAR_IN_SKY_eventPicture #DADEVO: Change this
	
	fire_only_once = yes
	
	trigger = {
		tag = H74 #Chaingrasper
		NOT = { has_country_flag = chaingrasper_lichdom_achieved }
		OR = {
			had_ruler_flag = { #You took too long
				flag = chaingrasper_lichdom_quest
				days = 20000 # 55 years
			}
			NOT = { #Dak died at some point
				has_ruler_modifier = chaingrasper_exceptional_willpower 
			}
		}
	}

	option = { #Bad RNG so RIP.
		name = flavor_chaingrasper.101.a
		ai_chance = { factor = 100 }
		
		#Dak will be 90+ years old, so he'll be dead in a few months
		remove_country_modifier = chaingrasper_exceptional_willpower
	}
}

country_event = { 
	id = flavor_chaingrasper.102 #A Successful Endeavour
	title = flavor_chaingrasper.102.t
	desc = flavor_chaingrasper.102.d
	picture = BIG_STAR_IN_SKY_eventPicture #DADEVO: Change this
	
	fire_only_once = yes
	
	trigger = {
		tag = H74 #Chaingrasper
		has_ruler_flag = is_a_lich
	}

	option = { #Aw yeah!
		name = flavor_chaingrasper.102.a
		ai_chance = { factor = 100 }
		remove_country_modifier = chaingrasper_exceptional_willpower
	}
}

country_event = {
	id = flavor_chaingrasper.2 #Unwanted Guests
	title = flavor_chaingrasper.2.t
	desc = flavor_chaingrasper.2.d
	picture = BIG_STAR_IN_SKY_eventPicture #DADEVO: Change this
	
	is_triggered_only = yes	
	fire_only_once = yes
		
	option = { #Time to murder Goblinsbane!
		name = flavor_chaingrasper.2.a
		ai_chance = { factor = 100 }
		
		4284 = {
			spawn_rebels = {
				type = nationalist
				size = 2 #DADEVO: check this lol
				culture = granite_dwarf
				religion = ancestor_worship
				friend = I19
				leader = "Goblinsbane" #DADEVO: Custom leader pips somehow?
				win = no
			}
		}
		
		hidden_effect = {
			set_country_flag = chaingrasper_fought_goblinsbane
		}
	}
}

country_event = {
	id = flavor_chaingrasper.3 #Goblinsbane is dead!
	title = flavor_chaingrasper.3.t
	desc = flavor_chaingrasper.3.d
	picture = BIG_STAR_IN_SKY_eventPicture #DADEVO: Change this
	
	fire_only_once = yes #DADEVO: TODO figure out how to fire when specific revolt dies?
	
	trigger = {
		tag = H74 #Chaingrasper
		num_of_rebel_armies = 0
		has_country_flag = chaingrasper_fought_goblinsbane
	}
		
	option = { #We finally got rid of him!
		name = flavor_chaingrasper.3.a
		ai_chance = { factor = 100 }
		add_prestige = 25
	}
}

country_event = {
	id = flavor_chaingrasper.4 #An Evolving Nation
	title = flavor_chaingrasper.4.t
	desc = flavor_chaingrasper.4.d
	picture = BIG_STAR_IN_SKY_eventPicture #DADEVO: Change this
	
	is_triggered_only = yes	
	fire_only_once = yes
		
	option = { #Stop being sad you stupid artificers
		name = flavor_chaingrasper.4.a
		ai_chance = { factor = 100 }
		hidden_effect = {
			country_event = { #DADEVO: Add loc
				id = flavor_chaingrasper.5
				days = 3650
				random = 100
			}
		}
	}
}

country_event = {
	id = flavor_chaingrasper.5 #Artificer Resistance
	title = flavor_chaingrasper.5.t
	desc = flavor_chaingrasper.5.d
	picture = BIG_STAR_IN_SKY_eventPicture #DADEVO: Change this
	
	is_triggered_only = yes	
	fire_only_once = yes
		
	option = { #Oh, no (artificer revolt starts)
		name = flavor_chaingrasper.5.a
		ai_chance = { factor = 100 }
		add_prestige = -10
		hidden_effect = {
			set_country_flag = chaingrasper_angry_artificers_achieved
			add_country_modifier = { #DADEVO: Add loc
				name = chaingrasper_disgruntled_artificers
				duration = -1
			}
			every_owned_province = { #Add artificer resistance to all holds
				if = {
					limit = {
						OR = {
							has_terrain = dwarven_hold_surface
							has_terrain = dwarven_hold
						}
					}
					add_province_modifier = { #DADEVO: Add Loc
						name = chaingrasper_artificer_resistance
						duration = -1
					}
				}
			}
			#Also add modifier to up to 5 random high dev provinces
			random_core_province = { #1
				limit = {
					NOT = { #Doesn't already have modifier, includes holds
						has_province_modifier = chaingrasper_artificer_resistance
					}
					development = 10
				}
				add_province_modifier = {
					name = chaingrasper_artificer_resistance
					duration = -1
				}
			}
			random_core_province = { #2
				limit = {
					NOT = { #Doesn't already have modifier, includes holds
						has_province_modifier = chaingrasper_artificer_resistance
					}
					development = 10
				}
				add_province_modifier = {
					name = chaingrasper_artificer_resistance
					duration = -1
				}
			}
			random_core_province = { #3
				limit = {
					NOT = { #Doesn't already have modifier, includes holds
						has_province_modifier = chaingrasper_artificer_resistance
					}
					development = 10
				}
				add_province_modifier = {
					name = chaingrasper_artificer_resistance
					duration = -1
				}
			}
			random_core_province = { #4
				limit = {
					NOT = { #Doesn't already have modifier, includes holds
						has_province_modifier = chaingrasper_artificer_resistance
					}
					development = 10
				}
				add_province_modifier = {
					name = chaingrasper_artificer_resistance
					duration = -1
				}
			}
			random_core_province = { #5
				limit = {
					NOT = { #Doesn't already have modifier, includes holds
						has_province_modifier = chaingrasper_artificer_resistance
					}
					development = 10
				}
				add_province_modifier = {
					name = chaingrasper_artificer_resistance
					duration = -1
				}
			}
		}
	}
}

country_event = {
	id = flavor_chaingrasper.6 #The Sacking of Gronstunad
	title = flavor_chaingrasper.6.t
	desc = flavor_chaingrasper.6.d
	picture = BIG_STAR_IN_SKY_eventPicture #DADEVO: Change this
	
	is_triggered_only = yes	
	fire_only_once = yes
		
	option = { #Slaughter the hobgoblins
		name = flavor_chaingrasper.6.a
		ai_chance = { factor = 75 }
		
		4311 = { #Gronstunad
			add_devastation = 100
			change_culture = ROOT
			change_religion = ROOT
			add_base_tax = -1
			add_base_production = -2
			add_base_manpower = -3
			
			add_permanent_province_modifier = { name = purge_unrest_modifier duration = 9125 }
			
			hidden_effect = {
				remove_province_modifier = hobgoblin_majority_oppressed
				remove_province_modifier = hobgoblin_majority_coexisting
				remove_province_modifier = hobgoblin_majority_integrated
			}
		}
		
		largest_decrease_of_hobgoblin_tolerance_effect = yes

	}
	option = { #Put the hobgoblins to work
		name = flavor_chaingrasper.6.b
		ai_chance = { factor = 25 }
		
		4311 = { #Gronstunad
			add_devastation = 20
			change_culture = ROOT
			change_religion = ROOT
			add_base_tax = -1
			add_base_production = -1
			add_base_manpower = -1
						
			hidden_effect = {
				remove_province_modifier = hobgoblin_majority_oppressed
				remove_province_modifier = hobgoblin_majority_coexisting
				remove_province_modifier = hobgoblin_majority_integrated
				add_permanent_province_modifier = { 
					name = hobgoblin_minority_oppressed_large 
					duration = -1
				}
			}
		}
		
		medium_decrease_of_hobgoblin_tolerance_effect = yes
	}
}

country_event = {
	id = flavor_chaingrasper.7 #A New Capital
	title = flavor_chaingrasper.7.t
	desc = flavor_chaingrasper.7.d
	picture = BIG_STAR_IN_SKY_eventPicture #DADEVO: Change this
	
	is_triggered_only = yes	
	fire_only_once = yes
		
	option = { #Change capital to Gronstunad
		name = flavor_chaingrasper.7.a
		ai_chance = { factor = 80 }
		set_capital	= 4311
		4311 = { #Gronstunad
			add_province_modifier = { #DADEVO: Add loc
				name = chaingrasper_a_new_capital
				duration = 9125
			}
		}
	}
	
	option = { #Keep capital
		name = flavor_chaingrasper.7.b
		ai_chance = { factor = 20 }
		add_stability_or_adm_power = yes
	}
}
