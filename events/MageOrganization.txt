namespace = mage_organization


# Initialization - Decision Choosing
country_event = {
	id = mage_organization.1
	title = mage_organization.1.t
	desc = mage_organization.1.d
	picture = DHIMMI_ESTATE_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		has_mage_organization_privilege = no
		has_estate = estate_mages
		NOT = { has_country_flag = banned_magic }
	}
	
	#Decentralized
	option = {
		name = mage_organization.1.a
		ai_chance = {
			factor = 34
		}
		trigger = {
			is_part_of_hre = no	#for now
			NOT = { tag = A85 }
		}
		ai_chance = {
			factor = 0.1
			modifier = {
				factor = 10
				is_at_war = yes
			}
		}
		set_estate_privilege = estate_mages_organization_guilds
	}
	
	#Centralized
	option = {
		name = mage_organization.1.b
		ai_chance = {
			factor = 33
		}
		trigger = {
			adm_tech = 12
			NOT = { tag = A85 }
		}
		set_estate_privilege = estate_mages_organization_state
	}
	
	#Magisterium
	option = {
		name = mage_organization.1.c
		ai_chance = {
			factor = 33
			modifier = {
				factor = 100
				is_part_of_hre = yes
			}
		}
		trigger = {
			OR = {
				is_part_of_hre = yes
				if = {
					limit = {
						exists = A85
					}
					A85 = {
						has_opinion = {
							who = ROOT
							value = 100
						}
					}
				}
			}
		}
		set_estate_privilege = estate_mages_organization_magisterium
	}
	
	#Religious
	option = {
		name = mage_organization.1.d
		ai_chance = {
			factor = 33
			modifier = {
				factor = 100
				OR = {
					religion = ravelian
					religion = the_jadd
					religion = bulwari_sun_cult
					religion = old_bulwari_sun_cult
					religion = xhazobkult
					religion = skaldhyrric_faith 
				}
			}
		}
		trigger = {
			OR = {
				religion = ravelian
				religion = the_jadd
				religion = bulwari_sun_cult
				religion = old_bulwari_sun_cult
				religion = xhazobkult
				religion = skaldhyrric_faith 
			}
			NOT = { tag = A85 }
		}
		set_estate_privilege = estate_mages_organization_religious
	}
	
	option = {
		name = mage_organization.1.dd
		ai_chance = {
			factor = 1
		}
		trigger = {
			OR = {
				religion = ravelianism
			}
		}
		set_country_flag = banned_magic
	}
}

#Expel Mages Change Noble Reform
country_event = {
	id = mage_organization.2
	title = mage_organization.2.t
	desc = mage_organization.2.d
	picture = NOBLE_ESTATE_DEMANDS_eventPicture
	
	mean_time_to_happen = {
		months = 1
	}
	
	trigger = {
		has_country_modifier = expelled_mages
		has_reform = magical_elite_reform
		has_estate = estate_nobles
	}
	
	#Strengthen Nobles
	option = {
		name = mage_organization.2.a
		ai_chance = {
			factor = 50
		}
		add_country_modifier = {
			name = magic_noble_reshuffle
			duration = 1825
		}
		add_government_reform = enforce_privileges_reform 
	}
	
	#Curtail Nobles
	option = {
		name = mage_organization.2.b
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0.5
				is_at_war = yes
			}
		}
		random_owned_province = {
			limit = {
				has_estate = estate_nobles
			}
			spawn_rebels = {
				size = 2
				leader = noble_zealot
				type = noble_rebels
			}
		}
		

		add_government_reform = quash_noble_power_reform 
	}
}

#Unban Magic Set Mage Organization
country_event = {
	id = mage_organization.3
	title = mage_organization.3.t
	desc = mage_organization.3.d
	picture = DHIMMI_ESTATE_eventPicture
	
	hidden = yes
	is_triggered_only = yes
	
	trigger = {
		has_mage_organization_privilege = no
		has_estate = estate_mages
		NOT = { has_country_flag = banned_magic }
	}
	
	option = {
		name = mage_organization.3.a
		if = {
			limit = {
				is_part_of_hre = yes
			}
			set_estate_privilege = estate_mages_organization_magisterium
		}
		else = {
			set_estate_privilege = estate_mages_organization_guilds
		}
	}
}