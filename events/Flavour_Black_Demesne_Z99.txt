namespace = black_demesne

##A new acolyte take the throne
country_event = {
	id = black_demesne.1
	title = black_demesne.1.t
	desc = black_demesne.1.d
	picture = COURT_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		tag = Z99
		any_subject_country = {
			is_subject_of_type = acolyte_dominion
			NOT = {
				calc_true_if = {
					all_known_country = {
						check_variable = {
							which = aInfluence
							which = PREV
						}
					}
					amount = 1
				}
			}
		}
	}
	
	immediate = {
		hidden_effect = {
			random_subject_country = {
				limit = { 
					is_subject_of_type = acolyte_dominion
					NOT = {
						calc_true_if = {
							all_known_country = {
								check_variable = {
									which = aInfluence
									which = PREV
								}
							}
							amount = 1
						}
					}
				}
				save_event_target_as = country
				set_country_flag = old_dominion
				exile_ruler_as = black_heir
			}
		}
	}
	
	option = {
		name = black_demesne.1.a
		ai_chance = { factor = 40 }
		set_ruler = black_heir
		add_ruler_modifier = {
			name = new_sorcerer_king
			duration = 3650
		}
	}
}

##The Demesne Expand
#Black Invasion
country_event = {
	id = black_demesne.2
	title = black_demesne.2.t
	desc = black_demesne.2.d
	picture = COURT_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		tag = Z99
	}
	
	immediate = {
		hidden_effect = {
			random_known_country = {
				limit = { has_country_flag = black_invasion_target }
				save_event_target_as = country
			}
		}
	}
	
	after = {
		hidden_effect = { event_target:country = { clr_country_flag = black_invasion_target } }
	}
	
	#Share the Lands as per your Land Distribution Law
	option = {
		name = black_demesne.2.a
		ai_chance = { factor = 40 }
		trigger = { calc_true_if = { all_subject_country = { is_subject_of_type = acolyte_dominion } amount = 1 } }
		hidden_effect = {
			set_variable = { nbProvBlack = 0 }
			REB = { set_variable = { nbProvBlack = 0 } }
			event_target:country = {
				every_subject_country = { grant_independence = yes }
				every_owned_province = {
					REB = { change_variable = { nbProvBlack = 1 } }
				}
			}
			REB = { ROOT = { set_variable = { which = nbProvBlack which = PREV } } }
			if = {
				limit = { has_estate_privilege = estate_acolytes_land_share_10 }
				multiply_variable = { nbProvBlack = 0.1 }
			}
			else_if = {
				limit = { has_estate_privilege = estate_acolytes_land_share_20 }
				multiply_variable = { nbProvBlack = 0.1 }
			}
			else_if = {
				limit = { has_estate_privilege = estate_acolytes_land_share_30 }
				multiply_variable = { nbProvBlack = 0.1 }
			}
			else_if = {
				limit = { has_estate_privilege = estate_acolytes_land_share_40 }
				multiply_variable = { nbProvBlack = 0.1 }
			}
			else_if = {
				limit = { has_estate_privilege = estate_acolytes_land_share_50 }
				multiply_variable = { nbProvBlack = 0.1 }
			}
			REB = { subtract_variable = { which = nbProvBlack which = ROOT } }
			while = {
				limit = { check_variable = { nbProvBlack = 0 } }
				subtract_variable = { nbProvBlack = 1 }
				event_target:country = {
					random_owned_province = {
						cede_province = ROOT
						remove_loot = { who = ROOT amount = 100 }
					}
				}
			}
			acolytes_land_distribution_effect = yes
			event_target:country = { every_owned_province = { cede_province = ROOT remove_loot = { who = ROOT amount = 100 } } }
		}
	}
	
	#Share the Lands but only for your acolyte
	option = {
		name = black_demesne.2.b
		ai_chance = { factor = 40 }
		trigger = { calc_true_if = { all_subject_country = { is_subject_of_type = acolyte_dominion } amount = 1 } }
		hidden_effect = {
			set_variable = { nbProvBlack = 0 }
			REB = { set_variable = { nbProvBlack = 0 } }
			event_target:country = {
				every_subject_country = { grant_independence = yes }
				every_owned_province = {
					REB = { change_variable = { nbProvBlack = 1 } }
				}
			}
			acolytes_land_distribution_effect = yes
			event_target:country = { every_owned_province = { cede_province = ROOT remove_loot = { who = ROOT amount = 100 } } }
		}
	}
	
	#Annex the Land
	option = {
		name = black_demesne.2.c
		ai_chance = { factor = 40 }
		if = {
			limit = { event_target:country = { total_development = 1000 } }
			every_subject_country = {
				limit = { is_subject_of_type = acolyte_dominion }
				add_liberty_desire = 100
			}
		}
		else_if = {
			limit = { event_target:country = { total_development = 900 } }
			every_subject_country = {
				limit = { is_subject_of_type = acolyte_dominion }
				add_liberty_desire = 90
			}
		}
		else_if = {
			limit = { event_target:country = { total_development = 800 } }
			every_subject_country = {
				limit = { is_subject_of_type = acolyte_dominion }
				add_liberty_desire = 80
			}
		}
		else_if = {
			limit = { event_target:country = { total_development = 700 } }
			every_subject_country = {
				limit = { is_subject_of_type = acolyte_dominion }
				add_liberty_desire = 70
			}
		}
		else_if = {
			limit = { event_target:country = { total_development = 600 } }
			every_subject_country = {
				limit = { is_subject_of_type = acolyte_dominion }
				add_liberty_desire = 60
			}
		}
		else_if = {
			limit = { event_target:country = { total_development = 500 } }
			every_subject_country = {
				limit = { is_subject_of_type = acolyte_dominion }
				add_liberty_desire = 50
			}
		}
		else_if = {
			limit = { event_target:country = { total_development = 400 } }
			every_subject_country = {
				limit = { is_subject_of_type = acolyte_dominion }
				add_liberty_desire = 40
			}
		}
		else_if = {
			limit = { event_target:country = { total_development = 300 } }
			every_subject_country = {
				limit = { is_subject_of_type = acolyte_dominion }
				add_liberty_desire = 30
			}
		}
		else_if = {
			limit = { event_target:country = { total_development = 200 } }
			every_subject_country = {
				limit = { is_subject_of_type = acolyte_dominion }
				add_liberty_desire = 20
			}
		}
		else_if = {
			limit = { event_target:country = { total_development = 100 } }
			every_subject_country = {
				limit = { is_subject_of_type = acolyte_dominion }
				add_liberty_desire = 10
			}
		}
		else_if = {
			limit = { event_target:country = { total_development = 0 } }
			every_subject_country = {
				limit = { is_subject_of_type = acolyte_dominion }
				add_liberty_desire = 5
			}
		}
		event_target:country = { ROOT = { inherit = PREV } }
	}
}

#The Apostle
country_event = {
	id = black_demesne.3
	title = black_demesne.3.t
	desc = black_demesne.3.d
	picture = COURT_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		always = yes
	}
	
	immediate = {
		hidden_effect = { set_country_flag = debug_menu }
		hidden_effect = {
			if = {
				limit = { ai = no }
				set_variable = { foo = 0 }
				export_to_variable = {
					which = foo
					value = years_of_income
				}
				multiply_variable = { foo = 0.03 }
				divide_variable = { foo = 1000 }
				multiply_variable = { foo = 1000 }
			}
		}
	}
	after = {
		hidden_effect = { clr_country_flag = debug_menu }
	}
	
	#Core
	option = {
		name = black_demesne.3.a
		ai_chance = { factor = 40 }
		custom_tooltip = the_apostle_tooltip
		while = {
			limit = {
				AND = {
					any_owned_province = {
						is_territory = yes
						AND = {
							NOT = { is_core = ROOT }
							NOT = { has_construction = core }
						}
					}
					adm_power = 50
				}
			}
			random_owned_province = {
				limit = { 
					is_territory = yes
					AND = {
						NOT = { is_core = ROOT }
						NOT = { has_construction = core }
					}
				}
				if = {
					limit = { ROOT = { ai = yes } }
					add_core_construction = {
						speed = 1.5
						cost = 0.5
					}
				}
				else = {
					add_core_construction = {
						speed = 2
						cost = 0.75
					}
				}
			}
			if = {
				limit = { ai = no }
				add_years_of_income = -0.03
			}
		}
	}
	
	#Go Back
	option = {
		name = black_demesne.3.b
		ai_chance = { factor = 0 }
	}
}

#Future of our Dominions
country_event = {
	id = black_demesne.4
	title = black_demesne.4.t
	desc = black_demesne.4.d
	picture = COURT_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		always = yes
	}
	
	immediate = {
		hidden_effect = {
			FROM = { save_event_target_as = country }
		}
	}
	
	#Share the Land
	option = {
		name = black_demesne.4.a
		ai_chance = { factor = 40 }
		trigger = { calc_true_if = { all_subject_country = { is_subject_of_type = acolyte_dominion } amount = 2 } }
		hidden_effect = {
			set_variable = { nbProvBlack = 0 }
			REB = { set_variable = { nbProvBlack = 0 } }
			event_target:country = {
				every_subject_country = { grant_independence = yes }
				every_owned_province = {
					REB = { change_variable = { nbProvBlack = 1 } }
				}
			}
			REB = { ROOT = { set_variable = { which = nbProvBlack which = PREV } } }
			if = {
				limit = { has_estate_privilege = estate_acolytes_land_share_10 }
				multiply_variable = { nbProvBlack = 0.1 }
			}
			else_if = {
				limit = { has_estate_privilege = estate_acolytes_land_share_20 }
				multiply_variable = { nbProvBlack = 0.1 }
			}
			else_if = {
				limit = { has_estate_privilege = estate_acolytes_land_share_30 }
				multiply_variable = { nbProvBlack = 0.1 }
			}
			else_if = {
				limit = { has_estate_privilege = estate_acolytes_land_share_40 }
				multiply_variable = { nbProvBlack = 0.1 }
			}
			else_if = {
				limit = { has_estate_privilege = estate_acolytes_land_share_50 }
				multiply_variable = { nbProvBlack = 0.1 }
			}
			REB = { subtract_variable = { which = nbProvBlack which = ROOT } }
			while = {
				limit = { check_variable = { nbProvBlack = 0 } }
				subtract_variable = { nbProvBlack = 1 }
				event_target:country = {
					random_owned_province = {
						cede_province = ROOT
						remove_loot = { who = ROOT amount = 100 }
						add_core = ROOT
					}
				}
			}
			acolytes_land_distribution_with_core_effect = yes
			event_target:country = { every_owned_province = { cede_province = ROOT add_core = ROOT remove_loot = { who = ROOT amount = 100 } } }
		}
	}
	
	#Split the Land
	option = {
		name = black_demesne.4.b
		ai_chance = { factor = 40 }
		trigger = { calc_true_if = { all_subject_country = { is_subject_of_type = acolyte_dominion } amount = 2 } }
		hidden_effect = {
			set_variable = { nbProvBlack = 0 }
			REB = { set_variable = { nbProvBlack = 0 } }
			event_target:country = {
				every_subject_country = { grant_independence = yes }
				every_owned_province = {
					REB = { change_variable = { nbProvBlack = 1 } }
				}
			}
			acolytes_land_distribution_with_core_effect = yes
			event_target:country = { every_owned_province = { cede_province = ROOT add_core = ROOT remove_loot = { who = ROOT amount = 100 } } }
		}
	}
	
	#Annex the Land
	option = {
		name = black_demesne.4.c
		ai_chance = { factor = 40 }
		if = {
			limit = { FROM = { total_development = 1000 } }
			every_subject_country = {
				limit = { is_subject_of_type = acolyte_dominion }
				add_liberty_desire = 100
			}
		}
		else_if = {
			limit = { FROM = { total_development = 900 } }
			every_subject_country = {
				limit = { is_subject_of_type = acolyte_dominion }
				add_liberty_desire = 90
			}
		}
		else_if = {
			limit = { FROM = { total_development = 800 } }
			every_subject_country = {
				limit = { is_subject_of_type = acolyte_dominion }
				add_liberty_desire = 80
			}
		}
		else_if = {
			limit = { FROM = { total_development = 700 } }
			every_subject_country = {
				limit = { is_subject_of_type = acolyte_dominion }
				add_liberty_desire = 70
			}
		}
		else_if = {
			limit = { FROM = { total_development = 600 } }
			every_subject_country = {
				limit = { is_subject_of_type = acolyte_dominion }
				add_liberty_desire = 60
			}
		}
		else_if = {
			limit = { FROM = { total_development = 500 } }
			every_subject_country = {
				limit = { is_subject_of_type = acolyte_dominion }
				add_liberty_desire = 50
			}
		}
		else_if = {
			limit = { FROM = { total_development = 400 } }
			every_subject_country = {
				limit = { is_subject_of_type = acolyte_dominion }
				add_liberty_desire = 40
			}
		}
		else_if = {
			limit = { FROM = { total_development = 300 } }
			every_subject_country = {
				limit = { is_subject_of_type = acolyte_dominion }
				add_liberty_desire = 30
			}
		}
		else_if = {
			limit = { FROM = { total_development = 200 } }
			every_subject_country = {
				limit = { is_subject_of_type = acolyte_dominion }
				add_liberty_desire = 20
			}
		}
		else_if = {
			limit = { FROM = { total_development = 100 } }
			every_subject_country = {
				limit = { is_subject_of_type = acolyte_dominion }
				add_liberty_desire = 10
			}
		}
		else_if = {
			limit = { FROM = { total_development = 0 } }
			every_subject_country = {
				limit = { is_subject_of_type = acolyte_dominion }
				add_liberty_desire = 5
			}
		}
		FROM = { ROOT = { inherit = PREV } }
	}
	
	#New Leader
	option = {
		name = black_demesne.4.e
		ai_chance = { factor = 40 }
		FROM = { 
			define_ruler = {  culture = black_demesner hide_skills = yes }
			hidden_effect = {
				divide_variable = { aInfluence = 2 }
			}
		}
		custom_tooltip = divide_influence_by_two_tooltip
	}
}


##################
#DEBUG EVENT
##################

#Influence Counter
country_event = {
	id = black_demesne.100
	title = black_demesne.100.t
	desc = black_demesne.100.d
	picture = COURT_eventPicture
	
	is_triggered_only = yes
	hidden = yes
	
	trigger = {
		tag = Z99
	}
	
	option = {		
		name = "black_demesne.1.a"
		ai_chance = { factor = 40 }
		REB = { set_variable = { aInfluence = 0 } }
		REB = { set_variable = { totalInfluence = 0 } }
		every_subject_country = {
			limit = { is_subject_of_type = acolyte_dominion }
			REB = {
				set_variable = {
					which = aInfluence
					which = PREV
				}
				change_variable = {
					which = totalInfluence
					which = aInfluence
				}
			}
		}
		if = {
			limit = { Z75 = { exists = yes is_subject_of_type = acolyte_dominion is_subject_of = Z99 } }
			REB = {
				Z75 = {
					set_variable = { which = percInfluence which = aInfluence }
					set_variable = { which = totalInfluence which = PREV }
					divide_variable = { which = percInfluence which = totalInfluence }
					multiply_variable = { percInfluence = 100 }
				}
			}
		}
		if = {
			limit = { Z76 = { exists = yes is_subject_of_type = acolyte_dominion is_subject_of = Z99 } }
			REB = {
				Z76 = { 
					set_variable = { which = percInfluence which = aInfluence }
					set_variable = { which = totalInfluence which = PREV }
					divide_variable = { which = percInfluence which = totalInfluence }
					multiply_variable = { percInfluence = 100 }
				}
			}
		}
		if = {
			limit = { Z77 = { exists = yes is_subject_of_type = acolyte_dominion is_subject_of = Z99 } }
			REB = {
				Z77 = { 
					set_variable = { which = percInfluence which = aInfluence }
					set_variable = { which = totalInfluence which = PREV }
					divide_variable = { which = percInfluence which = totalInfluence }
					multiply_variable = { percInfluence = 100 }
				}
			}
		}
		if = {
			limit = { Z78 = { exists = yes is_subject_of_type = acolyte_dominion is_subject_of = Z99 } }
			REB = {
				Z78 = { 
					set_variable = { which = percInfluence which = aInfluence }
					set_variable = { which = totalInfluence which = PREV }
					divide_variable = { which = percInfluence which = totalInfluence }
					multiply_variable = { percInfluence = 100 }
				}
			}
		}
		if = {
			limit = { Z79 = { exists = yes is_subject_of_type = acolyte_dominion is_subject_of = Z99 } }
			REB = {
				Z79 = { 
					set_variable = { which = percInfluence which = aInfluence }
					set_variable = { which = totalInfluence which = PREV }
					divide_variable = { which = percInfluence which = totalInfluence }
					multiply_variable = { percInfluence = 100 }
				}
			}
		}
		if = {
			limit = { Z80 = { exists = yes is_subject_of_type = acolyte_dominion is_subject_of = Z99 } }
			REB = {
				Z80 = { 
					set_variable = { which = percInfluence which = aInfluence }
					set_variable = { which = totalInfluence which = PREV }
					divide_variable = { which = percInfluence which = totalInfluence }
					multiply_variable = { percInfluence = 100 }
				}
			}
		}
		if = {
			limit = { Z81 = { exists = yes is_subject_of_type = acolyte_dominion is_subject_of = Z99 } }
			REB = {
				Z81 = { 
					set_variable = { which = percInfluence which = aInfluence }
					set_variable = { which = totalInfluence which = PREV }
					divide_variable = { which = percInfluence which = totalInfluence }
					multiply_variable = { percInfluence = 100 }
				}
			}
		}
		if = {
			limit = { Z82 = { exists = yes is_subject_of_type = acolyte_dominion is_subject_of = Z99 } }
			REB = {
				Z82 = { 
					set_variable = { which = percInfluence which = aInfluence }
					set_variable = { which = totalInfluence which = PREV }
					divide_variable = { which = percInfluence which = totalInfluence }
					multiply_variable = { percInfluence = 100 }
				}
			}
		}
		if = {
			limit = { Z83 = { exists = yes is_subject_of_type = acolyte_dominion is_subject_of = Z99 } }
			REB = {
				Z83 = { 
					set_variable = { which = percInfluence which = aInfluence }
					set_variable = { which = totalInfluence which = PREV }
					divide_variable = { which = percInfluence which = totalInfluence }
					multiply_variable = { percInfluence = 100 }
				}
			}
		}
		if = {
			limit = { Z84 = { exists = yes is_subject_of_type = acolyte_dominion is_subject_of = Z99 } }
			REB = {
				Z84 = { 
					set_variable = { which = percInfluence which = aInfluence }
					set_variable = { which = totalInfluence which = PREV }
					divide_variable = { which = percInfluence which = totalInfluence }
					multiply_variable = { percInfluence = 100 }
				}
			}
		}
		if = {
			limit = { Z85 = { exists = yes is_subject_of_type = acolyte_dominion is_subject_of = Z99 } }
			REB = {
				Z85 = { 
					set_variable = { which = percInfluence which = aInfluence }
					set_variable = { which = totalInfluence which = PREV }
					divide_variable = { which = percInfluence which = totalInfluence }
					multiply_variable = { percInfluence = 100 }
				}
			}
		}
		if = {
			limit = { Z86 = { exists = yes is_subject_of_type = acolyte_dominion is_subject_of = Z99 } }
			REB = {
				Z86 = { 
					set_variable = { which = percInfluence which = aInfluence }
					set_variable = { which = totalInfluence which = PREV }
					divide_variable = { which = percInfluence which = totalInfluence }
					multiply_variable = { percInfluence = 100 }
				}
			}
		}
	}
}