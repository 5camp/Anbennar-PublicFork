namespace = shadow_pact

#Roll random Portent
country_event = {
	id = shadow_pact.1
	title = shadow_pact.1.t
	desc = shadow_pact.1.d
	picture = DIPLOMACY_eventPicture
	
	is_triggered_only = yes
	hidden = yes
	
	trigger = {
	}
			
	option = {
		name = shadow_pact.1.a
		shadow_pact_remove_last_set = yes
		clr_country_flag = shadow_pact_rerolling
		if = {
			limit = {
				calc_true_if = {
					amount = 2
					shadow_pact_portents = yes
				}
			}
			set_country_flag = shadow_pact_third_portent
			shadow_pact_random_portent = yes
			add_church_power = -75
		}
		else_if = {
			limit = {
				calc_true_if = {
					amount = 1
					shadow_pact_portents = yes
				}
			}
			set_country_flag = shadow_pact_second_portent
			shadow_pact_random_portent = yes
			add_church_power = -75
		}
		else = {
			set_country_flag = shadow_pact_first_portent
			shadow_pact_random_portent = yes
			add_church_power = -75
		}
	}
}

#Re-roll last rolled Portent
country_event = {
	id = shadow_pact.2
	title = shadow_pact.2.t
	desc = shadow_pact.2.d
	picture = DIPLOMACY_eventPicture
	
	is_triggered_only = yes
	hidden = yes
	
	trigger = {
	}
	
	option = {
		name = shadow_pact.2.a
		set_country_flag = shadow_pact_rerolling
		if = {
			limit = {
				has_country_flag = last_set_sorcerer
				has_church_aspect = shadow_pact_sorcerer
			}
			remove_church_aspect = shadow_pact_sorcerer
			shadow_pact_random_portent = yes
		}
		if = {
			limit = {
				has_country_flag = last_set_wraith
				has_church_aspect = shadow_pact_wraith
			}
			remove_church_aspect = shadow_pact_wraith
			shadow_pact_random_portent = yes
		}
		if = {
			limit = {
				has_country_flag = last_set_three_urns
				has_church_aspect = shadow_pact_three_urns
			}
			remove_church_aspect = shadow_pact_three_urns
			shadow_pact_random_portent = yes
		}
		if = {
			limit = {
				has_country_flag = last_set_silat
				has_church_aspect = shadow_pact_silat
			}
			remove_church_aspect = shadow_pact_silat
			shadow_pact_random_portent = yes
		}
		if = {
			limit = {
				has_country_flag = last_set_tree
				has_church_aspect = shadow_pact_tree
			}
			remove_church_aspect = shadow_pact_tree
			shadow_pact_random_portent = yes
		}
		if = {
			limit = {
				has_country_flag = last_set_flame
				has_church_aspect = shadow_pact_flame
			}
			remove_church_aspect = shadow_pact_flame
			shadow_pact_random_portent = yes
		}
		if = {
			limit = {
				has_country_flag = last_set_flayed_man
				has_church_aspect = shadow_pact_flayed_man
			}
			remove_church_aspect = shadow_pact_flayed_man
			shadow_pact_random_portent = yes
		}
		if = {
			limit = {
				has_country_flag = last_set_meteor
				has_church_aspect = shadow_pact_meteor
			}
			remove_church_aspect = shadow_pact_meteor
			shadow_pact_random_portent = yes
		}
		if = {
			limit = {
				has_country_flag = last_set_tyrant
				has_church_aspect = shadow_pact_tyrant
			}
			remove_church_aspect = shadow_pact_tyrant
			shadow_pact_random_portent = yes
		}
		if = {
			limit = {
				has_country_flag = last_set_sleeper
				has_church_aspect = shadow_pact_sleeper
			}
			remove_church_aspect = shadow_pact_sleeper
			shadow_pact_random_portent = yes
		}
		if = {
			limit = {
				has_country_flag = last_set_burden
				has_church_aspect = shadow_pact_burden
			}
			remove_church_aspect = shadow_pact_burden
			shadow_pact_random_portent = yes
		}
		if = {
			limit = {
				has_country_flag = last_set_time
				has_church_aspect = shadow_pact_time
			}
			remove_church_aspect = shadow_pact_time
			shadow_pact_random_portent = yes
		}
		if = {
			limit = {
				has_country_flag = last_set_defiant
				has_church_aspect = shadow_pact_defiant
			}
			remove_church_aspect = shadow_pact_defiant
			shadow_pact_random_portent = yes
		}
		if = {
			limit = {
				has_country_flag = last_set_madness
				has_church_aspect = shadow_pact_madness
			}
			remove_church_aspect = shadow_pact_madness
			shadow_pact_random_portent = yes
		}
		if = {
			limit = {
				has_country_flag = last_set_golem
				has_church_aspect = shadow_pact_golem
			}
			remove_church_aspect = shadow_pact_golem
			shadow_pact_random_portent = yes
		}
		if = {
			limit = {
				has_country_flag = last_set_vulture
				has_church_aspect = shadow_pact_vulture
			}
			remove_church_aspect = shadow_pact_vulture
			shadow_pact_random_portent = yes
		}
		if = {
			limit = {
				has_country_flag = last_set_mother
				has_church_aspect = shadow_pact_mother
			}
			remove_church_aspect = shadow_pact_mother
			shadow_pact_random_portent = yes
		}
		shadow_pact_remove_last_set = yes
	}
}

country_event = {
	id = shadow_pact.2
	title = shadow_pact.2.t
	desc = shadow_pact.2.d
	picture = DIPLOMACY_eventPicture
	
	is_triggered_only = yes
	hidden = yes
	
	trigger = {
	}
			
	option = {
		name = shadow_pact.2.a
		set_country_flag = shadow_pact_rerolling
		if = {
			limit = {
				has_church_aspect = shadow_pact_sorcerer
			}
			remove_church_aspect = shadow_pact_sorcerer
			shadow_pact_random_portent = yes
		}
		if = {
			limit = {
				has_country_flag = last_set_wraith
				has_church_aspect = shadow_pact_wraith
			}
			remove_church_aspect = shadow_pact_wraith
			shadow_pact_random_portent = yes
		}
		if = {
			limit = {
				has_country_flag = last_set_three_urns
				has_church_aspect = shadow_pact_three_urns
			}
			remove_church_aspect = shadow_pact_three_urns
			shadow_pact_random_portent = yes
		}
		if = {
			limit = {
				has_country_flag = last_set_silat
				has_church_aspect = shadow_pact_silat
			}
			remove_church_aspect = shadow_pact_silat
			shadow_pact_random_portent = yes
		}
		if = {
			limit = {
				has_country_flag = last_set_tree
				has_church_aspect = shadow_pact_tree
			}
			remove_church_aspect = shadow_pact_tree
			shadow_pact_random_portent = yes
		}
		if = {
			limit = {
				has_country_flag = last_set_flame
				has_church_aspect = shadow_pact_flame
			}
			remove_church_aspect = shadow_pact_flame
			shadow_pact_random_portent = yes
		}
		if = {
			limit = {
				has_country_flag = last_set_flayed_man
				has_church_aspect = shadow_pact_flayed_man
			}
			remove_church_aspect = shadow_pact_flayed_man
			shadow_pact_random_portent = yes
		}
		if = {
			limit = {
				has_country_flag = last_set_meteor
				has_church_aspect = shadow_pact_meteor
			}
			remove_church_aspect = shadow_pact_meteor
			shadow_pact_random_portent = yes
		}
		if = {
			limit = {
				has_country_flag = last_set_tyrant
				has_church_aspect = shadow_pact_tyrant
			}
			remove_church_aspect = shadow_pact_tyrant
			shadow_pact_random_portent = yes
		}
		if = {
			limit = {
				has_country_flag = last_set_sleeper
				has_church_aspect = shadow_pact_sleeper
			}
			remove_church_aspect = shadow_pact_sleeper
			shadow_pact_random_portent = yes
		}
		if = {
			limit = {
				has_country_flag = last_set_burden
				has_church_aspect = shadow_pact_burden
			}
			remove_church_aspect = shadow_pact_burden
			shadow_pact_random_portent = yes
		}
		if = {
			limit = {
				has_country_flag = last_set_time
				has_church_aspect = shadow_pact_time
			}
			remove_church_aspect = shadow_pact_time
			shadow_pact_random_portent = yes
		}
		if = {
			limit = {
				has_country_flag = last_set_defiant
				has_church_aspect = shadow_pact_defiant
			}
			remove_church_aspect = shadow_pact_defiant
			shadow_pact_random_portent = yes
		}
		if = {
			limit = {
				has_country_flag = last_set_madness
				has_church_aspect = shadow_pact_madness
			}
			remove_church_aspect = shadow_pact_madness
			shadow_pact_random_portent = yes
		}
		if = {
			limit = {
				has_country_flag = last_set_golem
				has_church_aspect = shadow_pact_golem
			}
			remove_church_aspect = shadow_pact_golem
			shadow_pact_random_portent = yes
		}
		if = {
			limit = {
				has_country_flag = last_set_vulture
				has_church_aspect = shadow_pact_vulture
			}
			remove_church_aspect = shadow_pact_vulture
			shadow_pact_random_portent = yes
		}
		if = {
			limit = {
				has_country_flag = last_set_mother
				has_church_aspect = shadow_pact_mother
			}
			remove_church_aspect = shadow_pact_mother
			shadow_pact_random_portent = yes
		}
		shadow_pact_remove_last_set = yes
	}
}

#Ritual
country_event = {
	id = shadow_pact.3
	title = shadow_pact.3.t
	desc = shadow_pact.3.d
	picture = DIPLOMACY_eventPicture
	
	is_triggered_only = yes
	hidden = yes
	
	trigger = {
	}
	
	option = {
		name = shadow_pact.2.a
		set_country_flag = shadow_pact_rerolling
		if = {
			limit = {
				has_country_flag = shadow_pact_sorcerer_active
			}
			custom_tooltip = shadow_pact_sorcerer_ritual_tt
			add_yearly_manpower = -1
			custom_tooltip = shadow_pact_sorcerer_effect_tt
		}
		if = {
			limit = {
				has_country_flag = shadow_pact_wraith_active
			}
			custom_tooltip = shadow_pact_wraith_ritual_tt
			add_army_tradition = -15
			add_country_modifier = { 
				name = shadow_pact_wraith_mod
				duration = 7300
			}
		}
		if = {
			limit = {
				has_country_flag = shadow_pact_three_urns_active
			}
			custom_tooltip = shadow_pact_three_urns_ritual_tt
			custom_tooltip = shadow_pact_three_urns_effect_tt
			hidden_effect = {
				shadow_pact_three_urns_effect = yes
			}
			add_country_modifier = { 
				name = shadow_pact_three_urns_mod
				duration = 7300
			}
		}
		if = {
			limit = {
				has_country_flag = shadow_pact_silat_active
			}
			custom_tooltip = shadow_pact_silat_ritual_tt
			add_adm_power = 100
			add_dip_power = 100
			add_mil_power = 100
			add_country_modifier = { 
				name = shadow_pact_silat_mod
				duration = 7300
			}
		}
		if = {
			limit = {
				has_country_flag = shadow_pact_tree_active
			}
			custom_tooltip = shadow_pact_tree_ritual_tt
			custom_tooltip = shadow_pact_tree_effect_tt
			hidden_effect = {
				shadow_pact_tree_effect = yes
			}
			add_country_modifier = { 
				name = shadow_pact_tree_mod
				duration = 7300
			}
		}
		if = {
			limit = {
				has_country_flag = shadow_pact_flame_active
			}
			custom_tooltip = shadow_pact_flame_ritual_tt
			add_stability = 1
			add_corruption = 2
		}
		if = {
			limit = {
				has_country_flag = shadow_pact_flayed_man_active
			}
			custom_tooltip = shadow_pact_flayed_man_ritual_tt
			add_country_modifier = { 
				name = shadow_pact_flayed_man_mod
				duration = 7300
			}
		}
		if = {
			limit = {
				has_country_flag = shadow_pact_meteor_active
			}
			custom_tooltip = shadow_pact_meteor_ritual_tt
			random_list = { #50% chance to gain or lose stab
			50 = { add_stability = 1 }
			50 = { add_stability = -1 }
		}
		}
		if = {
			limit = {
				has_country_flag = shadow_pact_tyrant_active
			}
			custom_tooltip = shadow_pact_tyrant_ritual_tt
			add_country_modifier = { 
				name = shadow_pact_tyrant_mod
				duration = 7300
			}
		}
		if = {
			limit = {
				has_country_flag = shadow_pact_sleeper_active
			}
			custom_tooltip = shadow_pact_sleeper_ritual_tt
			add_adm_power = -25
			add_dip_power = -25
			add_mil_power = -25
			change_innovativeness = 3
			# capital_scope = {
			# 	if = {
			# 		limit = {  }
			# 	}
			# }
		}
		if = {
			limit = {
				has_country_flag = shadow_pact_burden_active
			}
			custom_tooltip = shadow_pact_burden_ritual_tt
			add_years_of_income = 1.5
			add_country_modifier = { 
				name = shadow_pact_burden_mod
				duration = 7300
			}
		}
		if = {
			limit = {
				has_country_flag = shadow_pact_time_active
			}
			custom_tooltip = shadow_pact_time_ritual_tt
			custom_tooltip = shadow_pact_time_effect_tt
		}
		if = {
			limit = {
				has_country_flag = shadow_pact_defiant_active
			}
			custom_tooltip = shadow_pact_defiant_ritual_tt
			add_country_modifier = { 
				name = shadow_pact_defiant_mod
				duration = 7300
			}
		}
		if = {
			limit = {
				has_country_flag = shadow_pact_madness_active
			}
			custom_tooltip = shadow_pact_madness_ritual_tt
			add_yearly_manpower = 1
			add_country_modifier = { 
				name = shadow_pact_madness_mod
				duration = 7300
			}
		}
		if = {
			limit = {
				has_country_flag = shadow_pact_golem_active
			}
			custom_tooltip = shadow_pact_golem_ritual_tt
			add_country_modifier = { 
				name = shadow_pact_golem_mod
				duration = 7300
			}
		}
		if = {
			limit = {
				has_country_flag = shadow_pact_vulture_active
			}
			custom_tooltip = shadow_pact_vulture_ritual_tt
			add_war_exhaustion = 2
			add_country_modifier = { 
				name = shadow_pact_vulture_mod
				duration = 7300
			}
		}
		if = {
			limit = {
				has_country_flag = shadow_pact_mother_active
			}
			custom_tooltip = shadow_pact_mother_ritual_tt
			add_prestige = -30
		}
		hidden_effect = {
			shadow_pact_remove_last_set = yes
			shadow_pact_remove_portent_flags = yes
		}
	}
}