namespace = theatre_of_attrition


### Kobold Traps Setup Events
# Build the Traps! (Region Choice)
country_event = {
	id = theatre_of_attrition.1
	title = theatre_of_attrition.1.title
	desc = theatre_of_attrition.1.desc
	picture = RELIGION_eventPicture #Change this

	is_triggered_only = yes

	option = {
		name = theatre_of_attrition.1.a
		trigger = {
			any_owned_province = {
				province_group = kobold_traps_provinces
				region = dragon_coast_region
				kobold_traps_individual_trigger = yes
			}
		}
		country_event = { id = theatre_of_attrition.2 }
	}
	option = {
		name = theatre_of_attrition.1.b
		trigger = {
			any_owned_province = {
				province_group = kobold_traps_provinces
				OR = {
					region = alenic_frontier_region
					region = alenic_reach_region
				}
				kobold_traps_individual_trigger = yes
			}
		}
	}
	option = {
		name = theatre_of_attrition.1.c
		trigger = {
			any_owned_province = {
				province_group = kobold_traps_provinces
				OR = {
					region = lencenor_region
					region = small_country_region
				}
				kobold_traps_individual_trigger = yes
			}
		}
	}
	option = {
		name = theatre_of_attrition.1.d
		trigger = {
			any_owned_province = {
				province_group = kobold_traps_provinces
				OR = {
					region = damescrown_region
					region = west_dameshead_region
				}
				kobold_traps_individual_trigger = yes
			}
		}
	}
	option = {
		name = theatre_of_attrition.1.e
		if = { #if you have a free traps from event, don't give manpower back
			limit = { has_country_flag = free_kobold_traps }
			clr_country_flag = emergency_traps_happening
		}
		else_if = { #free traps from defensive war
			limit = { 
				AND = {
					is_in_war = {
						defenders = ROOT
					}
					is_great_power = no
				}
			}
			remove_country_modifier = kobold_traps_normal_cooldown
			clr_country_flag = normal_traps_happening
		}
		else = { # else, give manpower back
			remove_country_modifier = kobold_traps_normal_cooldown
			add_yearly_manpower = 1
			clr_country_flag = normal_traps_happening
		}
	}
}

# Build the traps! (Dragon Coast)
country_event = {
	id = theatre_of_attrition.2
	title = theatre_of_attrition.2.title
	desc = theatre_of_attrition.2.desc
	picture = RELIGION_eventPicture #Change this

	is_triggered_only = yes

	option = {
		name = theatre_of_attrition.2.a
		trigger = {
			126 = { 
				owned_by = ROOT 
				kobold_traps_individual_trigger = yes
			}
		}
		goto = 126
		kobold_trap_mastery_effect = yes
		126 = {
			create_kobold_traps = yes
		}
	}
	option = {
		name = theatre_of_attrition.2.b
		trigger = {
			140 = { 
				owned_by = ROOT 
				kobold_traps_individual_trigger = yes
			}
		}
		goto = 140
		kobold_trap_mastery_effect = yes
		140 = {
			create_kobold_traps = yes
		}
	}
	option = {
		name = theatre_of_attrition.2.c
		trigger = {
			146 = { 
				owned_by = ROOT 
				kobold_traps_individual_trigger = yes
			}
		}
		goto = 146
		kobold_trap_mastery_effect = yes
		146 = {
			create_kobold_traps = yes
		}
	}
	option = {
		name = theatre_of_attrition.2.d
		trigger = {
			167 = { 
				owned_by = ROOT 
				kobold_traps_individual_trigger = yes
			}
		}
		goto = 167
		kobold_trap_mastery_effect = yes
		167 = {
			create_kobold_traps = yes
		}
	}
	option = {
		name = theatre_of_attrition.2.e
		trigger = {
			173 = { 
				owned_by = ROOT 
				kobold_traps_individual_trigger = yes
			}
		}
		goto = 173
		kobold_trap_mastery_effect = yes
		173 = {
			create_kobold_traps = yes
		}
	}
	option = {
		name = theatre_of_attrition.2.f
		trigger = {
			177 = { 
				owned_by = ROOT 
				kobold_traps_individual_trigger = yes
			}
		}
		kobold_trap_mastery_effect = yes
		goto = 177
		177 = {
			create_kobold_traps = yes
		}
	}
	option = {
		name = theatre_of_attrition.2.g
		trigger = {
			184 = { 
				owned_by = ROOT 
				kobold_traps_individual_trigger = yes
			}
		}
		kobold_trap_mastery_effect = yes
		goto = 184
		184 = {
			create_kobold_traps = yes
		}
	}
	option = {
		name = theatre_of_attrition.2.h
		trigger = {
			187 = { 
				owned_by = ROOT 
				kobold_traps_individual_trigger = yes
			}
		}
		kobold_trap_mastery_effect = yes
		goto = 187
		187 = {
			create_kobold_traps = yes
		}
	}
	option = {
		name = theatre_of_attrition.2.i
		trigger = {
			189 = { 
				owned_by = ROOT 
				kobold_traps_individual_trigger = yes
			}
		}
		goto = 189
		kobold_trap_mastery_effect = yes
		189 = {
			create_kobold_traps = yes
		}
	}
	option = {
		name = theatre_of_attrition.2.j
		trigger = {
			213 = { 
				owned_by = ROOT 
				kobold_traps_individual_trigger = yes
			}
		}
		goto = 213
		kobold_trap_mastery_effect = yes
		213 = {
			create_kobold_traps = yes
		}
	}
	option = {
		name = theatre_of_attrition.2.k
		trigger = {
			4646 = { 
				owned_by = ROOT 
				kobold_traps_individual_trigger = yes
			}
		}
		goto = 4646
		kobold_trap_mastery_effect = yes
		4646 = {
			create_kobold_traps = yes
		}
	}
	option = {
		name = theatre_of_attrition.1.e
		country_event = { id = theatre_of_attrition.1 }
	}
}


# Event 3: Alenic Frontier and Reach

# Event 4: Lencenor and Small Country

# Event 5: Dameshead

province_event = { # Our trap exploded!
	id = theatre_of_attrition.6
	title = theatre_of_attrition.6.title
	desc = theatre_of_attrition.6.desc
	picture = RELIGION_eventPicture #Change this
	goto = ROOT
	is_triggered_only = yes

	immediate = {
		ROOT = {
			hidden_effect = {
				save_event_target_as = trapped_province_exploding
				controller = {
					country_event = { id = theatre_of_attrition.7 }
				}
				kill_units = {
					who = controller
					type = infantry
					amount = 4
				}
				if = {
					limit = { has_province_modifier = kobold_traps_lvl_4 }
					remove_province_modifier = kobold_traps_lvl_4
				}
				else_if = {
					limit = { has_province_modifier = kobold_traps_lvl_3 }
					remove_province_modifier = kobold_traps_lvl_3
				}
				else_if = {
					limit = { has_province_modifier = kobold_traps_lvl_2 }
					remove_province_modifier = kobold_traps_lvl_2
				}
				else = {
					remove_province_modifier = kobold_traps_lvl_1
				}	
				hidden_effect = { clr_province_flag = has_kobold_traps }
				if = {
					limit = { has_building = fort_15th }
					remove_building = fort_15th
				}		
				else_if = {
					limit = { has_building = fort_16th }
					remove_building = fort_16th
				}	
				else_if = {
					limit = { has_building = fort_17th }
					remove_building = fort_17th
				}		
				else_if = {
					limit = { has_building = fort_18th }
					remove_building = fort_18th
				}
			}
		}
	}
	option = {
		name = theatre_of_attrition.6.a
		goto = trapped_province_exploding
		custom_tooltip = trap_exploded_tt
	}
}

country_event = { # Our enemy's trap exploded!
	id = theatre_of_attrition.7
	title = theatre_of_attrition.7.title
	desc = theatre_of_attrition.7.desc
	picture = RELIGION_eventPicture #Change this
	goto = trapped_province_exploding
	is_triggered_only = yes

	option = {
		name = theatre_of_attrition.7.a
		goto = trapped_province_exploding
		custom_tooltip = trap_exploded_tt
	}
}