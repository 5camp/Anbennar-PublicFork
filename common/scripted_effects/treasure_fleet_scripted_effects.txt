
JY_LF_clear_pirate_choice = {
	clr_global_flag = JY_LF_P_bribe
	clr_global_flag = JY_LF_P_sneak
	clr_global_flag = JY_LF_P_fight
	clr_global_flag = JY_LF_P_nah
	clr_global_flag = JY_LF_P_bribe_2
	clr_global_flag = JY_LF_P_sneak_2
	clr_global_flag = JY_LF_P_fight_2
	clr_global_flag = JY_LF_P_met
}

JY_LF_clear_pirate_status = {
	clr_global_flag = JY_LF_P_weak
	clr_global_flag = JY_LF_P_weaker
}

JY_LF_tuuchuweg_check = {
	if = {
		limit = { 
			4990 = { 
				is_city = yes
				owner = { NOT = { has_country_flag = JY_LF_tuuchuweg_checked } }
			}
		}
		4990 = { 
			province_event = { id = treasurefleet.3 days = 50 }
			owner = { set_country_flag = JY_LF_tuuchuweg_checked }
		}
	}
}

#JY_LF_somyonghon_check = {
#	if = {
#		limit = { NOT = { has_global_flag = JY_LF_somyonghon_caught_first } }
#		
#	}
#}

JY_LF_damage_ship = {
	custom_tooltip = JY_LF_damage
	if = {
		limit = { has_global_flag = JY_LF_damage_4 }
		set_global_flag = JY_LF_damage_5
	}
	else_if = {
		limit = { has_global_flag = JY_LF_damage_3 }
		set_global_flag = JY_LF_damage_4
	}
	else_if = {
		limit = { has_global_flag = JY_LF_damage_2 }
		set_global_flag = JY_LF_damage_3
	}
	else_if = {
		limit = { has_global_flag = JY_LF_damage_1 }
		set_global_flag = JY_LF_damage_2
	}
	else = {
		set_global_flag = JY_LF_damage_1
	}
}

#Takes away money for how much damage was sustained.
JY_LF_clear_damage = {
	if = {
		limit = { has_global_flag = JY_LF_damage_5 }
		custom_tooltip = JY_LF_damaged
		add_treasury = -75
	}
	else_if = {
		limit = { has_global_flag = JY_LF_damage_4 }
		custom_tooltip = JY_LF_damaged
		add_treasury = -60
	}
	else_if = {
		limit = { has_global_flag = JY_LF_damage_3 }
		custom_tooltip = JY_LF_damaged
		add_treasury = -45
	}
	else_if = {
		limit = { has_global_flag = JY_LF_damage_2 }
		custom_tooltip = JY_LF_damaged
		add_treasury = -30
	}
	else_if = {
		limit = { has_global_flag = JY_LF_damage_1 }
		custom_tooltip = JY_LF_damaged
		add_treasury = -15
	}
	else = {
		custom_tooltip = JY_LF_not_damaged
	}
	clr_global_flag = JY_LF_damage_1
	clr_global_flag = JY_LF_damage_2
	clr_global_flag = JY_LF_damage_3
	clr_global_flag = JY_LF_damage_4
	clr_global_flag = JY_LF_damage_5
}

JY_LF_trade = {
	add_province_modifier = {
		name = JY_LF_trading
		duration = 30
	}
}

JY_LF_clear_visited = {
	every_province = {
		limit = { has_province_modifier = JY_LF_visited }
		remove_province_modifier = JY_LF_visited
	}
}


#For a port to be included in the Fleet's trip, it's ID needs to be in the sequence below. It will then be visited if it also has the province modifier.
#This effect IS the route the Fleet follows once it passes Somyonghon.
#Scripted effect does not work, see treasurefleet.90
JY_LF_next_port = {
	if = { #Buogoj, closed at start
		limit = {
			5356 = {
				has_province_modifier = JY_LF_port
				NOT = { has_province_modifier = JY_LF_visited }
			}
		}
		5356 = { JY_LF_visitation = yes }
	}
	else_if = { #Jiantsang, first stop at game start
		limit = {
			4925 = {
				has_province_modifier = JY_LF_port
				NOT = { has_province_modifier = JY_LF_visited }
			}
		}
		4925 = { JY_LF_visitation = yes }
	}
	else_if = { #Beikdugang, loves them
		limit = {
			4907 = {
				has_province_modifier = JY_LF_port
				NOT = { has_province_modifier = JY_LF_visited }
			}
		}
		4907 = { JY_LF_visitation = yes }
	}
	else_if = { #Tianlou, river trade
		limit = {
			4871 = {
				has_province_modifier = JY_LF_port
				NOT = { has_province_modifier = JY_LF_visited }
			}
		}
		4871 = { JY_LF_visitation = yes }
	}
	else_if = { #Feiten
		limit = {
			4879 = {
				has_province_modifier = JY_LF_port
				NOT = { has_province_modifier = JY_LF_visited }
			}
		}
		4879 = { JY_LF_visitation = yes }
	}
	else_if = { #Cuihiok, former Zyujyut capital
		limit = {
			4884 = {
				has_province_modifier = JY_LF_port
				NOT = { has_province_modifier = JY_LF_visited }
			}
		}
		4884 = { JY_LF_visitation = yes }
	}
	else_if = { #Zyugok, current Zyujyut capital
		limit = {
			4839 = {
				has_province_modifier = JY_LF_port
				NOT = { has_province_modifier = JY_LF_visited }
			}
		}
		4839 = { JY_LF_visitation = yes }
	}
	else_if = { #Keoaden, has dwarves. Last stop if ruler said to avoid pirates.
		limit = {
			4955 = {
				has_province_modifier = JY_LF_port
				NOT = { has_province_modifier = JY_LF_visited }
			}
		}
		4955 = { JY_LF_visitation = yes }
	}
	else_if = { #Note this else if covers every stop past and including the pirates.
		limit = { NOT = { has_global_flag = JY_LF_P_nah } } #Fleet goes home here if ordered to not interact with pirates at start.
		if = {
			limit = { NOT = { has_global_flag = JY_LF_P_met } }
			4773 = { province_event = { id = treasurefleet.9 } } #Meijyun, province irrelevant it is Pinghoi tag that represents local pirates.
		}
		else_if = { #Arawkelin, last stop normally.
			limit = {
				4963 = {
					has_province_modifier = JY_LF_port
					NOT = { has_province_modifier = JY_LF_visited }
				}
			}
			4963 = { JY_LF_visitation = yes }
		}
		else_if = { #Cay Sam Sinh, biggest not Rahen port
			limit = {
				4701 = {
					has_province_modifier = JY_LF_port
					NOT = { has_province_modifier = JY_LF_visited }
				}
			}
			4701 = { JY_LF_visitation = yes }
		}
		else_if = { #Prukakhim, wannabe pirates
			limit = {
				4570 = {
					has_province_modifier = JY_LF_port
					NOT = { has_province_modifier = JY_LF_visited }
				}
			}
			4570 = { JY_LF_visitation = yes }
		}
		else_if = { #Sramaya, biggest rahen port (if not biggest haless port)
			limit = {
				4420 = {
					has_province_modifier = JY_LF_port
					NOT = { has_province_modifier = JY_LF_visited }
				}
			}
			4420 = { JY_LF_visitation = yes }
		}
		else_if = { #Sarkhashabid
			limit = {
				4367 = {
					has_province_modifier = JY_LF_port
					NOT = { has_province_modifier = JY_LF_visited }
				}
			}
			4367 = { JY_LF_visitation = yes }
		}
	}
	else = {
		5226 = { province_event = { id = treasurefleet.100 days = 120 } } #Go home
	}
}

#This decides what happens when the fleet visits a port.
#Scripted effect does not work, see treasurefleet.91
JY_LF_visitation = {
	random_list = {
		50 = { #Normal Encounter
			THIS = { province_event = { id = treasurefleet.8 days = 25 } }
		}
		50 = { #Flavor Encounter (WIP)
			THIS = { province_event = { id = treasurefleet.8 days = 25 } }
		}
	}
}

#Tells Zurkanrek's owner what happened with the Pirates when the Fleet gets back
JY_LF_pirate_status = {
	if = {
		limit = { has_global_flag = JY_LF_P_weak }
		custom_tooltip = JY_LF_P_weak_t
	}
	if = {
		limit = { has_global_flag = JY_LF_P_weaker }
		custom_tooltip = JY_LF_P_weaker_t
	}
	if = {
		limit = { has_global_flag = JY_LF_bribed_P }
		custom_tooltip = JY_LF_bribed_P_t
		clr_global_flag = JY_LF_bribed_P
		add_treasury = -25
	}
	if = {
		limit = { has_global_flag = JY_LF_snuck_P }
		custom_tooltip = JY_LF_snuck_P_t
		clr_global_flag = JY_LF_snuck_P
	}
	if = {
		limit = { has_global_flag = JY_LF_caught_P }
		custom_tooltip = JY_LF_caught_P_t
		add_treasury = -40
		clr_global_flag = JY_LF_caught_P
	}
	if = {
		limit = { has_global_flag = JY_LF_beat_P }
		custom_tooltip = JY_LF_beat_P_t
		clr_global_flag = JY_LF_beat_P
	}
	if = {
		limit = { has_global_flag = JY_LF_lost_P }
		custom_tooltip = JY_LF_lost_P_t
		clr_global_flag = JY_LF_lost_P
	}
}

#How much money per port the Fleet gets
JY_LF_calculate_yield = {
	set_variable = {
		which = JY_LF_yield
		value = 15
	}
	if = {
		limit = { is_year = 1500 }
		change_variable = {
			which = JY_LF_yield
			value = 5
		}
	}
	if = {
		limit = { owner = { tag = J33 } }
		multiply_variable = {
			which = JY_LF_yield
			value = 2
		}
	}
}

#How much money the Fleet gets total
JY_LF_calculate_total = {
	#hidden_effect = {
		set_variable = {
			which = JY_LF_total
			which = JY_LF_ports
		}
		#TODO, factor in institution to yield
		multiply_variable = {
			which = JY_LF_total
			which = JY_LF_yield
		}
	#}
}