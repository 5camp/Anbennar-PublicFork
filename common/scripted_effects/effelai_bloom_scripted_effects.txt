#Scripted Effect For Determing Regional Flags - For Determining which events to receive in the PTM
effelai_bloom_region_flag_allocation = {
	if = {
		limit = {
			leechdens_region = {
				owned_by = ROOT
			}
		}
		set_country_flag = effelai_has_leechdens_province
	}
	else_if = {
		limit = {
			has_country_flag = effelai_has_leechdens_province
		}
		clr_country_flag = effelai_has_leechdens_province
	}
	if = {
		limit = {
			east_effelai_region = {
				owned_by = ROOT
			}
		}
		set_country_flag = effelai_has_east_effelai_province
	}
	else_if = {
		limit = {
			has_country_flag = effelai_has_east_effelai_province
		}
		clr_country_flag = effelai_has_east_effelai_province
	}
	if = {
		limit = {
			dry_coast_region = {
				owned_by = ROOT
			}
		}
		set_country_flag = effelai_has_dry_coast_province
	}
	else_if = {
		limit = {
			has_country_flag = effelai_has_dry_coast_province
		}
		clr_country_flag = effelai_has_dry_coast_province
	}
	if = {
		limit = {
			south_effelai_region = {
				owned_by = ROOT
			}
		}
		set_country_flag = effelai_has_south_effelai_province
	}
	else_if = {
		limit = {
			has_country_flag = effelai_has_south_effelai_province
		}
		clr_country_flag = effelai_has_south_effelai_province
	}
	if = {
		limit = {
			mushroom_forest_region = {
				owned_by = ROOT
			}
		}
		set_country_flag = effelai_has_mushroom_forest_province
	}
	else_if = {
		limit = {
			has_country_flag = effelai_has_mushroom_forest_province
		}
		clr_country_flag = effelai_has_mushroom_forest_province
	}
	if = {
		limit = {
			west_effelai_region = {
				owned_by = ROOT
			}
		}
		set_country_flag = effelai_has_west_effelai_province
	}
	else_if = {
		limit = {
			has_country_flag = effelai_has_west_effelai_province
		}
		clr_country_flag = effelai_has_west_effelai_province
	}
	if = {
		limit = {
			soruin_region = {
				owned_by = ROOT
			}
		}
		set_country_flag = effelai_has_soruin_province
	}
	else_if = {
		limit = {
			has_country_flag = effelai_has_soruin_province
		}
		clr_country_flag = effelai_has_soruin_province
	}
}
#Province scope version of the country scope scripted effect above^
provincescope_effelai_bloom_region_flag_allocation = {
	if = {
		limit = {
			region = leechdens_region
		}
		owner = {
			set_country_flag = effelai_has_leechdens_province
		}
	}
	else_if = {
		limit = {
			region = east_effelai_region
		}
		owner = {
			set_country_flag = effelai_has_east_effelai_province
		}
	}
	else_if = {
		limit = {
			region = dry_coast_region
		}
		owner = {
			set_country_flag = effelai_has_dry_coast_province
		}
	}
	else_if = {
		limit = {
			region = south_effelai_region
		}
		owner = {
			set_country_flag = effelai_has_south_effelai_province
		}
	}
	else_if = {
		limit = {
			region = mushroom_forest_region
		}
		owner = {
			set_country_flag = effelai_has_mushroom_forest_province
		}
	}
	else_if = {
		limit = {
			region = west_effelai_region
		}
		owner = {
			set_country_flag = effelai_has_west_effelai_province
		}
	}
	else_if = {
		limit = {
			region = soruin_region
		}
		owner = {
			set_country_flag = effelai_has_soruin_province
		}
	}
}
effelai_bloom_region_flag_removal = {
	clr_country_flag = effelai_has_leechdens_province
	clr_country_flag = effelai_has_east_effelai_province
	clr_country_flag = effelai_has_dry_coast_province
	clr_country_flag = effelai_has_south_effelai_province
	clr_country_flag = effelai_has_mushroom_forest_province
	clr_country_flag = effelai_has_west_effelai_province
	clr_country_flag = effelai_has_soruin_province
}
effelai_bloom_check_burn = { 
	if = { 
		limit = {
			$REGION$ = {
				AND = {
					is_effelai_network_hub = yes
					NOT = {
						owned_by = PREV
					}
				}
			}
		}
		country_event = {
			id = effelai_bloom.420
		}
		clr_country_flag = effelai_is_burning_region
		clr_country_flag = $BURNFLAG$
		$REGION$ = {
			remove_province_modifier = effelai_hub_is_burning
			clr_province_flag = effelai_hub_burn_target
		}
	}
	else_if = {
		limit = {
			NOT = {
				num_of_rebel_armies = 1
				num_of_rebel_controlled_provinces = 1
			}
			$REGION$ = {
				type = all
				OR = {
					NOT = {
						is_effelai_network_hub = yes
					}
					has_province_modifier = effelai_hub_is_burning
				}
			}
		}
		clr_country_flag = $BURNFLAG$
		clr_country_flag = effelai_is_burning_region
		set_global_flag = $GLOBFLAG$
	}
	else_if = {
		limit = {
			$REGION$ = {
				type = all
				OR = {
					NOT = {
						is_effelai_network_hub = yes
					}
					controlled_by = REB
				}
			}
		}
		set_country_flag = effelai_burn_failed_to_rebels
	}
}
effelai_bloom_burn_cancel_burning = {
	clr_country_flag = effelai_is_burning_dry_coast
	clr_country_flag = effelai_is_burning_east_effelai
	clr_country_flag = effelai_is_burning_south_effelai
	clr_country_flag = effelai_is_burning_west_effelai
	clr_country_flag = effelai_is_burning_soruin
	clr_country_flag = effelai_is_burning_leechdens
	clr_country_flag = effelai_is_burning_region
	every_owned_province = {
		remove_province_modifier = effelai_hub_is_burning
		clr_province_flag = effelai_hub_burn_target
	}
	disband_rebels = song_servant_ambusher_rebels
	disband_rebels = effelai_beast_rebels
}
effelai_bloom_burn_mark_region = { #rebels will try to move to hubs specifically
	$BURNREGION$ = {
		limit = {
			is_effelai_network_hub = yes
		}
		set_province_flag = effelai_hub_burn_target
	}
}
effelai_bloom_burn_spawn_songservants = { #effelai fights harder the more you burn
	if = {
		limit = {
			1804 = {
				check_variable = {
					which = effelai_total_regions_burned
					value = 5
				}
			}
		}
		area = {
			if = {
				limit = {
					is_effelai_network_hub = yes
				}
				spawn_rebels = {
					size = 6
					type = effelai_beast_rebels
				}
			}
			else = {
				spawn_rebels = {
					size = 5
					type = effelai_beast_rebels
				}
			}
		}
	}
	else_if = {
		limit = {
			1804 = {
				check_variable = {
					which = effelai_total_regions_burned
					value = 4
				}
			}
		}
		area = {
			if = {
				limit = {
					is_effelai_network_hub = yes
				}
				spawn_rebels = {
					size = 5
					type = effelai_beast_rebels
				}
			}
			else = {
				spawn_rebels = {
					size = 4
					type = effelai_beast_rebels
				}
			}
		}
	}
	else_if = {
		limit = {
			1804 = {
				check_variable = {
					which = effelai_total_regions_burned
					value = 3
				}
			}
		}
		area = {
			if = {
				limit = {
					is_effelai_network_hub = yes
				}
				spawn_rebels = {
					size = 4
					type = song_servant_ambusher_rebels
				}
			}
			else = {
				spawn_rebels = {
					size = 3
					type = song_servant_ambusher_rebels
				}
			}
		}
	}
	else_if = {
		limit = {
			1804 = {
				check_variable = {
					which = effelai_total_regions_burned
					value = 2
				}
			}
		}
		area = {
			if = {
				limit = {
					is_effelai_network_hub = yes
				}
				spawn_rebels = {
					size = 3
					type = song_servant_ambusher_rebels
				}
			}
			else = {
				spawn_rebels = {
					size = 2
					type = song_servant_ambusher_rebels
				}
			}
		}
	}
	else_if = {
		limit = {
			1804 = {
				check_variable = {
					which = effelai_total_regions_burned
					value = 1
				}
			}
		}
		area = {
			if = {
				limit = {
					is_effelai_network_hub = yes
				}
				spawn_rebels = {
					size = 2
					type = song_servant_ambusher_rebels
				}
			}
			else = {
				spawn_rebels = {
					size = 1
					type = song_servant_ambusher_rebels
				}
			}
		}
	}
	else = {
		area = {
			if = {
				limit = {
					is_effelai_network_hub = yes
				}
				spawn_rebels = {
					size = 1
					type = song_servant_ambusher_rebels
				}
			}
			else = {
				spawn_rebels = {
					size = 1
					type = song_servant_ambusher_rebels
				}
			}
		}
	}
}
effelai_bloom_remove_hub = {
	remove_province_modifier = effelai_hub_attuned
	remove_province_modifier = effelai_hub_blooming
	remove_province_modifier = effelai_hub_dormant
	remove_province_modifier = effelai_hub_burned
}
effelai_bloom_remove_roots = {
	remove_province_modifier = effelai_roots_attuned
	remove_province_modifier = effelai_roots_blooming
	remove_province_modifier = effelai_roots_dormant
	remove_province_modifier = effelai_roots_burned
}
effelai_bloom_burn_effect = {
	clr_province_flag = effelai_hub_burn_target
	if = {
		limit = {
			is_effelai_network_root = yes
		}
		effelai_bloom_remove_roots = yes
		add_permanent_province_modifier = {
			name = effelai_roots_burned
			duration = -1
		}
	}
	if = {
		limit = {
			is_effelai_network_hub = yes
		}
		effelai_bloom_remove_hub = yes
		remove_province_modifier = effelai_hub_is_burning
		add_permanent_province_modifier = {
			name = effelai_hub_burned
			duration = -1
		}
	}
	if = {
		limit = {
			has_terrain = jungle
		}
		add_permanent_province_modifier = {
			name = effelai_jungle_cleared
			duration = -1
		}
		add_permanent_province_modifier = {
			name = effelai_slash_and_burn
			duration = 18250
		}
	}
	if = {
		limit = {
			has_terrain = mushroom_forest_terrain
		}
		remove_province_modifier = giant_shroom
		add_permanent_province_modifier = {
			name = effelai_mushrooms_cleared
			duration = -1
		}
	}
}
effelai_attune_province = {
	if = {
		limit = { 
			is_effelai_network_hub = yes
		}
		effelai_bloom_remove_hub = yes
		add_permanent_province_modifier = {
			name = effelai_hub_attuned
			duration = -1
		}
	}
	else_if = {
		limit = { 
			is_effelai_network_root = yes
		}
		effelai_bloom_remove_roots = yes
		add_permanent_province_modifier = {
			name = effelai_roots_attuned
			duration = -1
		}
	}
	else = {#delete this later
		owner = {
			add_treasury = 1000
		}
	}
}
effelai_bloom_spread_attunement = {
	while = {
		limit = {
			check_variable = {
				which = effelai_bloom_attunement_growth
				value = 1
			}
		}
		if = {
			limit = { 
				any_owned_province = {
					NOT = {
						is_effelai_network_attuned = yes
					}
					is_effelai_network_province = yes
				}
			}
			if = {
				limit = { #spread to a random marked province
					any_owned_province = {
						has_province_modifier = effelai_province_is_attuning
					}
				}
				random_owned_province = {
					limit = {
						has_province_modifier = effelai_province_is_attuning
					}
					remove_province_modifier = effelai_province_is_attuning
					effelai_attune_province = yes
					change_variable = {
						which = effelai_bloom_attunement_growth
						value = -1
					}
				}
			}
			else = { #if no more provinces are marked, mark every eligible province
				set_country_flag = effelai_test_flag_found_a_province_to_mark
				every_owned_province = {
					if = {
						limit = {
							NOT = {
								is_effelai_network_attuned = yes
							}
							is_effelai_network_province = yes
							any_neighbor_province = {
								is_effelai_network_attuned = yes
							}
							
							
						}
						add_province_modifier = {
							name = effelai_province_is_attuning
							duration = -1
						}
						owner = {
							clr_country_flag = effelai_test_flag_found_a_province_to_mark
						}
					}
				}
				if = {
					limit = { 
						has_country_flag = effelai_test_flag_found_a_province_to_mark
					}
					add_dip_power = -999999
					set_variable = {
						which = effelai_bloom_attunement_growth
						value = 0
					}
				}
			}
		}
		else = { #every province has been converted
			set_variable = {
				which = effelai_bloom_attunement_growth
				value = 0
			}
		}
	}
}