setup_vault_digging_vault = {
	hidden_effect = {
		if = {
			limit = { has_province_modifier = owb_vault_1 }
			set_variable = { speed = 10 }
		}
		else_if = {
			limit = { has_province_modifier = owb_vault_2 }
			set_variable = { speed = 20 }
		}
		else_if = {
			limit = { has_province_modifier = owb_vault_3 }
			set_variable = { speed = 25 }
		}
		else_if = {
			limit = { has_province_modifier = owb_vault_4 }
			set_variable = { speed = 30 }
		}
		else_if = {
			limit = { has_province_modifier = owb_vault_5 }
			set_variable = { speed = 35 }
		}
		else_if = {
			limit = { has_province_modifier = owb_vault_6 }
			set_variable = { speed = 40 }
		}
		else_if = {
			limit = { has_province_modifier = owb_vault_7 }
			set_variable = { speed = 45 }
		}
		else_if = {
			limit = { has_province_modifier = owb_vault_8 }
			set_variable = { speed = 50 }
		}
		else_if = {
			limit = { has_province_modifier = owb_vault_9 }
			set_variable = { speed = 55 }
		}
		else_if = {
			limit = { has_province_modifier = owb_vault_10 }
			set_variable = { speed = 60 }
		}
		set_variable = { globalCost = 0 }
		set_variable = { globalTime = 0 }
		set_variable = { localCost = 0 }
		set_variable = { localTime = 0 }
		set_variable = { testCost = 0 }
		set_variable = { testTime = 0 }
		set_variable = { Cost = 0 }
		set_variable = { Time = 0 }
		
		if = {
			limit = { check_variable = { speed = 80 } }
			set_variable = { speed = 80 }
		}
		if = {
			limit = { NOT = { check_variable = { speed = 10 } } }
			set_variable = { speed = 10 }
		}
		multiply_variable = { speed = 0.001 }
		multiply_variable = { speed = 1000 }#Final Cost in Ducats
		export_to_variable = {
			which = globalCost
			value = modifier:build_cost
			who = PREV
		}
		export_to_variable = {
			which = globalTime
			value = modifier:build_time
			who = PREV
		}
		export_to_variable = {
			which = localCost
			value = modifier:local_build_cost
		}
		export_to_variable = {
			which = localTime
			value = modifier:local_build_time
		}
		change_variable = {
			which = localCost
			which = globalCost
		}
		change_variable = {
			which = localTime
			which = globalTime
		}

		#cap time to -90%
		if = {
			limit = { NOT = { check_variable = { localTime = -0.910 } } }
			set_variable = { localTime = -0.900 }
		}
		
		change_variable = { Cost = 1 }
		change_variable = { Time = 1 }
		change_variable = { which = Cost which = localCost }
		change_variable = { which = Time which = localTime }
		
		set_variable = { which = finalCost which = speed }
		multiply_variable = { which = finalCost which = finalCost }
		multiply_variable = { which = finalCost which = Cost }
		multiply_variable = { finalCost = 0.001 }
		multiply_variable = { finalCost = 1000 }#Final Cost in Ducats
		
		set_variable = { which = finalTime which = speed }
		multiply_variable = { which = finalTime which = Time } #Final Time in Years
	}
}

start_vault_digging = {
	if = {
		limit = { owner = { check_variable = { APA = 2 } } }
		owner = { 
			custom_tooltip = owb_lose_2_APA_tooltip
			hidden_effect = { subtract_variable = { APA = 2 } }
		}
		hidden_effect = { cancel_construction = yes }
		custom_tooltip = cost_capital_dig_tooltip
		hidden_effect = {
			if = { limit = { check_variable = { speed =	80	} } add_building_construction = { building = vault_digging speed =	160	cost =	6400	} }
			else_if = { limit = { check_variable = { speed =	79	} } add_building_construction = { building = vault_digging speed =	158	cost =	6241	} }
			else_if = { limit = { check_variable = { speed =	78	} } add_building_construction = { building = vault_digging speed =	156	cost =	6084	} }
			else_if = { limit = { check_variable = { speed =	77	} } add_building_construction = { building = vault_digging speed =	154	cost =	5929	} }
			else_if = { limit = { check_variable = { speed =	76	} } add_building_construction = { building = vault_digging speed =	152	cost =	5776	} }
			else_if = { limit = { check_variable = { speed =	75	} } add_building_construction = { building = vault_digging speed =	150	cost =	5625	} }
			else_if = { limit = { check_variable = { speed =	74	} } add_building_construction = { building = vault_digging speed =	148	cost =	5476	} }
			else_if = { limit = { check_variable = { speed =	73	} } add_building_construction = { building = vault_digging speed =	146	cost =	5329	} }
			else_if = { limit = { check_variable = { speed =	72	} } add_building_construction = { building = vault_digging speed =	144	cost =	5184	} }
			else_if = { limit = { check_variable = { speed =	71	} } add_building_construction = { building = vault_digging speed =	142	cost =	5041	} }
			else_if = { limit = { check_variable = { speed =	70	} } add_building_construction = { building = vault_digging speed =	140	cost =	4900	} }
			else_if = { limit = { check_variable = { speed =	69	} } add_building_construction = { building = vault_digging speed =	138	cost =	4761	} }
			else_if = { limit = { check_variable = { speed =	68	} } add_building_construction = { building = vault_digging speed =	136	cost =	4624	} }
			else_if = { limit = { check_variable = { speed =	67	} } add_building_construction = { building = vault_digging speed =	134	cost =	4489	} }
			else_if = { limit = { check_variable = { speed =	66	} } add_building_construction = { building = vault_digging speed =	132	cost =	4356	} }
			else_if = { limit = { check_variable = { speed =	65	} } add_building_construction = { building = vault_digging speed =	130	cost =	4225	} }
			else_if = { limit = { check_variable = { speed =	64	} } add_building_construction = { building = vault_digging speed =	128	cost =	4096	} }
			else_if = { limit = { check_variable = { speed =	63	} } add_building_construction = { building = vault_digging speed =	126	cost =	3969	} }
			else_if = { limit = { check_variable = { speed =	62	} } add_building_construction = { building = vault_digging speed =	124	cost =	3844	} }
			else_if = { limit = { check_variable = { speed =	61	} } add_building_construction = { building = vault_digging speed =	122	cost =	3721	} }
			else_if = { limit = { check_variable = { speed =	60	} } add_building_construction = { building = vault_digging speed =	120	cost =	3600	} }
			else_if = { limit = { check_variable = { speed =	59	} } add_building_construction = { building = vault_digging speed =	118	cost =	3481	} }
			else_if = { limit = { check_variable = { speed =	58	} } add_building_construction = { building = vault_digging speed =	116	cost =	3364	} }
			else_if = { limit = { check_variable = { speed =	57	} } add_building_construction = { building = vault_digging speed =	114	cost =	3249	} }
			else_if = { limit = { check_variable = { speed =	56	} } add_building_construction = { building = vault_digging speed =	112	cost =	3136	} }
			else_if = { limit = { check_variable = { speed =	55	} } add_building_construction = { building = vault_digging speed =	110	cost =	3025	} }
			else_if = { limit = { check_variable = { speed =	54	} } add_building_construction = { building = vault_digging speed =	108	cost =	2916	} }
			else_if = { limit = { check_variable = { speed =	53	} } add_building_construction = { building = vault_digging speed =	106	cost =	2809	} }
			else_if = { limit = { check_variable = { speed =	52	} } add_building_construction = { building = vault_digging speed =	104	cost =	2704	} }
			else_if = { limit = { check_variable = { speed =	51	} } add_building_construction = { building = vault_digging speed =	102	cost =	2601	} }
			else_if = { limit = { check_variable = { speed =	50	} } add_building_construction = { building = vault_digging speed =	100	cost =	2500	} }
			else_if = { limit = { check_variable = { speed =	49	} } add_building_construction = { building = vault_digging speed =	98	cost =	2401	} }
			else_if = { limit = { check_variable = { speed =	48	} } add_building_construction = { building = vault_digging speed =	96	cost =	2304	} }
			else_if = { limit = { check_variable = { speed =	47	} } add_building_construction = { building = vault_digging speed =	94	cost =	2209	} }
			else_if = { limit = { check_variable = { speed =	46	} } add_building_construction = { building = vault_digging speed =	92	cost =	2116	} }
			else_if = { limit = { check_variable = { speed =	45	} } add_building_construction = { building = vault_digging speed =	90	cost =	2025	} }
			else_if = { limit = { check_variable = { speed =	44	} } add_building_construction = { building = vault_digging speed =	88	cost =	1936	} }
			else_if = { limit = { check_variable = { speed =	43	} } add_building_construction = { building = vault_digging speed =	86	cost =	1849	} }
			else_if = { limit = { check_variable = { speed =	42	} } add_building_construction = { building = vault_digging speed =	84	cost =	1764	} }
			else_if = { limit = { check_variable = { speed =	41	} } add_building_construction = { building = vault_digging speed =	82	cost =	1681	} }
			else_if = { limit = { check_variable = { speed =	40	} } add_building_construction = { building = vault_digging speed =	80	cost =	1600	} }
			else_if = { limit = { check_variable = { speed =	39	} } add_building_construction = { building = vault_digging speed =	78	cost =	1521	} }
			else_if = { limit = { check_variable = { speed =	38	} } add_building_construction = { building = vault_digging speed =	76	cost =	1444	} }
			else_if = { limit = { check_variable = { speed =	37	} } add_building_construction = { building = vault_digging speed =	74	cost =	1369	} }
			else_if = { limit = { check_variable = { speed =	36	} } add_building_construction = { building = vault_digging speed =	72	cost =	1296	} }
			else_if = { limit = { check_variable = { speed =	35	} } add_building_construction = { building = vault_digging speed =	70	cost =	1225	} }
			else_if = { limit = { check_variable = { speed =	34	} } add_building_construction = { building = vault_digging speed =	68	cost =	1156	} }
			else_if = { limit = { check_variable = { speed =	33	} } add_building_construction = { building = vault_digging speed =	66	cost =	1089	} }
			else_if = { limit = { check_variable = { speed =	32	} } add_building_construction = { building = vault_digging speed =	64	cost =	1024	} }
			else_if = { limit = { check_variable = { speed =	31	} } add_building_construction = { building = vault_digging speed =	62	cost =	961 	} }
			else_if = { limit = { check_variable = { speed =	30	} } add_building_construction = { building = vault_digging speed =	60	cost =	900 	} }
			else_if = { limit = { check_variable = { speed =	29	} } add_building_construction = { building = vault_digging speed =	58	cost =	841 	} }
			else_if = { limit = { check_variable = { speed =	28	} } add_building_construction = { building = vault_digging speed =	56	cost =	784 	} }
			else_if = { limit = { check_variable = { speed =	27	} } add_building_construction = { building = vault_digging speed =	54	cost =	729 	} }
			else_if = { limit = { check_variable = { speed =	26	} } add_building_construction = { building = vault_digging speed =	52	cost =	676 	} }
			else_if = { limit = { check_variable = { speed =	25	} } add_building_construction = { building = vault_digging speed =	50	cost =	625 	} }
			else_if = { limit = { check_variable = { speed =	24	} } add_building_construction = { building = vault_digging speed =	48	cost =	576 	} }
			else_if = { limit = { check_variable = { speed =	23	} } add_building_construction = { building = vault_digging speed =	46	cost =	529 	} }
			else_if = { limit = { check_variable = { speed =	22	} } add_building_construction = { building = vault_digging speed =	44	cost =	484 	} }
			else_if = { limit = { check_variable = { speed =	21	} } add_building_construction = { building = vault_digging speed =	42	cost =	441 	} }
			else_if = { limit = { check_variable = { speed =	20	} } add_building_construction = { building = vault_digging speed =	40	cost =	400 	} }
			else_if = { limit = { check_variable = { speed =	19	} } add_building_construction = { building = vault_digging speed =	38	cost =	361 	} }
			else_if = { limit = { check_variable = { speed =	18	} } add_building_construction = { building = vault_digging speed =	36	cost =	324 	} }
			else_if = { limit = { check_variable = { speed =	17	} } add_building_construction = { building = vault_digging speed =	34	cost =	289 	} }
			else_if = { limit = { check_variable = { speed =	16	} } add_building_construction = { building = vault_digging speed =	32	cost =	256 	} }
			else_if = { limit = { check_variable = { speed =	15	} } add_building_construction = { building = vault_digging speed =	30	cost =	225 	} }
			else_if = { limit = { check_variable = { speed =	14	} } add_building_construction = { building = vault_digging speed =	28	cost =	196 	} }
			else_if = { limit = { check_variable = { speed =	13	} } add_building_construction = { building = vault_digging speed =	26	cost =	169 	} }
			else_if = { limit = { check_variable = { speed =	12	} } add_building_construction = { building = vault_digging speed =	24	cost =	144 	} }
			else_if = { limit = { check_variable = { speed =	11	} } add_building_construction = { building = vault_digging speed =	22	cost =	121 	} }
			else	= {													add_building_construction = { building = vault_digging speed =	20	cost =	100 	} }
		}
	}
	else = {
		owner = { custom_tooltip = not_enough_APA_2_tooltip }
	}
	
}

upgrade_vault = {
	trigger_switch = {
		on_trigger = has_province_modifier
		
		owb_vault_1 = { remove_province_modifier = owb_vault_1 add_permanent_province_modifier = { name = owb_vault_2 duration = -1 } }
		owb_vault_2 = { remove_province_modifier = owb_vault_2 add_permanent_province_modifier = { name = owb_vault_3 duration = -1 } }
		owb_vault_3 = { remove_province_modifier = owb_vault_3 add_permanent_province_modifier = { name = owb_vault_4 duration = -1 } }
		owb_vault_4 = { remove_province_modifier = owb_vault_4 add_permanent_province_modifier = { name = owb_vault_5 duration = -1 } }
		owb_vault_5 = { remove_province_modifier = owb_vault_5 add_permanent_province_modifier = { name = owb_vault_6 duration = -1 } }
		owb_vault_6 = { remove_province_modifier = owb_vault_6 add_permanent_province_modifier = { name = owb_vault_7 duration = -1 } }
		owb_vault_7 = { remove_province_modifier = owb_vault_7 add_permanent_province_modifier = { name = owb_vault_8 duration = -1 } }
		owb_vault_8 = { remove_province_modifier = owb_vault_8 add_permanent_province_modifier = { name = owb_vault_9 duration = -1 } }
		owb_vault_9 = { remove_province_modifier = owb_vault_9 add_permanent_province_modifier = { name = owb_vault_10 duration = -1 } }
		owb_vault_10 = { remove_province_modifier = owb_vault_10 add_permanent_province_modifier = { name = owb_vault_11 duration = -1 } }
	}
}

upgrade_wing = {
	if = {
		limit = { is_variable_equal = { which = $wing$ value = 0 } }
		if = {
			limit = { NOT = { owner = { check_variable = { APA = 1 } } } }
			owner = { custom_tooltip = not_enough_APA_1_tooltip }
			hidden_effect = { province_event = { id = owb.1000 } }
		}
		else = {
			hidden_effect = { set_province_flag = $wing$ }
			add_building_construction = { building = vault_wing_upgrade speed =	1	cost =	1 }
			custom_tooltip = owb_lose_1_APA_tooltip
			hidden_effect = { owner = { clr_country_flag = debug_vault_flag } }
		}
	}
	else_if = {
		limit = { is_variable_equal = { which = $wing$ value = 1 } }
		if = {
			limit = { NOT = { owner = { check_variable = { APA = 2 } } } }
			owner = { custom_tooltip = not_enough_APA_2_tooltip }
			hidden_effect = { province_event = { id = owb.1000 } }
		}
		else = {
			hidden_effect = { set_province_flag = $wing$ }
			add_building_construction = { building = vault_wing_upgrade speed =	1	cost =	1 }
			custom_tooltip = owb_lose_2_APA_tooltip
			hidden_effect = { owner = { clr_country_flag = debug_vault_flag } }
		}
	}
	else_if = {
		limit = { is_variable_equal = { which = $wing$ value = 2 } }
		if = {
			limit = { NOT = { owner = { check_variable = { APA = 3 } } } }
			owner = { custom_tooltip = not_enough_APA_3_tooltip }
			hidden_effect = { province_event = { id = owb.1000 } }
		}
		else = {
			hidden_effect = { set_province_flag = $wing$ }
			add_building_construction = { building = vault_wing_upgrade speed =	1	cost =	1 }
			custom_tooltip = owb_lose_3_APA_tooltip
			hidden_effect = { owner = { clr_country_flag = debug_vault_flag } }
		}
	}
}

owb_found_one_apa = {
	custom_tooltip = owb_found_one_apa_tooltip
	hidden_effect = { change_variable = { APA = 1 } }
}

owb_found_two_apa = {
	custom_tooltip = owb_found_two_apa_tooltip
	hidden_effect = { change_variable = { APA = 2 } }
}

owb_found_three_apa = {
	custom_tooltip = owb_found_three_apa_tooltip
	hidden_effect = { change_variable = { APA = 3 } }
}

owb_orbital_strike_target = {
	random_known_country = {
		limit = { 
			NOT = { has_country_flag = orbital_strike_target }
			war_with = OWB
		}
		set_country_flag = orbital_strike_target
		save_event_target_as = country_1
		capital_scope = { save_event_target_as = capital_1 }
	}
	random_known_country = {
		limit = { 
			NOT = { has_country_flag = orbital_strike_target }
			war_with = OWB
		}
		set_country_flag = orbital_strike_target
		save_event_target_as = country_2
		capital_scope = { save_event_target_as = capital_2 }
	}
	random_known_country = {
		limit = { 
			NOT = { has_country_flag = orbital_strike_target }
			war_with = OWB
		}
		set_country_flag = orbital_strike_target
		save_event_target_as = country_3
		capital_scope = { save_event_target_as = capital_3 }
	}
	random_known_country = {
		limit = { 
			NOT = { has_country_flag = orbital_strike_target }
			war_with = OWB
		}
		set_country_flag = orbital_strike_target
		save_event_target_as = country_4
		capital_scope = { save_event_target_as = capital_4 }
	}
	random_known_country = {
		limit = { 
			NOT = { has_country_flag = orbital_strike_target }
			war_with = OWB
		}
		set_country_flag = orbital_strike_target
		save_event_target_as = country_5
		capital_scope = { save_event_target_as = capital_5 }
	}
	random_known_country = {
		limit = { 
			NOT = { has_country_flag = orbital_strike_target }
			war_with = OWB
		}
		set_country_flag = orbital_strike_target
		save_event_target_as = country_6
		capital_scope = { save_event_target_as = capital_6 }
	}
}

owb_orbital_strike = {
	event_target:$capital$ = {
		custom_tooltip = owb_strike_against_the_heavens_tt
		hidden_effect = {
			add_devastation = 95
			add_base_tax = -6
			add_base_manpower = -6
			add_base_production = -6
			kill_units = { amount = 18 }
			add_permanent_province_modifier = {
				name = owb_magical_heat
				duration = 3650
			}
			every_neighbor_province = {
				limit = { NOT = { has_province_modifier = owb_magical_heat } }
				add_devastation = 85
				add_base_tax = -5
				add_base_manpower = -5
				add_base_production = -5
				kill_units = { amount = 15 }
				add_permanent_province_modifier = {
					name = owb_magical_heat
					duration = 2555
				}
				every_neighbor_province = {
					limit = { NOT = { has_province_modifier = owb_magical_heat } }
					add_devastation = 75
					add_base_tax = -4
					add_base_manpower = -4
					add_base_production = -4
					kill_units = { amount = 12 }
					add_permanent_province_modifier = {
						name = owb_magical_heat
						duration = 1825
					}
				}
			}
		}
	}
	event_target:$country$ = {
		add_country_modifier = {
			name = owb_orbital_striked
			duration = 3650
		}
		add_opinion = {
			who = ROOT
			modifier = used_doomsweapon_against_us
		}
		add_war_exhaustion = 15
	}
	hidden_effect = {
		every_known_country = {
			add_opinion = {
				who = ROOT
				modifier = used_doomsweapon
			}
		}
	}
	add_country_modifier = {
		name = owb_recharging_canon
		duration = 1095
	}
	add_adm_power = -100
	add_mil_power = -100
	add_dip_power = -100
} 