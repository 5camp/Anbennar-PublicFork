# Triggers and effects will be given the Actor's scope, with the Recipient's as FROM
feiten_buy_skyport_rights = {
	category = economy
	require_acceptance = yes
	
	is_visible = {
		tag = Y20
		4879 = { has_great_project = { type = feiten_aerodrome } }
    }
	
	is_allowed = {
		hidden_trigger = {
			tag = Y20
			4879 = { has_great_project = { type = feiten_aerodrome } }
		}
		custom_trigger_tooltip = {
			tooltip = "[FROM.GetName]'s home node does NOT already have a skyport"
			FROM = {
				home_trade_node = {
					all_trade_node_member_province = {
						NOT = { has_province_modifier = feiten_skyport_handler_mod }
					}
				}
			}
		}
		custom_trigger_tooltip = {
			tooltip = "[FROM.GetName] has a Center of Trade on which a skyport can be built"
			FROM = {
				home_trade_node = {
					any_trade_node_member_province = {
						owned_by = FROM
						province_has_center_of_trade_of_level = 1
					}
				}
			}
		}
		NOT = {
			check_variable = {
				which = feitenSkyportBalance
				value = 1
			}
		}
	}

    on_accept = {
		add_treasury = -1000
		add_dip_power = -50
		FROM = {
			home_trade_node_effect_scope = {
				random_trade_node_member_province = {
					limit = {
						owned_by = FROM
						province_has_center_of_trade_of_level = 1
					}
					add_province_triggered_modifier = feiten_skyport_handler_mod
				}
			}
		}
	}

    ai_acceptance = {
        add_entry = {
            name = "Is a subject of [Root.GetName]"
            limit = { FROM = { is_subject_of = ROOT } }
            export_to_variable = {
                variable_name = ai_value
                value = 25
                who = FROM
                with = THIS
            }
        }

		add_entry = {
			name = OPINION
			export_to_variable = {
				variable_name = ai_value
				value = opinion
				who = FROM
				with = THIS
			}
			divide_variable = { which = ai_value value = 4 }
		}
		
		add_entry = {
			name = "Base"
			export_to_variable = {
				variable_name = ai_value
				value = -20
				who = FROM
				with = THIS
			}
		}

		add_entry = {
			name = "Neutral attitude toward Feiten"
			limit = { 
				FROM = {
					ai_attitude = {
						who = ROOT
						attitude = attitude_neutral
					}
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = -10
				who = FROM
				with = THIS
			}
		}

		add_entry = {
			name = "Negative attitude toward Feiten (Hostile, Rivalry, Outraged, Disloyal, Rebellious, Threatened, or Domineering)"
			limit = {
				FROM = {
					OR = {
						ai_attitude = {
							who = ROOT
							attitude = attitude_hostile
						}
						ai_attitude = {
							who = ROOT
							attitude = attitude_rivalry
						}
						ai_attitude = {
							who = ROOT
							attitude = attitude_outraged
						}
						ai_attitude = {
							who = ROOT
							attitude = attitude_disloyal
						}
						ai_attitude = {
							who = ROOT
							attitude = attitude_rebellious
						}
						ai_attitude = {
							who = ROOT
							attitude = attitude_threatened
						}
						ai_attitude = {
							who = ROOT
							attitude = attitude_domineering
						}
					}
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = -1000
				who = FROM
				with = THIS
			}
		}

		add_entry = {
			name = "Is a Republic"
			limit = { FROM = { is_republic = yes } }
			export_to_variable = {
				variable_name = ai_value
				value = 5
				who = FROM
				with = THIS
			}
		}

		add_entry = {
			name = "Not the same religion"
			limit = { FROM = { NOT = { religion_group = ROOT } } }
			export_to_variable = {
				variable_name = ai_value
				value = -5
				who = FROM
				with = THIS
			}
		}

		add_entry = {
			name = "They dominate their home trade node"
			limit = {
				FROM = { home_trade_node = { has_most_province_trade_power = FROM } }
			}
			export_to_variable = {
				variable_name = ai_value
				value = -10
				who = FROM
				with = THIS
			}
		}

		add_entry = {
			name = "Their mercantilism"
			export_to_variable = {
				variable_name = ai_value
				value = trigger_value:mercantilism
				who = FROM
				with = THIS
			}
			multiply_variable = { which = ai_value value = -0.5 }
		}

		add_entry = {
			name = TRUST
			export_to_variable = {
				variable_name = ai_value
				value = trust
				who = FROM
				with = THIS
			}
			subtract_variable = { which = ai_value value = 50 }
			multiply_variable = { which = ai_value value = 2 }
		}
    }

	ai_will_do = {
		always = no
	}
}