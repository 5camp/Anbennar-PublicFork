
ravenmarch_1_missions = {
	slot = 1
	generic = no
	ai = yes 
	has_country_shield = yes
	potential = { tag = B48 }
	
	ravenmarch_dostans_way = {
		icon = geneva_conventions
		position = 1
		required_missions = { }

		provinces_to_highlight = { 
			area = dostans_way_area
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		}
		
		trigger = {
			dostans_way_area = {
				country_or_non_sovereign_subject_holds = ROOT
				type = all
			}
		}
		effect = {
			devaced_area = {
				add_permanent_claim = ROOT
			}
			vernham_area = {
				add_permanent_claim = ROOT
			}
			beastgrave_area = {
				add_permanent_claim = ROOT
			}
			clovenwood_area = {
				add_permanent_claim = ROOT
			}
			banesfork_area = {
				add_permanent_claim = ROOT
			}
		}
	}
	ravenmarch_godshield_foothills = {
		icon = geneva_conventions
		position = 2
		required_missions = { ravenmarch_dostans_way }

		provinces_to_highlight = {
			OR = {
				area = devaced_area
				area = catelsvord_area
			}
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		}
		
		trigger = {
			devaced_area = {
				country_or_non_sovereign_subject_holds = ROOT
				type = all
			}
			catelsvord_area = {
				country_or_non_sovereign_subject_holds = ROOT
				type = all
			}
		}
		effect = {
			784 = {
				add_permanent_claim = ROOT
			}
			786 = {
				add_permanent_claim = ROOT
			}
			789 = {
				add_permanent_claim = ROOT
			}
			oudmerewood_area = {
				add_permanent_claim = ROOT
			}
			verteben_area = {
				add_permanent_claim = ROOT
			}
			valefort_area = {
				add_permanent_claim = ROOT
			}
		}
	}
	
	ravenmarch_imperial_sympathies = {
		icon = geneva_conventions
		position = 6
		required_missions = { ravenmarch_secure_inheritance }
		
		trigger = {
			all_country = {
				is_part_of_hre = yes
				has_opinion = {
					who = ROOT
					value = 75
				}
			}
			amount = 5
		}
		effect = {
			add_dip_power = 50
			add_country_modifier = { name = ravenmarch_imperial_connections duration = 9125 }
		}
	}
	
	ravenmarch_midnight = {
		icon = geneva_conventions
		position = 7
		required_missions = { ravenmarch_imperial_connections ravenmarch_light_in_darkness }
		
		trigger = {
			treasury = 100
			prestige = 60
			OR = {
				AND = {
					if = {
						limit = { exists = A59 }
						has_spy_network_in = {
							who = A59
							value = 75
						}
					}
					else = {
						any_neighbor_country = {	
							owns = 441
							has_spy_network_from = {
								who = ROOT
								value = 75
							}
						}
					}
				}
				AND = {
					if = {
						limit = { exists = A59 }
						reverse_has_opinion = {
							who = A59
							value = 100
						}
					}
					else = {
						any_neighbor_country = {	
							owns = 441
							reverse_has_opinion = {
								who = ROOT
								value = 100
							}
						}
					}
				}
			}
		}
		effect = {
			add_treasury = -100
			every_neighbor_country = {
				limit = { owns = 441 }
				add_spy_network_from = {
					who = B48
					value = -75
				}
			}
			country_event = { id = flavor_ravenmarch.3 days = 7 }
		}
	}
}

ravenmarch_2_missions = {
	slot = 2
	generic = no
	ai = yes 
	has_country_shield = yes
	potential = { tag = B48 }
	
	ravenmarch_secure_holdings = {
		icon = geneva_conventions
		position = 2
		required_missions = { ravenmarch_dostans_way ravenmarch_vernham }

		provinces_to_highlight = {
			OR = {
				province_id = 803
				province_id = 800
			}
			NOT = { has_fort_building_trigger = yes }
		}
		
		trigger = {
			803 = {
				owned_by = ROOT
				has_fort_building_trigger = yes
			}
			800 = {
				owned_by = ROOT
				has_fort_building_trigger = yes
			}
		}
		effect = {
			add_country_modifier = { name = ravenmarch_secured_holdings duration = 5475 }
			803 = {
				add_province_modifier = { name = ravenmarch_hill_and_vale duration = -1 }
			}
			800 = {
				add_province_modifier = { name = ravenmarch_hill_and_vale duration = -1 }
			}
		}
	}
	ravenmarch_offer_refuge = {
		icon = geneva_conventions
		position = 3
		required_missions = { ravenmarch_secure_holdings ravenmarch_godshield_foothills }

		provinces_to_highlight = { }
		
		trigger = {
			dip_power = 50
			if = {
				limit = { exists = A59 }
				has_spy_network_in = {
					who = A59
					value = 75
				}
			}
			else = {
				any_neighbor_country = {	
					owns = 441
					has_spy_network_from = {
						who = ROOT
						value = 75
					}
				}
			}
		}
		effect = {
			every_neighbor_country = {
				limit = { owns = 441 }
				add_spy_network_from = {
					who = B48
					value = -75
				}
			}
			add_dip_power = -50
			add_manpower = 2
			capital_scope = {
				add_base_tax = 1
				add_base_production = 1
			}
			random_owned_province = {
				add_base_production = 1
				add_base_manpower = 1
			}
			if = {
				limit = { exists = A59 }
				A59 = {
					random_owned_province = {
						limit = { NOT = { has_province_flag = ravenmarch_refuge } }
						add_base_tax = -1
						add_base_production = -1
						set_province_flag = ravenmarch_refuge
					}
					random_owned_province = {
						limit = { NOT = { has_province_flag = ravenmarch_refuge } }
						add_base_production = -1
						add_base_manpower = -1
						set_province_flag = ravenmarch_refuge
					}
				}
			}
			else = {
				random_province = {
					limit = { region = dostanor_region NOT = { has_province_flag = ravenmarch_refuge } }
					add_base_tax = -1
					add_base_production = -1
					set_province_flag = ravenmarch_refuge
				}
				random_province = {
					limit = { region = dostanor_region NOT = { has_province_flag = ravenmarch_refuge } }
					add_base_production = -1
					add_base_manpower = -1
					set_province_flag = ravenmarch_refuge
				}
			}
		}
	}
	
	ravenmarch_secure_inheritance = {
		icon = geneva_conventions
		position = 5
		required_missions = { ravenmarch_dostanor_beyond }
		
		trigger = {
			calc_true_if = {
				all_ally = {
					NOT = {
						OR = {
							capital_scope = { region = south_castanor_region }
							capital_scope = { region = inner_castanor_region }
							capital_scope = { region = west_castanor_region }
						}
					}
				}
				amount = 2
			}
			OR = {
				alliance_with = A59
				is_rival = A59
			}
		}
		effect = {
			legitimacy_equivalent = 15
			add_country_modifier = { name = ravenmarch_courtly_politic duration = 9125 }
		}
	}
	
	ravenmarch_light_in_darkness = {
		icon = geneva_conventions
		position = 6
		required_missions = { ravenmarch_secure_inheritance }
		
		trigger = {
			if = {
				limit = { exists = A59 }
				has_spy_network_in = {
					who = A59
					value = 75
				}
			}
			else = {
				any_neighbor_country = {	
					owns = 441
					has_spy_network_from = {
						who = ROOT
						value = 75
					}
				}
			}
			estate_loyalty = {
				estate = estate_clergy
				loyalty = 70
			}
			adm_power = 50
			dip_power = 50
		}
		effect = {
			add_adm_power = -50
			add_dip_power = -50
			every_neighbor_country = {
				limit = { owns = 441 }
				add_spy_network_from = {
					who = B48
					value = -75
				}
			}
			define_advisor = { #order of the ruby scale
				type = inquisitor
				name = "Carmine Judge Cristof"
				skill = 2
				discount = yes
				culture = corvurian
				religion = regent_court
			}
			add_estate_loyalty = {
				estate = estate_clergy
				loyalty = 5
			}
			if = {
				433 = {
					limit = { NOT = { owned_by = ROOT } }
					add_province_modifier = { name = ravenmarch_order_of_ruby_scale_1 duration = 5475 }
				}
			}
			else = {
				add_estate_loyalty = {
					estate = estate_clergy
					loyalty = 5
				}
				433 = {
					add_base_tax = 1
					add_base_production = 1
					add_base_manpower = 1
				}
			}
		}
	}
}

ravenmarch_3_missions = {
	slot = 3
	generic = no
	ai = yes 
	has_country_shield = yes
	potential = { tag = B48 }
	
	ravenmarch_vernham = {
		icon = geneva_conventions
		position = 1
		required_missions = { }

		provinces_to_highlight = {
			area = vernham_area
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		}
		
		trigger = {
			vernham_area = {
				country_or_non_sovereign_subject_holds = ROOT
				type = all
			}
		}
		effect = {
			set_capital = 800
			add_prestige = 10
		}
	}
	
	ravenmarch_old_new = {
		icon = geneva_conventions
		position = 2
		required_missions = { ravenmarch_vernham }

		provinces_to_highlight = {
			area = vernham_area
			NOT = { development = 15 }
		}
		
		trigger = {
			vernham_area = {
				development = 15
				type = all
			}
		}
		effect = {
			add_country_modifier = { name = ravenmarch_new_home duration = 9125 }
		}
	}
	
	ravenmarch_ryalan_grace = {
		icon = geneva_conventions
		position = 3
		required_missions = { ravenmarch_old_new }

		provinces_to_highlight = {
			area = vernham_area
			NOT = { 
				has_tax_building_trigger = yes
			}
		}
		
		trigger = {
			vernham_area = {
				has_tax_building_trigger = yes
				type = all
			}
		}
		effect = {
			add_stability_or_adm_power = yes
			capital_scope = {
				if = {
					limit = { NOT = { has_building = cathedral } }
					remove_building = temple
					add_building = cathedral
				}
				else = { add_base_tax = 2 }
			}
		}
	}
	
	ravenmarch_dostanor_beyond = {
		icon = geneva_conventions
		position = 4
		required_missions = { ravenmarch_ryalan_grace ravenmarch_silver_shores ravenmarch_offer_refuge }
		
		trigger = {
			stability = 2
			legitimacy_equivalent = 80
			prestige = 50
		}
		effect = {
			set_government_rank = 2
			south_castanor_region = {
				add_permanent_claim = ROOT
			}
			daravans_folly_region = {
				add_permanent_claim = ROOT
			}
		}
	}
	
	ravenmarch_sons_of_the_mire = {
		icon = geneva_conventions
		position = 5
		required_missions = { ravenmarch_dostanor_beyond }
		
		trigger = {
			num_of_cavalry = 10
			mil_power = 75
		}
		effect = {
			add_mil_power = -75
			add_country_modifier = { name = ravenmarch_sons_of_mire duration = -1 }
		}
	}
	
	ravenmarch_last_korbarids = {
		icon = geneva_conventions
		position = 6
		required_missions = { ravenmarch_sons_of_the_mire }
		
		trigger = {
			dip_power = 100
			treasury = 100
			780 = {
				country_or_non_sovereign_subject_holds = ROOT
			}
		}
		effect = {
			add_dip_power = -100
			add_treasury = -100
			country_event = { id = flavor_ravenmarch.2 days = 5 }
		}
	}
	
	ravenmarch_corins_might = {
		icon = geneva_conventions
		position = 7
		required_missions = { ravenmarch_light_in_darkness ravenmarch_last_korbarids ravenmarch_fresh_start }
		
		trigger = {
			OR = {
				AND = {
					religion = regent_court
					has_personal_deity = corin
				}
				religion = corinite
			}
		}
		effect = {
			if = {
				limit = { AND = { is_religion_enabled = corinite religion = regent_court } }
				change_religion = corinite
				capital_scope = { change_religion = corinite add_reform_center = corinite }
				random_owned_province = {
					limit = {
						has_tax_building_trigger = yes
					}
					change_religion = corinite
				}
				random_owned_province = {
					limit = {
						has_tax_building_trigger = yes
					}
					change_religion = corinite
				}
				add_country_modifier = { name = conversion_zeal duration = 3650 }
			}
			else = {
				add_stability_or_adm_power = yes
				add_adm_power = 75
				add_dip_power = 75
				add_mil_power = 75
			}
		}
	}
}

ravenmarch_4_missions = {
	slot = 4
	generic = no
	ai = yes 
	has_country_shield = yes
	potential = { tag = B48 }
	
	ravenmarch_broken_blade = {
		icon = geneva_conventions
		position = 2
		required_missions = { ravenmarch_vernham ravenmarch_forests_edge }
		
		provinces_to_highlight = {
			area = blademarch_area
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		}
		
		trigger = {
			blademarch_area = {
				country_or_non_sovereign_subject_holds = ROOT
				type = all
			}
		}
		effect = {
			add_prestige = 5
			add_mil_power = 25
			oudeben_area = {
				add_permanent_claim = ROOT
			}
			themin_area = {
				add_permanent_claim = ROOT
			}
		}
	}
	
	ravenmarch_silver_shores = {
		icon = geneva_conventions
		position = 3
		required_missions = { ravenmarch_broken_blade ravenmarch_primeval_traps }
		
		provinces_to_highlight = {
			OR = {
				area = oudmerewood_area
				area = oudeben_area
				area = themin_area
			}
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		}
		trigger = {
			oudmerewood_area = {
				country_or_non_sovereign_subject_holds = ROOT
				type = all
			}
			oudeben_area = {
				country_or_non_sovereign_subject_holds = ROOT
				type = all
			}
			themin_area = {
				country_or_non_sovereign_subject_holds = ROOT
				type = all
			}
		}
		effect = {
			add_adm_power = 75
			add_dip_power = 25
			add_mil_power = 25
		}
	}
	
	ravenmarch_continuing_advance = {
		icon = geneva_conventions
		position = 5
		required_missions = { ravenmarch_dostanor_beyond }
		
		provinces_to_highlight = {
			region = south_castanor_region
			owner = {
				is_monstrous_horde = yes
			}
		}
		
		trigger = {
			custom_trigger_tooltip = {
				tooltip = ravenmarch_continuing_advance_tooltip
				OR = {
					check_variable = { nbRavenWon = 8 }
					south_castanor_region = {
						type = all
						NOT = {
							owner = {
								is_monstrous_horde = yes
							}
						}
					}
				}
			}
		}
		effect = {
			add_country_modifier = { name = ravenmarch_late_greentide duration = 7300 }
		}
	}
	
	ravenmarch_a_fresh_start = {
		icon = geneva_conventions
		position = 6
		required_missions = { ravenmarch_continuing_advance }
		
		provinces_to_highlight = {
			OR = {
				area = escerfork_area
				area = medirleigh_area
			}
			NOT = { owned_by = ROOT }
		}
		
		trigger = {
			escerfork_area = {
				owned_by = ROOT
				type = all
			}
			medirleigh_area = {
				owned_by = ROOT
				type = all
			}
			num_of_owned_provinces_with = {
				value = 2
				has_building = farm_estate
				OR = {
					area = escerfork_area
					area = medirleigh_area
				}
			}
		}
		effect = {
			
		}
	}
}

ravenmarch_5_missions = {
	slot = 5
	generic = no
	ai = yes 
	has_country_shield = yes
	potential = { tag = B48 }
	
	ravenmarch_forests_edge = {
		icon = geneva_conventions
		position = 1
		required_missions = { }
		
		provinces_to_highlight = {
			OR = {
				area = clovenwood_area
				area = beastgrave_area
				area = banesfork_area
			}
			NOT = {
				country_or_non_sovereign_subject_holds = ROOT
			}
		}
		
		trigger = {
			clovenwood_area = {
				country_or_non_sovereign_subject_holds = ROOT
				type = all
			}
			beastgrave_area = {
				country_or_non_sovereign_subject_holds = ROOT
				type = all
			}
			banesfork_area = {
				country_or_non_sovereign_subject_holds = ROOT
				type = all
			}
		}
		effect = {
			blademarch_area = {
				add_permanent_claim = ROOT
			}
			swapstoke_area = {
				add_permanent_claim = ROOT
			}
		}
	}
	
	ravenmarch_primeval_traps = {
		icon = geneva_conventions
		position = 2
		required_missions = { ravenmarch_forests_edge }
		
		trigger = {
			num_of_owned_provinces_with = {
				value = 4
				trade_goods = fur
				OR = {
					has_production_building_trigger = yes
					base_production = 5
				}
			}
		}
		effect = {
			add_country_modifier = { name = ravenmarch_deepwoods_furs duration = 7300 }
		}
	}
}