# Author: Elefante

#Ma Hoang loses the civil war
Y63_missions_1a = {
	slot = 1
	generic = no
	ai = yes 
	potential = {
		tag = Y63
		has_global_flag = khom_civilwar_honsai_won_war
	}
	has_country_shield = yes
	
	Y63_harbor_dinh_loyalists = {
		icon = mission_ras
		position = 2
		required_missions = { Y63_civil_intercession }
		
		provinces_to_highlight = {
			is_capital_of = Y67
		}
		
		trigger = {
			NOT = { exists = Y67 }
			has_spy_network_in = {
				who = Y66
				value = 30
			}
		}
		
		effect = {
			5424 = {
				add_human_minority_size_effect = yes
				add_human_minority_size_effect = yes
			}
			country_event = { id = verkalozovar_events.1 days = 30 }
			hidden_effect = { complete_mission = Y63_welcome_hinphati_veterans }
		}
	}
	
	Y63_prepare_hykhuwok = {
		icon = mission_ras
		position = 3
		required_missions = { Y63_harbor_dinh_loyalists }
		
		provinces_to_highlight = {
			OR = {
				province_id = 4945
				province_id = 4775
				province_id = 4776
			}
			NOT = { base_manpower = 5 }
		}
		
		trigger = {
			4945 = { base_manpower = 5 }
			4775 = { base_manpower = 5 }
			4776 = { base_manpower = 5 }
		}
		
		effect = {
			every_subject_country = {
				limit = { primary_culture = hinphat }
				add_country_modifier = {
					name = Y63_preparing_the_hykhuwok
					duration = 3650
				}
			}
		}
	}
	
	Y63_end_ghost_emperor = {
		icon = mission_ras
		position = 4
		required_missions = { Y63_prepare_hykhuwok }
		
		trigger = {
			land_forcelimit = 15
			army_size_percentage = 1
		}
		
		effect = {
			declare_war_with_cb = {
			    who = Y66
			    casus_belli = cb_conquest
			}
			if = {
				limit = {
					has_country_flag = Y63_elephant_grove_flag
					OR = {
						4761 = { country_or_non_sovereign_subject_holds = Y66 }
						4967 = { country_or_non_sovereign_subject_holds = Y66 }
					}
				}
				Y66 = { country_event = { id = verkalozovar_events.2 } }
			}
		}
	}
	
	Y63_keeping_our_promises = {
		icon = mission_ras
		position = 5
		required_missions = { Y63_end_ghost_emperor }
		
		provinces_to_highlight = {
			OR = {
				owned_by = Y66
				AND = {
					OR = {
						area = phonan_area
						area = ananhu_area
						area = nui_phom_area
					}
					NOT = { country_or_non_sovereign_subject_holds = ROOT }
				}
			}
		}
		
		trigger = {
			NOT = { exists = Y66 }
			phonan_area = {
				type = all
				country_or_non_sovereign_subject_holds = ROOT
			}
			ananhu_area = {
				type = all
				country_or_non_sovereign_subject_holds = ROOT
			}
			nui_phom_area = {
				type = all
				country_or_non_sovereign_subject_holds = ROOT
			}
		}
		
		effect = {
			country_event = { id = verkalozovar_events.4 }
			5424 = {
				remove_human_minority_size_effect = yes
			}
			hidden_effect = { complete_mission = Y63_shadow_of_the_mountain }
		}
	}
}

#Ma Hoang wins the civil war
Y63_missions_1b = {
	slot = 1
	generic = no
	ai = yes 
	potential = {
		tag = Y63
		NOT = { has_global_flag =  khom_civilwar_honsai_won_war }
	}
	has_country_shield = yes
	
	Y63_welcome_hinphati_veterans = {
		icon = mission_ras
		position = 2
		required_missions = { Y63_civil_intercession }
		
		trigger = {
			NOT = { tag = Y66 }
			all_subject_country = {
				has_opinion = {
					who = ROOT
					value = 100
				}
			}
		}
		
		effect = {
			5424 = {
				add_human_minority_size_effect = yes
			}
			add_country_modifier = {
				name = Y63_hinphati_veterans
				duration = 3650
			}
			hidden_effect = { complete_mission = Y63_harbor_dinh_loyalists }
		}
	}
	
	Y63_honor_beyond_the_mountain = {
		icon = mission_ras
		position = 3
		required_missions = { Y63_welcome_hinphati_veterans }
		
		trigger = {
			reverse_has_opinion = {
				who = Y67
				value = 150
			}
			alliance_with = Y67
		}
		
		effect = {
			country_event = { id = verkalozovar_events.5 }
		}
	}
	
	Y63_more_than_friends = {
		icon = mission_ras
		position = 4
		required_missions = { Y63_honor_beyond_the_mountain }
		
		trigger = {
			army_size = Y67
			5424 = {
				has_dwarven_hold_4 = yes
			}
			custom_trigger_tooltip = {
				tooltip = Y63_more_than_friends_tt
				if = {
					limit = { mission_completed = Y63_honor_beyond_the_mountain }
					NOT = { has_country_modifier = Y63_treaty_happened }
				}
				else = {
					always = no
				}
			}
		}
		
		effect = {
			Y67 = {
				country_event = { id = verkalozovar_events.8 }
			}
		}
	}
	
	Y63_shadow_of_the_mountain = {
		icon = mission_ras
		position = 5
		required_missions = { Y63_more_than_friends }
		
		trigger = {
			Y67 = {
				is_subject_of = ROOT
				is_subject_other_than_tributary_trigger = yes
				NOT = { liberty_desire = 50 }
			}
		}
		
		effect = {
			create_subject = {
				subject_type = patronate
				subject = Y67
			}
			hidden_effect = { complete_mission = Y63_keeping_our_promises }
		}
	}
}

Y63_missions_1 = {
	slot = 1
	generic = no
	ai = yes 
	potential = {
		tag = Y63
	}
	has_country_shield = yes

	Y63_wonderful_wizards_of_oz = {
		icon = mission_ras
		position = 7
		required_missions = { Y63_king_of_kai }
		
		trigger = {
			calc_true_if = {
				desc = Y63_wonderful_wizards_of_oz_tt
				amount = 4
				asia = {
					type = all
					owner = { is_subject_of = ROOT }
					has_building = mage_tower
				}
			}
			has_estate_privilege = estate_mages_patronage_of_the_magical_arts
		}
		
		effect = {
			country_event = { id = verkalozovar_events.11 }
		}
	}
	
	Y63_wisdom_of_ancients = {
		icon = mission_ras
		position = 9
		required_missions = { Y63_wonderful_wizards_of_oz Y63_secrets_from_days_gone }
		
		trigger = {
			NOT = { is_at_war = yes }
			monthly_adm = 6
			monthly_dip = 6
			monthly_mil = 6
			has_regency = no
		}
		
		effect = {
			add_country_modifier = {
				name = Y63_commuting_with_oz_amekh
				duration = 365
			}
			country_event = { id = verkalozovar_events.12 days = 365 }
		}
	}
	
	Y63_runic_renaissance = {
		icon = mission_ras
		position = 14
		required_missions = { Y63_engrave_core_nephrite }
		
		trigger = {
			# have 3 grand runes at the same time
			if = {
				limit = {
					any_country = {
						culture_is_dwarven = yes
						capital_scope = { superregion = east_serpentspine_superregion }
					}
				}
				any_ally = {
					culture_is_dwarven = yes
				}
			}
			else = {
				any_known_country = {
					culture_is_dwarven = yes
					has_opinion = {
						who = ROOT
						value = 150
					}
				}
			}
			custom_trigger_tooltip = {
				tooltip = Y63_runic_renaissance_tt
				num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = {
					value = 15
					NOT = { owned_by = ROOT }
					has_building = mage_tower
					has_production_building_trigger = yes
				}
			}
		}
		
		effect = {
			custom_tooltip = Y63_unlocked_jorkin_rune_tt
			set_country_flag = Y63_unlocked_jorkin_rune
		}
	}
}

Y63_missions_2 = {
	slot = 2
	generic = no
	ai = yes 
	potential = {
		tag = Y63
	}
	has_country_shield = yes
	
	Y63_civil_intercession = {
		icon = mission_ras
		position = 1
		required_missions = { }
		
		trigger = {
			custom_trigger_tooltip = {
				tooltip = Y63_intercession_tt
				OR = {
					AND = {
						offensive_war_with = Y66
						has_country_flag = Y63_ma_hoang_friendship_flag
					}
					has_country_flag = Y63_ma_hoang_angy_flag
					NOT = { Y66 = { is_at_war = yes } }
				}
			}
			custom_trigger_tooltip = {
				tooltip = Y63_intercession_2_tt
				Y67 = { war_score = 25 }
			}
		}
		
		effect = {
			every_subject_country = {
				limit = { primary_culture = hinphat }
				add_country_modifier = {
					name = Y63_final_offensive
					duration = 1825
				}
			}
		}
	}
	
	Y63_seeds_of_distrust = {
		icon = mission_ras
		position = 3
		required_missions = { Y63_harbor_dinh_loyalists Y63_welcome_hinphati_veterans }
		
		trigger = {
			if = {
				limit = { NOT = { exists = Y67 } }
				NOT = { exists = Y67 }
			}
			else_if = {
				limit = { NOT = { alliance_with = Y71 } }
				NOT = { alliance_with = Y71 }
			}
			else = {
				has_spy_network_in = {
					who = Y71
					value = 25
				}
				Y71 = {
					trust = {
						who = ROOT
						value = 70
					}
				}
			}
		}
		
		effect = {
			if = {
				limit = {
					Y67 = { alliance_with = Y71 }
				}
				Y67 = {
					add_trust = {
						who = Y71
						value = -25
						mutual = yes
					}
					add_opinion = {
						who = Y71
						modifier = Y63_seeds_of_distrust
					}
					reverse_add_opinion = {
						who = Y71
						modifier = Y63_seeds_of_distrust
					}
				}
				Y71 = {
					add_country_modifier = {
						name = Y63_diplomatic_sabotage
						duration = 1825
					}
				}
			}
		}
	}
	
	Y63_quash_the_revolt = {
		icon = mission_ras
		position = 4
		required_missions = { Y63_seeds_of_distrust }
		
		trigger = {
			army_size_percentage = 0.9
			if = {
				limit = { has_global_flag = khom_civilwar_honsai_won_war }
				trade_embargoing  = Y71
			}
		}
		
		effect = {
			if = {
				limit = { exists = Y71 }
				declare_war_with_cb = {
					who = Y71
					casus_belli = cb_vassalize_mission
				}
				if = {
					limit = { NOT = { has_global_flag = khom_civilwar_honsai_won_war } }
					4751 = { add_claim = ROOT }
				}
			}
			else = {
				4751 = {
					owner = {
						reverse_add_casus_belli = {
							target = ROOT
							type = cb_vassalize_mission
						}
					}
				}
			}
		}
	}
	
	Y63_unkillable_east = {
		icon = mission_ras
		position = 5
		required_missions = { Y63_quash_the_revolt }
		
		trigger = {
			Y71 = {
				is_subject_of = ROOT
				is_subject_other_than_tributary_trigger = yes
				NOT = { liberty_desire = 50 }
			}
		}
		
		effect = {
			create_subject = {
				subject_type = patronate
				subject = Y71
			}
		}
	}
	
	Y63_king_of_kai = {
		icon = mission_ras
		position = 6
		required_missions = { Y63_unkillable_east Y63_shadow_of_the_mountain Y63_keeping_our_promises Y63_toast_to_unity }
		
		trigger = {
			any_subject_country = {
				primary_culture = phonan
				is_subject_of_type = patronate
			}
			any_subject_country = {
				primary_culture = hinphat
				is_subject_of_type = patronate
			}
			any_subject_country = {
				primary_culture = bokai
				is_subject_of_type = patronate
			}
			any_subject_country = {
				primary_culture = sikai
				is_subject_of_type = patronate
			}
			NOT = {
				any_subject_country = {
					variable_arithmetic_trigger = {
						custom_tooltip = has_twice_our_development_tt
						export_to_variable = {
							which = subject_development
							value = trigger_value:total_development
						}
						export_to_variable = {
							which = overlord_development
							value = trigger_value:total_development
							who = ROOT
						}
						multiply_variable = { which = overlord_development value = 2 }
						check_variable = { which = subject_development which = overlord_development }
					}
				}
			}
			has_estate_privilege = estate_nobles_strong_duchies
		}
		
		effect = {
			if = {
				limit = { government_rank = 1 }
				set_government_rank = 2
			}
			custom_tooltip = Y63_unlock_patronate_estate_tt
			random_subject_country = {
				limit = {
					primary_culture = phonan
					is_subject_of_type = patronate
				}
				override_country_name = Y63_PHONAN_NAME
				hidden_effect = {
					south_haless_superregion = {
						limit = { culture = phonan }
						add_permanent_claim = PREV
					}
				}
			}
			random_subject_country = {
				limit = {
					primary_culture = hinphat
					is_subject_of_type = patronate
				}
				override_country_name = Y63_HINPHAT_NAME
				hidden_effect = {
					south_haless_superregion = {
						limit = { culture = hinphat }
						add_permanent_claim = PREV
					}
				}
			}
			random_subject_country = {
				limit = {
					primary_culture = bokai
					is_subject_of_type = patronate
				}
				override_country_name = Y63_BOKAI_NAME
				hidden_effect = {
					south_haless_superregion = {
						limit = { culture = bokai }
						add_permanent_claim = PREV
					}
				}
			}
			random_subject_country = {
				limit = {
					primary_culture = sikai
					is_subject_of_type = patronate
				}
				override_country_name = Y63_SIKAI_NAME
				hidden_effect = {
					south_haless_superregion = {
						limit = { culture = sikai }
						add_permanent_claim = PREV
					}
				}
			}
			custom_tooltip = Y63_king_of_kai_effect_tt
		}
	}
	
	Y63_investigate_old_fort = {
		icon = mission_ras
		position = 7
		required_missions = { Y63_king_of_kai }
		
		trigger = {
			4755 = {
				owner = { is_subject_of = ROOT }
				num_of_units_in_province = {
					who = ROOT
					type = infantry
					amount = 5
				}
			}
		}
		
		effect = {
			4755 = {
				kill_units = {
					who = ROOT
					type = infantry
					amount = 5
				}
				add_permanent_province_modifier = {
					name = Y63_investigatory_expedition
					duration = 1825
				}
			}
		}
	}
	
	Y63_secrets_from_days_gone = {
		icon = mission_ras
		position = 8
		required_missions = { Y63_investigate_old_fort Y63_wonderful_wizards_of_oz }
		
		trigger = {
			4755 = {
				NOT = { has_province_modifier = Y63_investigatory_expedition }
			}
			adm_power = 100
		}
		
		effect = {
			add_adm_power = -100
			custom_tooltip = Y63_unlocked_minor_runes_tt
			set_country_flag = Y63_unlocked_minor_runes
		}
	}
	
	Y63_rise_of_runesmiths = {
		icon = mission_ras
		position = 10
		required_missions = { Y63_wisdom_of_ancients }
		
		trigger = {
			estate_loyalty = {
				estate = estate_mages
				loyalty = 60
			}
			# has an active rune
			NOT = { has_country_modifier = Y63_commuting_with_oz_amekh }
		}
		
		effect = {
			if = {
				limit = { NOT = { government = theocracy } }
				change_government = theocracy
			}
			add_government_reform = verkal_ozovar_magocracy
			country_event = { id = verkalozovar_events.14 days = 730 }
		}
	}
	
	Y63_palace_of_high_king = {
		icon = mission_ras
		position = 11
		required_missions = { Y63_rise_of_runesmiths }
		
		trigger = {
			treasury = 8000
			5424 = {
				NOT = {
					has_construction = building
					has_construction = missionary
					has_construction = colonist
					has_construction = culture
				}
			}
			if = {
				limit = {
					NOT = {
						has_country_flag = Y63_occupancy_king
						has_country_flag = Y63_occupancy_oz_amekh
					}
				}
				custom_trigger_tooltip = {
					tooltip = Y63_palace_of_high_king_tt
					always = no
				}
			}
		}
		
		effect = {
			add_treasury = -8000
			5424 = {
				add_province_modifier = {
					name = Y63_building_nephrite_palace
					duration = 1825
				}
			}
			if = {
				limit = { has_country_flag = Y63_occupancy_king }
				5424 = { add_province_triggered_modifier = Y63_nephrite_palace_king }
			}
			else_if = {
				limit = { has_country_flag = Y63_occupancy_oz_amekh }
				5424 = { add_province_triggered_modifier = Y63_nephrite_palace_oz_amekh }
			}
		}
	}
	
	Y63_prepare_the_beacon = {
		icon = mission_ras
		position = 12
		required_missions = { Y63_fuel_for_fire Y63_palace_of_high_king }
		
		provinces_to_highlight = {
			OR = {
				AND = {
					province_id = 5424
					NOT = {
						AND = {
							development = 100
							has_building = mage_tower
						}
					}
				}
				AND = {
					OR = {
						province_id = 4945
						province_id = 4751
						province_id = 4955
						province_id = 4764
						province_id = 4779
						province_id = 4701
						province_id = 4765
						province_id = 4963
						province_id = 4941
						province_id = 4580
						province_id = 4570
						province_id = 4565
						province_id = 4396
						province_id = 4600
					}
					NOT = {
						AND = {
							country_or_non_sovereign_subject_holds = ROOT
							development = 25
						}
					}
				}
			}
		}
		
		trigger = {
			5424 = {
				development = 100
				has_building = mage_tower
			}
			OR = {
				has_country_modifier = magic_estate_aiding_construction_1
				has_country_modifier = magic_estate_aiding_construction_2
				has_country_modifier = magic_estate_aiding_construction_3
			}
			4945 = {
				country_or_non_sovereign_subject_holds = ROOT
				development = 25
			}
			4751 = {
				country_or_non_sovereign_subject_holds = ROOT
				development = 25
			}
			4955 = {
				country_or_non_sovereign_subject_holds = ROOT
				development = 25
			}
			4764 = {
				country_or_non_sovereign_subject_holds = ROOT
				development = 25
			}
			4779 = {
				country_or_non_sovereign_subject_holds = ROOT
				development = 25
			}
			4701 = {
				country_or_non_sovereign_subject_holds = ROOT
				development = 25
			}
			4765 = {
				country_or_non_sovereign_subject_holds = ROOT
				development = 25
			}
			4963 = {
				country_or_non_sovereign_subject_holds = ROOT
				development = 25
			}
			4941 = {
				country_or_non_sovereign_subject_holds = ROOT
				development = 25
			}
			4580 = {
				country_or_non_sovereign_subject_holds = ROOT
				development = 25
			}
			4570 = {
				country_or_non_sovereign_subject_holds = ROOT
				development = 25
			}
			4565 = {
				country_or_non_sovereign_subject_holds = ROOT
				development = 25
			}
			4396 = {
				country_or_non_sovereign_subject_holds = ROOT
				development = 25
			}
			4600 = {
				country_or_non_sovereign_subject_holds = ROOT
				development = 25
			}
		}
		
		effect = {
			add_country_modifier = {
				name = Y63_preparing_the_beacon
				duration = 1095
			}
		}
	}
	
	Y63_engrave_core_nephrite = {
		icon = mission_ras
		position = 13
		required_missions = { Y63_prepare_the_beacon }
		
		trigger = {
			NOT = { has_country_modifier = Y63_preparing_the_beacon }
			5424 = {
				has_local_modifier_value = {
					which = local_production_efficiency
					value = 1.5
				}
			}
			OR = {
				court_mage = 3
				5424 = {
					has_dwarven_hold_8 = yes
				}
			}
			estate_loyalty = {
				estate = estate_mages
				loyalty = 75
			}
			# Gulan-Amekh rune active
		}
		
		effect = {
			country_event = { id = verkalozovar_events.15 }
		}
	}
	
	Y63_runic_domination = {
		icon = mission_ras
		position = 15
		required_missions = { Y63_runic_renaissance Y63_focal_point }
		
		provinces_to_highlight = {
			OR = {
				AND = {
					province_id = 4559
					NOT = { has_courthouse_building_trigger = yes }
				}
				AND = {
					OR = {
						province_id = 4945
						province_id = 4751
						province_id = 4955
						province_id = 4764
						province_id = 4779
						province_id = 4701
						province_id = 4765
						province_id = 4963
						province_id = 4941
						province_id = 4580
						province_id = 4570
						province_id = 4565
						province_id = 4396
						province_id = 4600
					}
					NOT = { has_building = mage_tower }
				}
			}
		}
		
		trigger = {
			4559 = {
				has_courthouse_building_trigger = yes
			}
			all_subject_country = {
				NOT = { liberty_desire = 50 }
			}
			OR = {
				has_ruler_modifier = magic_realm_enchantment_charm_assuage_subjects_2
				has_ruler_modifier = magic_realm_enchantment_charm_assuage_subjects_3
			}
			4945 = {
				has_building = mage_tower
			}
			4751 = {
				has_building = mage_tower
			}
			4955 = {
				has_building = mage_tower
			}
			4764 = {
				has_building = mage_tower
			}
			4779 = {
				has_building = mage_tower
			}
			4701 = {
				has_building = mage_tower
			}
			4765 = {
				has_building = mage_tower
			}
			4963 = {
				has_building = mage_tower
			}
			4941 = {
				has_building = mage_tower
			}
			4580 = {
				has_building = mage_tower
			}
			4570 = {
				has_building = mage_tower
			}
			4565 = {
				has_building = mage_tower
			}
			4396 = {
				has_building = mage_tower
			}
			4600 = {
				has_building = mage_tower
			}
		}
		
		effect = {
			add_country_modifier = {
				name = Y63_runethought_network
				duration = -1
			}
			custom_tooltip = Y63_mage_tower_subject_no_diplo_upkeep_tt # todo
			set_country_flag = Y63_mage_tower_subject_no_diplo_upkeep
			custom_tooltip = Y63_unlocked_dauth_rune_tt
			set_country_flag = Y63_unlocked_dauth_rune
		}
	}
}

Y63_missions_3 = {
	slot = 3
	generic = no
	ai = yes 
	potential = {
		tag = Y63
	}
	has_country_shield = yes
	
	Y63_united_under_mountain = {
		icon = mission_ras
		position = 2
		required_missions = { Y63_civil_intercession Y63_gates_of_mountain }
		
		trigger = {
			Y88 = {
				is_subject_of = ROOT
				has_opinion = {
					who = ROOT
					value = 150
				}
				NOT = { has_country_modifier = Y63_final_offensive }
			}
			Y87 = {
				is_subject_of = ROOT
				has_opinion = {
					who = ROOT
					value = 150
				}
				NOT = { has_country_modifier = Y63_final_offensive }
			}
			Y56 = {
				is_subject_of = ROOT
				has_opinion = {
					who = ROOT
					value = 150
				}
				NOT = { has_country_modifier = Y63_final_offensive }
			}
			OR = {
				advisor = diplomat
				advisor = statesman
			}
		}
		
		effect = {
			Y88 = {
				inherit = Y87
				inherit = Y56
			}
			create_subject = {
				subject_type = patronate
				subject = Y88
			}
			hinphat_area = {
				set_local_autonomy = 0
			}
			phakphon_area = {
				set_local_autonomy = 0
			}
		}
	}
	
	Y63_reminder_of_duty = {
		icon = mission_ras
		position = 3
		required_missions = { Y63_harbor_dinh_loyalists Y63_welcome_hinphati_veterans Y63_united_under_mountain }
		
		trigger = {
			if = {
				limit = { exists = Y59 }
				army_size = Y59
				prestige = Y59
				reverse_has_opinion_modifier = {
					who = Y59
					modifier = warned
				}
				NOT = { truce_with = Y59 }
			}
			else = {
				thirabnir_area = {
					type = all
					owner = { is_subject_of = ROOT }
				}
			}
		}
		
		effect = {
			if = {
				limit = { exists = Y59 }
				declare_war_with_cb = {
					who = Y59
					casus_belli = cb_vassalize_mission
				}
			}
			else = {
				custom_tooltip = Y63_reminder_of_duty_tt
				hidden_effect = {
					Y59 = {
						every_core_province = {
							add_permanent_claim = Y88
						}
					}
				}
			}
		}
	}
	
	Y63_mercantile_escalation = {
		icon = mission_ras
		position = 4
		required_missions = { Y63_reminder_of_duty }
		
		trigger = {
			trading_policy_in_node = {
				node = 4779
				policy = hostile_trading
			}
			OR = {
				ngoen_area = {
					type = all
					owner = { is_subject_of = ROOT }
				}
				4777 = {
					owner = {
						has_spy_network_from = {
							who = ROOT
							value = 50
						}
					}
				}
			}
			if = {
				limit = { NOT = { exists = Y59 } }
				Y88 = {
					any_owned_province = {
						is_core = Y59
					}
				}
			}
		}
		
		effect = {
			if = {
				limit = { NOT = { exists = Y59 } }
				Y88 = { release = Y59 }
				vassalize = Y59
			}
			ngoen_area = {
				add_permanent_claim = Y59
			}
		}
	}
	
	Y63_toast_to_unity = {
		icon = mission_ras
		position = 5
		required_missions = { Y63_mercantile_escalation }
		
		trigger = {
			Y59 = {
				is_subject_of = ROOT
				is_subject_other_than_tributary_trigger = yes
				NOT = { liberty_desire = 50 }
			}
		}
		
		effect = {
			create_subject = {
				subject_type = patronate
				subject = Y59
			}
			if = {
				limit = { Y59 = { NOT = { government = monarchy } } }
				Y59 = {
					change_government = monarchy
					add_government_reform = autocracy_reform
				}
			}
			else = {
				Y59 = {
					add_government_reform = autocracy_reform
				}
			}
		}
	}
	
	Y63_great_unifier = {
		icon = mission_ras
		position = 7
		required_missions = { Y63_king_of_kai Y63_king_of_dwarves }
		
		trigger = {
			custom_trigger_tooltip = {
				tooltip = Y63_great_unifier_1_tt
				asia = {
					type = all
					OR = {
						NOT = { culture_group = kai }
						culture = binhrung
						owner = { is_subject_of = ROOT }
					}
				}
			}
			custom_trigger_tooltip = {
				tooltip = Y63_great_unifier_2_tt
				all_subject_country = {
					OR = {
						NOT = { culture_group = kai }
						NOT = { liberty_desire = 50 }
					}
				}
			}
		}
		
		effect = {
			add_country_modifier = {
				name = Y63_unifier_of_the_kai
				duration = 9125
			}
			Y88 = {
				add_country_modifier = {
					name = Y63_the_little_lord
					duration = 36500
				}
			}
		}
	}
	
	Y63_pacify_south = {
		icon = mission_ras
		position = 9
		required_missions = { Y63_great_unifier }
		
		trigger = {
			has_estate_privilege = estate_adventurers_spirit_hunters
			custom_trigger_tooltip = {
				tooltip = Y63_pacify_south_tt
				temple_province_group = {
					type = all
					OR = {
						NOT = { owner = { is_subject_of = ROOT } }
						has_fort_building_trigger = yes
					}
				}
			}
			any_war_enemy_country = {
				religion = mystic_accord
				capital_scope = {
					OR = {
						region = lupulan_rainforest_region
						region = thidinkai_region
					}
				}
			}
		}
		
		effect = {
			custom_tooltip = Y63_pacify_south_effect_1_tt
			hidden_effect = {
				lupulan_rainforest_region = {
					limit = { owner = { religion = mystic_accord } }
					add_permanent_claim = ROOT
				}
			}
			custom_tooltip = Y63_pacify_south_effect_2_tt
			hidden_effect = {
				every_subject_country = {
					limit = {
						capital_scope = { region = thidinkai_region }
						temple_province_group = {
							owned_by = PREV
						}
					}
					add_country_modifier = {
						name = Y63_march_against_the_south
						duration = 5475
					}
				}
			}
		}
	}
	
	Y63_damage_undone = {
		icon = mission_ras
		position = 10
		required_missions = { Y63_pacify_south }
		
		trigger = {
			custom_trigger_tooltip = {
				tooltip = Y63_damage_undone_tt
				lupulan_rainforest_region = {
					type = all
					OR = {
						NOT = { religion = mystic_accord }
						owner = { is_subject_of = ROOT }
					}
				}
			}
			4710 = {
				has_building = mage_tower
			}
		}
		
		effect = {
			if = {
				limit = { exists = Y65 }
				add_casus_belli = {
					target = Y65
					type = cb_vassalize_mission
					months = 240
				}
				Y65 = {
					add_country_modifier = {
						name = Y63_lupulan_ward
						duration = 1825
					}
				}
			}
			else = {
				custom_tooltip = Y63_damage_undone_effect_tt
				hidden_effect = {
					lupulan_rainforest_region = {
						limit = { religion = high_philosophy }
						add_permanent_claim = ROOT
					}
				}
			}
		}
	}
	
	Y63_fuel_for_fire = {
		icon = mission_ras
		position = 11
		required_missions = { Y63_rise_of_runesmiths Y63_damage_undone }
		
		trigger = {
			lupulan_rainforest_region = {
				type = all
				country_or_non_sovereign_subject_holds = ROOT
			}
		}
		
		effect = {
			custom_tooltip = Y63_fuel_for_fire_tt
			hidden_effect = {
				for = {
					amount = 10
					effect =
					"random_subject_country = { limit = { any_owned_province = { region = lupulan_rainforest_region has_terrain = jungle NOT = { has_province_flag = Y63_fuel_for_fire_flag } } }
						random_owned_province = { limit = { region = lupulan_rainforest_region has_terrain = jungle NOT = { has_province_flag = Y63_fuel_for_fire_flag } }
							add_base_tax = -1 add_base_production = -1 add_base_manpower = -1 add_devastation = 10 set_province_flag = Y63_fuel_for_fire_flag
						}
					}" # had to do ugly indentation to remain under the 512 characters limit
				}
				lupulan_rainforest_region = {
					clr_province_flag = Y63_fuel_for_fire_flag
				}
			}
			5424 = {
				add_province_modifier = {
					name = Y63_increased_lumber_shipments
					duration = 18250
				}
			}
		}
	}
	
	Y63_invite_mystic_refugees = {
		icon = mission_ras
		position = 12
		required_missions = { Y63_fuel_for_fire Y63_tortoise_shell }
		
		trigger = {
			bomdan_region = {
				type = all
				country_or_non_sovereign_subject_holds = ROOT
			}
			# Have Dorumdhum minor rune active
			custom_trigger_tooltip = {
				tooltip = Y63_invite_mystic_refugees_tt
				num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = {
					value = 5
					NOT = { owned_by = ROOT }
					any_neighbor_province = { region = xianjie_region }
					has_tax_building_trigger = yes
				}
			}
		}
		
		effect = {
			xianjie_region = {
				add_permanent_claim = ROOT
			}
			custom_tooltip = Y63_invite_mystic_refugees_effect_tt
			hidden_effect = {
				for = {
					amount = 3
					effect =
					"random_known_country = {
						limit = {
							religion = righteous_path
							capital_scope = { region = xianjie_region }
							NOT = { has_country_flag = Y63_invite_mystic_refugees_flag }
						}
						capital_scope = { add_base_manpower = -2 }
						set_country_flag = Y63_invite_mystic_refugees_flag
					}"
				}
				every_known_country = {
					limit = { has_country_flag = Y63_invite_mystic_refugees_flag }
					clr_country_flag = Y63_invite_mystic_refugees_flag
				}
				for = {
					amount = 3
					effect =
					"random_subject_country = { limit = { any_owned_province = { any_neighbor_province = { region = xianjie_region } has_tax_building_trigger = yes NOT = { has_province_flag = Y63_invite_mystic_refugees_flag } } }
						random_owned_province = { limit = { any_neighbor_province = { region = xianjie_region } has_tax_building_trigger = yes NOT = { has_province_flag = Y63_invite_mystic_refugees_flag } }
							add_base_manpower = 2 set_province_flag = Y63_invite_mystic_refugees_flag
						}
					}" # had to do ugly indentation to remain under the 512 characters limit
				}
				asia = {
					limit = { has_province_flag = Y63_invite_mystic_refugees_flag }
					clr_province_flag = Y63_invite_mystic_refugees_flag
				}
			}
		}
	}
	
	Y63_focal_point = {
		icon = mission_ras
		position = 14
		required_missions = { Y63_engrave_core_nephrite Y63_invite_mystic_refugees Y63_reeducate_hunters }
		
		trigger = {
			jiezhong_area = {
				type = all
				owner = { is_subject_of = ROOT }
			}
			4559 = {
				has_building = mage_tower
			}
			is_enchantment_1 = yes
		}
		
		effect = {
			custom_tooltip = Y63_unlocked_kron_rune_tt
			set_country_flag = Y63_unlocked_kron_rune
			4559 = {
				if = {
					limit = { is_core = owner }
					remove_core = owner
					add_core = ROOT
				}
				cede_province = ROOT
			}
		}
	}
	
	Y63_dawn_of_eastern_king = {
		icon = mission_ras
		position = 16
		required_missions = { Y63_runic_domination Y63_center_of_haless }
		
		trigger = {
			south_haless_superregion = {
				type = all
				country_or_non_sovereign_subject_holds = ROOT
			}
			5424 = {
				has_dwarven_hold_8 = yes
			}
			stability = 2
			devotion = 95
			is_enchantment_3 = yes
		}
		
		effect = {
			custom_tooltip = Y63_dawn_of_eastern_king_tt
			hidden_effect = {
				every_known_country = {
					limit = {
						NOT = { is_subject_of = ROOT }
						capital_scope = {
							OR = {
								superregion = rahen_superregion
								superregion = yanshen_superregion
								superregion = south_haless_superregion
							}
						}
					}
					reverse_add_casus_belli = {
						target = ROOT
						type = cb_viridescent_onslaught
					}
				}
			}
			if = {
				limit = {
					OR = {
						has_country_flag = Y63_oz_amekh_ending
						NOT = { has_ruler_flag = Y63_conversed_with_oz_amekh }
					}
				}
				custom_tooltip = Y63_will_of_the_oz_amekh_tt
				hidden_effect = {
					every_subject_country = {
						add_country_modifier = {
							name = Y63_will_of_the_oz_amekh
							duration = -1
						}
					}
				}
				custom_tooltip = Y63_hidden_behind_the_curtain_tt
				hidden_effect = { 5424 = { add_province_triggered_modifier = Y63_hidden_behind_the_curtain } }
			}
			else = {
				add_country_modifier = {
					name = Y63_absolute_domination
					duration = -1
				}
				custom_tooltip = Y63_enchantment_upgrade_tt
				set_country_flag = Y63_enchantment_upgrade
			}
		}
	}
}

Y63_missions_4 = {
	slot = 4
	generic = no
	ai = yes 
	potential = {
		tag = Y63
	}
	has_country_shield = yes

	Y63_gates_of_mountain = {
		icon = mission_ras
		position = 1
		required_missions = { }
		
		trigger = {
			4775 = {
				owner = { is_subject_of = ROOT }
				has_fort_building_trigger = yes
			}
			adm_power = 50
			mil_power = 50
		}
		
		effect = {
			add_adm_power = -50
			add_mil_power = -50
			4775 = {
				add_province_triggered_modifier = Y63_gates_of_the_sky
			}
		}
	}
	
	Y63_surface_farmers = {
		icon = mission_ras
		position = 3
		required_missions = { Y63_united_under_mountain }
		
		trigger = {
			custom_trigger_tooltip = {
				tooltip = Y63_surface_farmers_tt
				thidinkai_region = {
					type = all
					OR = {
						NOT = { culture = hinphat }
						base_production = 8
					}
				}
			}
		}
		
		effect = {
			custom_tooltip = Y63_surface_farmers_effect_tt
			hidden_effect = {
				thidinkai_region = {
					limit = { culture = hinphat }
					add_dwarven_minority_size_effect = yes
				}
			}
			hidden_effect = { country_event = { id = 6014 days = 365 } }
		}
	}
	
	Y63_symbiotic_production = {
		icon = mission_ras
		position = 4
		required_missions = { Y63_surface_farmers }
		
		trigger = {
			custom_trigger_tooltip = {
				tooltip = Y63_surface_farmers_tt
				thidinkai_region = {
					type = all
					OR = {
						NOT = { culture = hinphat }
						has_production_building_trigger = yes
					}
				}
			}
		}
		
		effect = {
			every_subject_country = {
				limit = { primary_culture = hinphat }
				medium_increase_of_dwarven_tolerance_effect = yes
				add_country_modifier = {
					name = Y63_dwarven_coexistance
					duration = -1
				}
			}
		}
	}
	
	Y63_king_of_dwarves = {
		icon = mission_ras
		position = 6
		required_missions = { Y63_symbiotic_production Y63_underground_rainwater }
		
		trigger = {
			5424 = {
				has_dwarven_hold_6 = yes
			}
			prestige = 50
		}
		
		effect = {
			country_event = { id = verkalozovar_events.20 }
			custom_tooltip = Y63_king_of_dwarves_tt
			hidden_effect = {
				5424 = {
					remove_province_triggered_modifier = Y63_masters_of_the_phokhao
					add_province_triggered_modifier = Y63_masters_of_the_phokhao_upgraded
				}
			}
		}
	}
	
	Y63_call_to_action = {
		icon = mission_ras
		position = 7
		required_missions = { Y63_king_of_dwarves }
		
		trigger = {
			OR = {
				AND = {
					estate_loyalty = {
						estate = estate_adventurers
						loyalty = 60
					}
					estate_influence = {
						estate = estate_adventurers
						influence = 40
					}
				}
				AND = {
					estate_loyalty = {
						estate = estate_nobles
						loyalty = 70
					}
					estate_influence = {
						estate = estate_nobles
						influence = 50
					}
				}
			}
		}
		
		effect = {
			custom_tooltip = Y63_call_to_action_tt
			if = {
				limit = {
					estate_loyalty = {
						estate = estate_adventurers
						loyalty = 60
					}
					estate_influence = {
						estate = estate_adventurers
						influence = 40
					}
				}
				set_country_flag = Y63_jadequest_adventurers
				# start getting adventurer jadequest events
			}
			else_if = {
				limit = {
					estate_loyalty = {
						estate = estate_nobles
						loyalty = 70
					}
					estate_influence = {
						estate = estate_nobles
						influence = 50
					}
				}
				set_country_flag = Y63_jadequest_diplomatic
				# start getting diplomatic jadequest events
			}
		}
	}
	
	Y63_brothers_revolt = {
		icon = mission_ras
		position = 9
		required_missions = { Y63_call_to_action }
		
		trigger = {
			if = {
				limit = { owns_or_non_sovereign_subject_of = 4580 }
				owns_or_non_sovereign_subject_of = 4580
			}
			else = {
				4580 = {
					owner = {
						has_spy_network_from = {
							who = ROOT
							value = 60
						}
					}
				}
				treasury = 400
			}
		}
		
		effect = {
			if = {
				limit = { NOT = { owns_or_non_sovereign_subject_of = 4580 } }
				add_treasury = -400
				custom_tooltip = Y63_brothers_revolt_tt
				hidden_effect = {
					4580 = {
						owner = {
							capital_scope = {
								every_province_in_state = {
									spawn_rebels = {
										type = particularist_rebels
										size = 2
									}
								}
							}
							set_country_flag = Y63_brothers_revolt_flag
						}
					}
				}
			}
		}
	}
	
	Y63_tortoise_shell = {
		icon = mission_ras
		position = 11
		required_missions = { Y63_brothers_revolt }
		
		trigger = {
			OR = {
				fortification_expert = 2
				has_global_modifier_value = {
					which = siege_ability
					value = 0.25
				}
			}
			num_of_artillery = 25
		}
		
		effect = {
			custom_tooltip = Y63_tortoise_shell_tt
			hidden_effect = {
				asia = {
					limit = {
						OR = {
							culture = risbeko
							culture = biengdi
							culture = gon
						}
					}
					add_permanent_claim = ROOT
				}
			}
			add_country_modifier = {
				name = Y63_shellcracker
				duration = 5475
			}
		}
	}
	
	Y63_center_of_haless = {
		icon = mission_ras
		position = 15
		required_missions = { Y63_focal_point }
		
		trigger = {
			custom_trigger_tooltip = {
				tooltip = Y63_center_of_haless_1_tt
				south_haless_superregion = {
					type = all
					OR = {
						NOT = { has_dwarven_minority_trigger = yes }
						country_or_non_sovereign_subject_holds = ROOT
					}
				}
				yanshen_superregion = {
					type = all
					OR = {
						NOT = { has_dwarven_minority_trigger = yes }
						country_or_non_sovereign_subject_holds = ROOT
					}
				}
			}
			4458 = {
				owner = {
					has_opinion_modifier = {
						who = ROOT
						modifier = sent_gift
					}
				}
			}
			4435 = {
				owner = {
					has_opinion_modifier = {
						who = ROOT
						modifier = sent_gift
					}
				}
			}
			4411 = {
				owner = {
					has_opinion_modifier = {
						who = ROOT
						modifier = sent_gift
					}
				}
			}
			custom_trigger_tooltip = {
				tooltip = Y63_center_of_haless_2_tt
				4500 = {
					all_trade_node_member_province = {
						NOT = { higher_development_than = 4500 }
					}
				}
			}
			# has Gulan-Amekh rune active
		}
		
		effect = {
			custom_tooltip = Y63_center_of_haless_effect_tt
			hidden_effect = {
				4621 = {
					add_permanent_province_modifier = {
						name = golden_highway_under_construction
						duration = -1
					}
				}
				4784 = {
					add_permanent_province_modifier = {
						name = golden_highway_under_construction
						duration = -1
					}
				}
				4782 = {
					add_permanent_province_modifier = {
						name = golden_highway_under_construction
						duration = -1
					}
				}
				4940 = {
					add_permanent_province_modifier = {
						name = golden_highway_under_construction
						duration = -1
					}
				}
				4777 = {
					add_permanent_province_modifier = {
						name = golden_highway_under_construction
						duration = -1
					}
				}
				4942 = {
					add_permanent_province_modifier = {
						name = golden_highway_under_construction
						duration = -1
					}
				}
				4776 = {
					add_permanent_province_modifier = {
						name = golden_highway_under_construction
						duration = -1
					}
				}
				4775 = {
					add_permanent_province_modifier = {
						name = golden_highway_under_construction
						duration = -1
					}
				}
			}
			5424 = {
				center_of_trade = 3
			}
		}
	}
}

Y63_missions_5 = {
	slot = 5
	generic = no
	ai = yes 
	potential = {
		tag = Y63
	}
	has_country_shield = yes

	Y63_crafting_a_foundation = {
		icon = mission_ras
		position = 1
		required_missions = { }
		
		trigger = {
			5424 = {
				if = {
					limit = { has_dlc = "Leviathan" }
					has_expanded_infrastructure_level = { level = 1 }
					num_of_times_improved = 5
				}
				else = {
					num_of_times_improved = 8
				}
			}
		}
		
		effect = {
			add_country_modifier = {
				name = Y63_architectural_revitalization
				duration = 3650
			}
			every_subject_country = {
				add_country_modifier = {
					name = Y63_architectural_revitalization
					duration = 3650
				}
			}
		}
	}
	
	Y63_bounty_of_the_mountains = {
		icon = mission_ras
		position = 2
		required_missions = { Y63_crafting_a_foundation }
		
		trigger = {
			5424 = {
				has_dwarven_hold_3 = yes
			}
		}
		
		effect = {
			5424 = {
				add_province_triggered_modifier = Y63_masters_of_the_phokhao
			}
		}
	}
	
	Y63_repopulate_rune_workshops = {
		icon = mission_ras
		position = 3
		required_missions = { Y63_bounty_of_the_mountains }
		
		trigger = {
			5424 = {
				has_production_building_trigger = yes
				has_dwarven_hold_4 = yes
			}
			estate_loyalty = {
				estate = estate_mages
				loyalty = 60
			}
		}
		
		effect = {
			5424 = {
				add_building_construction = {
					building = mage_tower
					speed = 0.5
					cost = 0.25
				}
			}
		}
	}
	
	Y63_underground_rainwater = {
		icon = mission_ras
		position = 5
		required_missions = { Y63_repopulate_rune_workshops }
		
		trigger = {
			5424 = {
				OR = {
					has_province_modifier = magic_estate_ward_1
					has_province_modifier = magic_estate_ward_2
					has_province_modifier = magic_estate_ward_3
				}
			}
			crown_land_share = 5
		}
		
		effect = {
			add_stability = 1
			every_subject_country = {
				add_stability = 1
			}
			custom_tooltip = Y63_underground_rainwater_tt
			set_country_flag = remove_dip_from_regulations
			change_estate_land_share = {
				estate = estate_mages
				share = 5
			}
		}
	}
	
	Y63_new_settlement = {
		icon = mission_ras
		position = 7
		required_missions = { Y63_king_of_dwarves }
		
		trigger = {
			custom_trigger_tooltip = {
				tooltip = Y63_new_settlement_tt
				check_variable = { jadeCounter = 3 }
			}
			4756 = {
				owner = {
					has_opinion = {
						who = ROOT
						value = 200
					}
				}
			}
		}
		
		effect = {
			4756 = {
				change_culture = jade_dwarf
				change_religion = ancestor_worship
				add_permanent_province_modifier = {
					name = Y63_dwarven_exclave
					duration = -1
				}
			}
		}
	}
	
	Y63_armorsmiths_of_binhrunghin = {
		icon = mission_ras
		position = 8
		required_missions = {  Y63_great_unifier Y63_call_to_action Y63_new_settlement }
		
		trigger = {
			4955 = {
				has_production_building_trigger = yes
				base_production = 8
				owner = { is_subject_of = ROOT }
			}
		}
		
		effect = {
			if = {
				limit = { has_country_flag = Y63_jadequest_adventurers }
				custom_tooltip = Y63_armorsmiths_of_binhrunghin_adventurers_tt
				set_country_flag = Y63_jadequest_adventurers_1
				# unlock adventurer jadequest events "Helping the War Effort"
			}
			if = {
				limit = { has_country_flag = Y63_jadequest_diplomatic }
				custom_tooltip = Y63_armorsmiths_of_binhrunghin_diplomatic_tt
				set_country_flag = Y63_jadequest_diplomatic_1
				# unlock diplomatic jadequest events "Great Foundries"
			}
		}
	}
	
	Y63_hermit_fortress = {
		icon = mission_ras
		position = 10
		required_missions = { Y63_armorsmiths_of_binhrunghin Y63_brothers_revolt }
		
		trigger = {
			4580 = {
				fort_level = 4
				if = {
					limit = {
						OR = {
							NOT = { has_manufactory_trigger = yes }
							has_building = ramparts
						}
					}
					has_building = ramparts
				}
				owner = { is_subject_of = ROOT }
			}
		}
		
		effect = {
			if = {
				limit = { has_country_flag = Y63_jadequest_adventurers }
				custom_tooltip = Y63_hermit_fortress_adventurers_tt
				set_country_flag = Y63_jadequest_adventurers_2
				# unlock adventurer jadequest events "Construction Assistance"
			}
			if = {
				limit = { has_country_flag = Y63_jadequest_diplomatic }
				custom_tooltip = Y63_hermit_fortress_diplomatic_tt
				set_country_flag = Y63_jadequest_diplomatic_2
				# unlock diplomatic jadequest events "A Helping Hand in Administration"
			}
		}
	}
	
	Y63_reeducate_hunters = {
		icon = mission_ras
		position = 13
		required_missions = { Y63_hermit_fortress }
		
		trigger = {
			4570 = {
				has_trade_building_trigger = yes
				if = {
					limit = { has_dlc = "Dharma" }
					province_has_center_of_trade_of_level = 2
				}
				owner = { is_subject_of = ROOT }
			}
		}
		
		effect = {
			if = {
				limit = { has_country_flag = Y63_jadequest_adventurers }
				custom_tooltip = Y63_reeducate_hunters_adventurers_tt
				set_country_flag = Y63_jadequest_adventurers_3
				# unlock adventurer jadequest events "Beast Slayers"
			}
			if = {
				limit = { has_country_flag = Y63_jadequest_diplomatic }
				custom_tooltip = Y63_reeducate_hunters_diplomatic_tt
				set_country_flag = Y63_jadequest_diplomatic_3
				# unlock diplomatic jadequest events "Big Returns"
			}
		}
	}
}
