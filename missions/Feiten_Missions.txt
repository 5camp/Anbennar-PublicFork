feiten_missions_1 = {
	slot = 1
	generic = no
	ai = yes
	potential = {
		OR = {
			was_tag = Y20
			tag = Y20
		}
	}
	has_country_shield = yes

	feiten_port_facilities = {
		icon = mission_unknown_mission
		position = 1
		required_missions = { }

		provinces_to_highlight = { province_id = 4879 } # Feiten 
		
		trigger = {
			4879 = {
				development = 25
				has_dock_building_trigger = yes
			}
		}
		
		effect = {
			add_country_modifier = {
				name = feiten_port_facilities_built
				duration = 7300
			}
		}
	}
	feiten_dual_harbors = {
		icon = mission_unknown_mission
		position = 3
		required_missions = {
			feiten_port_facilities
			feiten_integrate_cuihiok
		}

		provinces_to_highlight = {
			OR = {
				province_id = 4879 # Feiten
				province_id = 4884 # Cuihiok
			}
			OR = {
				has_trade_building_trigger = no
				has_influencing_fort = no
			}
			if = {
				limit = { has_dlc = "Dharma" }
				
			}
		}
		
		trigger = {
			4884 = {
				has_trade_building_trigger = yes
				has_influencing_fort = yes
			}
			4879 = {
				has_trade_building_trigger = yes
				has_influencing_fort = yes
			}
			OR = {
				4879 = { province_has_center_of_trade_of_level = 2 }
				4884 = { province_has_center_of_trade_of_level = 2 }
			}
		}
		
		effect = {
			add_mercantilism = 3
			custom_tooltip = "If both provinces have a level 2 Center of Trade, gain an additional §G3.00§! mercantilism"
			if = {
				limit = {
					4879 = { province_has_center_of_trade_of_level = 2 }
					4884 = { province_has_center_of_trade_of_level = 2 }
				}
				add_mercantilism = 3
			}
			if = {
				limit = {
					4879 = { province_has_center_of_trade_of_level = 2 }
					4884 = { province_has_center_of_trade_of_level = 2 }
				}
				# I know its not random but the illusion of randomness is fine in this case
				random_list = {
					1 = {
						4879 = {
							add_province_modifier = {
								name = feiten_dual_harbors
								duration = 7300
							}
						}
					}
					1 = {
						4884 = {
							add_province_modifier = {
								name = feiten_dual_harbors
								duration = 7300
							}
						}
					}
				}
			}
			else_if = {
				limit = { 4879 = { province_has_center_of_trade_of_level = 2 } }
				4879 = {
					add_province_modifier = {
						name = feiten_dual_harbors
						duration = 7300
					}
				}
			}
			else_if = {
				limit = { 4884 = { province_has_center_of_trade_of_level = 2 } }
				4884 = {
					add_province_modifier = {
						name = feiten_dual_harbors
						duration = 7300
					}
				}
			}
		}
	}
	feiten_coast_blooms = {
		icon = mission_unknown_mission
		position = 4
		required_missions = { feiten_dual_harbors }

		provinces_to_highlight = {
			sea_zone = { province_id = 1371 } # Jellyfish Coast
			owned_by = ROOT
			OR = {
				NOT = { development = 10 }
				if = {
					limit = { has_dlc = "Mandate of Heaven" }
					is_prosperous = no
				}
				else = { has_tax_building_trigger = no }
			}
		}
		
		trigger = {
			num_of_owned_provinces_with = {
				value = 6
				sea_zone = { province_id = 1371 }
				development = 10
			}
			iongsim_area = {
				type = all
				if = {
					limit = { has_dlc = "Mandate of Heaven" }
					is_prosperous = yes
				}
				else = { has_tax_building_trigger = yes }
			}
		}
		
		effect = {
			add_mercantilism = 3
			add_republican_tradition_excess_to_mana_effect = { VAL = 10 }
		}
	}
}

feiten_missions_2 = {
	slot = 2
	generic = no
	ai = yes
	potential = {
		OR = {
			was_tag = Y20
			tag = Y20
		}
	}
	has_country_shield = yes

	feiten_integrate_cuihiok = {
		icon = mission_unknown_mission
		position = 2
		required_missions = { }

		provinces_to_highlight = { province_id = 4884 } # Cuihiok 
		
		trigger = {
			4884 = {
				has_tax_building_trigger = yes
				NOT = { local_autonomy = 10 }
			}
		}
		
		effect = {
			4884 = {
				add_base_manpower = 1
				add_base_production = 1
				add_base_tax = 1
				change_religion = high_philosophy
			}
			hungngon_area = { add_permanent_claim = ROOT }
			wanglam_area = { add_claim = ROOT }
			4984 = { add_claim = ROOT }
			4982 = { add_claim = ROOT }
		}
	}
	feiten_into_the_tea_forest = {
		icon = mission_unknown_mission
		position = 3
		required_missions = { feiten_integrate_cuihiok }

		provinces_to_highlight = {
			area = hungngon_area
			OR = {
				NOT = { owned_by = ROOT }
				NOT = { is_core = ROOT }
			}
		}
		
		trigger = {
			hungngon_area = {
				type = all
				owned_by = ROOT
				is_core = ROOT
			}
		}
		
		effect = {
			wanglam_area = { add_permanent_claim = ROOT }
			4984 = { add_permanent_claim = ROOT }
			4982 = { add_permanent_claim = ROOT }
			add_power_projection = {
				type = mission_rewards_power_projection
				amount = 10
			}
		}
	}
	feiten_monopoly_on_tea_gardens = {
		icon = mission_unknown_mission
		position = 4
		required_missions = { feiten_into_the_tea_forest }

		provinces_to_highlight = {
			country_or_non_sovereign_subject_holds = ROOT
			trade_goods = tea
			OR = {
				has_production_building_trigger = no
				has_trade_building_trigger = no
			}
		}
		
		trigger = {
			num_of_owned_provinces_with = {
				value = 3
				trade_goods = tea
				has_production_building_trigger = yes
				has_trade_building_trigger = yes
			}
		}
		
		effect = {
			add_years_of_owned_provinces_production_income = {
				years = 2
				trigger = {
					trade_goods = tea
					has_production_building_trigger = yes
					has_trade_building_trigger = yes
				}
			}
			custom_tooltip = fulfill_conditions_prov_tt
			tooltip = {
				capital_scope = {
					add_province_modifier = {
						name = feiten_local_trade_monopoly
						duration = 10950
					}
				}
			}
			hidden_effect = {
				every_owned_province = {
					limit = {
						trade_goods = tea
						has_production_building_trigger = yes
						has_trade_building_trigger = yes
					}
					add_province_modifier = {
						name = feiten_local_trade_monopoly
						duration = 10950
					}
				}
			}
		}
	}
}

feiten_missions_3 = {
	slot = 3
	generic = no
	ai = yes
	potential = {
		OR = {
			was_tag = Y20
			tag = Y20
		}
	}
	has_country_shield = yes

	feiten_incite_the_rebellious_cub = {
		icon = mission_unknown_mission
		position = 1
		required_missions = { }

		provinces_to_highlight = {
			OR = {
				owned_by = Y24 # Luoyip
				owned_by = Y21 # Xiyun
			}
		}
		
		trigger = {
			reverse_has_opinion = {
				who = Y24
				value = 200
			}
			has_spy_network_in = {
				who = Y21
				value = 50
			}
		}
		
		effect = {
			every_province = {
				limit = { owned_by = Y21 }
				add_permanent_claim = Y24
			}
			declare_war_with_cb = {
				who = Y21
				casus_belli = cb_conquest
			}
			Y24 = { join_all_offensive_wars_of = ROOT }
			add_favors = { who = Y24 amount = 20 }
		}
	}
	feiten_under_our_wing = {
		icon = mission_unknown_mission
		position = 2
		required_missions = { feiten_incite_the_rebellious_cub }

		provinces_to_highlight = {
			if = {
				limit = { exists = Y21 }
				OR = {
					owned_by = Y24
					owned_by = Y21
				}
				
			}
			else = {
				OR = {
					province_id = 4888
					province_id = 4889
					province_id = 4893
				}
				NOT = { is_core = Y24 }
			}
		}
		
		trigger = {
			Y24 = { trust = { who = ROOT value = 90 } }
			4888 = { is_core = Y21 }
			4889 = { is_core = Y21 }
			4893 = { is_core = Y21 }
		}
		
		effect = {
			create_march = Y24
			add_dip_power = -150
		}
	}
	feiten_sate_silk_turban_greed = {
		icon = mission_unknown_mission
		position = 3
		required_missions = { feiten_under_our_wing }

		provinces_to_highlight = { province_id = 4890 } # Ongdou
		
		trigger = {
			4890 = {
				has_trade_building_trigger = yes
				has_production_building_trigger = yes
			}
		}
		
		effect = {
			add_years_of_owned_provinces_production_income = {
				years = 2
				trigger = { province_id = 4890 }
			}
			4890 = {
				add_province_modifier = {
					name = feiten_local_trade_monopoly
					duration = 10950
				}
			}
			add_prestige_excess_to_splendour_effect = { VAL = 10 }
			add_estate_loyalty = {
				estate = estate_burghers
				loyalty = 10
			}
		}
	}
	feiten_a_new_trading_power = {
		icon = mission_unknown_mission
		position = 5
		required_missions = {
			feiten_sate_silk_turban_greed
			feiten_monopoly_on_tea_gardens
			feiten_monopoly_on_salt
		}

		provinces_to_highlight = { province_id = 1372 } # Tianlou Bay
		
		trigger = {
			republican_tradition = 95
			stability = 1
			4871 = { # Tianlou
				trade_share = {
					country = ROOT
					share = 20
				}
			}
		}
		
		effect = {
			random_country = {
				limit = { owns = 4871 }
				add_historical_rival = ROOT
				ROOT = { add_historical_rival = PREV }
			}
			add_country_modifier = {
				name = feiten_trade_power_rises
				duration = 18250
			}
			# Enable merchant republic mechanics reform
		}
	}
}

feiten_missions_4 = {
	slot = 4
	generic = no
	ai = yes
	potential = {
		OR = {
			was_tag = Y20
			tag = Y20
		}
	}
	has_country_shield = yes

	feiten_white_gold = {
		icon = mission_unknown_mission
		position = 2
		required_missions = { }

		provinces_to_highlight = { owned_by = Y27 }
		
		trigger = {
			if = {
				limit = { exists = Y27 }
				OR = {
					has_spy_network_in = {
						who = Y27
						value = 50
					}
					reverse_has_opinion = {
						who = Y27
						value = 190
					}
				}
			}
			else = { 4896 = { country_or_non_sovereign_subject_holds = ROOT } }
		}
		
		effect = {
			custom_tooltip = "§TIf completed by diplomacy:§!"
			tooltip = {
				Y27 = {
					add_country_modifier = {
						name = feiten_salt_trade_deal_kohai
						duration = 7300
					}
				}
				add_country_modifier = {
					name = feiten_salt_trade_deal_feiten
					duration = 7300
				}
				add_trust = {
					who = Y27
					value = 10
					mutual = yes
				}
			}
			custom_tooltip = "§T\nIf completed by espionage:§!"
			tooltip = { hongnguan_area = { add_permanent_claim = ROOT } }
			hidden_effect = {
				if = {
					limit = { exists = Y27 }
					if = {
						limit = {
							has_spy_network_in = {
								who = Y27
								value = 50
							}
						}
						hongnguan_area = { add_permanent_claim = ROOT }
					}
					else_if = {
						limit = {
							reverse_has_opinion = {
								who = Y27
								value = 190
							}
						}
						Y27 = {
							add_country_modifier = {
								name = feiten_salt_trade_deal_kohai
								duration = 7300
							}
						}
						add_country_modifier = {
							name = feiten_salt_trade_deal_feiten
							duration = 7300
						}
						add_trust = {
							who = Y27
							value = 10
							mutual = yes
						}
					}
				}
			}
		}
	}
	feiten_control_the_salt_road = {
		icon = mission_unknown_mission
		position = 3
		required_missions = { feiten_white_gold }

		provinces_to_highlight = {
			if = {
				limit = {
					4896 = { is_permanent_claim = ROOT } # Sising
					province_id = 4896
				}
			}
			else = { owned_by = Y27 }
		}
		
		trigger = {
			OR = {
				4896 = { owned_by = ROOT }
				AND = {
					alliance_with = Y27
					Y27 = { trust = { who = ROOT value = 75 } }
					1371 = {
						trade_share = {
							country = ROOT
							share = 50
						}
					}
				}
			}
		}
		
		effect = {
			4871 = {
				add_trade_modifier = {
					who = ROOT
					duration = -1
					power = 10
					key = "Control of the Salt Road"
				}
			}
			4859 = {
				add_trade_modifier = {
					who = ROOT
					duration = -1
					power = 10
					key = "Control of the Salt Road"
				}
			}
			add_country_modifier = {
				name = feiten_salt_road_control
				duration = 7300
			}
			if = {
				limit = { has_country_modifier = feiten_salt_trade_deal_feiten }
				remove_country_modifier = feiten_salt_trade_deal_feiten
				Y27 = { remove_country_modifier = feiten_salt_trade_deal_kohai }
			}
		}
	}
	feiten_monopoly_on_salt = {
		icon = mission_unknown_mission
		position = 4
		required_missions = { feiten_control_the_salt_road }

		provinces_to_highlight = { province_id = 4896 }
		
		trigger = {
			if = {
				limit = { 4896 = { owned_by = ROOT } }
				4896 = {
					has_trade_building_trigger = yes
					has_production_building_trigger = yes
				}
			}
			else = {
				Y27 = {
					has_opinion_modifier = {
						who = ROOT
						modifier = transfers_trade_power
					}
				}
			}
		}
		
		effect = {
			if = {
				limit = { 4896 = { owned_by = ROOT } }
				add_years_of_owned_provinces_production_income = {
					years = 2
					trigger = { province_id = 4896 }
				}
				4896 = {
					add_province_modifier = {
						name = feiten_local_trade_monopoly
						duration = 10950
					}
				}
			}
			else = {
				add_years_of_trade_income = {
					years = 2
					custom_tooltip = "Gain §G2 years§! worth of Trade Income."
				}
			}
		}
	}
}

feiten_missions_5 = {
	slot = 5
	generic = no
	ai = yes
	potential = {
		OR = {
			was_tag = Y20
			tag = Y20
		}
	}
	has_country_shield = yes

	feiten_state_whaling_expeditions = {
		icon = mission_unknown_mission
		position = 1
		required_missions = { }

		provinces_to_highlight = { }
		
		trigger = {
			num_of_light_ship = 12
			treasury = 50
		}
		
		effect = {
			add_treasury = -50
			country_event = { id = flavor_feiten.1 }
		}
	}
	feiten_first_foray_into_the_skies = {
		icon = mission_unknown_mission
		position = 3
		required_missions = {
			feiten_state_whaling_expeditions
			feiten_white_gold
		}

		provinces_to_highlight = { province_id = 4879 }
		
		trigger = {
			4879 = { renaissance = 100 }
		}
		
		effect = {
			define_advisor = {
				type = natural_scientist
				# name = 
				skill = 2
				cost_multiplier = 0.25
			}
			add_country_modifier = {
				name = feiten_starting_balloon_research
				duration = 3650
			}
		}
	}
	feiten_from_theory_to_practice = {
		icon = mission_unknown_mission
		position = 4
		required_missions = { feiten_first_foray_into_the_skies }

		provinces_to_highlight = { }
		
		trigger = {
			NOT = { has_country_modifier = feiten_starting_balloon_research }
			OR = {
				has_mil_advisor_2 = yes
				mil = 5
			}
		}
		
		effect = {
			country_event = { id = flavor_feiten.10 }
			if = {
				limit = { has_dlc = "Rule Britannia" }
				change_innovativeness = 5
			}
			else = {
				add_adm_power = 33
				add_dip_power = 33
				add_mil_power = 33
			}
		}
	}
}