
velsfadhecai_missions_1 = {
	slot = 1
	generic = no
	ai = yes
	has_country_shield = yes
	potential = {
		OR = {	
			tag = G38
			AND = {
				tag = H27
				was_tag = G38
			}
		}
	}

	G38_velsfadhecai_knives_out = {
		icon = mission_assassination
		required_missions = {}
		position = 1

		trigger = {
			has_estate_privilege = estate_mages_patronage_of_the_magical_arts
			custom_trigger_tooltip = {
				tooltip = vf_ko_advisor_tt
				OR = {
					advisor = army_reformer
					advisor = army_organiser
					advisor = commandant
					advisor = recruitmaster
					advisor = grand_captain
				}
			}
			custom_trigger_tooltip = {
				tooltip = vf_ko_friends_tt
				calc_true_if = {
					amount = 2
					all_known_country = {
						primary_culture = sarda
						has_opinion = {
							who = ROOT
							value = 80
						}
					}
				}
			}
		}

		effect = {
			country_event = {
				id = flavour_velsfadhecai.2
			}
			custom_tooltip = vf_ko_i_tt
		}
	}

	G38_velsfadhecai_beaks_bloody = {
		icon = mission_head_on_spike
		required_missions = {
			G38_velsfadhecai_knives_out
		}
		position = 2

		trigger = {
			OR = {
				G84 = {
					is_subject_of = G38
				}
				AND = {
					G84 = {
						is_subject = yes
					}
					is_in_war = {
						defenders = G84
					}
					1138 = {
						controlled_by = G38
					}
					1822 = {
						controlled_by = G38
					}
					1821 = {
						controlled_by = G38
					}
				}
			}
			if = {
				limit = {
					AND = {
						G84 = {
							is_subject = yes
						}
						NOT = {
							G84 = {
								is_subject_of = G38
							}
						}
					}
				}
				G84 = {
					overlord = {
						NOT = {
							army_size = G38
						}
					}
				}
			}
			else = {
				army_size = G84
			}
		}

		effect = {
			country_event = {
				id = flavour_velsfadhecai.3
			}
			custom_tooltip = vf_bb_i_tt 
		}
	}

}

velsfadhecai_missions_2 = {
	slot = 2
	generic = no
	ai = yes
	has_country_shield = yes
	potential = {
		OR = {	
			tag = G38
			AND = {
				tag = H27
				was_tag = G38
			}
		}
	}

	G38_velsfadhecai_swift_sudden = {
		icon = mission_heated_battle
		required_missions = {
			G38_velsfadhecai_knives_out
		}
		position = 2

		trigger = {
			custom_trigger_tooltip = {
				tooltip = vf_ss_battlewins_tt
				check_variable = {
					which = nbCharge
					value = 10
				}
			}
			custom_trigger_tooltip = {
				tooltip = vf_ss_warwins_tt
				check_variable = {
					which = VFWarsWon
					value = 2
				}
			}
		}

		effect = {
			add_country_modifier = {
				name = vf_valk
				duration = 5475
			}
			clr_country_flag = vf_count_flg
		}
	}

	G38_velsfadhecai_visions_violence = {
		icon = mission_burning_man
		required_missions = {
			G38_velsfadhecai_beaks_bloody
			G38_velsfadhecai_swift_sudden
		}
		position = 3

		trigger = {
			ynnic_iosahar = 5
			custom_trigger_tooltip = {
				tooltip = vf_vv_armysize_tt
				NOT = {
					any_known_country = {
						capital_scope = {
							region = sarda_region
						}
						army_size = ROOT
					}
				}
			}
		}

		effect = {
			add_country_modifier = {
				name = vf_augury
				duration = 3650
			}
		}
	}

}

velsfadhecai_missions_3 = {
	slot = 3
	generic = no
	ai = yes
	has_country_shield = yes
	potential = {
		OR = {
			tag = G38
			AND = {
				tag = H27
				was_tag = G38
			}
		}
	}

	G38_velsfadhecai_tidal_forces = {
		icon = mission_solaris
		required_missions = {
			G38_velsfadhecai_swift_sudden
			G38_velsfadhecai_ice_darkness
		}
		position = 3

		trigger = {
			OR = {
				custom_trigger_tooltip = {
					tooltip = vf_tf_celadildead_tt
					NOT = {
						has_ruler_flag = vf_celadil_flg
					}
				}
				NOT = {
					estate_influence = {
						estate = estate_nobles
						influence = 45
					}
				}
			}
			legitimacy = 90
			prestige = 30
		}

		effect = {
			custom_tooltip = vf_tf_revokefirstnight_tt
			hidden_effect = {
				remove_estate_privilege = estate_nobles_vf_first_night
			}
		}
	}
}

velsfadhecai_missions_4 = {
	slot = 4
	generic = no
	ai = yes
	has_country_shield = yes
	potential = {
		OR = {	
			tag = G38
			AND = {
				tag = H27
				was_tag = G38
			}
		}
	}

	G38_velsfadhecai_ice_darkness = {
		icon = mission_alone_in_the_forest
		required_missions = {
			G38_velsfadhecai_dark_forest
		}
		position = 2

		provinces_to_highlight = {
			area = hradavezl_area
			NOT = {
				OR = {
					province_id = 1840
					AND = {
						area = hradavezl_area
						infantry_in_province = G38
					}
				}
			}
		}

		trigger = {
			has_estate_privilege = estate_adventurers_generous_quest_rewards
			estate_loyalty = {
				estate = estate_adventurers
				loyalty = 50
			}
			custom_trigger_tooltip = {
				tooltip = vf_id_infantryhere_tt	
				1825 = {
					owned_by = G38
					infantry_in_province = G38
				}
				1826 = {
					owned_by = G38
					infantry_in_province = G38
				}
				1827 = {
					owned_by = G38
					infantry_in_province = G38
				}
			}
		}

		effect = {
			hidden_effect = {
				1825 = {
					kill_units = {
						who = G38
						type = infantry
						amount = 1
					}
				}
				1826 = {
					kill_units = {
						who = G38
						type = infantry
						amount = 1
					}
				}
				1827 = {
					kill_units = {
						who = G38
						type = infantry
						amount = 1
					}
				}
			}
			country_event = {
				id = flavour_velsfadhecai.4
			}
			custom_tooltip = vf_id_i_tt 
		}
	}

	G38_velsfadhecai_portents_prosperity = {
		icon = mission_the_surge
		required_missions = {
			G38_velsfadhecai_ice_darkness
			G38_velsfadhecai_under_canopy
		}
		position = 3

		provinces_to_highlight = {
			area = hradavezl_area
			NOT = {
				OR = {
					province_id = 1840
					devastation = 0
					unrest = 0
				}
			}
		}

		trigger = {
			stability = 3
			hradavezl_area = {
				OR = {
					AND = {
						NOT = {
							devastation = 0.01
						}
						NOT = {
							unrest = 0.1
						}
						owned_by = ROOT
					}
					province_id = 1840
				}
			}
			1826 = {
				fort_level = 3
			}
		}

		effect = {
			custom_tooltip = vf_upgrade_cww_tt
			hidden_effect = {
				1826 = {
					remove_province_modifier = vf_darkforest_1
					add_province_modifier = {
						name = vf_darkforest_2
						duration = -1
					}
				}
			}
			1825 = {
				add_province_modifier = {
					name = vf_tyernakrarh_1
					duration = -1
				}
			}
			1827 = {
				add_province_modifier = {
					name = vf_tyernakrarh_1
					duration = -1
				}
			}
		}
	}
}

velsfadhecai_missions_5 = {
	slot = 5
	generic = no
	ai = yes
	has_country_shield = yes
	potential = {
		OR = {	
			tag = G38
			AND = {
				tag = H27
				was_tag = G38
			}
		}
	}

	G38_velsfadhecai_dark_forest = {
		icon = mission_verdant_secret
		required_missions = {}
		position = 1

		provinces_to_highlight = {
			province_id = 1826
			if = {
				limit = {
					1826 = {
						num_of_times_improved = 5
					}
				}
				NOT = {
					province_id = 1826
				}
			}
		}

		trigger = {
			1826 = {
				num_of_times_improved = 5
			}
			custom_trigger_tooltip = {
				tooltip = vf_df_growth_tt
				OR = {
					has_country_modifier = magic_estate_scrying_rivals_3
					has_country_modifier = magic_estate_scrying_rivals_2
					has_country_modifier = magic_estate_scrying_rivals_1
				}
			}
		}

		effect = {
			1826 = {
				set_province_flag = vf_darkforest_fort_flg
				custom_tooltip = vf_df_fort_tt
				hidden_effect = {
					add_province_triggered_modifier = vf_darkforest_fort
				}
				add_province_modifier = {
					name = vf_darkforest_1
					duration = -1
				}
			}
		}
	}

	G38_velsfadhecai_under_canopy = {
		icon = mission_alone_in_the_wood
		required_missions = {
			G38_velsfadhecai_dark_forest
		}
		position = 2

		provinces_to_highlight = {
			province_id = 1825
			province_id = 1827
		}

		trigger = {
			OR = {
				AND = {
					estate_loyalty = {
						estate = estate_mages
						loyalty = 50
					}
					estate_influence = {
						estate = estate_mages
						influence = 35
					}
				}
				court_mage = 2
			}
			1825 = {
				num_of_buildings_in_province = 2
			}
			1827 = {
				num_of_buildings_in_province = 1
			}
		}

		effect = {
			1826 = {
				add_province_modifier = {
					name = vf_tyernakrarh_1
					duration = -1
				}
			}
			add_country_modifier = {
				name = vf_goodtidings
				duration = 3650
			}
			if = {
				limit = {
					NOT = {
						has_dlc = "Mandate of Heaven"
					}
				}
				add_treasury = 100
			}
			else = {
				if = {
					limit = {
						hradavezl_area = {
							is_prosperous = yes
						}
					}
					add_treasury = 100
				}
				else = {
					hradavezl_area = {
						add_prosperity = 25
					}
				}
			}
		}
	}

	G38_velsfadhecai_beckoning_waters = {
		icon = mission_market
		required_missions = {
			G38_velsfadhecai_under_canopy
		}
		position = 3

		provinces_to_highlight = {

		}

		trigger = {
			1826 = {
				has_building = marketplace
			}
			if = {
				limit = { 
					has_dlc = "Cradle of Civilization" 
				}
				trading_policy_in_node = {
					node = 1139
					policy = establish_communities
				}
			}
			else = {
				NOT = {
					num_of_loans = 1
				}
				treasury = 50
			}
			custom_trigger_tooltip = {
				tooltip = vf_bw_friends_tt
				calc_true_if = {
					amount = 6
					all_known_country = { 
						culture_group = ynnic_ruinborn_elf
						has_opinion = {
							who = ROOT
							value = 120
						}
					}
				}
			}
		}

		effect = {
			1826 = {
				center_of_trade = 1
			}
		}
	}
}